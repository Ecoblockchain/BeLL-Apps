$(function(){App.Views.ConfigurationView=Backbone.View.extend({template:$("#template-Configuration").html(),template:_.template($("#template-Configuration").html()),vars:{},events:{"click #saveLanguage":function(e){var t=false;var i=$("#languageSelection").val();if(i!=""){this.model.set("currentLanguage",i);t=true}if($("#appversion").val()!=""){this.model.set("version",$("#appversion").val());t=true}if($("#notes").val()!=""){this.model.set("notes",$("#notes").val());t=true}if(t){var s=this;console.log(this.model.toJSON());this.model.save(null,{success:function(e,t){s.model.set("_rev",e.get("rev"))}});alert("Configuration saved.");location.reload()}else{alert("You have not changed any thing.")}}},render:function(){this.vars=this.model.toJSON();this.$el.html(this.template(this.vars));this.$el.append('<br>&nbsp;&nbsp;<button class="btn btn-success" id="saveLanguage" >Save</button>')}})});$(function(){window.isActivityLogChecked=false;App.Views.listSyncDbView=Backbone.View.extend({id:"invitationForm",events:{"click #cancelButton":"hidediv","click #formButton":"syncData","click #selectAll":"selectAll"},hidediv:function(){$("#invitationdiv").fadeOut(1e3);setTimeout(function(){$("#invitationdiv").hide()},1e3)},render:function(){var e=$('<h6>Select Item(\'s) To Sync</h6><br><br><input type="checkbox" value="ActivityReports" name="syncData">Log Activity Reports<br><input type="checkbox" value="Reports" name="syncData">Reports<br><input type="checkbox" value="ResourcesFeedbacks" name="syncData">Resources Feedbacks<br><input type="checkbox" value="ApplicationFeedbacks" name="syncData">Application Feedbacks<br><input type="checkbox" value="MembersDb" name="syncData">Members Database<br>');this.$el.append(e);this.$el.append('<button class="btn btn-info" id="selectAll" style="width:110px">Select All</button><button style="margin-left:10px; width:110px" class="btn btn-success" id="formButton" style="width:110px">Send</button>');this.$el.append('<button class="btn btn-warning" id="cancelButton" style="width:110px;margin-left:10px">Cancel</button>')},selectAll:function(){if($("#selectAll").text()=="Select All"){$("input[name='syncData']").each(function(){$(this).prop("checked",true)});$("#selectAll").text("Unselect All")}else{$("input[name='syncData']").each(function(){$(this).prop("checked",false)});$("#selectAll").text("Select All")}},syncData:function(){var e=this;App.startActivityIndicator();$("input[name='syncData']").each(function(){if($(this).is(":checked")){if($(this).val()=="Resources"){e.ReplicateResource()}else if($(this).val()=="ActivityReports"){isActivityLogChecked=true;e.syncLogActivitiy()}else if($(this).val()=="Reports"){e.syncReports()}else if($(this).val()=="ResourcesFeedbacks"){e.syncResourcesFeedbacks()}else if($(this).val()=="ApplicationFeedbacks"){e.syncApplicationFeedbacks()}else if($(this).val()=="MembersDb"){e.syncMembersDb()}if($(this).val()=="Application"){e.checkAvailableUpdates()}}});$("#invitationdiv").fadeOut(1e3);setTimeout(function(){$("#invitationdiv").hide()},1e3)},ReplicateResource:function(){App.startActivityIndicator();var e=this;var t=$.url().attr("host").split(".");var i=$.url().attr("host");var s="";var n="";var o="";var a=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var l=new a;l.fetch({async:false});var r=l.first();var c=r.toJSON();o=c.rows[0].doc.type;s=c.rows[0].doc.nationUrl;n=c.rows[0].doc.nationName;App.$el.children(".body").html("Please Wait…");var d="";var u="";$.ajax({url:"http://"+n+":"+App.password+"@"+s+":5984/communities/_all_docs?include_docs=true",type:"GET",dataType:"jsonp",success:function(t){for(var i=0;i<t.rows.length;i++){var a=t.rows[i];var l=a.doc.url;var r=a.doc.name;u=d;d=d+"<br>Replicating to "+r+". Please wait…";App.$el.children(".body").html(d);e.synchCommunityWithURL(l,r);d=u;d=d+"<br>Replication to "+r+" is complete.";App.$el.children(".body").html(d)}if(o!="nation"){u=d;d=d+"<br>Replicating to "+r+". Please wait…";e.synchCommunityWithURL(s,n);d=u;d=d+"<br>Replication to "+r+" is complete.<br>Replication completed."}}})},synchCommunityWithURL:function(e,t){console.log("http://"+t+":"+App.password+"@"+e+":5984/resources");$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"resources",target:"http://"+t+":"+App.password+"@"+e+":5984/resources"}),success:function(e){},async:false})},syncReports:function(){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"communityreports",target:"http://"+App.configuration.get("nationName")+":"+App.password+"@"+App.configuration.get("nationUrl")+"/communityreports"}),success:function(e){alert("Successfully Replicated Reports");if(isActivityLogChecked==false){App.stopActivityIndicator()}},error:function(e,t,i){alert("Error (Try Later)")}})},syncLogActivitiy:function(){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"activitylog",target:"http://"+App.configuration.get("nationName")+":"+App.password+"@"+App.configuration.get("nationUrl")+"/activitylog"}),success:function(e){$.ajax({url:"http://"+App.configuration.get("nationName")+":oleoleole@"+App.configuration.get("nationUrl")+'/community/_design/bell/_view/getCommunityByCode?_include_docs=true&key="'+App.configuration.get("code")+'"',type:"GET",dataType:"jsonp",success:function(e){var t=e.rows[0].value;var i=e.rows[0].id;$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+App.configuration.get("nationName")+":oleoleole@"+App.configuration.get("nationUrl")+"/community",target:"community",doc_ids:[i]}),success:function(e){console.log("Successfully Replicated.");var s=new Date;var n=s.getFullYear();var o=(1+s.getMonth()).toString();o=o.length>1?o:"0"+o;var a=s.getDate().toString();a=a.length>1?a:"0"+a;var l=o+"-"+a+"-"+n;t.lastActivitiesSyncDate=o+"/"+a+"/"+n;$.ajax({headers:{Accept:"application/json","Content-Type":"multipart/form-data"},type:"PUT",url:App.Server+"/community/"+i+"?rev="+t._rev,dataType:"json",data:JSON.stringify(t),success:function(e){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"community",target:"http://"+App.configuration.get("nationName")+":oleoleole@"+App.configuration.get("nationUrl")+"/community",doc_ids:[i]}),success:function(e){alert("Successfully Replicated Log Activity Reports");App.stopActivityIndicator()},async:false})},async:false})},async:false})},error:function(){console.log("http://"+nationName+":oleoleole@"+nationURL+'/community/_design/bell/_view/getCommunityByCode?key="'+App.configuration.get("code")+'"')}})},error:function(e,t,i){alert("Error (Try Later)")}})},syncResourcesFeedbacks:function(){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"feedback",target:"http://"+App.configuration.get("nationName")+":"+App.password+"@"+App.configuration.get("nationUrl")+"/feedback"}),success:function(e){alert("Successfully Replicated Resources Feedbacks");if(isActivityLogChecked==false){App.stopActivityIndicator()}},error:function(e,t,i){alert("Error (Try Later)")}})},syncApplicationFeedbacks:function(){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"report",target:"http://"+App.configuration.get("nationName")+":"+App.password+"@"+App.configuration.get("nationUrl")+"/report"}),success:function(e){alert("Successfully Replicated Application Feedbacks");if(isActivityLogChecked==false){App.stopActivityIndicator()}},error:function(e,t,i){alert("Error (Try Later)")}})},syncMembersDb:function(){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"members",target:"http://"+App.configuration.get("nationName")+":"+App.password+"@"+App.configuration.get("nationUrl")+"/members",filter:"bell/adminFilter"}),success:function(e){alert("Members database replicated.");if(isActivityLogChecked==false){App.stopActivityIndicator()}},error:function(e,t,i){alert("Error (Try Later)")}})},versionCompare:function(e,t,i){var s=i&&i.lexicographical;zeroExtend=i&&i.zeroExtend;v1parts=e.split(".");v2parts=t.split(".");function n(e){return(s?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}if(!v1parts.every(n)||!v2parts.every(n)){return NaN}if(zeroExtend){while(v1parts.length<v2parts.length)v1parts.push("0");while(v2parts.length<v1parts.length)v2parts.push("0")}if(!s){v1parts=v1parts.map(Number);v2parts=v2parts.map(Number)}for(var o=0;o<v1parts.length;++o){if(v2parts.length==o){return 1}if(v1parts[o]==v2parts[o]){continue}else if(v1parts[o]>v2parts[o]){return 1}else{return-1}}if(v1parts.length!=v2parts.length){return-1}return 0},checkAvailableUpdates:function(){var e=this;var t;var i=new App.Collections.Configurations;i.fetch({success:function(e){t=e.first()},async:false});var s=t.get("nationName");var n=t.get("nationUrl");var o="http://"+s+":oleoleole@"+n+":5984/configurations/_all_docs?include_docs=true";$.ajax({url:o,type:"GET",dataType:"jsonp",success:function(i){var s=i.rows[0].doc;nationConfigJson=s;if(typeof s.version==="undefined"){}else if(s.version==t.get("version")){}else{if(e.versionCompare(s.version,t.get("version"))<0){console.log("Nation is at low level")}else if(e.versionCompare(s.version,t.get("version"))>0){e.updateApp()}else{console.log("Nation is uptodate")}}}});return},updateApp:function(){var e=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var t=new e;t.fetch({async:false});var i=t.first().toJSON().rows[0].doc;i.version=this.latestVersion;var s=i.nationName;var n=i.nationUrl;$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+s+":oleoleole@"+n+":5984/apps",target:"apps"}),success:function(e){console.log(e)},async:false});$.ajax({headers:{Accept:"application/json","Content-Type":"multipart/form-data"},type:"PUT",url:App.Server+"/configurations/"+i._id+"?rev="+i._rev,dataType:"json",data:JSON.stringify(i),success:function(e){console.log(e);alert("Successfully updated to latest version.")},async:false})}})});$(function(){App.Views.MemberLoginForm=Backbone.View.extend({className:"form login-form",events:{"keypress .bbf-form":"listenToEnterForSubmit","click #formButton":"setForm","submit form":"setFormFromEnterKey","click #formButton2":"signup","click #welcomeButton":"showWelcomeVideo"},listenToEnterForSubmit:function(e){if(e.keyCode==13){this.setForm()}},render:function(){var e=this;var t=new App.Collections.Resources;t.setUrl(App.Server+"/resources/_design/bell/_view/welcomeVideo");t.fetch({success:function(){if(t.length>0){var i=t.models[0].attributes.id;var s="/apps/_design/bell/bell-resource-router/index.html#openres/"+i;var n=$('<a id="welcomeButton" class="login-form-button btn btn-block btn-lg btn-success" target="_blank" href="hmmm" style="margin-left: -4px;margin-top: -21px; font-size:27px;">Welcome</button>');e.$el.append(n);e.$el.find("#welcomeButton").attr("href",s)}},error:function(){console.log("Error in fetching welcome video doc from db")},async:false});this.form=new Backbone.Form({model:this.model});this.$el.append(this.form.render().el);var i=$('<a class="login-form-button btn btn-block btn-lg btn-success" style="margin-left: -4px;margin-top: -21px; font-size:27px;" id="formButton">Sign In</button>');var s=$('<div class="signup-div" ><a style="margin-left: -4px;margin-top: -21px; font-size:22px;" class="signup-form-button btn btn-block btn-lg btn-info" id="formButton2">Become A Member</button></div>');this.$el.append(i);this.$el.append(s)},showWelcomeVideo:function(){},setFormFromEnterKey:function(e){e.preventDefault();this.setForm()},signup:function(){Backbone.history.navigate("member/add",{trigger:true})},setForm:function(){var e=this;this.form.commit();var t=this.form.model;var i=new App.Collections.Members;var s;i.login=t.get("login");i.fetch({success:function(){if(i.length>0){s=i.first();if(s&&s.get("password")==t.get("password")&&s.get("login")==t.get("login")){if(s.get("status")=="active"){App.member=s;var n=parseInt(s.get("visits"));n++;s.set("visits",n);s.once("sync",function(){});s.save(null,{success:function(e,t){}});e.logActivity(s);var o=new Date;$.cookie("Member.login",s.get("login"),{path:"/apps/_design/bell"});$.cookie("Member._id",s.get("_id"),{path:"/apps/_design/bell"});$.cookie("Member.expTime",o,{path:"/apps/_design/bell"});$.cookie("Member.roles",s.get("roles"),{path:"/apps/_design/bell"});if(parseInt(s.get("visits"))==1&&s.get("roles").indexOf("SuperManager")!=-1){Backbone.history.navigate("configuration/add",{trigger:true});return}e.trigger("success:login")}else{alert("Your Account Is Deactivated")}}else{alert("Login or Password Incorrect")}}else{alert("Login or Password Incorrect.")}}})},logActivity:function(e){var t=this;var i=new PouchDB("activitylogs");var s=new Date;var n=this.getFormattedDate(s);i.get(n,function(s,o){if(!s){t.UpdatejSONlog(e,o,i,n)}else{t.createJsonlog(e,n,i)}})},UpdatejSONlog:function(e,t,i,s){var n=e.get("roles").indexOf("SuperManager");if(e.get("Gender")=="Male"){var o=parseInt(t.male_visits);if(n==-1){o++}t.male_visits=o}else{var o=parseInt(t.female_visits);if(n==-1){o++}t.female_visits=o}t.community=App.configuration.get("code");i.put(t,s,t._rev,function(e,t){if(!e){console.log("MemberLoginForm:: updated daily log from pouchdb for today..")}else{console.log("MemberLoginForm:: UpdatejSONlog:: err making update to record");console.log(e)}})},getFormattedDate:function(e){var t=e.getFullYear();var i=(1+e.getMonth()).toString();i=i.length>1?i:"0"+i;var s=e.getDate().toString();s=s.length>1?s:"0"+s;return i+"/"+s+"/"+t},createJsonlog:function(e,t,i){var s=e.get("roles").indexOf("SuperManager");var n={logDate:t,resourcesIds:[],male_visits:0,female_visits:0,male_timesRated:[],female_timesRated:[],male_rating:[],community:App.configuration.get("code"),female_rating:[],resources_names:[],resources_opened:[],male_opened:[],female_opened:[],male_deleted_count:0,female_deleted_count:0};if(e.get("Gender")=="Male"){var o=parseInt(n.male_visits);if(s==-1){o++}n.male_visits=o}else{var o=parseInt(n.female_visits);if(s==-1){o++}n.female_visits=o}n.community=App.configuration.get("code"),i.put(n,t,function(e,t){if(!e){console.log("MemberLoginForm:: created activity log in pouchdb for today..")}else{console.log("MemberLoginForm:: createJsonlog:: error creating/pushing activity log doc in pouchdb..");console.log(e)}})}})});$(function(){App.Views.navBarView=Backbone.View.extend({tagName:"ul",className:"nav",id:"itemsinnavbar",authorName:null,template1:_.template($("#template-nav-logged-in").html()),template0:_.template($("#template-nav-log-in").html()),initialize:function(e){if(e.isLoggedIn==0){this.template=this.template0}else{this.template=this.template1}var t=Backbone.history.location.href;t=t.split("#");var i="";if(!App.configuration){var s=new App.Collections.Configurations;s.fetch({async:false});var n=s.first();App.configuration=n}if(!App.languageDict){var o=App.configuration.get("currentLanguage");var a=new App.Collections.Languages;a.fetch({async:false});var l=a.first().toJSON();var r=l[o];App.languageDict=l[o]}i=App.configuration.get("version");this.data={uRL:t[1],versionNO:i,languageDict:App.languageDict};this.$el.append(this.template(this.data));if(!App.member&&$.cookie("Member._id")){var c=new App.Models.Member;c.set("_id",$.cookie("Member._id"));c.fetch({async:false,success:function(e,t){App.member=e},error:function(){App.Router.expireSession();Backbone.history.stop();App.start()}})}},render:function(){}})});$(function(){App.Views.MemberForm=Backbone.View.extend({className:"form",id:"memberform",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey","click #formButtonCancel":function(){window.history.back()},"click #deactive":function(e){e.preventDefault();var t=this;this.model.on("sync",function(){location.reload()});this.model.save({status:"deactive"},{success:function(){}})},"click #ptManager":function(e){},"click #active":function(e){e.preventDefault();var t=this;this.model.on("sync",function(){location.reload()});this.model.save({status:"active"},{success:function(){}})}},getRoles:function(e){var t=e?new App.Models.Member({_id:e}):new App.Models.Member({_id:$.cookie("Member._id")});t.fetch({async:false});var i=t.get("roles");return i},render:function(){this.form=new Backbone.Form({model:this.model});var e="";this.$el.append(this.form.render().el);this.form.fields["status"].$el.hide();this.form.fields["yearsOfTeaching"].$el.hide();this.form.fields["teachingCredentials"].$el.hide();this.form.fields["subjectSpecialization"].$el.hide();this.form.fields["forGrades"].$el.hide();this.form.fields["visits"].$el.hide();this.form.setValue({community:App.configuration.get("name"),region:App.configuration.get("region"),nation:App.configuration.get("nationName")});$("input[name='community']").attr("disabled",true);$("input[name='region']").attr("disabled",true);$("input[name='nation']").attr("disabled",true);var t="<p id='imageText' style='margin-top: 15px;'></p>";if(this.model.id!=undefined){e="Update";$("input[name='login']").attr("disabled",true)}else{e="Register"}var i=$('<div class="signup-submit"><a class="btn btn-success" id="formButton" style="margin-top: 10px;">'+e+'</button><a class="btn btn-danger" id="formButtonCancel" style="margin-top: 10px;">Cancel</button></div>');var s=$('<form method="post" id="fileAttachment" ><input type="file" name="_attachments" style="margin-left: 170px;" id="_attachments" multiple="multiple" /> <input class="rev" type="hidden" name="_rev"></form>');var n=$('<div id="browseImage" >'+t+'<img style="width:100px;height:100px;border-radius:50px" id="memberImage"></div>');this.$el.append(n);this.$el.append(s);this.$el.append(i);if(this.model.id!=undefined){if(this.model.get("status")=="active"){$(".signup-submit").append('<a class="btn btn-danger" id="deactive" href="#" style="margin-top: 10px;">Resign</a>')}else{$(".signup-submit").append('<a class="btn btn-success" id="active" style="margin-top: 10px;" href="#">Reinstate</a>')}var o=this.getRoles(false);if(o.indexOf("SuperManager")>-1){var a=this.getRoles(this.model.id);$("#memberform").append('<div style="margin-left: 170px;margin-top: -40px;"><input id="ptManager" type="checkbox" ><label for="ptManager">Promote To Manager</label></div>');if(a.indexOf("Manager")>-1){$("#ptManager").prop("checked",true)}}}var l="/members/"+this.model.id+"/";if(typeof this.model.get("_attachments")!=="undefined"){l=l+_.keys(this.model.get("_attachments"))[0];document.getElementById("memberImage").src=l}},validImageTypeCheck:function(e){if(e.val()==""){return 1}var t=e.val().split(".");console.log(t[t.length-1]);if(t[t.length-1]=="jpeg"||t[t.length-1]=="jpg"||t[t.length-1]=="png"||t[t.length-1]=="JPG"){return 1}alert("ERROR: Not a valid image file \n\n Valid Extensions are  [.jpg, .jpeg ]");return 0},setFormFromEnterKey:function(e){e.preventDefault();this.setForm()},setForm:function(){if($("#ptManager").attr("checked")){var e=this.model.toJSON().roles.indexOf("Manager");if(e<0){this.model.toJSON().roles.push("Manager")}}else{var e=this.model.toJSON().roles.indexOf("Manager");if(e>-1){this.model.toJSON().roles.splice(e,1)}}var t=this;if(this.form.validate()!=null){return}if(this.validImageTypeCheck($('input[type="file"]'))){var i=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var s=new i;s.fetch({async:false});console.log("---***********---");console.log(s);console.log(s.first().toJSON());var n=s.first().toJSON().rows[0].doc;this.form.setValue({status:"active",community:n.code,region:n.region,nation:n.nationName});this.form.commit();if($.inArray("lead",this.model.get("roles"))==-1){t.model.set("yearsOfTeaching",null);t.model.set("teachingCredentials",null);t.model.set("subjectSpecialization",null);t.model.set("forGrades",null)}var o=true;if(this.model.get("_id")==undefined){this.model.set("roles",["Learner"]);this.model.set("visits",0);var a=new App.Collections.Members;a.login=t.model.get("login");a.fetch({async:false,success:function(){a=a.first();if(a!=undefined){if(a.toJSON().login!=undefined){alert("Login already exist");o=false}}}})}if(o){var l=this.model;this.model.save(null,{success:function(){t.model.unset("_attachments");if($('input[type="file"]').val()){t.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev")}else{if(t.model.attributes._rev==undefined){var e=new PouchDB("activitylogs");var i=new Date;var s=t.getFormattedDate(i);e.get(s,function(i,o){if(!i){t.UpdatejSONlog(s,o,l,e)}else{t.createJsonlog(s,n,l,e)}})}else{alert("Successfully Updated!!!");Backbone.history.navigate("members",{trigger:true})}}t.model.on("savedAttachment",function(){if(t.model.attributes._rev==undefined){var e=new PouchDB("activitylogs");var i=new Date;var s=t.getFormattedDate(i);e.get(s,function(i,o){if(!i){t.UpdatejSONlog(s,o,l,e)}else{t.createJsonlog(s,n,l,e)}})}else{alert("Successfully Updated!!!");Backbone.history.navigate("members",{trigger:true})}},t.model)}})}}},getFormattedDate:function(e){var t=e.getFullYear();var i=(1+e.getMonth()).toString();i=i.length>1?i:"0"+i;var s=e.getDate().toString();s=s.length>1?s:"0"+s;return i+"/"+s+"/"+t},createJsonlog:function(e,t,i,s){var n={logDate:e,resourcesIds:[],male_visits:0,female_visits:0,female_new_signups:0,male_new_signups:0,male_timesRated:[],female_timesRated:[],male_rating:[],community:t.code,female_rating:[],resources_names:[],resources_opened:[],male_opened:[],female_opened:[],male_deleted_count:0,female_deleted_count:0};if(i.get("Gender")=="Male"){n.male_new_signups=1}else{n.female_new_signups=1}s.put(n,e,function(t,i){if(!t){console.log("created activity log in pouchdb for today.. i-e "+e);console.log(i)}else{console.log("MyApp::MemberForm.js (view):: createJsonlog: error creating activity log doc in pouchdb..");console.log(t)}alert("Successfully Registered!!!");Backbone.history.navigate("members",{trigger:true})})},UpdatejSONlog:function(e,t,i,s){if(i.get("Gender")=="Male"){t.male_new_signups=parseInt(t.male_new_signups?t.male_new_signups:0)+1}else{t.female_new_signups=parseInt(t.female_new_signups?t.female_new_signups:0)+1}s.put(t,e,t._rev,function(t,i){if(!t){console.log("updated activity log in pouchdb for today.. i-e "+e);console.log(i)}else{console.log("MyApp::MemberForm.js (view):: UpdatejSONlog: err making update to record");console.log(t)}alert("Successfully Registered!!!");Backbone.history.navigate("members",{trigger:true})})}})});$(function(){App.Views.siteFeedback=Backbone.View.extend({tagName:"div",id:"site-feedback",authorName:null,initialize:function(){},events:{"click #formButton":"setForm","click #CancelButton":"cancelform","click #ViewAllButton":"gotoRoute"},gotoRoute:function(){Backbone.history.navigate("siteFeedback",{trigger:true})},cancelform:function(){$("#site-feedback").animate({height:"toggle"});this.unsetForm()},setForm:function(){if($("#comment").val().length!=0&&$('input[name="category"]:checked').val()){var e=Backbone.history.location.href;var t=new Date;t.getDate();e=e.split("#");var i="";if($("#priority").is(":checked")){i="urgent"}this.model.set({comment:$("#comment").val(),category:$('input[name="category"]:checked').val(),priority:i,PageUrl:"Personal:"+e[1],Resolved:"0",memberLogin:$.cookie("Member.login"),time:t.toString(),communityCode:App.configuration.get("code")});this.model.save();alert("Feedback Successfully Sent");this.unsetForm()}$("#site-feedback").animate({height:"toggle"})},unsetForm:function(){$("#comment",this.$el).val("");$('input[name="category"]').attr("checked",false);$("#priority").attr("checked",false)},render:function(){this.$el.append('<br/><br/><div class="form-field" ><input name="PageUrl" id="PageUrl" type="text"></div>');this.$el.append('<div class="form-field" style="margin-left:23px;"><input name="priority" value="urgent" id="priority" type="checkbox"><label for="priority">urgent</label></div>');this.$el.append('<div class="form-field" style="margin-top: -19px;margin-left: 115px;"> <input type="radio" name="category" value="Bug">&nbsp Bug &nbsp&nbsp&nbsp<input type="radio" name="category" value="Question">&nbsp Question &nbsp&nbsp&nbsp<input type="radio" name="category" value="Suggestion">&nbsp Suggestion &nbsp&nbsp&nbsp</div><br/><br/>');this.$el.append('<div class="form-field" style="margin-left:23px;"><textarea †rows="7" type="text" name="comment" placeholder="Give us your feedback on the current page ... " id="comment"></textarea></div>');this.$el.append('<div class="form-field"><input name="Resolved" id="Resolved" type="text"></div>');this.$el.append('<div class="form-field"><input name="memberLogin" id="memberLogin" type="text"></div>');this.$el.append('<div class="form-field"><input name="time" id="time" type="text"></div>');$("#PageUrl",this.$el).hide();$("#Resolved",this.$el).hide();$("#memberLogin",this.$el).hide();$("#time",this.$el).hide();var e=$('<br/><div id="f-formButton"><button class="btn btn-hg btn-danger" id="CancelButton">Cancel</button><button class="btn btn-hg btn-info" id="ViewAllButton">View</button><button class="btn btn-hg btn-primary" id="formButton">Submit</button></div>');this.$el.append(e)}})});$(function(){App.Views.Dashboard=Backbone.View.extend({template:$("#template-Dashboard").html(),vars:{},nationConfiguration:null,latestVersion:null,nationConfigJson:null,events:{"click #updateButton":"updateVersion","click #showReleaseNotesDiv":function(e){if($("#releaseVersion").css("display")=="none"){$("#releaseVersion").slideDown("slow",function(){})}else{$("#releaseVersion").slideUp("slow",function(){$("#appversion").val("");$("#notes").val("")})}},"click #cancelnotes":function(e){$("#releaseVersion").slideUp("slow",function(){$("#appversion").val("");$("#notes").val("")})},"click #savenotes":function(e){if($("#appversion").val()==""){alert("Please enter version no.");return}if($("#notes").val()==""){alert("Please enter release notes.");return}var t=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var i=new t;i.fetch({async:false});var s=i.first();s=s.get("rows")[0].doc;var n=new App.Models.ReleaseNotes({_id:s._id});n.fetch({async:false});n.set("version",$("#appversion").val());n.set("notes",$("#notes").val());n.save(null,{success:function(e){$("#releaseVersion").slideUp("slow",function(){$("#appversion").val("");$("#notes").val("");alert("Notes successfully saved.")})}})},"click #viewReleaseNotes":function(e){if($("#showReleaseNotes").css("display")=="none"){$("#showReleaseNotes").slideDown("slow",function(){$("textarea#shownotes").val(nationConfigJson.notes)})}else{$("#showReleaseNotes").slideUp("slow",function(){})}}},updateVersion:function(e){var t=this;App.startActivityIndicator();var i=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var s=new i;s.fetch({async:false});var n=s.first().toJSON().rows[0].doc;n.version=this.latestVersion;var o=n.nationName;var a=n.nationUrl;$.ajax({url:"http://"+o+":oleoleole@"+a+'/community/_design/bell/_view/getCommunityByCode?_include_docs=true&key="'+App.configuration.get("code")+'"',type:"GET",dataType:"jsonp",success:function(e){if(e.rows.length>0){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+o+":oleoleole@"+a+"/apps",target:"apps"}),async:false,success:function(e){$.ajax({headers:{Accept:"application/json","Content-Type":"multipart/form-data"},type:"PUT",url:App.Server+"/configurations/"+n._id+"?rev="+n._rev,dataType:"json",data:JSON.stringify(n),success:function(e){console.log("Configurations Updated")},async:false});t.updateDesignDocs("activitylog");t.updateDesignDocs("members");t.updateDesignDocs("collectionlist");t.updateDesignDocs("community");t.updateDesignDocs("resources");t.updateDesignDocs("coursestep");t.updateDesignDocs("groups");t.updateDesignDocs("publications")},error:function(){App.stopActivityIndicator();alert("Not Replicated!")}});var i=e.rows[0].value;var s=e.rows[0].id;$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+o+":oleoleole@"+a+"/community",target:"community",doc_ids:[s]}),success:function(e){console.log("Successfully Replicated.");var t=new Date;var l=t.getFullYear();var r=(1+t.getMonth()).toString();r=r.length>1?r:"0"+r;var c=t.getDate().toString();c=c.length>1?c:"0"+c;var d=r+"-"+c+"-"+l;i.lastAppUpdateDate=r+"/"+c+"/"+l;i.version=n.version;$.ajax({headers:{Accept:"application/json","Content-Type":"multipart/form-data"},type:"PUT",url:App.Server+"/community/"+s+"?rev="+i._rev,dataType:"json",data:JSON.stringify(i),success:function(e){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"community",target:"http://"+o+":oleoleole@"+a+"/community",doc_ids:[s]}),success:function(e){alert("Updated Successfully");window.location.reload(false)},async:false})},async:false})},async:false})}else{alert(" The community is not authorized to update until it is properly configured with a nation");window.location.reload(false)}},error:function(){console.log("http://"+o+":oleoleole@"+a+'/community/_design/bell/_view/getCommunityByCode?key="'+App.configuration.get("code")+'"')}})},updateDesignDocs:function(e){var t=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var i=new t;i.fetch({async:false});var s=i.first().toJSON().rows[0].doc;s.version=this.latestVersion;var n=s.nationName;var o=s.nationUrl;$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+n+":oleoleole@"+o+"/"+e,target:e,doc_ids:["_design/bell"]}),success:function(t){console.log(e+" DesignDocs successfully updated.")},async:false})},render:function(){var e=this;this.vars.mails=0;var t=App.configuration.get("currentLanguage");var i=App.configuration.get("type");console.log(App.languageDict);console.log(t);this.vars.languageDict=App.languageDict;this.vars.imgURL="img/header_slice.png";var s=new App.Collections.MailUnopened({receiverId:$.cookie("Member._id")});s.fetch({async:false});this.vars.mails=s.length;this.$el.html(_.template(this.template,this.vars));groups=new App.Collections.MemberGroups;groups.memberId=$.cookie("Member._id");groups.fetch({success:function(e){groupsSpans=new App.Views.GroupsSpans({collection:groups});groupsSpans.render();$("#cc").append(groupsSpans.el);TutorsSpans=new App.Views.TutorsSpans({collection:groups});TutorsSpans.render();$("#tutorTable").append(TutorsSpans.el)}});shelfSpans=new App.Views.ShelfSpans;shelfSpans.render();UserMeetups=new App.Collections.UserMeetups;UserMeetups.memberId=$.cookie("Member._id");UserMeetups.fetch({async:false});MeetupSpans=new App.Views.MeetupSpans({collection:UserMeetups});MeetupSpans.render();$("#meetUpTable").append(MeetupSpans.el);$(".now").html(moment().format("dddd | DD MMMM, YYYY"));var n=App.member;var o="/members/"+n.id+"/";if(typeof n.get("_attachments")!=="undefined"){
o=o+_.keys(n.get("_attachments"))[0];document.getElementById("imgurl").src=o}var a;var l=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var r=new l;r.fetch({async:false,success:function(){a=r.first().toJSON().rows[0].doc}});var c=a.name;var i=a.type;c=c.charAt(0).toUpperCase()+c.slice(1);if(i==="nation"){c=c+" Nation Bell"}else{c=c+" Community Bell"}$(".bellLocation").html(c);if(!n.get("visits")){n.set("visits",1);n.save()}if(parseInt(n.get("visits"))==0){temp="Error!!"}else{temp=n.get("visits")+" visits"}var d="&nbsp;-&nbsp;";var u=0;if(n.get("roles").indexOf("Learner")!=-1){d=d+"Learner";u=1}if(n.get("roles").indexOf("Leader")!=-1){if(u==1){d=d+",&nbsp;"}d=d+"Leader";u=1}if(n.get("roles").indexOf("Manager")!=-1){if(u==1){d=d+",&nbsp;"}if(i=="nation"){d=d+'<a href="../nation/index.html#dashboard">Manager</a>'}else{d=d+'<a href="#communityManage">Manager</a>'}}$(".visits").html(temp);$(".name").html(n.get("firstName")+" "+n.get("lastName")+'<span style="font-size:15px;">'+d+"</span>"+'&nbsp;<a href="#member/edit/'+$.cookie("Member._id")+'"><i class="fui-gear"></i></a>');e.checkAvailableUpdates(n.get("roles"),e);if($.cookie("Member.login")==="admin"){var p=$('<button id="welcomeButton" class="btn btn-hg btn-primary" onclick="document.location.href=\'#updatewelcomevideo\'">Update Welcome Video</button>');e.$el.append(p)}},checkAvailableUpdates:function(e,t){var i=this;if($.inArray("Manager",e)==-1){return}var s=App.configuration;var n=s.get("nationName");var o=s.get("nationUrl");var a="http://"+n+":oleoleole@"+o+"/configurations/_all_docs?include_docs=true";nName=App.configuration.get("nationName");pass=App.password;nUrl=App.configuration.get("nationUrl");currentBellName=App.configuration.get("name");var l=this.$el;var r="http://"+nName+":"+pass+"@"+nUrl+'/publicationdistribution/_design/bell/_view/getPublications?include_docs=true&key=["'+currentBellName+'",'+false+"]";$.ajax({url:a,type:"GET",dataType:"jsonp",success:function(e){var n=e.rows[0].doc;nationConfigJson=n;if(typeof n.version==="undefined"){}else if(n.version==s.get("version")){}else{if(i.versionCompare(n.version,s.get("version"))<0){console.log("Nation has lower application version than that of your community application")}else if(i.versionCompare(n.version,s.get("version"))>0){t.latestVersion=n.version;t.$el.append('<button class="btn systemUpdate" id="updateButton">System Update Available ('+n.version+") </button>");t.$el.append('<button class="btn systemUpdate" id="viewReleaseNotes">View Release Notes </button>')}else{console.log("Nation is uptodate")}}},error:function(e,t,i){console.log('Error fetching application version from nation "'+s.nationName+'"');console.log(t);console.log(i)}});$.ajax({url:r,type:"GET",dataType:"jsonp",success:function(e){var i=[],s=[];_.each(e.rows,function(e){i.push(e.doc);s.push(e.doc.publicationId)});var n=0;var o=new App.Collections.Publication;var a=App.Server+"/publications/_design/bell/_view/allPublication?include_docs=true";o.setUrl(a);o.fetch({success:function(){var e=o.models;for(var s in i){var a=e.map(function(e){return e.get("_id")}).indexOf(i[s].publicationId);if(a>-1){}else{n++}}if(n>0)t.$el.append('<a class="btn systemUpdate" id="newPublication" href="#publications/for-'+currentBellName+'">Publications (new '+n+")</a>")}})},error:function(e,t,i){console.log(e);console.log(t);console.log(i)}})},versionCompare:function(e,t,i){var s=i&&i.lexicographical;zeroExtend=i&&i.zeroExtend;v1parts=e.split(".");v2parts=t.split(".");function n(e){return(s?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}if(!v1parts.every(n)||!v2parts.every(n)){return NaN}if(zeroExtend){while(v1parts.length<v2parts.length)v1parts.push("0");while(v2parts.length<v1parts.length)v2parts.push("0")}if(!s){v1parts=v1parts.map(Number);v2parts=v2parts.map(Number)}for(var o=0;o<v1parts.length;++o){if(v2parts.length==o){return 1}if(v1parts[o]==v2parts[o]){continue}else if(v1parts[o]>v2parts[o]){return 1}else{return-1}}if(v1parts.length!=v2parts.length){return-1}return 0}})});$(function(){App.Views.GroupSpan=Backbone.View.extend({tagName:"td",className:"course-box",template:$("#template-GroupSpan").html(),render:function(){if(this.model.keys().length<5){this.model.destroy();return}var e=this.model.toJSON();var t=new App.Collections.membercourseprogresses;t.courseId=e._id;t.memberId=$.cookie("Member._id");t.fetch({async:false});var i="";var s=0;var n=0;if(t.length!=0){i=t.first().toJSON();s=0;temp=0;n=i.stepsStatus.length;while(temp<n){if(i.stepsStatus[temp]=="1"){s++}temp++}}console.log("here is Group Span");if(n!=0){e.yes="<br>("+s+"/"+n+")"}else{e.yes="<br>(No Steps)"}this.$el.append(_.template(this.template,e))}})});$(function(){App.Views.GroupsSpans=Backbone.View.extend({tagName:"tr",addOne:function(e){var t=new App.Views.GroupSpan({model:e});t.render();$("#cc").append(t.el)},addAll:function(){if(this.collection.length!=0){this.collection.each(this.addOne,this)}else{$("#cc").append("<td class='course-box'>No Courses Accepted</td>")}},render:function(){this.addAll()}})});$(function(){App.Views.ShelfSpan=Backbone.View.extend({tagName:"td",className:"shelf-box",template:$("#template-ShelfSpan").html(),render:function(){var e=this.model.toJSON();alert("test");console.log(e);alert("shelf span in");this.$el.append(_.template(this.template,e))}})});$(function(){App.Views.ShelfSpans=Backbone.View.extend({tagName:"tr",render:function(){var e=true;var t=true;for(var i in App.ShelfItems){e=false;break}if(!e){$.each(App.ShelfItems,function(e,t){var i=t.toString().split("+");if(i[0]!="true"){$("#ur").append('<td class="shelf-box"><a href="#resource/detail/'+e+"/"+i[2]+"/"+i[3]+'">'+i[1]+"</a></td>")}});$.each(App.ShelfItems,function(e,i){var s=i.toString().split("+");if(s[0]!="true")t=false})}if(t){$("#ur").append('<td class="shelf-box">No Item In the Shelf</td>')}}})});$(function(){App.Views.MeetupSpan=Backbone.View.extend({tagName:"td",className:"meetup-box",template:$("#template-Meetup").html(),render:function(){var e=this.model.toJSON();this.$el.append(_.template(this.template,e))}})});$(function(){App.Views.MeetupSpans=Backbone.View.extend({tagName:"tr",addOne:function(e){var t=new App.Views.MeetupSpan({model:e});t.render();$("#meetUpTable").append(t.el)},addAll:function(){if(this.collection.length!=0){this.collection.each(this.addOne,this)}else{$("#meetUpTable").append("<td class='course-box'>No MeetUp</td>")}},render:function(){this.addAll()}})});$(function(){App.Views.TutorSpan=Backbone.View.extend({tagName:"td",className:"tutor-box",template:$("#template-Tutor").html(),render:function(){if($.cookie("Member._id")=="821d357b8f3ba3c09836c91bebcb29d7"){var e={};e.leaderEmail=this.model;e._id="none"}else{var e=this.model.toJSON();if(!e.leaderEmail){e.leaderEmail="Undefined"}}this.$el.append(_.template(this.template,e))}})});$(function(){App.Views.TutorsSpans=Backbone.View.extend({tagName:"tr",addOne:function(e){var t=new App.Views.TutorSpan({model:e});t.render();$("#tutorTable").append(t.el)},addAll:function(){if($.cookie("Member._id")=="821d357b8f3ba3c09836c91bebcb29d7"){var e=["English","Algebra","Midwifery"];for(var t=0;t<3;t++){this.addOne(e[t],this)}}else{if(this.collection.length!=0){this.collection.each(this.addOne,this)}else{$("#tutorTable").append("<td class='course-box'>No Tutor</td>")}}},render:function(){$("#tutorTable").append("<td class='course-box'> functionality is under construction </td>")}})});$(function(){App.Views.ResourcesTable=Backbone.View.extend({tagName:"table",isAdmin:null,className:"table table-striped",events:{"click #backButton":function(e){if(this.collection.skip>0){this.collection.skip=parseInt(this.collection.skip)-20}this.collection.fetch({async:false});if(this.collection.length>0){this.render()}},"click #nextButton":function(e){this.collection.skip=parseInt(this.collection.skip)+20;this.collection.fetch({async:false});if(this.collection.length>0){this.render()}},"click .clickonalphabets":function(e){this.collection.skip=0;var t=$(e.target).text();this.collection.startkey=t;this.collection.fetch({async:false});if(this.collection.length>0){this.render()}},"click #allresources":function(e){this.collection.startkey="";this.collection.skip=0;this.collection.fetch({async:false});if(this.collection.length>0){this.render()}},"click .pageNumber":function(e){this.collection.startkey="";this.collection.skip=e.currentTarget.attributes[0].value;this.collection.fetch({async:false});if(this.collection.length>0){this.render()}}},initialize:function(){},addOne:function(e){var t=new App.Views.ResourceRow({model:e,admin:this.isAdmin});t.isManager=this.isManager;t.displayCollec_Resources=this.displayCollec_Resources;t.collections=this.collections;t.render();this.$el.append(t.el)},addAll:function(){if(this.collection.length==0){this.$el.append("<tr><td width: 630px;>No resource found</td><td></td><td></td><td></td><td></td><td></td><td></td></tr>")}if(this.isadmin>-1){this.isAdmin=1}else{this.isAdmin=0}this.collection.forEach(this.addOne,this)},render:function(){if(this.displayCollec_Resources!=true){this.$el.html("");if(this.removeAlphabet==undefined){var e="<tr></tr>";e+="<tr><td colspan=7  style='cursor:default' >";e+='<a  id="allresources">#</a>&nbsp;&nbsp;';var t="ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var i=0;i<t.length;i++){var s=t.charAt(i);e+='<a  class="clickonalphabets"  value="'+s+'">'+s+"</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}e+="</td></tr>";this.$el.append(e)}}this.$el.append("<br/><br/>");this.$el.append("<tr><th style='width: 430px;'>Title</th><th colspan='6'>Actions</th></tr>");this.addAll();var n="<tr><td>";if(this.collection.skip!=0){n+='<a class="btn btn-success" id="backButton" >Back</a>&nbsp;&nbsp;'}if(this.collection.length>=20)n+='<a class="btn btn-success" id="nextButton">Next</a>';n+="</td></tr>";this.$el.append(n);var o;var a=this;if(this.removeAlphabet==undefined){$.ajax({url:"/resources/_design/bell/_view/count?group=false",type:"GET",dataType:"json",success:function(e){if(e.rows[0]){o=e.rows[0].value}if(a.displayCollec_Resources!=true){var t="<tr><td colspan=7><p style='width: 940px; word-wrap: break-word;'>";var i=o/20;for(var s=0;s<i;s++){if(s==0)t+='<a  class="pageNumber" value="'+s*20+'">Home</a>&nbsp&nbsp';else t+='<a  class="pageNumber" value="'+s*20+'">'+s+"</a>&nbsp&nbsp"}t+="</p></td></tr>";a.$el.append(t)}}})}}})});$(function(){App.Views.ResourceRow=Backbone.View.extend({tagName:"tr",id:null,admn:null,events:{"click .destroy":function(e){if(confirm("Are you sure you want to delete this resource?")){var t=this;var i=new App.Collections.shelfResource;i.deleteResource=1;i.resourceId=this.model.get("_id");i.fetch({async:false});var s;while(s=i.first()){s.destroy()}var n=new App.Collections.ResourceFeedback;n.resourceId=this.model.get("_id");n.fetch({async:false});while(s=n.first()){s.destroy()}var o=new App.Collections.coursesteps;o.getAll=1;o.resourceId=this.model.get("_id");o.fetch({async:false});o.each(function(e){if(!e.get("resourceId")){e.set("resourceId",[])}var i=e.get("resourceId").indexOf(t.model.get("_id").toString());if(i!=-1){e.get("resourceId").splice(i,1);e.get("resourceTitles").splice(i,1);e.save()}});this.model.destroy();alert("Resource Successfully deleted.");e.preventDefault()}},"click .removeFromCollection":function(e){var t=window.location.href.split("#")[1].split("/")[1];var i=this.model.get("Tag");var s=i.indexOf(t);if(s>-1)i.splice(s,1);var n=this;this.model.set("Tag",i);this.model.save(null,{success:function(e,t){n.remove();alert("Removed Successfully From Collection")}})},"click .hides":function(e){$(this.el).html("");this.model.set({hidden:true});this.model.save();App.startActivityIndicator();var t=new App.Collections.shelfResource;t.deleteResource=1;t.resourceId=this.model.get("_id");t.fetch({async:false});t.each(function(e){e.set({hidden:true});e.save()});App.stopActivityIndicator();var i=new App.Models.Resource({_id:this.model.get("_id")});i.fetch({async:false});this.model=i;this.render()},"click .unhide":function(e){$(this.el).html("");this.model.set({hidden:false});this.model.save();App.startActivityIndicator();var t=new App.Collections.shelfResource;t.deleteResource=1;t.resourceId=this.model.get("_id");t.fetch({async:false});t.each(function(e){e.set({hidden:false});e.save()});App.stopActivityIndicator();var i=new App.Models.Resource({_id:this.model.get("_id")});i.fetch({async:false});this.model=i;this.render()},"click .trigger-modal":function(){$("#myModal").modal({show:true})},"click .resFeedBack":function(e){var t=new App.Collections.ResourcesFrequency;t.memberID=$.cookie("Member._id");t.fetch({async:false});if(t.length==0){var i=new App.Models.ResourceFrequency;i.set("memberID",$.cookie("Member._id"));i.set("resourceID",[this.model.get("_id")]);i.set("reviewed",[0]);i.set("frequency",[1]);i.save();return}else{var i=t.first();var s=i.get("resourceID").indexOf(this.model.get("_id").toString());if(s!=-1){var n=i.get("frequency");n[s]=n[s]+1;i.save()}else{i.get("resourceID").push(this.model.get("_id"));i.get("frequency").push(1);if(!i.get("reviewed")){i.set("reviewed",[0])}else{i.get("reviewed").push(0)}i.save();return}}$("ul.nav").html($("#template-nav-logged-in").html()).hide();Backbone.history.navigate("resource/feedback/add/"+this.model.get("_id")+"/"+this.model.get("title"),{trigger:true})}},vars:{},template:_.template($("#template-ResourceRow").html()),initialize:function(e){this.model.on("destroy",this.remove,this)},render:function(){var e=this.model.toJSON();var t="";if(e.author!=undefined&&e.author!=""){t=t+"<b>Author </b>"+e.author+" , "}if(e.Year!=undefined&&e.Year!=""){t=t+"<b>Year </b>"+e.Year+" , "}if(e.openWith!=undefined){t=t+"<b>Media </b>";t=t+e.openWith+" , "}if(e.language!=undefined){if(e.language.length>0){t=t+"<b>Language </b>"+e.language+" , "}}if(e.subject!=undefined){t=t+"<b>Subject(s) </b>";if($.isArray(e.subject)){for(var i=0;i<e.subject.length;i++){t=t+e.subject[i]+" / "}}else{t=t+e.subject+" / "}t=t.substring(0,t.length-3);t=t+" , "}if(e.Level!=undefined){t=t+"<b>Level(s) </b>";if($.isArray(e.Level)){for(var i=0;i<e.Level.length;i++){t=t+e.Level[i]+" / "}}else{t=t+e.Level+" / "}t=t.substring(0,t.length-3);t=t+" , "}if(e.Publisher!=undefined&&e.Publisher!=""){t=t+"<b>Publisher/Attribution </b>"+e.Publisher+" , "}if(e.linkToLicense!=undefined&&e.linkToLicense!=""){t=t+"<b>Link To License </b>"+e.linkToLicense+" , "}if(e.resourceFor!=undefined&&e.resourceFor!=""){t=t+"<b> Resource For </b>"+e.resourceFor+" , "}if(e.resourceType!=undefined&&e.resourceType!=""){t=t+"<b> Resource Type </b>"+e.resourceType+" , "}if(e.Tag!=undefined){if($.isArray(e.Tag)){if(e.Tag.length>0)t=t+"<b>Collection </b>";for(var i=0;i<e.Tag.length;i++){if(this.collections.get(e.Tag[i])!=undefined)t=t+this.collections.get(e.Tag[i]).toJSON().CollectionName+" / "}}else{if(e.Tag!="Add New")t=t+"<b>Collection </b>"+e.Tag+" / "}}t=t.substring(0,t.length-3);t=t+" , ";t=t.substring(0,t.length-3);e.Details=t;if(e.hidden==undefined){e.hidden=false}if(this.model.get("sum")!=0){e.totalRatings=this.model.get("timesRated");e.averageRating=parseInt(this.model.get("sum"))/parseInt(e.totalRatings)}else{e.averageRating="Sum not found";e.totalRatings=0}if(this.isManager>-1){e.Manager=1}else{e.Manager=0}if(this.displayCollec_Resources==true){e.removeFormCollection=1}else{e.removeFormCollection=0}this.$el.append(this.template(e))}})});$(function(){App.Views.ResourcesDetail=Backbone.View.extend({authorName:null,tagName:"table",className:"btable btable-striped resourceDetail",sid:null,rid:null,events:{"click #DestroyShelfItem":function(e){var t=this.model.toJSON();var i=t._id;var s=$.cookie("Member._id");var n=new App.Collections.shelfResource;n.resourceId=i;n.memberId=s;n.fetch({async:false});n.each(function(e){e.destroy()});alert("Resource Successfully removed from Shelf ");Backbone.history.navigate("dashboard",{trigger:true})}},initialize:function(){this.$el.append('<th colspan="2"><h6>Resource Detail</h6></th>')},SetShelfId:function(e,t){this.sid=e;this.rid=t},render:function(){var e=this.model.toJSON();this.$el.append("<tr><td>Title</td><td>"+e.title+"</td></tr>");this.$el.append("<tr><td>Subject</td><td>"+e.subject+"</td></tr>");this.$el.append("<tr><td>Tag</td><td>"+e.Tag+"</td></tr>");this.$el.append("<tr><td>Level</td><td>"+e.Level+"</td></tr>");if(e.author){this.$el.append("<tr><td>Author</td><td>"+e.author+"</td></tr>")}else{this.$el.append("<tr><td>Author</td><td>No Author Defined</td></tr>")}if(e._attachments){this.$el.append("<tr><td>Attachment</td><td><a class='btn open'  target='_blank' style='background-color:#1ABC9C;position: absolute;display: inline-block; line-height: 25px;margin-top: 35px;margin-left:-620px;width: 65px;height:26px;font-size: large' href='/apps/_design/bell/bell-resource-router/index.html#open/"+e._id+"'>View</a></td></tr>")}else{this.$el.append("<tr><td>Attachment</td><td>No Attachment</td></tr>")}this.$el.append('<tr><td colspan="2"><button class="btn btn-danger" id="DestroyShelfItem">Remove</button></td></tr>')}})});$(function(){App.Views.ResourceForm=Backbone.View.extend({className:"form",id:"resourceform",hide:false,events:{'keydown input[name="title"]':"getFocusForTitle",'keydown input[name="author"]':"getFocusForAuthor",'keydown input[name="Year"]':"getFocusForYear",'keydown select[name="language"]':"getFocusForLanguage",'keydown input[name="Publisher"]':"getFocusForPublisher","keydown #_attachments":"getFocusForBrowse","keydown  .save":"getFocusForSave","click .save":"saveForm","click #cancel":function(){window.history.back()},"click #add_newCoellection":function(){App.Router.AddNewSelect("Add New")},"click #saveUpdatedWelcomeVideoForm":"saveUpdatedWelcomeVideoForm"},getFocusForTitle:function(e){if(e.keyCode==9){e.preventDefault();$.trim($('[name="title"]').val());$('[name="author"]').focus()}},getFocusForAuthor:function(e){if(e.keyCode==9){e.preventDefault();$.trim($('[name="author"]').val());$('[name="Year"]').focus()}},getFocusForBrowse:function(e){if(e.keyCode==9){e.preventDefault();var t=$(":focus");$(".save").attr("tabindex",0);$(".save").addClass("myTabIndexClass");$(".myTabIndexClass").focus();t=$(":focus")}},getFocusForSave:function(e){if(e.keyCode==9){e.preventDefault();var t=$(":focus");$("#cancel").attr("tabindex",0);$("#cancel").focus();t=$(":focus");e.preventDefault()}},getFocusForYear:function(e){if(e.keyCode==9){e.preventDefault();$.trim($('[name="Year"]').val());$('[name="language"]').focus()}},getFocusForLanguage:function(e){if(e.keyCode==9){e.preventDefault();$('[name="Publisher"]').focus()}},getFocusForPublisher:function(e){if(e.keyCode==9){e.preventDefault();$('[name="linkToLicense"]').focus()}},getFocusForLinkToLicense:function(e){if(e.keyCode==9){e.preventDefault();$.trim($('[name="Publisher"]').val());$('[name="resourceType"]').focus()}},getFocusForResourceType:function(e){if(e.keyCode==9){e.preventDefault();$('[name="subject"]').focus()}},template:_.template($("#template-form-file").html()),render:function(){var e={};if(_.has(this.model,"id")){e.header='Details "'+this.model.get("title")+'"';var t=this.model.get("_attachments");var i=_.map(_.pairs(t),function(e){return{key:e[0],value:e[1]}});e.resourceAttachments=i;e.resourceTitle=this.model.get("title");e.resourceUrl=this.model.get("url")}else{e.header="New Resource";e.resourceAttachments="No File Selected.";e.resourceUrl=""}this.form=new Backbone.Form({model:this.model});this.form.render();this.form.fields["uploadDate"].$el.hide();if(this.edit==false){this.form.fields["addedBy"].$el.val($.cookie("Member.login"))}this.form.fields["addedBy"].$el.attr("disabled",true);this.form.fields["averageRating"].$el.hide();var s=this;if(_.has(this.model,"id")){if(this.model.get("Level")=="All"){s.hide=true}}e.form="";this.$el.html(this.template(e));$(".fields").html(this.form.el);this.$el.append('<button class="btn btn-success" id="add_newCoellection" >Add New</button>');$("#progressImage").hide();$('[name="title"]').focus();return this},saveUpdatedWelcomeVideoForm:function(){if(this.model.get("isWelcomeVideo")===undefined){this.model.set("isWelcomeVideo",true)}this.form.commit();this.model.set("Level",null);this.model.set("subject",null);var e=this;var t=$('input[type="file"]').val();this.model.save(null,{success:function(i){if(t){e.model.unset("_attachments");App.startActivityIndicator();e.model.on("savedAttachment",function(){App.stopActivityIndicator();this.trigger("processed")},e.model);e.model.saveAttachment("#fileAttachment","#_attachments","#fileAttachment .rev");e.form.fields["addedBy"].setValue($.cookie("Member.login"))}else{return}}})},renderAddOrUploadWelcomeVideoForm:function(){var e=$("<h3> Edit Welcome Video Form </h3><br><br><br><br>");this.$el.append(e);this.form=new Backbone.Form({model:this.model});this.$el.append(this.form.render().el);for(var t in this.form.fields){this.form.fields[t].$el.hide()}this.form.fields["addedBy"].$el.show();this.form.fields["resourceType"].$el.show();this.form.fields["addedBy"].editor.el.disabled=true;this.form.fields["uploadDate"].$el.show();this.form.fields["openWith"].$el.show();this.form.fields["resourceFor"].$el.show();var i=this.model.get("_attachments");var s=_.map(_.pairs(i),function(e){return{key:e[0],value:e[1]}});for(var t in s){var n=$("<label>").text(s[t].key);this.$el.append(n)}this.$el.append("<br><br>");this.$el.append('<form method="post" id="fileAttachment"></form>');this.$el.find("#fileAttachment").append('<label for="_attachments">Upload Welcome Video</label>');this.$el.find("#fileAttachment").append('<input type="file" name="_attachments" id="_attachments" style="line-height: 28px;" multiple="multiple" label=" :" />');this.$el.find("#fileAttachment").append('<input class="rev" type="hidden" name="_rev">');this.$el.append('<button class="addNation-btn btn btn-success" id="saveUpdatedWelcomeVideoForm">Submit</button>');this.$el.append('<a class="btn btn-danger" id="cancel">Cancel</a>')},saveForm:function(){var e=this.model.get("title");var t=this.model.get("_id");var i=this;this.form.commit();if(this.model.get("openWith")=="PDF.js"){this.model.set("need_optimization",true)}var s=this.model.get("title");if(this.model.get("title").length==0){alert("Resource Title is missing")}else if(this.model.get("subject")==null){alert("Resource Subject is missing")}else if(this.model.get("Level")==null){alert("Resource Level is missing")}else{if(t){var n=true;if(e!=s){if(this.DuplicateTitle()){n=false}}if(n){this.model.save(null,{success:function(e){if($('input[type="file"]').val()){i.model.unset("_attachments");App.startActivityIndicator();i.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev")}else{window.history.back()}}})}}else{if(!this.DuplicateTitle()){this.model.set("sum",0);this.model.set("timesRated",0);this.model.save(null,{success:function(e){if($('input[type="file"]').val()){App.startActivityIndicator();i.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev")}else{window.history.back()}}})}}}this.model.on("savedAttachment",function(){this.trigger("processed")},i.model)},DuplicateTitle:function(){var e=new App.Collections.Resources;e.title=this.model.get("title");e.fetch({async:false});e=e.first();if(e!=undefined)if(e.toJSON().title!=undefined){alert("Title already exist");return true}return false},statusLoading:function(){this.$el.children(".status").html('<div style="display:none" class="progress progress-striped active"> <div class="bar" style="width: 100%;"></div></div>')}})});$(function(){App.Views.Search=Backbone.View.extend({events:{"keypress #searchText":"SearchByEnter","click #searchR":"searchResult","click #addRestoPub":"addResourceToPublication","click #next_button":function(e){App.startActivityIndicator();this.groupresult.skip=this.groupresult.skip+20;this.groupresult.fetch({async:false});App.stopActivityIndicator();var t=this;if(this.groupresult.length>0){var i=new App.Views.SearchSpans({collection:this.groupresult});i.resourceids=t.resourceids;i.render();$("#srch").html(i.el);$("#previous_button").show();if(this.groupresult.length<20){$("#next_button").hide()}}else{this.groupresult.skip=this.groupresult.skip-20;$("#next_button").hide()}},"click #previous_button":function(e){App.startActivityIndicator();this.groupresult.skip=this.groupresult.skip-20;this.groupresult.fetch({async:false});App.stopActivityIndicator();var t=this;if(this.groupresult.length>0){var i=new App.Views.SearchSpans({collection:this.groupresult});i.resourceids=t.resourceids;i.render();$("#srch").html(i.el);$("#next_button").show()}else{$("#previous_button").hide()}if(this.groupresult.skip<=0){$("#previous_button").hide()}}},template:$("#template-Search").html(),vars:{},groupresult:null,resultArray:null,initialize:function(){this.groupresult=new App.Collections.Resources;this.resultArray=[];enablenext=0},SearchByEnter:function(e){if(e.keyCode==13){if(this.vars.addResource==true){this.searchResult()}else{ResourceSearch()}}},render:function(){var e=this;var t=App.collectionslist;this.vars.tags=t.toJSON();this.vars.addResource=this.addResource;if(typeof this.Publications!="undefined"){this.vars.Publications=this.Publications}else{this.vars.Publications=false}this.$el.html(_.template(this.template,this.vars));if(searchText!=""||this.collectionFilter||this.subjectFilter||this.levelFilter||this.languageFilter||this.mediumFilter||this.ratingFilter&&this.ratingFilter.length>0){App.startActivityIndicator();this.getSearchedRecords()}},getSearchedRecords:function(){var e={};var t=new Array;if(this.collectionFilter&&searchText.replace(" ","")==""&&!this.subjectFilter){for(var i=0;i<this.collectionFilter.length;i++){t.push(this.collectionFilter[i])}}else{if(this.collectionFilter&&(searchText.replace(" ","")!=""||this.subjectFilter)){e["Tag"]=this.collectionFilter}}if(this.subjectFilter&&searchText.replace(" ","")==""){for(var i=0;i<this.subjectFilter.length;i++){t.push(this.subjectFilter[i].toLowerCase())}}else{if(this.subjectFilter&&searchText.replace(" ","")!=""){e["subject"]=this.subjectFilter}}if(this.levelFilter&&!this.languageFilter&&searchText.replace(" ","")==""&&!this.subjectFilter&&!this.collectionFilter){for(var i=0;i<this.levelFilter.length;i++){t.push(this.levelFilter[i].toLowerCase())}}else{if(this.levelFilter&&(this.languageFilter||searchText.replace(" ","")!=""||this.subjectFilter||this.collectionFilter)){e["Level"]=this.levelFilter}}if(this.mediumFilter&&!this.levelFilter&&!this.languageFilter&&searchText.replace(" ","")==""&&!this.subjectFilter&&!this.collectionFilter){for(var i=0;i<this.mediumFilter.length;i++){t.push(this.mediumFilter[i].toLowerCase())}}else{if(this.mediumFilter&&(this.levelFilter||this.languageFilter||searchText.replace(" ","")!=""||this.subjectFilter||this.collectionFilter)){e["Medium"]=this.mediumFilter}}if(this.languageFilter&&searchText.replace(" ","")==""&&!this.subjectFilter&&!this.collectionFilter){for(var i=0;i<this.languageFilter.length;i++){t.push(this.languageFilter[i])}}else{if(this.languageFilter&&(searchText.replace(" ","")!=""||this.subjectFilter||this.collectionFilter)){e["language"]=this.languageFilter}}if(this.ratingFilter.length>0&&!this.mediumFilter&&!this.levelFilter&&!this.languageFilter&&searchText.replace(" ","")==""&&!this.subjectFilter&&!this.collectionFilter){for(var i=0;i<this.ratingFilter.length;i++){t.push(parseInt(this.ratingFilter[i]))}}else{if(this.ratingFilter.length>0&&(this.mediumFilter||this.levelFilter||this.languageFilter||searchText.replace(" ","")!=""||this.subjectFilter||this.collectionFilter)){e["timesRated"]=this.ratingFilter}}var s,n,o,a;var l=[];if(searchText!=""){s=searchText.replace(/[!(.,'";):&]+/gi,"").toLowerCase();t.push(s);$.ajax({url:'/collectionlist/_design/bell/_view/collectionByName?_include_docs=true&key="'+s+'"',type:"GET",dataType:"json",success:function(e){console.log(e);if(e.rows.length>0){a=e.rows[0].id;t.push(a)}},error:function(){alert("Unable to get collections.")},async:false});o=searchText.replace(/[" "-]+/gi,"").toLowerCase();if(o!=null){t.push(o)}s=searchText.replace(/[!(.,;'"):&]+/gi,"").toLowerCase();n=s.replace(/[-]+/gi," ");t.push(n);s=s.replace(/[-]+/gi," ").split(" ");l=s;for(var r in s){if(s[r]!=" "&&s[r]!=""&&s[r]!="the"&&s[r]!="an"&&s[r]!="a"&&s[r]!="and"&&s[r]!="&")t.push(s[r])}}var c=JSON.stringify(t);console.log(c);this.groupresult.skip=0;this.groupresult.collectionName=c;this.groupresult.fetch({async:false});var d;if(this.groupresult.models.length>0&&!this.isEmpty(e)){var u=this.groupresult.models;d=this.checkANDConditions(e,u)}if(this.groupresult.models.length>0&&searchText!=""&&this.isEmpty(e)){if(a!=null||a!=undefined){var p=a}var h=this.groupresult.models;d=this.checkSearchTextCompleteMatch(l,p,h)}if(d!=null){this.groupresult.models=d;if(d.length==0){this.groupresult.length=0}else{this.groupresult.length=d.length}}App.stopActivityIndicator();var m=this;if(m.addResource==true){if(this.groupresult.length>0){var f=new App.Views.SearchSpans({collection:this.groupresult});f.resourceids=m.resourceids;f.render();$("#srch").append(f.el)}}else{var g=App.member;var v=g.get("roles");var b=new App.Views.ResourcesTable({collection:this.groupresult});b.removeAlphabet=true;b.isManager=v.indexOf("Manager");b.resourceids=m.resourceids;b.collections=App.collectionslist;b.render();$("#srch").html('<h4>Search Result <a style="float:right" class="btn btn-info" onclick="backtoSearchView()">Back To Search</a></h4>');$("#srch").append(b.el)}},isEmpty:function(e){for(var t in e){if(e.hasOwnProperty(t)){return false}}return true},checkANDConditions:function(e,t){var i;var s=[];for(var n=0;n<t.length;n++){i=[];var o=t[n];for(var a in e){var l=e[a];if(Array.isArray(o.attributes[a])){var r=false;for(var c=0;c<l.length;c++){var d=l[c];if(o.attributes[a].indexOf(d)>-1){r=true}}i.push(r)}else{var u=false;if(a!="timesRated"){for(var p=0;p<l.length;p++){var d=l[p];if(o.attributes[a]==d){u=true}}}else{for(var p=0;p<l.length;p++){var d=l[p];var h=Math.ceil(o.attributes.sum/o.attributes[a]);if(h==d){u=true}}}i.push(u)}}if(i.indexOf(false)==-1){s.push(o)}}return s},checkSearchTextCompleteMatch:function(e,t,i){var s,n,o,a;var l=[];for(var r=0;r<i.length;r++){s=[];n=[];o=[];a=[];var c=i[r];for(var d=0;d<e.length;d++){if(c.attributes.title.toLowerCase().indexOf(e[d])>-1||c.attributes.title.replace(/[!(.," "-;):]+/g,"").toLowerCase().indexOf(e[d])>-1||c.attributes.title.replace(/[!(.,-;):]+/g," ").toLowerCase().indexOf(e[d])>-1){n.push(true)}else{n.push(false)}if(c.attributes.Publisher.toLowerCase().indexOf(e[d])>-1||c.attributes.Publisher.replace(/[!(.," "-;):]+/g,"").toLowerCase().indexOf(e[d])>-1||c.attributes.Publisher.replace(/[!(.,-;):]+/g," ").toLowerCase().indexOf(e[d])>-1){o.push(true)}else{o.push(false)}if(c.attributes.author.toLowerCase().indexOf(e[d])>-1||c.attributes.author.replace(/[!(.," "-;):]+/g,"").toLowerCase().indexOf(e[d])>-1||c.attributes.author.replace(/[!(.,-;):]+/g," ").toLowerCase().indexOf(e[d])>-1){a.push(true)}else{a.push(false)}for(var u=0;u<c.attributes.subject.length;u++){if(c.attributes.subject[u].toLowerCase().indexOf(e[d])>-1||c.attributes.subject[u].replace(/[!(.," "-;):]+/g,"").toLowerCase().indexOf(e[d])>-1||c.attributes.subject[u].replace(/[!(.,-;):]+/g," ").toLowerCase().indexOf(e[d])>-1){s.push(true)}}if(c.attributes.Tag){for(var p=0;p<c.attributes.Tag.length;p++){if(c.attributes.Tag[p].indexOf(t)>-1){s.push(true)}}}}if(n.indexOf(false)==-1||o.indexOf(false)==-1||a.indexOf(false)==-1){s.push(true)}if(s.indexOf(true)>-1){l.push(c)}}return l},addResourceToStepView:function(){var e=this;var t=new Backbone.Collection;if(e.resultArray.length>0){t.set(e.resultArray);var i=new App.Views.SearchSpans({collection:t});i.resourceids=e.resourceids;i.render();$("#srch").append(i.el)}},searchResult:function(){searchText=$("#searchText").val();var e=new Array;var t=new Array;var i=new Array;ratingFilter.length=0;e=$("#multiselect-collections-search").val();t=$("#multiselect-subject-search").val();i=$("#multiselect-levels-search").val();
mediumFilter=$("#multiselect-medium-search").val();$("input[name='star']").each(function(){if($(this).is(":checked")){ratingFilter.push($(this).val())}});if(searchText!=""||e||t||i||mediumFilter||ratingFilter&&ratingFilter.length>0){this.collectionFilter=e;this.levelFilter=i;this.subjectFilter=t;this.ratingFilter=ratingFilter;this.mediumFilter=mediumFilter;this.addResource=true;App.$el.children(".body").html(search.el);this.render();$("#searchText2").val(searchText);$("#srch").show();$(".row").hide();$(".search-bottom-nav").show();$(".search-result-header").show();$("#selectAllButton").show()}$("#previous_button").hide();$("#searchText").focus();$("#searchText").val(searchText)},addResourceToPublication:function(){if(typeof grpId==="undefined"){document.location.href="../nation/index.html#publication"}var e=new Array;var t=new App.Models.Publication({_id:grpId});t.fetch({async:false});$("input[name='result']").each(function(){if($(this).is(":checked")){var i=$(this).val();if(t.get("resources")!=null){e=t.get("resources");if(e.indexOf(i)<0)e.push(i)}else{e.push(i)}}});t.set("resources",e);t.save();t.on("sync",function(){alert("Your Resources have been added successfully");window.location="../nation/index.html#publicationdetail/"+t.get("_id")})}})});$(function(){App.Views.SearchSpan=Backbone.View.extend({tagName:"tr",className:"search-box",template:$("#template-Search-box").html(),render:function(){var e=this.model.toJSON();if(!e.Tag)e.Tag="";if(e.name){e.title="CourseSearchBox";e.Tag="CourseSearchBox"}else{e.name="ResourceSearchBox"}this.$el.append(_.template(this.template,e))}})});$(function(){App.Views.SearchSpans=Backbone.View.extend({addOne:function(e){if(this.resourceids){if($.inArray(e.get("id"),this.resourceids)==-1){this.renderView(e)}}else{this.renderView(e)}},renderView:function(e){var t=new App.Views.SearchSpan({model:e});t.render();this.$el.append(t.el)},addAll:function(){this.collection.each(this.addOne,this)},render:function(){this.addAll()}})});$(function(){App.Views.RequestView=Backbone.View.extend({tagName:"div",id:"site-request",type:null,events:{"click #formButton":"setForm","click #CancelButton":"cancelform","click #ViewAllButton":"gotoRoute"},gotoRoute:function(){document.getElementById("nav").style.visibility="visible";Backbone.history.navigate("AllRequests",{trigger:true})},cancelform:function(){$("#site-request").animate({height:"toggle"});this.form.setValue({request:""});var e=this;setTimeout(function(){e.remove()},1e3);document.getElementById("nav").style.visibility="visible"},setForm:function(){var e=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var t=new e;t.fetch({async:false});var i=t.first();var s=i.toJSON();var n=new Date;console.log(n);var o=("0"+(n.getMonth()+1).toString()).substr(-2)+"/"+("0"+n.getDate().toString()).substr(-2)+"/"+n.getFullYear().toString().substr(2);if(this.form.getValue("request").length!=0){this.form.setValue({status:"0"});this.form.setValue({senderId:$.cookie("Member._id")});this.form.setValue({date:o});this.form.setValue({sendFrom:s.rows[0].doc.type});this.form.setValue({sendFromName:s.rows[0].doc.name});this.form.setValue({response:""});this.form.setValue({type:this.type});this.form.commit();this.model.save();console.log(this.model.toJSON());alert("Request Successfully Sent");this.form.setValue({request:""})}$("#site-request").animate({height:"toggle"});var a=this;setTimeout(function(){a.remove()},1e3);document.getElementById("nav").style.visibility="visible"},render:function(){document.getElementById("nav").style.visibility="hidden";var e=new App.Models.request;this.model=e;this.form=new Backbone.Form({model:e});if(this.type=="Course"){this.$el.html('<span style=" font-weight: bold;visibility: visible;">I would like to enroll in a course on the following subject</span>')}else if(this.type=="Resource"){this.$el.html('<span style=" font-weight: bold;visibility: visible;">I would like to have the following resource in BELL</span>')}else if(this.type=="Meetup"){this.$el.html('<span style=" font-weight: bold;visibility: visible;">I would like to join a Meetup on the following topic</span>')}else{this.$el.html('<span style=" font-weight: bold;visibility: visible;">Error!!!!</span>')}this.$el.append(this.form.render().el);this.form.fields["senderId"].$el.hide();this.form.fields["status"].$el.hide();this.form.fields["response"].$el.hide();this.form.fields["type"].$el.hide();this.form.fields["sendFrom"].$el.hide();this.form.fields["sendFromName"].$el.hide();this.form.fields["date"].$el.hide();var t=$('<br/><div id="f-formButton"><button class="btn btn-hg btn-danger" id="CancelButton">Cancel</button><button class="btn btn-hg btn-info" id="ViewAllButton">View All</button><button class="btn btn-hg btn-primary" id="formButton">Submit</button></div>');this.$el.append(t)}})});$(function(){App.Views.FeedbackTable=Backbone.View.extend({tagName:"table",className:"btable btable-striped",addOne:function(e){var t=new App.Views.FeedbackRow({model:e});t.render();this.$el.append(t.el)},addAll:function(){this.$el.append("<tr><th>Comment</th><th>Rating</th></tr>");this.collection.each(this.addOne,this)},render:function(){this.addAll()}})});$(function(){App.Views.FeedbackRow=Backbone.View.extend({vars:{},tagName:"tr",events:{"click .destroy":function(e){e.preventDefault();this.model.destroy();this.remove()},"click .browse":function(e){e.preventDefault();$("#modal").modal({show:true})}},template:$("#template-FeedbackRow").html(),render:function(){var e=this.model.toJSON();e.memberName="";this.$el.append(_.template(this.template,e))}})});$(function(){App.Views.FeedbackForm=Backbone.View.extend({tagName:"form",user_rating:"null",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey"},render:function(){var e=this;this.user_rating=0;console.log(this.model);this.form=new Backbone.Form({model:this.model});var t=this.model;this.$el.append(this.form.render().el);this.form.fields["rating"].$el.hide();this.form.fields["memberId"].$el.hide();this.form.fields["resourceId"].$el.hide();this.form.fields["communityCode"].$el.hide();var i=$('<a class="btn btn-success" style="margin-left:10px" id="formButton">Save</a>');$btnAddToShelf=$('<button class="btn btn-success" id="AddToShelf" style="margin-left:10px">Save And Add To My Library</button>');this.$el.append(i);this.$el.append($btnAddToShelf);$btnAddToShelf.click(function(){e.setForm();if(e.user_rating>0){AddToShelfAndSaveFeedback(t.get("resourceId"),escape(e.rtitle))}})},setFormFromEnterKey:function(e){e.preventDefault();this.setForm()},setUserRating:function(e){this.user_rating=e},setForm:function(){if(this.user_rating==0){alert("Please rate the resource first")}else{if(this.form.getValue("comment").length==0){this.form.setValue("comment","No Comment")}this.form.setValue("rating",this.user_rating);this.form.setValue("communityCode",App.configuration.get("code"));this.form.commit();var e=this;var t=e.model;var i=new App.Models.Member;i.set("_id",$.cookie("Member._id"));i.fetch({success:function(i,s){e.logActivity(i,t)}});var s=new PouchDB("feedback");s.post(e.model.toJSON(),function(t,i){if(!t){var s=new PouchDB("resources");var n=e.model.get("resourceId");console.log(n);s.get(n,function(t,i){console.log(t);console.log(i);if(!t){var o=parseInt(i.timesRated);o++;var a=parseInt(i.sum)+parseInt(e.user_rating);s.put({sum:a,timesRated:o},i._id,i._rev,function(e,t){console.log(e);console.log(t)})}else{s.post({_id:n,sum:parseInt(e.user_rating),timesRated:1},function(e,t){console.log(e);console.log(t)})}console.log("Rating is successfully saved");Backbone.history.navigate("resources",{trigger:true})});console.log(i)}else{console.log(t)}});$("#externalDiv").hide()}},logActivity:function(e,t){var i=this;var s=new PouchDB("activitylogs");var n=new Date;var o=this.getFormattedDate(n);s.get(o,function(n,a){if(!n){i.UpdatejSONlog(e,a,s,t,o)}else{i.createJsonlog(e,o,s,t)}})},createJsonlog:function(e,t,i,s){var n=this;var o={logDate:t,resourcesIds:[],male_visits:0,female_visits:0,male_timesRated:[],female_timesRated:[],male_rating:[],community:App.configuration.get("code"),female_rating:[],resources_names:[],resources_opened:[],male_opened:[],female_opened:[],male_deleted_count:0,female_deleted_count:0};i.put(o,t,function(o,a){if(!o){console.log("FeedbackForm:: createJsonlog:: created activity log in pouchdb for today..");i.get(t,function(o,a){if(!o){n.UpdatejSONlog(e,a,i,s,t)}else{console.log("FeedbackForm:: createJsonlog:: Error fetching activitylog doc from Pouch after creating it")}})}else{console.log("FeedbackForm:: createJsonlog:: error creating/pushing activity log doc in pouchdb..");console.log(o)}})},UpdatejSONlog:function(e,t,i,s,n){var o=e.get("roles").indexOf("SuperManager");console.log(s);memRating=parseInt(s.get("rating"));var a=s.get("resourceId");var l=t.resourcesIds.indexOf(a);if(l==-1){t.resourcesIds.push(a);if(e.get("Gender")=="Male"){if(o==-1){t.male_rating.push(memRating);t.female_rating.push(0);t.male_timesRated.push(1);t.female_timesRated.push(0)}else{t.male_rating.push(0);t.female_rating.push(0);t.male_timesRated.push(0);t.female_timesRated.push(0)}}else{if(o==-1){t.male_rating.push(0);t.female_rating.push(memRating);t.male_timesRated.push(0);t.female_timesRated.push(1)}else{t.male_rating.push(0);t.female_rating.push(0);t.male_timesRated.push(0);t.female_timesRated.push(0)}}}else{if(e.get("Gender")=="Male"){if(o==-1){t.male_rating[l]=parseInt(t.male_rating[l])+memRating;t.male_timesRated[l]=parseInt(t.male_timesRated[l])+1}}else{if(o==-1){t.female_rating[l]=parseInt(t.female_rating[l])+memRating;t.female_timesRated[l]=parseInt(t.female_timesRated[l])+1}}}i.put(t,n,t._rev,function(e,t){if(!e){console.log("FeedbackForm:: UpdatejSONlog:: updated daily log from pouchdb for today..")}else{console.log("FeedbackForm:: UpdatejSONlog:: err making update to record");console.log(e)}})},getFormattedDate:function(e){var t=e.getFullYear();var i=(1+e.getMonth()).toString();i=i.length>1?i:"0"+i;var s=e.getDate().toString();s=s.length>1?s:"0"+s;return i+"/"+s+"/"+t}})});$(function(){App.Views.GroupsTable=Backbone.View.extend({tagName:"table",className:"btable btable-striped",roles:null,addOne:function(e){var t=new App.Views.GroupRow({model:e,roles:this.roles});t.courseId=this.courseId;t.render();this.$el.append(t.el)},events:{"click .pageNumber":function(e){this.collection.startkey="";this.collection.skip=e.currentTarget.attributes[0].value;this.collection.fetch({async:false});if(this.collection.length>0){this.render()}}},addAll:function(){this.$el.html("<tr><th>Title</th><th colspan='0'>Actions</th></tr>");var e=new App.Models.Member({_id:$.cookie("Member._id")});e.fetch({async:false});this.roles=e.get("roles");this.collection.each(this.addOne,this);var t;var i=this;$.ajax({url:"/groups/_design/bell/_view/count?group=false",type:"GET",dataType:"json",success:function(e){t=e.rows[0].value;if(i.displayCollec_Resources!=true){var s="<tr><td colspan=7>";var n=t/20;for(var o=0;o<n;o++){if(o==0)s+='<a  class="pageNumber" value="'+o*20+'">Home</a>&nbsp&nbsp';else s+='<a  class="pageNumber" value="'+o*20+'">'+o+"</a>&nbsp&nbsp"}s+="</td></tr>";i.$el.append(s)}}})},render:function(){this.collection.skip=0;this.addAll()}})});$(function(){App.Views.GroupRow=Backbone.View.extend({tagName:"tr",roles:null,events:{"click .destroy":function(e){e.preventDefault();var t=this.model.get("_id");var i=new App.Collections.CourseLevels;var s;i.groupId=t;i.fetch({success:function(){while(s=i.first()){s.destroy()}}});console.log("Course Step Deleted");var n=new App.Collections.StepResultsbyCourse;var s;n.courseId=t;n.fetch({success:function(){while(s=n.first()){s.destroy()}}});console.log("Course Progress Deleted");var o=new App.Collections.EntityInvitation;var s;o.entityId=t;o.fetch({success:function(){while(s=o.first()){s.destroy()}}});var a=new App.Models.CourseSchedule;a.courseId=t;a.fetch({success:function(){a.destroy()}});this.model.destroy();this.remove()},"click .browse":function(e){e.preventDefault();$("#modal").modal({show:true})}},template:$("#template-GroupRow").html(),initialize:function(e){this.roles=e.roles},render:function(){if(this.courseId==null){var e=this.model.toJSON();e.courseId=this.courseId;if(e._id=="_design/bell")return;if(!e.members){e.members=new Array}if(e.courseLeader!=undefined&&e.courseLeader==$.cookie("Member._id")){e.isLeader=1}else{e.isLeader=0}if(this.roles.indexOf("Manager")!=-1||e.courseLeader==$.cookie("Member._id")||e.members.indexOf($.cookie("Member._id"))!=-1){e.viewProgress=1}else{e.viewProgress=0}if(this.roles.indexOf("Manager")!=-1){e.isAdmin=1}else{e.isAdmin=0}this.$el.append(_.template(this.template,e))}else{var e=this.model.toJSON();e.viewProgress=0;e.isAdmin=0;e.isLeader=0;e.courseId=this.courseId;this.$el.append(_.template(this.template,e))}}})});$(function(){App.Views.GroupForm=Backbone.View.extend({className:"form",id:"groupform",prevmemlist:null,btnText:"Continue",events:{"click #sformButton":"setForm","click #uformButton":"setForm","submit form":"setFormFromEnterKey","click #inviteMemberButton":"MemberInvite","click #coursescheduleButton":"CourseSchedule","click #cancel":function(){window.history.back()}},CourseSchedule:function(){var e=new App.Views.CourseScheduleForm;e.courseId=this.model.id;var t;var i=new App.Collections.CourseScheduleByCourse;i.courseId=this.model.id;i.fetch({async:false});if(i.length>0){t=i.first();console.log(t);e.edit=true;e.sid=t.get("_id");e.srevid=t.get("_rev")}e.render();App.$el.children(".body").html('<a id="BackToCourse" onclick = "location.reload()" class="btn btn-info"><< Back To Course</a>');App.$el.children(".body").append('<p id="scheduletitle">'+this.model.get("name")+"|Schedule</p>");App.$el.children(".body").append(e.el);$("#startTime").timepicker();$("#endTime").timepicker();$("#startDate").datepicker();$("#endDate").datepicker();$("#typeView").hide();$(".days").hide();if(i.length>0){t=i.first();$("#startTime").val(t.get("startTime"));$("#endTime").val(t.get("endTime"));$("#startDate").val(t.get("startDate"));$("#endDate").val(t.get("endDate"));$("#location").val(t.get("location"));$("#type").val(t.get("type"));if(t.get("type")=="Weekly"){$("#weekDays").val(t.get("weekDays"))}}$("#type").on("change",function(){if(this.value=="Monthly"){$("#typeView").show();$(".days").hide();$("#typeView").multiDatesPicker()}else if(this.value=="Weekly"){$(".days").show();$("#typeView").hide()}else{$(".days").hide();$("#typeView").hide()}})},MemberInvite:function(){if($("textarea[name='description']").val().length>0){$("#invitationdiv").fadeIn(1e3);document.getElementById("cont").style.opacity=.1;document.getElementById("nav").style.opacity=.1;$("#invitationdiv").show();var e=new App.Models.InviFormModel;e.resId=this.model.get("_id");e.senderId=$.cookie("Member._id");e.type=this.model.get("kind");e.title=this.model.get("name");var t=new App.Views.InvitationForm({model:e});t.description=this.model.get("description");t.render();$("#invitationdiv").html("&nbsp");$("#invitationdiv").append(t.el)}else{alert("Specify course description first")}},getRoles:function(){var e=new App.Models.Member;e.id=$.cookie("Member._id");e.fetch({async:false});return e.get("roles")},render:function(){$("#invitationdiv").hide();var e=this;if(this.model.get("_id")!=undefined){this.prevmemlist=this.model.get("members");this.model.on({"change:statDate":this.sendMail,"change:endDate":this.sendMail,"change:startTime":this.sendMail,"change:endTime":this.sendMail,"change:location":this.sendMail})}if(!this.model.get("languageOfInstruction")){this.model.set("languageOfInstruction","")}this.model.schema.members.options=[];var t=new App.Collections.leadermembers;t.fetch({success:function(){var i=[];i.push({label:"Select....",val:"0000"});t.each(function(e){var t={label:e.toJSON().firstName+" "+e.toJSON().lastName,val:e.toJSON()._id};i.push(t)});e.model.schema.courseLeader.options=i;e.form=new Backbone.Form({model:e.model});e.$el.append(e.form.render().el);e.form.fields["members"].$el.hide();if(e.model.get("_id")==undefined){e.form.fields["Day"].$el.hide()}$(".field-backgroundColor input").spectrum({clickoutFiresChange:true,preferredFormat:"hex"});$(".field-foregroundColor input").spectrum({clickoutFiresChange:true,preferredFormat:"hex"});var s=$('<a class="group btn btn-success" id="sformButton">Continue</button>');var n=$('<a class="group btn btn-success" style="" id="uformButton">Update</button>');var o=$('<a style="margin-left:52%;margin-top: -100px;" role="button" id="ProgressButton" class="btn" href="#course/report/'+e.model.get("_id")+"/"+e.model.get("name")+'"> <i class="icon-signal"></i> Progress</a><a style="margin-top: -100px;"class="btn btn-success" id="inviteMemberButton">Invite Member</button><a style="margin-top: -100px;"class="btn btn-success" id="" href="#course/members/'+e.model.get("_id")+'"> Members</a>');if(e.model.get("_id")!=undefined){e.$el.prepend(o);e.$el.append(n)}else{e.$el.append(s)}e.$el.append("<a class='btn btn-danger' style='margin-left : 20px;' id='cancel'>Cancel</a>")},async:false})},setFormFromEnterKey:function(e){e.preventDefault();this.setForm()},setForm:function(){var e=this;var t=0;this.model.once("sync",function(){Backbone.history.navigate("course/manage/"+e.model.get("id"),{trigger:true})});var i=this.model.get("courseLeader");this.form.commit();this.model.set("name",this.model.get("CourseTitle"));if(this.model.get("_id")==undefined){t=1;this.model.set("members",[$.cookie("Member._id")])}else{this.model.set("members",this.prevmemlist)}if(this.model.get("CourseTitle").length==0){alert("Course Title is missing")}else if(this.model.get("description").length==0){alert("Course description is missing")}else{var s=new App.Models.Member;s.id=$.cookie("Member._id");s.fetch({async:false});if(s.get("roles").indexOf("Leader")==-1){s.get("roles").push("Leader");s.save()}var n=false;var o=this.model.get("courseLeader");var a=this.model.get("members");var l=a.indexOf(i);if(a.indexOf(o)==-1){a.push(o)}else{n=true}this.model.set("members",a);console.log();var r=this;this.model.save(null,{success:function(s){console.log(r.model.get("courseLeader"));var a=new App.Models.membercourseprogress;var l=new Array;var c=new Array;var d=new Array;if(t==1){a.set("stepsIds",l);a.set("memberId",$.cookie("Member._id"));a.set("stepsResult",c);a.set("stepsStatus",d);a.set("courseId",s.get("id"));a.save();if(r.model.get("courseLeader")!=$.cookie("Member._id")&&r.model.get("courseLeader")!="0000"){a.set("stepsIds",l);a.set("memberId",r.model.get("courseLeader"));a.set("stepsResult",c);a.set("stepsStatus",d);a.set("courseId",s.get("id"));a.save()}alert("Course successfully Created.")}else{if(o!==i&&n===false){var u=new App.Collections.coursesteps;u.courseId=r.model.get("_id");u.fetch({success:function(){u.each(function(e){l.push(e.get("_id"));c.push("0");d.push("0")});a.set("stepsIds",l);a.set("memberId",o);a.set("stepsResult",c);a.set("stepsStatus",d);a.set("courseId",u.courseId);a.save({success:function(){alert("saved")}})}})}var p=new App.Models.Group;p.id=e.model.get("_id");p.fetch({async:false});e.model.set("_rev",p.get("_rev"));alert("Course successfully Updated.")}}})}},sendMail:function(e){memberList=e._previousAttributes.members;for(var t=0;t<memberList.length;t++){var i=new App.Models.Member({_id:memberList[t]});i.fetch({async:false});var s=new Date;var n=new App.Models.Mail;n.set("senderId",$.cookie("Member._id"));n.set("receiverId",i.get("_id"));n.set("subject","Change of Course Schedule | "+e.get("name"));var o="<b>Schedule is changed </b><br><br>New Schedule is:<br> Duration:   "+e.get("startDate")+"  to  "+e.get("endDate")+"<br>";o+="Timing:        "+e.get("startTime")+"  to  "+e.get("endTime");o+="<br>Locatoin:      "+e.get("location");n.set("body",o);n.set("status","0");n.set("type","mail");n.set("sentDate",s);n.save()}}})});$(function(){App.Views.GroupView=Backbone.View.extend({tagName:"table",className:"table table-striped",roles:null,events:{"click #admissionButton":function(e){}},render:function(){console.log(this.model);this.addCourseDetails()},addCourseDetails:function(){var e=this;var t=this.model.toJSON();var i=this.courseLeader.toJSON();console.log(t);console.log(i);this.$el.append("<tr><td><b>Name</b></td><td>"+t.CourseTitle+"</td></tr>");this.$el.append("<tr><td><b>Subject Level </b></td><td>"+t.subjectLevel+"</td></tr>");this.$el.append("<tr><td><b>Grade Level </b></td><td>"+t.gradeLevel+"</td></tr>");this.$el.append("<tr><td><b>Description</b></td><td>"+t.description+"</td></tr>");this.$el.append("<tr><td><b>Leader Name </b></td><td>"+i.firstName+" "+i.lastName+"</td></tr>");this.$el.append("<tr><td><b>Leader Email </b></td><td>"+i.email+"</td></tr>");this.$el.append("<tr><td><b>Leader Phone Number </b></td><td>"+i.phone+"</td></tr>");this.$el.append("<tr><td><b>schedule</b></td><td>Date :  "+t.startDate+"-"+t.endDate+"<br>Time :  "+t.startTime+"- "+t.endTime+"</td></tr>");this.$el.append("<tr><td><b>Location </b></td><td>"+t.location+"</td></tr>")}})});$(function(){App.Views.CourseStepsView=Backbone.View.extend({tagName:"table",className:"table table-striped",roles:null,addOne:function(e){},render:function(){this.collection.each(this.addStep,this)},addStep:function(e){this.$el.append("<tr><td></td><td><b>"+e.get("title")+"</b></br></br>"+e.get("description")+"</td></tr>")}})});$(function(){App.Views.BecomeMemberForm=Backbone.View.extend({className:"form",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey"},render:function(){this.form=new Backbone.Form({model:this.model});this.$el.append(this.form.render().el);this.form.fields["status"].$el.hide();this.form.fields["yearsOfTeaching"].$el.hide();this.form.fields["teachingCredentials"].$el.hide();this.form.fields["subjectSpecialization"].$el.hide();this.form.fields["forGrades"].$el.hide();this.form.fields["visits"].$el.hide();var e=this;var t=$('<a class="btn btn-success" id="formButton">Save</button>');this.$el.append(t)},setFormFromEnterKey:function(e){e.preventDefault();this.setForm()},setForm:function(){if(this.form.validate()!=null){return}var e=this;this.model.once("sync",function(){alert("Thank you for becoming a member");$.cookie("Member.login",e.model.get("login"),{path:"/apps/_design/bell/lms"});$.cookie("Member._id",e.model.get("id"),{path:"/apps/_design/bell/lms"});$.cookie("Member.login",e.model.get("login"),{path:"/apps/_design/bell/personal"});$.cookie("Member._id",e.model.get("id"),{path:"/apps/_design/bell/personal"});e.trigger("BecomeMemberForm:done")});this.form.setValue({status:"active"});this.form.commit();var t=true;var i=new App.Collections.Members;i.fetch({async:false});i.each(function(i){if(i.get("login")==e.model.get("login")){alert("Login already exist");t=false}});if($.inArray("lead",this.model.get("roles"))==-1){e.model.set("yearsOfTeaching",null);e.model.set("teachingCredentials",null);e.model.set("subjectSpecialization",null);e.model.set("forGrades",null)}this.model.set("visits",0);if(t){this.model.save()}}})});$(function(){App.Views.CoursesStudentsProgress=Backbone.View.extend({tagName:"div",className:"Graphbutton",arrayOfData:new Array,grandpassed:null,grandremaining:null,totalRecords:null,startFrom:null,totalSpace:null,events:{"click #Donut":function(){$("#graph").html(" ");document.getElementById("horizontallabel").style.visibility="hidden";document.getElementById("veticallable").style.visibility="hidden";this.$el.html('<a class="btn btn-info" id="Bar">Detailed View</a>');Morris.Donut({element:"graph",data:[{label:"Passed Steps",value:this.grandpassed},{label:"Remaining Steps",value:this.grandremaining}],colors:["#0B62A4","#7A92A3"]})},"click #Bar":function(){$("#graph").html(" ");document.getElementById("horizontallabel").style.visibility="visible";document.getElementById("veticallable").style.visibility="visible";this.$el.html('<a class="btn btn-info" id="Donut">Birdeye View</a>');Morris.Bar({element:"graph",data:this.arrayOfData,xkey:"subject",ykeys:["passed","remaining"],labels:["passed","remaining"],gridTextWeight:900,gridTextSize:16,axes:true,grid:true,stacked:true})}},addOne:function(e){var t=this;temp=new Object;data=e.toJSON().stepsStatus;total=e.toJSON().stepsStatus.length;passed=0;remaining=0;for(var i=0;i<total;i++){if(data[i]!="1"){remaining++;this.grandremaining++}else{passed++;this.grandpassed++}}student=new App.Models.Member({_id:e.toJSON().memberId});student.fetch({async:false});console.log(student.toJSON());if(student.toJSON().firstName!=undefined){temp.name=student.toJSON().firstName;temp.passed=passed;temp.remaining=remaining;this.arrayOfData.push(temp);var s=new App.Collections.AssignmentPapers;s.senderId=e.get("memberId");s.courseId=e.get("courseId");s.fetch({async:false});var n=this.startFrom+this.totalSpace/2-8;var o='<table style="margin-top:14px;margin-left: '+n+'%; position:absolute ">';s.each(function(e){var t="/assignmentpaper/"+e.get("_id")+"/";var i="";if(typeof e.get("_attachments")!=="undefined"){t=t+_.keys(e.get("_attachments"))[0];i=_.keys(e.get("_attachments"))[0]}o=o+'<tr><td><a href="'+t+'" target="_blank" ><button class="btn btn-primary">Paper for Step No. '+e.get("stepNo")+"</button></td></tr></a>"});o=o+"</table>";this.$el.append(o);this.startFrom=this.startFrom+this.totalSpace}},BuildString:function(){if(this.collection.length!=0){this.startFrom=4;this.totalRecords=this.collection.length;this.totalSpace=93/this.collection.length;this.collection.each(this.addOne,this)}else{alert("No Data Found on Server")}},render:function(){this.arrayOfData=[];this.grandpassed=0;this.grandremaining=0;this.BuildString();Morris.Bar({element:"graph",data:this.arrayOfData,xkey:"name",ykeys:["passed","remaining"],labels:["passed","remaining"],gridTextWeight:900,gridTextSize:12,axes:true,grid:true,stacked:true,xLabelMargin:5})}})});$(function(){App.Views.CourseInfoView=Backbone.View.extend({authorName:null,tagName:"table",className:"courseInfo-table",initialize:function(){this.$el.html('<th colspan="20">Course Information</th>')},add:function(e){},render:function(){var e=this.model.toJSON();var t=this.leader.toJSON();this.$el.append("<tr><td>Name : </td><td>"+e.name+"</td></tr>");this.$el.append("<tr><td>Levels : </td><td>"+e.subjectLevel+"</td></tr>");this.$el.append("<tr><td>Description : </td><td>"+e.description+"</td></tr>");this.$el.append("<tr><td>Leader Name: </td><td>"+t.firstName+" "+t.lastName+"</td></tr>");this.$el.append("<tr><td>Leader Email : </td><td>"+t.email+"</td></tr>");this.$el.append("<tr><td>Leader Phone Number : </td><td>"+t.phone+"</td></tr>");var i="";var s="";if(e.backgroundColor=="")i="Not Set";this.$el.append('<tr><td>Background Color : </td><td><div style="border:2px solid black;width:50px;height:20px;background-color:'+e.backgroundColor+'"></div>'+i+"</td></tr>");if(e.foregroundColor=="")s="Not Set";this.$el.append('<tr><td>foreground Color :</td><td><div style="border:2px solid black;width:50px;height:20px;background-color:'+e.foregroundColor+'"></div>'+s+"</td></tr>")}})});$(function(){App.Views.GroupMembers=Backbone.View.extend({vars:{},initialize:function(){},events:{"click  #selectAllMembers":"selectAllMembers","click  .removeMember":"removeMember","click #retrunBack":function(e){history.back()}},selectAllMembers:function(){if($("#selectAllMembers").text()=="Select All"){$("input[name='courseMember']").each(function(){$(this).prop("checked",true)});$("#selectAllMembers").text("Unselect All")}else{$("input[name='courseMember']").each(function(){$(this).prop("checked",false)});$("#selectAllMembers").text("Select All")}},removeMember:function(e){var t=e.currentTarget.value;var i=this;var s=new App.Models.Group({_id:this.courseId});s.fetch({success:function(e){members=e.get("members");members.splice(members.indexOf(t),1);e.set("members",members);e.save();memberCoursePro=new App.Collections.membercourseprogresses;memberCoursePro.memberId=t;memberCoursePro.courseId=i.courseId;memberCoursePro.fetch({async:false});while(model=memberCoursePro.first()){model.destroy()}i.render();alert("Member is Removed From Course")}})},render:function(){var e=new App.Models.Group({_id:this.courseId});e.fetch({async:false});var t=e.get("members");var i=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var s=new i;s.fetch({async:false});var n=s.first().toJSON();var o=n.rows[0].doc.code;var a=n.rows[0].doc.nationName.substring(3,5);this.$el.html('<h3 style="margin-left:5%">Course Members | '+e.get("name")+"</h3>");var l='<table class="btable btable-striped"><th>Photo</th><th colspan=3>Name</th>';for(var r=0;r<t.length;r++){var c=new App.Models.Member({_id:t[r]});c.fetch({async:false});var d=c.get("login")+"."+o+a+"@olebell.org";var u="img/default.jpg";var p="/members/"+c.id+"/";if(typeof c.get("_attachments")!=="undefined"){p=p+_.keys(c.get("_attachments"))[0];u=p}l+='<tr><td><img width="45px" height="45px" src="'+u+'"/></td><td>'+c.get("firstName")+" "+c.get("lastName")+'</td><td><input type="checkbox" name="courseMember" value="'+d+'">Send mail</td>';if($.cookie("Member._id")==e.get("courseLeader")){l+='<td><button class="btn btn-danger removeMember" value="'+c.get("_id")+'">Remove</button></td>'}l+="</tr>"}l+='<tr><td></td><td></td><td><button class="btn"  id="selectAllMembers">Select All</button><button style="margin-left:10px" class="btn" onclick=showComposePopupMultiple("'+d+'") id="sendMailButton">Send Mail</button><button class="btn" style="margin-left:10px"  id="retrunBack">Back</button></td></tr>';l+="</table>";this.$el.append(l)}})});$(function(){App.Views.InvitationForm=Backbone.View.extend({id:"invitationForm",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey","click #cancelButton":"hidediv"},title:null,entityId:null,type:null,senderId:null,hidediv:function(){$("#invitationdiv").fadeOut(1e3);document.getElementById("cont").style.opacity=1;document.getElementById("nav").style.opacity=1;setTimeout(function(){$("#invitationdiv").hide()},1e3)},SetParams:function(e,t,i,s){this.title=e;this.entityId=t;this.type=i;this.senderId=s},render:function(){console.log(this.model);var e=new App.Collections.Members;var t=this;var i=this;i.on("InvitationForm:MembersReady",function(){console.log(t.model.schema);this.model.schema.members.options=e;this.form=new Backbone.Form({model:i.model});this.$el.append(this.form.render().el);this.form.fields["members"].$el.hide();this.form.fields["levels"].$el.hide();this.form.fields["invitationType"].$el.change(function(){var e=t.form.fields["invitationType"].$el.find("option:selected").text();if(e=="Members"){t.form.fields["members"].$el.show();t.form.fields["levels"].$el.hide()}else if(e=="Level"){t.form.fields["members"].$el.hide();t.form.fields["levels"].$el.show()}else{t.form.fields["members"].$el.hide();t.form.fields["levels"].$el.hide()}});var s=$('<a class="btn btn-success" id="formButton">Invite</button>');this.$el.append(s);this.$el.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");this.$el.append('<a class="btn btn-danger" id="cancelButton">Cancel</button>')});e.once("sync",function(){i.trigger("InvitationForm:MembersReady")});e.fetch()},setFormFromEnterKey:function(e){e.preventDefault();this.setForm()},setForm:function(){var e=new App.Models.Member({_id:$.cookie("Member._id")});e.fetch({async:false});this.form.commit();var t=new App.Collections.Members;t.fetch({async:false});var i;var s=this;var n=new Date;if(this.model.get("invitationType")=="All"){t.each(function(e){i=new App.Models.Mail;i.set("senderId",s.model.senderId);i.set("receiverId",e.get("_id"));i.set("status","0");i.set("subject","Course Invitation | "+s.model.title);i.set("type","course-invitation");i.set("body",s.description+'<br/><br/><button class="btn btn-primary" id="invite-accept" value="'+s.model.resId+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+s.model.resId+'" >Reject</button>');i.set("sendDate",n);i.set("entityId",s.model.resId);i.save()})}else if(this.model.get("invitationType")=="Members"){
t.each(function(e){var t=s;if(s.model.get("members").indexOf(e.get("_id"))>-1){i=new App.Models.Mail;i.set("senderId",s.model.senderId);i.set("receiverId",e.get("_id"));i.set("status","0");i.set("subject","Course Invitation | "+s.model.title);i.set("body",s.description+'<br/><br/><button class="btn btn-primary" id="invite-accept" value="'+s.model.resId+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+s.model.resId+'" >Reject</button>');i.set("type","course-invitation");i.set("sendDate",n);i.set("entityId",s.model.resId);i.save();console.log(i)}})}else{t.each(function(e){var t=e.get("levels");if(s.model.get("levels").indexOf(t[0])>-1){i=new App.Models.Mail;i.set("senderId",s.model.senderId);i.set("receiverId",e.get("_id"));i.set("status","0");i.set("subject","Course Invitation | "+s.model.title);i.set("body",s.description+'<br/><br/><button class="btn btn-primary" id="invite-accept" value="'+s.model.resId+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+s.model.resId+'" >Reject</button>');i.set("type","course-invitation");i.set("sendDate",n);i.set("entityId",s.model.resId);i.save()}})}$("#invitationdiv").fadeOut(1e3);alert("Invitation sent successfully");document.getElementById("cont").style.opacity=1;document.getElementById("nav").style.opacity=1;setTimeout(function(){$("#invitationdiv").hide()},1e3)}})});$(function(){App.Views.CourseSearch=Backbone.View.extend({template:$("#template-Search").html(),vars:{},groupresult:null,resultArray:null,initialize:function(){this.groupresult=new App.Collections.SearchCourses;this.resultArray=[];enablenext=0},render:function(){var e=this;if(searchText!=""){this.fetchRecords()}},fetchRecords:function(){var e=this;this.groupresult.fetch({success:function(){e.resultArray.push.apply(e.resultArray,e.searchInArray(e.groupresult.models,searchText));if(e.resultArray.length!=searchRecordsPerPage&&e.groupresult.models.length==limitofRecords){e.fetchRecords()}else if(e.groupresult.models.length==0){previousPageButtonPressed()}else if(e.groupresult.models.length<limitofRecords&&e.resultArray.length==0&&skipStack.length==1){$("#not-found").html("No Such Record Exist");$("#selectAllButton").hide()}else{var t=new Backbone.Collection;if(e.resultArray.length>0){t.set(e.resultArray);var i=new App.Views.GroupsTable({collection:t});i.resourceids=e.resourceids;i.render();$(".body").append(i.el)}else{$("#not-found").html("No Such Record Exist");$("#not-found").show()}}}})},searchInArray:function(e,t){var i=this;var s=[];var n;if(t!=""){_.each(e,function(e){if(e.get("name")!=null){skip++;if(e.get("name").toLowerCase().indexOf(t.toLowerCase())>=0){if(s.length<searchRecordsPerPage){s.push(e)}else{enablenext=1;skip--}}else if(s.length>=searchRecordsPerPage){skip--}}})}return s}})});$(function(){App.Views.QuizView=Backbone.View.extend({template:$("#make-Quiz").html(),vars:{},quizQuestions:null,questionOptions:null,answers:null,currentQuestion:null,events:{"click .EditQuestiontoView":"EditQuestiontoView","click #delete-quiz-question":"deleteQuestion","click #cancel-edit-question":function(e){this.render();this.displayQuestionsInView()},"click #cancel-quiz":function(){Backbone.history.navigate("level/view/"+this.levelId+"/"+this.revId,{trigger:true})},"click #cancel-new-question":function(){$("textarea#quizQuestion").val("");$("#option1").val("");$("#option2").val("");$("#option3").val("");$("#option4").val("");$("#option5").val("");$("input[name=options]:checked").each(function(){this.checked=false})},"click #save-new-question":function(e){this.savequestion()},"click #save-edit-question":function(e){this.savequestion();this.render();this.displayQuestionsInView()},"click #save-quiz":function(e){var t=new App.Models.CourseStep({_id:this.levelId,_rev:this.revId});t.fetch({async:false});t.set("questions",this.quizQuestions);t.set("qoptions",this.questionOptions);t.set("answers",this.answers);var i=this;t.save(null,{success:function(e,t){alert("Quiz Successfully Saved");Backbone.history.navigate("level/view/"+t.id+"/"+t.rev,{trigger:true})}})}},savequestion:function(e){if(!this.validQuestionAndOptions()){alert("invalid inputs")}else{this.saveQuestionAndOptions();$("#question-no").html("Question :");$("textarea#quizQuestion").val("");$("#option1").val("");$("#option2").val("");$("#option3").val("");$("#option4").val("");$("#option5").val("");$("input[name=options]:checked").each(function(){this.checked=false})}},displayQuestionInView:function(e){var t=e;t++;$("#question-no").html("Question "+t+":");$("textarea#quizQuestion").val(this.quizQuestions[e]);$("#option1").val(this.questionOptions[e*5]);$("#option2").val(this.questionOptions[e*5+1]);$("#option3").val(this.questionOptions[e*5+2]);$("#option4").val(this.questionOptions[e*5+3]);$("#option5").val(this.questionOptions[e*5+4]);$("input[name=options]:checked").each(function(){this.checked=false});var i=this.questionOptions.indexOf(this.answers[e]);if(i>=0){var s=i%5;var n=document.getElementsByName("options");n[s].checked=true}},saveQuestionAndOptions:function(){this.quizQuestions[this.currentQuestion]=$("textarea#quizQuestion").val();this.questionOptions[this.currentQuestion*5]=$("#option1").val();this.questionOptions[this.currentQuestion*5+1]=$("#option2").val();this.questionOptions[this.currentQuestion*5+2]=$("#option3").val();this.questionOptions[this.currentQuestion*5+3]=$("#option4").val();this.questionOptions[this.currentQuestion*5+4]=$("#option5").val();this.answers[this.currentQuestion]=$("#"+$("input[name=options]:checked").val()).val();this.displayQuestionsInView()},displayQuestionsInView:function(){$("#listofquestions").html("");for(var e=0;e<this.quizQuestions.length;e++){this.AddQuestiontoView(e)}this.currentQuestion=this.quizQuestions.length},AddQuestiontoView:function(e){var t='<tr><td colspan="6"><h6>Question# '+(e+1)+"&nbsp&nbsp<a name="+e+' class="EditQuestiontoView btn btn-info">Edit</a>&nbsp&nbsp<button value="'+e+'" class="btn btn-danger" id="delete-quiz-question" >Delete</button></h6>'+this.quizQuestions[e]+"</td></tr>";t+="<tr>";t+="<td><b>Options</b></td>";t+="<td>"+this.questionOptions[e*5]+"</td>";t+="<td>"+this.questionOptions[e*5+1]+"</td>";t+="<td>"+this.questionOptions[e*5+2]+"</td>";t+="<td>"+this.questionOptions[e*5+3]+"</td>";t+="<td>"+this.questionOptions[e*5+4]+"</td>";t+="<td><b>"+this.answers[e]+"<b></td>";t+="</tr>";t+='<tr><td colspan="7"><div id="'+e+'"></div></td></tr>';$("#listofquestions").append(t)},EditQuestiontoView:function(e){this.currentQuestion=e.currentTarget.name;this.displayQuestionInView(this.currentQuestion);$("#question-div").appendTo("#"+this.currentQuestion);$("#save-edit-question").show();$("#cancel-edit-question").show();$("#save-new-question").hide();$("#cancel-new-question").hide()},deleteQuestion:function(e){this.currentQuestion=e.currentTarget.value;this.quizQuestions.splice(this.currentQuestion,1);this.questionOptions.splice(this.currentQuestion*5,5);this.answers.splice(this.currentQuestion,1);this.render();this.displayQuestionsInView()},validQuestionAndOptions:function(){var e=0;if(typeof $("textarea#quizQuestion").val()==="undefined"||$("textarea#quizQuestion").val()==""){return false}else if(typeof $("#option1").val()==="undefined"||$("#option1").val()==""){return false}else if(typeof $("#option2").val()==="undefined"||$("#option2").val()==""){return false}else if(typeof $("#option3").val()==="undefined"||$("#option3").val()==""){return false}else if(typeof $("#option4").val()==="undefined"||$("#option4").val()==""){return false}else if(typeof $("#option5").val()==="undefined"||$("#option5").val()==""){return false}else if(typeof $("input[name=options]:checked").val()==="undefined"||$("input[name=options]:checked").val()==""){return false}else{return true}},initialize:function(){this.quizQuestions=new Array;this.questionOptions=new Array;this.answers=new Array;this.currentQuestion=0},render:function(){var e=this;this.vars.courseTitle=this.ltitle;this.$el.html(_.template(this.template,this.vars));$("#save-edit-question").hide();$("#cancel-edit-question").hide()}})});$(function(){App.Views.takeQuizView=Backbone.View.extend({Questions:{},Optns:{},Score:0,Correctanswers:{},Givenanswers:new Array,index:-1,TotalCount:0,tagName:"form",id:"questionForm",mymodel:null,events:{"click #exitPressed":function(e){$("div.takeQuizDiv").hide();document.getElementById("cont").style.opacity="1";document.getElementById("nav").style.opacity="1"},"click #finishPressed":function(e){$("div.takeQuizDiv").hide();location.reload();document.getElementById("cont").style.opacity="1";document.getElementById("nav").style.opacity="1"},"click #nextPressed":function(e){if($("input:radio[name='optn']:checked").val()!=undefined){this.Givenanswers.push(decodeURI($("input:radio[name='optn']:checked").val()));console.log(this.Givenanswers);console.log(this.Correctanswers);if(this.Givenanswers[this.index]==this.Correctanswers[this.index]){console.log("corre");this.Score++}this.renderQuestion()}else{alert("no option selected")}}},initialize:function(){this.Correctanswers=this.options.answers;this.Questions=this.options.questions;this.Optns=this.options.options;this.stepId=this.options.stepId;this.TotalCount=this.Questions.length;this.pp=parseInt(this.options.passP);console.log(this.pp);this.myModel=this.options.resultModel;this.stepindex=this.options.stepIndex;this.Givenanswers=[];console.log("==============================");console.log(this.Correctanswers,"Correctanswers");console.log(this.Questions,"Questions");console.log(this.Optns,"Optns");console.log(this.stepId,"stepId");console.log(this.TotalCount,"TotalCount");console.log(this.pp,"pp");console.log(this.myModel,"myModel");console.log(this.stepindex,"stepindex");console.log(this.Givenanswers,"Givenanswers");console.log("==============================")},renderQuestion:function(){console.log(this.index+1);console.log(this.TotalCount);if(this.index+1!=this.TotalCount){this.index++;var e=this.index*5;this.$el.html("&nbsp");this.$el.append('<div class="Progress" style="float:right;"><p>'+(this.index+1)+"/"+this.TotalCount+"</p> </div>");this.$el.append('<div class="quizText"><textarea disabled>'+this.Questions[this.index]+"</textarea> </div>");o0=encodeURI(this.Optns[e]);o1=encodeURI(this.Optns[e+1]);o2=encodeURI(this.Optns[e+2]);o3=encodeURI(this.Optns[e+3]);o4=encodeURI(this.Optns[e+4]);this.$el.append('<div class="quizOptions"><input type="radio" name="optn" value='+o0+">"+this.Optns[e]+'<br><input type="radio" name="optn" value='+o1+">"+this.Optns[e+1]+"<br>"+'<input type="radio" name="optn" value='+o2+">"+this.Optns[e+2]+"<br>"+'<input type="radio" name="optn" value='+o3+">"+this.Optns[e+3]+"<br>"+'<input type="radio" name="optn" value='+o4+">"+this.Optns[e+4]+"</div>");this.$el.append('<div class="quizActions" ><button class="btn btn-danger" id="exitPressed">Exit</button><button class="btn btn-primary" id="nextPressed">Next</button></div>')}else{this.$el.html("&nbsp");var t=Math.round(this.Score/this.TotalCount*100);console.log(t);this.$el.append('<div class="quizText"><h4>You Scored '+Math.round(this.Score/this.TotalCount*100)+"%<h4></div>");this.$el.append('<div class="quizActions" ><button class="btn btn-info" id="finishPressed">Finish</button></div>');var i=this.myModel.get("stepsStatus");var s=this.myModel.get("stepsResult");if(this.pp<=t){i[this.stepindex]="1";this.myModel.set("stepsStatus",i)}s[this.stepindex]=t.toString();this.myModel.set("stepsResult",s);this.myModel.save(null,{success:function(e,t){console.log("Result Saved!")},error:function(){console.log("Not Saved")}});if(this.pp<=t){this.$el.append("</BR><p>You have Passed this Level</p>")}else{this.$el.append("</BR><p>You are unable to pass this Level. Read carefully and try again</p>")}}},start:function(){$("div.takeQuizDiv").show();this.renderQuestion()},render:function(){document.getElementById("cont").style.opacity="0.1";document.getElementById("nav").style.opacity="0.1";this.start()}})});$(function(){App.Views.LevelForm=Backbone.View.extend({className:"form",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey","click #retrunBack":function(e){history.back()},"click #addresources":function(e){this.addResource=true;this.setForm()}},render:function(){var e=this;this.form=new Backbone.Form({model:e.model});this.$el.append(this.form.render().el);this.form.fields["courseId"].$el.hide();this.form.fields["questions"].$el.hide();this.form.fields["qoptions"].$el.hide();this.form.fields["answers"].$el.hide();this.form.fields["resourceId"].$el.hide();this.form.fields["resourceTitles"].$el.hide();var t='<a class="btn btn-success" id="retrunBack"> Back </button>';t+='<a class="btn btn-success" id="formButton">Save</button>';t+='<a class="btn btn-success" id="addresources">Add Resource</button>';this.$el.append(t)},setFormFromEnterKey:function(e){e.preventDefault();this.setForm()},setForm:function(){var e=this;this.model.once("sync",function(){var t=e.model.get("id");var i=e.model.get("rev");var s=e.model.get("title");console.log(e.model);if(e.edit!=true){var n=new App.Collections.StepResultsbyCourse;n.courseId=e.model.get("courseId");n.fetch({success:function(){n.each(function(t){var i=t.get("stepsIds");var s=t.get("stepsResult");var n=t.get("stepsStatus");i.push(e.model.get("id"));s.push("0");n.push("0");t.set("stepsIds",i);t.set("stepsResult",s);t.set("stepsStatus",n);t.save()})}});if(e.addResource){window.location.href="#search-bell/"+t+"/"+i}else{Backbone.history.navigate("course/manage/"+e.model.get("courseId"),{trigger:true})}}else{Backbone.history.navigate("level/view/"+t+"/"+i,{trigger:true})}});this.form.commit();if(isNaN(this.model.get("allowedErrors"))){alert("Not a valid Allowed Errors")}else if(isNaN(this.model.get("step"))){alert("Not a valid Step Number")}else{if(!this.edit){this.model.set("questions",null);this.model.set("answers",null);this.model.set("qoptions",null);this.model.set("resourceId",[]);this.model.set("resourceTitles",[])}else{this.model.set("questions",this.ques);this.model.set("answers",this.ans);this.model.set("qoptions",this.opt);this.model.set("resourceId",this.res);this.model.set("resourceTitles",this.rest)}levels=new App.Collections.CourseLevels;levels.groupId=this.model.get("courseId");levels.fetch({success:function(){levels.sort();var t=true;if(e.edit){if(e.previousStep!=e.model.get("step")){levels.each(function(i){if(i.get("step")==e.model.get("step"))t=false})}}else{levels.each(function(i){if(i.get("step")==e.model.get("step")){t=false}})}if(t)e.model.save();else alert("Step already exists")}})}}})});$(function(){App.Views.LevelDetail=Backbone.View.extend({events:{"click .remover":function(e){var t=this;var i=e.currentTarget.value;var s=this.model.get("resourceTitles");var n=this.model.get("resourceId");var o=n.indexOf(i);n.splice(o,1);s.splice(o,1);this.model.set("resourceId",n);this.model.set("resourceTitles",s);this.model.save(null,{success:function(e,s){t.model.set("_rev",s.rev);$("#"+i.replace(".","\\.")).remove()}})},"click .removeAttachment":function(e){var t=this;var i=e.currentTarget.value;$.ajax({url:"/coursestep/"+this.model.get("_id")+"/"+_.keys(this.model.get("_attachments"))[i]+"?rev="+this.model.get("_rev"),type:"DELETE",success:function(e,i,s){alert("Successfully deleted.");App.Router.ViewLevel(t.model.get("_id"),t.model.get("_rev"))}})},"click .levelResView":function(e){var t=e.currentTarget.attributes[0].value;var i=this.model.get("_id");var s=this.model.get("_rev");Backbone.history.navigate("resource/atlevel/feedback/"+t+"/"+i+"/"+s,{trigger:true})},"click #addInstructions":function(e){var t=document.forms["fileAttachment"]["_attachments"];t.click()},"change #_attachments":function(e){var t=this;var i=$('input[type="file"]');var s=i.val().split(".");if(i.val()!=""&&s[s.length-1]!="doc"&&s[s.length-1]!="pdf"&&s[s.length-1]!="mp4"&&s[s.length-1]!="ppt"&&s[s.length-1]!="docx"&&s[s.length-1]!="pptx"&&s[s.length-1]!="jpg"&&s[s.length-1]!="jpeg"&&s[s.length-1]!="png"&&s[s.length-1]!="mp4"&&s[s.length-1]!="mov"&&s[s.length-1]!="mp3"){alert("Invalid attatchment.");return}if($('input[type="file"]').val()){this.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev")}else{alert("no attachment")}this.model.on("savedAttachment",function(){alert("Assignement successfully submitted.");App.Router.ViewLevel(t.model.get("_id"),t.model.get("_rev"))},this.model)}},render:function(){var e=0;var t=this.model.get("resourceTitles");var i=this.model.get("resourceId");var s='</BR><table class="table table-striped">';if(this.model.get("resourceTitles")){for(e=0;e<this.model.get("resourceTitles").length;e++){var n=new App.Models.Resource({_id:i[e]});n.fetch({async:false});if(!n.get("hidden")){if(n.get("_attachments")){s=s+("<tr id='"+i[e]+"'><td>"+t[e]+"</td><td><a class='levelResView btn btn-info' href='/apps/_design/bell/bell-resource-router/index.html#open/"+i[e]+"'  target='_blank' value='"+i[e]+"'><i class='icon-eye-open'></i>View</a></td><td><button class='remover btn btn-danger' value='"+i[e]+"'>Remove </button><input type='hidden' id='"+i[e]+"' value='"+t[e]+"'/>")}else{s=s+("<tr id='"+i[e]+"'><td>"+t[e]+"</td><td>No Attachment</td><td><button class='remover btn btn-danger' value='"+i[e]+"'>Remove </button><input type='hidden' id='"+i[e]+"' value='"+t[e]+"'/>")}}}s=s+"</table>";this.$el.append(s);this.$el.append('<br/><br/><B>Instructions</B>&nbsp;&nbsp;<a class="btn btn-success"  style="" id="addInstructions">Add</a><br/><br/>');var o='<form method="post" id="fileAttachment">';o=o+'<input type="file" name="_attachments" id="_attachments" multiple="multiple" style="display: none" /> ';o=o+'<input class="rev" type="hidden" name="_rev"></form>';this.$el.append(o);if(!this.model.get("_attachments")){return}var a='<table class="table table-striped">';for(e=0;e<_.keys(this.model.get("_attachments")).length;e++){var l="/coursestep/"+this.model.get("_id")+"/";var r="";if(typeof this.model.get("_attachments")!=="undefined"){l=l+_.keys(this.model.get("_attachments"))[e];r=_.keys(this.model.get("_attachments"))[e]}a=a+("<tr><td>"+r+"</td><td><a class='btn btn-info' href='"+l+"'  target='_blank' ><i class='icon-eye-open'></i>View</a></td><td><button class='removeAttachment btn btn-danger' value='"+e+"'>Remove </button><input type='hidden'/>")}a=a+"</table>";this.$el.append(a)}}})});$(function(){App.Views.LevelsTable=Backbone.View.extend({tagName:"table",changedSteps:null,className:"btable btable-striped",events:{"click #Rearrange":function(e){if($("input[type='radio']").is(":visible")){$("#Rearrange").text("Rearrange");for(var t=0;t<this.changedSteps.length;t++){this.collection.models[this.changedSteps[t]].save()}this.changedSteps.remove;$("input[type='radio']").hide();$("#moveup").hide();$("#movedown").hide()}else{$("#Rearrange").text("Save");$("input[type='radio']").show();$("#moveup").show();$("#movedown").show()}},"click #moveup":function(e){var t;var i=0;var s=document.getElementsByName("stepRow");for(var n=0;n<s.length;n++){if(s[n].checked){t=s[n].parentNode.parentNode;if(n>0){this.collection.models[n].set("step",n);this.collection.models[n-1].set("step",n+1);this.changeColumnHtml(this.collection.models[n].get("step"),this.collection.models[n].get("title"),s[n].parentNode,true);this.changeColumnHtml(this.collection.models[n-1].get("step"),this.collection.models[n-1].get("title"),s[n-1].parentNode,false);var o=this.collection.models[n];this.collection.models[n]=this.collection.models[n-1];this.collection.models[n-1]=o;if(this.changedSteps.indexOf(n)==-1){this.changedSteps.push(n)}if(this.changedSteps.indexOf(n-1)==-1){this.changedSteps.push(n-1)}}break}}var a=t.previousSibling;var l=t.parentNode;if(a){l.removeChild(t);l.insertBefore(t,a)}},"click #movedown":function(e){var t;var i=0;var s=document.getElementsByName("stepRow");for(var n=0;n<s.length;n++){if(s[n].checked){t=s[n].parentNode.parentNode;if(n<s.length-1){this.collection.models[n].set("step",n+2);this.collection.models[n+1].set("step",n+1);this.changeColumnHtml(this.collection.models[n].get("step"),this.collection.models[n].get("title"),s[n].parentNode,true);this.changeColumnHtml(this.collection.models[n+1].get("step"),this.collection.models[n+1].get("title"),s[n+1].parentNode,false);var o=this.collection.models[n];this.collection.models[n]=this.collection.models[n+1];this.collection.models[n+1]=o;if(this.changedSteps.indexOf(n)==-1){this.changedSteps.push(n)}if(this.changedSteps.indexOf(n+1)==-1){this.changedSteps.push(n+1)}}break}}var a=t.nextSibling;var l=t.parentNode;if(a.nextSibling){l.removeChild(t);l.insertBefore(t,a.nextSibling)}else{l.removeChild(t);l.appendChild(t)}console.log(this.collection.models)}},changeColumnHtml:function(e,t,i,s){if(s){$(i).html('<input type="radio" name="stepRow" checked="checked" />&nbsp;&nbsp;Step '+e+" : "+t)}else{$(i).html('<input type="radio" name="stepRow" />&nbsp;&nbsp;Step '+e+" : "+t)}},addOne:function(e){var t=this;var i=new App.Views.LevelRow({model:e});i.on("levelDeleted",function(){var e=i.model.get("step");for(var s=e;s<t.collection.models.length;s++){t.collection.models[s].set("step",s);t.updateModel(t.collection.models[s])}alert("Step successfully deleted.");t.collection.models.splice(e-1,1);if(t.collection.models.length==0){$("#moveup").hide();$("#movedown").hide();$("#Rearrange").hide()}$("#addstep").attr("onClick","document.location.href='#level/add/"+t.groupId+"/nolevel/"+t.collection.models.length+"' ");location.reload()});i.render();this.$el.append(i.el)},updateModel:function(e){e.save({success:function(){}})},addAll:function(){this.collection.each(this.addOne,this)},initialize:function(){this.changedSteps=new Array},render:function(){this.$el.append('<br/><button class="btn btn-success" id="addstep"  onclick = "document.location.href=\'#level/add/'+this.groupId+"/nolevel/"+this.collection.models.length+"' \">Add Step</button>");if(this.collection.models.length>0){this.$el.append('&nbsp;&nbsp;&nbsp;<button class="btn btn-success" id="Rearrange" >Rearrange</button><br/><br/>')}this.$el.append('<button class="btn btn-success" id="moveup" >Up</button>&nbsp;&nbsp;&nbsp;');this.$el.append('<button class="btn btn-success" id="movedown" >Down</button>');this.addAll()}})});$(function(){App.Views.LevelRow=Backbone.View.extend({tagName:"tr",events:{"click .destroyStep":function(e){this.trigger("levelDeleted");e.preventDefault();var t=this;var i=new App.Collections.StepResultsbyCourse;i.courseId=this.model.get("courseId");i.fetch({success:function(){i.each(function(e){var i=e.get("stepsIds");var s=e.get("stepsResult");var n=e.get("stepsStatus");var o=i.indexOf(t.model.get("_id"));i.splice(o,1);s.splice(o,1);n.splice(o,1);e.set("stepsIds",i);e.set("stepsResult",s);e.set("stepsStatus",n);console.log(e.toJSON());e.save({success:function(){console.log("Model Updated")}})})}});this.model.destroy();this.remove()},"click .browse":function(e){e.preventDefault();$("#modal").modal({show:true})}},template:$("#template-LevelRow").html(),initialize:function(){},render:function(){var e=this.model.toJSON();this.$el.append(_.template(this.template,e))}})});$(function(){App.Views.MeetUpTable=Backbone.View.extend({tagName:"table",className:"btable btable-striped",roles:null,addOne:function(e){var t=new App.Views.MeetUpRow({model:e,roles:this.roles});t.render();this.$el.append(t.el)},events:{"click .pageNumber":function(e){this.collection.startkey="";this.collection.skip=e.currentTarget.attributes[0].value;this.collection.fetch({async:false});if(this.collection.length>0){this.render()}}},addAll:function(){this.$el.html("<tr><th>Topic</th><th colspan='4'>Actions</th></tr>");var e=new App.Models.Member({_id:$.cookie("Member._id")});e.fetch({async:false});this.roles=e.get("roles");this.collection.each(this.addOne,this);var t;var i=this;$.ajax({url:"/meetups/_design/bell/_view/count?group=false",type:"GET",dataType:"json",success:function(e){meetupLength=e.rows[0].value;if(i.displayCollec_Resources!=true){var t="<tr><td colspan=7>";var s=meetupLength/20;for(var n=0;n<s;n++){if(n==0)t+='<a  class="pageNumber" value="'+n*20+'">Home</a>&nbsp&nbsp';else t+='<a  class="pageNumber" value="'+n*20+'">'+n+"</a>&nbsp&nbsp"}t+="</td></tr>";i.$el.append(t)}}})},render:function(){this.addAll()}})});$(function(){App.Views.meetupView=Backbone.View.extend({authorName:null,tagName:"table",className:"btable btable-striped",initialize:function(){this.$el.html('<h3 colspan="20">Meetup | '+this.model.get("title")+"</h3>")},events:{"click  #joinMeetUp":"joinMeetUp","click #meetupsInvitation":"MemberInvite"},MemberInvite:function(){$("#invitationdiv").fadeIn(1e3);document.getElementById("cont").style.opacity=.1;document.getElementById("nav").style.opacity=.1;$("#invitationdiv").show();var e=new App.Models.InviMeetup;e.resId=this.model.get("_id");e.senderId=$.cookie("Member._id");e.type=this.model.get("kind");e.title=this.model.get("title");e.description=this.model.get("description");var t=new App.Views.MeetupInvitation({model:e});t.render();$("#invitationdiv").html("&nbsp");$("#invitationdiv").append(t.el)},add:function(e){},joinMeetUp:function(){var e=new App.Collections.UserMeetups;e.memberId=$.cookie("Member._id");e.meetupId=this.model.get("_id");e.fetch({async:false});if(e.length>0){alert("Your have already joined this Meetup");return}var t=new App.Models.UserMeetup;t.set("memberId",$.cookie("Member._id"));t.set("meetupId",this.model.get("_id"));t.set("meetupTitle",this.model.get("title"));t.save();alert("successfully Added to your Meetups");Backbone.history.navigate("dashboard",{trigger:true})},render:function(){$("#invitationdiv").hide();var e=this.model.toJSON();var t=new Date(e.schedule);e.schedule=t.toUTCString();this.$el.append("<tr><td><b>Title  </b></td><td>"+e.title+"   ("+e.category+")</td></tr>");this.$el.append("<tr><td><b>Category  </b></td><td>"+e.category+"</td></tr>");this.$el.append("<tr><td><b>Description </b></td><td>"+e.description+"</td></tr>");this.$el.append("<tr><td><b>Location </b></td><td>"+e.meetupLocation+"</td></tr>");this.$el.append("<tr><td><b>Date </b></td><td>"+e.startDate+" --- "+e.endDate+"</td></tr>");this.$el.append("<tr><td><b>Time </b></td><td>"+e.startTime+" --- "+e.endTime+"</td></tr>");this.$el.append('<tr><td><a class="btn btn-success" id="joinMeetUp">Join Meetup</a><a style="margin-left:20px" class="btn btn-info" id="meetupsInvitation">Invite Members</a><a style="margin-left:20px" class="btn btn-info" href="#meetups">Back</a></td><td></td></tr>')}})});$(function(){App.Views.MeetupDetails=Backbone.View.extend({authorName:null,tagName:"table",className:"table table-striped resourceDetail",sid:null,rid:null,events:{"click #DestroyMeetupItem":function(e){var t=this.model.toJSON();var i=$.cookie("Member._id");var s=new App.Collections.UserMeetups;s.memberId=i;s.meetupId=t._id;s.fetch({async:false});var n;while(n=s.first()){n.destroy()}alert("Successfully removed from My Meetups ");Backbone.history.navigate("dashboard",{trigger:true})}},initialize:function(){this.$el.append('<th colspan="2"><h6>Meetup Detail</h6></th>')},render:function(){var e=this.model.toJSON();var t=new Date(e.schedule);e.schedule=t.toUTCString();console.log(e);this.$el.append("<tr><td><b>Title  </b></td><td>"+e.title+"   ("+e.category+")</td></tr>");this.$el.append("<tr><td><b>Category  </b></td><td>"+e.category+"</td></tr>");this.$el.append("<tr><td><b>Description </b></td><td>"+e.description+"</td></tr>");this.$el.append("<tr><td><b>Location </b></td><td>"+e.meetupLocation+"</td></tr>");this.$el.append("<tr><td><b>Date </b></td><td>"+e.startDate+" --- "+e.endDate+"</td></tr>");this.$el.append("<tr><td><b>Time </b></td><td>"+e.startTime+" --- "+e.endTime+"</td></tr>");this.$el.append('<tr><td colspan="2"><button class="btn btn-danger" id="DestroyMeetupItem">Unjoin</button></td></tr>')}})});$(function(){App.Views.MeetUpRow=Backbone.View.extend({tagName:"tr",roles:null,events:{},template:$("#template-MeetUpRow").html(),initialize:function(e){this.roles=e.roles},render:function(){var e=this.model.toJSON();if(this.roles.indexOf("Manager")!=-1){e.isAdmin=1}else{e.isAdmin=0}if(e.creator&&e.creator==$.cookie("Member._id")){e.creator=1}else{e.creator=0}if(e._id!="_design/bell")this.$el.append(_.template(this.template,e))}})});$(function(){App.Views.MeetUpForm=Backbone.View.extend({className:"form",id:"meetUpForm",prevmemlist:null,saved:null,btnText:"Save",events:{"click #MeetUpformButton":"setForm","submit form":"setFormFromEnterKey","click #InviteMembers":"MemberInvite","click #MeetUpcancel":function(){window.history.back()}},MemberInvite:function(){var e=this.model;console.log(e);if(!e.get("id")){this.setForm();return}if($("textarea[name='description']").val().length>0){$("#invitationdiv").fadeIn(1e3);document.getElementById("cont").style.opacity=.1;document.getElementById("nav").style.opacity=.1;$("#invitationdiv").show();var t=new App.Models.InviMeetup;t.resId=e.get("id");t.senderId=$.cookie("Member._id");t.type=e.get("kind");t.title=e.get("title");t.description=e.get("description");var i=new App.Views.MeetupInvitation({model:t});i.render();$("#invitationdiv").html("&nbsp");$("#invitationdiv").append(i.el)}else{alert("Specify Meetup description first")}},render:function(){$("#invitationdiv").hide();if(!this.model.get("_id"))this.$el.append("<h3>Start a New Meetup</h3>");else{this.$el.append("<h3>Edit Meetup | "+this.model.get("title")+"</h3>");this.btnText="Update"}this.form=new Backbone.Form({model:this.model});this.$el.append(this.form.render().el);if(this.btnText!="Update")this.form.fields["Day"].$el.hide();var e=$('<a class="btn btn-success" id="MeetUpformButton">'+this.btnText+"</a>");var t=$('<a class="btn btn-success" id="formButton">Cancel</a>');this.$el.append(e);if(this.btnText!="Update")this.$el.append('<a class="btn btn-info" id="InviteMembers">Invite Members</a>');this.$el.append("<a class='btn btn-danger' id='MeetUpcancel'>Cancel</a>");console.log(this.model)},setFormFromEnterKey:function(e){e.preventDefault();this.setForm()},setForm:function(){if(this.model.get("id")){alert("Saved already");return}var e=this;this.form.commit();if(this.model.get("title").length==0){alert("Meetup title is missing")}else if(this.model.get("description").length==0){alert("Meetup Description is missing")}else if(this.model.get("meetupLocation").length==0){alert("Meetup Location is missing")}else{this.model.set("creator",$.cookie("Member._id"));this.model.save(null,{success:function(t){if(e.btnText=="Save"){var i=new App.Models.UserMeetup;i.set({memberId:$.cookie("Member._id"),meetupId:t.get("id"),meetupTitle:t.get("title")});i.save();e.MemberInvite(t)}else{var i=new App.Collections.UserMeetups;i.meetupId=t.get("id");i.memberId=$.cookie("Member._id");i.fetch({async:false});if(res=i.first()){res.set("meetupTitle",t.get("title"));res.save();alert("Updated Successfully")}Backbone.history.navigate("meetups",{trigger:true})}}})}}})});$(function(){App.Views.MembersTable=Backbone.View.extend({tagName:"table",className:"btable btable-striped",addOne:function(e){var t=new App.Views.MemberRow({model:e});t.isadmin=this.isadmin;t.community_code=this.community_code;t.render();this.$el.append(t.el)},events:{"click .pageNumber":function(e){this.collection.startkey="";this.collection.skip=e.currentTarget.attributes[0].value;this.collection.fetch({async:false});if(this.collection.length>0){this.render()}}},addAll:function(){this.$el.html("<tr><th>Photo</th><th>Last Name</th><th>First Name</th><th>Visits</th><th>Email</th><th>Bell-Email</th><th>Actions</th></tr>");console.log(this.collection);this.collection.each(this.addOne,this);var e;var t=this;$.ajax({url:"/members/_design/bell/_view/count?group=false",type:"GET",dataType:"json",success:function(e){memberLength=e.rows[0].value;if(t.displayCollec_Resources!=true){var i="<tr><td colspan=7>";var s=memberLength/20;for(var n=0;n<s;n++){if(n==0)i+='<a  class="pageNumber" value="'+n*20+'">Home</a>&nbsp&nbsp';else i+='<a  class="pageNumber" value="'+n*20+'">'+n+"</a>&nbsp&nbsp";
}i+="</td></tr>";t.$el.append(i)}}})},render:function(){this.addAll()}})});$(function(){App.Views.MembersView=Backbone.View.extend({searchText:"",events:{"click .Search":function(e){this.renderTable($("#searchText").val().toLowerCase())}},render:function(){this.$el.html('<h3 style="float:right"><input id="searchText" style="margin-right:15px;height:28px;width:170px" type="Text" placeholder="Last Name"><button style="margin-top:-10px;" class="Search btn btn-info">Search</button></h3>');this.$el.append('<h3>Members<a style="margin-left:20px" class="btn btn-success" href="#member/add">Add a New Member</a></h3>');this.$el.append('<div id="memberTable"></div>');this.renderTable(searchText)},renderTable:function(e){App.startActivityIndicator();var t=this;var i=new App.Collections.Configurations;i.fetch({async:false});var s=i.first();var n=s.toJSON();code=n.code;nationName=n.nationName;var o=App.Router.getRoles();members=new App.Collections.Members;members.searchText=e;members.fetch({success:function(e){membersTable=new App.Views.MembersTable({collection:e});membersTable.community_code=code+nationName.substring(3,5);if(o.indexOf("Manager")>-1){membersTable.isadmin=true}else{membersTable.isadmin=false}membersTable.render();$("#memberTable").html(membersTable.el);App.stopActivityIndicator()},error:function(){App.stopActivityIndicator()}})}})});$(function(){App.Views.MemberRow=Backbone.View.extend({tagName:"tr",getFormattedDate:function(e){var t=e.getFullYear();var i=(1+e.getMonth()).toString();i=i.length>1?i:"0"+i;var s=e.getDate().toString();s=s.length>1?s:"0"+s;return i+"/"+s+"/"+t},createJsonlog:function(e,t,i){var s={logDate:t,resourcesIds:[],male_visits:0,female_visits:0,male_timesRated:[],female_timesRated:[],male_rating:[],community:App.configuration.get("code"),female_rating:[],resources_names:[],resources_opened:[],male_opened:[],female_opened:[],male_deleted_count:0,female_deleted_count:0};if(i=="Male"){s.male_deleted_count=parseInt(s.male_deleted_count?s.male_deleted_count:0)+1;s.female_deleted_count=parseInt(s.female_deleted_count?s.female_deleted_count:0)+0}else{s.female_deleted_count=parseInt(s.female_deleted_count?s.female_deleted_count:0)+1;s.male_deleted_count=parseInt(s.male_deleted_count?s.male_deleted_count:0)+0}s.community=App.configuration.get("code"),e.put(s,t,function(e,t){if(!e){alert("Deleted members successfully saved.")}else{alert("Deleted members count failed to save.");console.log(e)}})},UpdatejSONlog:function(e,t,i,s){if(s=="Male"){i.male_deleted_count=parseInt(i.male_deleted_count?i.male_deleted_count:0)+1;i.female_deleted_count=parseInt(i.female_deleted_count?i.female_deleted_count:0)+0}else{i.female_deleted_count=parseInt(i.female_deleted_count?i.female_deleted_count:0)+1;i.male_deleted_count=parseInt(i.male_deleted_count?i.male_deleted_count:0)+0}i.community=App.configuration.get("code");e.put(i,t,i._rev,function(e,t){if(!e){alert("updated daily log from pouchdb for today..")}else{alert("UpdatejSONlog:: err making update to record");console.log(e)}})},events:{"click .destroy":function(e){var t=this;var i=new PouchDB("activitylogs");var s=new Date;var n=t.getFormattedDate(s);var o=this.model.get("Gender");i.get(n,function(e,s){if(!e){t.UpdatejSONlog(i,n,s,o)}else{t.createJsonlog(i,n,o)}});e.preventDefault();this.model.destroy();this.remove()},"click #deactive":function(e){e.preventDefault();var t=this;this.model.on("sync",function(){location.reload()});this.model.save({status:"deactive"},{success:function(){}})},"click #active":function(e){e.preventDefault();var t=this;this.model.on("sync",function(){location.reload()});this.model.save({status:"active"},{success:function(){}})},"click .browse":function(e){e.preventDefault();$("#modal").modal({show:true})}},template:$("#template-MemberRow").html(),initialize:function(){},render:function(){if(!this.model.get("visits")){this.model.set("visits")}var e=this.model.toJSON();e.community_code=this.community_code;if(this.model.get("_id")==$.cookie("Member._id")&&!this.isadmin){e.showdelete=false;e.showedit=true}else if(!this.isadmin){e.showdelete=false;e.showedit=false}else{e.showdelete=true;e.showedit=true}e.src="img/default.jpg";var t="/members/"+this.model.id+"/";if(typeof this.model.get("_attachments")!=="undefined"){t=t+_.keys(this.model.get("_attachments"))[0];e.src=t}this.$el.html(_.template(this.template,e))}})});$(function(){App.Views.ReportsRow=Backbone.View.extend({tagName:"tr",admn:null,events:{"click .destroy":function(e){alert("deleting");this.model.destroy();e.preventDefault()},"click #open":function(e){if(this.model.get("views")==undefined){this.model.set("views",1);this.model.save()}else{this.model.set("views",this.model.get("views")+1);this.model.save()}},"click #commentButton":function(e){var t=new App.Collections.CommunityReportComments;t.CommunityReportId=e.target.attributes[0].nodeValue;t.fetch({async:false});var i=new App.Views.CommunityReportCommentView({collection:t,CommunityReportId:e.target.attributes[0].nodeValue});i.render();$("#debug").append(i.el)}},vars:{},template:_.template($("#template-ReportRow").html()),initialize:function(e){this.model.on("destroy",this.remove,this)},render:function(){var e=this.model.toJSON();if(e.views==undefined){e.views=0}e.isManager=this.isManager;var t=new Date(e.Date);e.Date=t.toUTCString();this.$el.append(this.template(e))}})});$(function(){App.Views.ReportsTable=Backbone.View.extend({tagName:"table",isManager:null,className:"btable btable-striped",initialize:function(){},addOne:function(e){var t=new App.Views.ReportsRow({model:e});t.isManager=this.isManager;t.render();this.$el.append(t.el)},addAll:function(){this.$el.append('<tr><th>Time</th><th>Title</th><th>Author</th><th>Views</th><th colspan="5">Actions</th></tr>');this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}})});$(function(){App.Views.ReportForm=Backbone.View.extend({className:"form",hide:false,events:{"click .save":"saveForm","click #cancel":function(){window.history.back()}},template:_.template($("#template-form-file").html()),render:function(){var e={};if(_.has(this.model,"id")){e.header='Title "'+this.model.get("title")+'"';e.hidesave=true;var t=this.model.get("_attachments");var i=_.map(_.pairs(t),function(e){return{key:e[0],value:e[1]}});e.resourceAttachments=i}else{e.header="New Report";e.hidesave=false;e.resourceAttachments="No File Selected."}this.form=new Backbone.Form({model:this.model});this.form.render();if(this.edit==false){alert("here")}var s=this;if(_.has(this.model,"id")){}e.form="";this.$el.html(this.template(e));$(".fields").html(this.form.el);$("#progressImage").hide();return this},saveForm:function(){var e=true;var t=this.model.get("title");var i;var s=this.model.get("_id");this.form.commit();i=this.model.get("title");var n=this;var o=false;if(this.model.get("title").length==0){alert("Resource Title is missing")}else if(this.model.get("Tag")=="News"&&!this.model.get("author")){alert("Please Specify Author For This News Resource")}else{$("#gressImage").show();this.model.set(" uploadDate",(new Date).getTime());if(this.model.get("Level")=="All"){this.model.set("toLevel",0);this.model.set("fromLevel",0)}else{if(parseInt(this.model.get("fromLevel"))>parseInt(this.model.get("toLevel"))){alert("Invalid range specified ");e=false}}if(s==undefined){var n=this;var a=new App.Collections.Reports;a.fetch({async:false});a.each(function(t){if(n.model.get("title")==t.get("title")){alert("Title already exist");e=false}})}if(e){if(s==undefined){this.model.set("sum",0)}else{this.model.set("title",t)}this.model.save(null,{success:function(){n.model.unset("_attachments");if($('input[type="file"]').val()){if(s!=undefined){if(t!=i){var e=false;var o=new App.Collections.Resources;o.fetch({async:false});o.each(function(t){if(i==t.get("title")){e=true}});if(!e){var a=new App.Models.Resource;a.set("title",i);a.set("description",n.model.get("description"));a.set("articleDate",n.model.get("articleDate"));a.set("addedBy",n.model.get("addedBy"));a.set("openWith",n.model.get("openWith"));a.set("openWhichFile",n.model.get("openWhichFile"));a.set("uploadDate",n.model.get("uploadDate"));a.set("openUrl",n.model.get("openUrl"));a.save();a.on("sync",function(){a.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev");a.on("savedAttachment",function(){alert("Resource Updated Successfully");Backbone.history.navigate("#resources",{trigger:true});n.trigger("processed");$("#progressImage").hide()},a)})}else{alert("Resource title Already exist")}}else{alert("Cannot update model due to identical title")}}else{n.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev")}}else{n.model.trigger("processed")}n.model.on("savedAttachment",function(){this.trigger("processed");$("#progressImage").hide()},n.model)}})}}},statusLoading:function(){alert("asdf");this.$el.children(".status").html('<div style="display:none" class="progress progress-striped active"> <div class="bar" style="width: 100%;"></div></div>')}})});$(function(){App.Views.CommunityReportCommentView=Backbone.View.extend({tagName:"div",id:"comment-feedback",cId:null,initialize:function(e){console.log(e);this.cId=e.CommunityReportId;this.model=new App.Models.CommunityReportComment},events:{"click #submitFormButton":"submit","click #cancelFormButton":"cancel"},cancel:function(){$("#debug").hide();this.remove()},submit:function(){if(this.form.getValue("comment").length!=0){var e=new Date;e.getDate();this.form.setValue({CommunityReportId:this.cId});this.form.setValue({commentNumber:this.collection.length+1});this.form.setValue({memberLogin:$.cookie("Member.login")});this.form.setValue({time:e.toString()});this.form.commit();this.model.save();this.form.setValue({comment:""});this.collection.fetch({async:false});this.model.set({comment:""});this.render()}},addOne:function(e){$("#comments").append("<div id=tile><b>Login:</b>"+e.toJSON().memberLogin+"<br/><b>Time:</b>"+e.toJSON().time+"<br/><b>Comment:</b>"+e.toJSON().comment+"</div>");console.log(e.toJSON())},render:function(){$("#debug").show();this.$el.html("&nbsp;");$("#comments").html("&nbsp;");this.collection.forEach(this.addOne,this);this.form=new Backbone.Form({model:this.model});this.$el.append(this.form.render().el);this.form.fields["CommunityReportId"].$el.hide();this.form.fields["commentNumber"].$el.hide();this.form.fields["memberLogin"].$el.hide();this.form.fields["time"].$el.hide();var e=$('<div id="r-formButton"><button class="btn btn-primary" id="submitFormButton">Add Comment</button><button class="btn btn-info" id="cancelFormButton">Close</button></div>');this.$el.append(e)}})});$(function(){App.Views.CourseLevelsTable=Backbone.View.extend({id:"accordion",vars:{},modl:null,template:_.template($("#template-courseLevelsTable").html()),events:{"click #takequiz":"quiz","click #resourseOpened":function(e){resid=e.target.attributes.rid.nodeValue;var t=new App.Models.Member({_id:$.cookie("Member._id")});t.fetch({async:false});var i=[];if(t.get("pendingReviews")){i=t.get("pendingReviews")}i.push(resid);t.set("pendingReviews",i);t.save();ratingModel=new App.Models.Feedback;ratingModel.set("resourceId",resid);ratingModel.set("memberId",$.cookie("Member._id"));ratingView=new App.Views.FeedbackForm({model:ratingModel,resId:resid});$("#externalDiv").html('<div id="star"></div>');$("#star").append("Rating<br/>");$("#star").raty();$("#star > img").click(function(){ratingView.setUserRating($(this).attr("alt"))});ratingView.render();$("#externalDiv").append(ratingView.el);$("#externalDiv").show()}},quiz:function(e){var t=this;var i=e.currentTarget.value;step=new App.Models.CourseStep({_id:i});step.fetch({async:false});var s=null;s=step.toJSON();var n=t.modl.get("stepsIds");var o=n.indexOf(i);var a=new App.Views.takeQuizView({questions:s.questions,answers:s.answers,options:s.qoptions,passP:s.passingPercentage,resultModel:t.modl,stepIndex:o});a.render();$("div.takeQuizDiv").html(a.el)},initialize:function(){$("div.takeQuizDiv").hide()},addAll:function(){this.collection.each(this.addOne,this)},addOne:function(e){this.vars=e.toJSON();if(!this.vars.outComes){this.vars.outComes="";if(this.vars.questions&&this.vars.questions.length>0)this.vars.outComes=["Quiz"]}else if(this.vars.outComes instanceof Array){}else{var t=this.vars.outComes;this.vars.outComes=new Array;this.vars.outComes[0]=t}var s=0;var n=this.modl.get("stepsStatus");var o=this.modl.get("stepsIds");var a=this.modl.get("stepsResult");while(s<n.length&&o[s]!=this.vars._id){s++}if(s==n.length){this.vars.status="Error!!";this.vars.marks="Error!!"}else{this.vars.status=n[s];this.vars.marks=a[s];this.vars.index=s}var l=new Array;var r=new Array;if(e.get("_attachments")){for(i=0;i<_.keys(e.get("_attachments")).length;i++){var c="/coursestep/"+e.get("_id")+"/";var d="";if(typeof e.get("_attachments")!=="undefined"){c=c+_.keys(e.get("_attachments"))[i];d=_.keys(e.get("_attachments"))[i];l.push(d);r.push(c)}}}this.vars.attachmentNames=l;this.vars.attachmentURLs=r;this.$el.append(this.template(this.vars))},setAllResults:function(){var e=this;var t=$.cookie("Member._id");var i=this.collection.first().get("courseId");var s=new PouchDB("membercourseprogress");s.query({map:function(e){if(e.memberId&&e.courseId){emit([e.memberId,e.courseId],e)}}},{key:[t,i]},function(s,n){var o=new App.Collections.membercourseprogresses;o.memberId=t;o.courseId=i;o.fetch({async:false,success:function(){e.renderaccordian(o.first())}})})},renderaccordian:function(e){var t=this;t.modl=e;var i=0;var s=t.modl.get("stepsStatus");var n=s.length;while(i<n&&s[i]!="0"){i++}t.addAll();$("#accordion").accordion({header:"h3",heightStyle:"content"}).sortable({axis:"y",handle:"h3",stop:function(e,t){t.item.children("h3").triggerHandler("focusout")}})},render:function(){if(this.collection.length<1){this.$el.append('<p style="font-weight:900;">No data related to selected course found</p>')}else{this.setAllResults()}}})});$(function(){App.Views.ResourceForm=Backbone.View.extend({className:"form",id:"resourceform",hide:false,events:{'keydown input[name="title"]':"getFocusForTitle",'keydown input[name="author"]':"getFocusForAuthor",'keydown input[name="Year"]':"getFocusForYear",'keydown select[name="language"]':"getFocusForLanguage",'keydown input[name="Publisher"]':"getFocusForPublisher","keydown #_attachments":"getFocusForBrowse","keydown  .save":"getFocusForSave","click .save":"saveForm","click #cancel":function(){window.history.back()},"click #add_newCoellection":function(){App.Router.AddNewSelect("Add New")},"click #saveUpdatedWelcomeVideoForm":"saveUpdatedWelcomeVideoForm"},getFocusForTitle:function(e){if(e.keyCode==9){e.preventDefault();$.trim($('[name="title"]').val());$('[name="author"]').focus()}},getFocusForAuthor:function(e){if(e.keyCode==9){e.preventDefault();$.trim($('[name="author"]').val());$('[name="Year"]').focus()}},getFocusForBrowse:function(e){if(e.keyCode==9){e.preventDefault();var t=$(":focus");$(".save").attr("tabindex",0);$(".save").addClass("myTabIndexClass");$(".myTabIndexClass").focus();t=$(":focus")}},getFocusForSave:function(e){if(e.keyCode==9){e.preventDefault();var t=$(":focus");$("#cancel").attr("tabindex",0);$("#cancel").focus();t=$(":focus");e.preventDefault()}},getFocusForYear:function(e){if(e.keyCode==9){e.preventDefault();$.trim($('[name="Year"]').val());$('[name="language"]').focus()}},getFocusForLanguage:function(e){if(e.keyCode==9){e.preventDefault();$('[name="Publisher"]').focus()}},getFocusForPublisher:function(e){if(e.keyCode==9){e.preventDefault();$('[name="linkToLicense"]').focus()}},getFocusForLinkToLicense:function(e){if(e.keyCode==9){e.preventDefault();$.trim($('[name="Publisher"]').val());$('[name="resourceType"]').focus()}},getFocusForResourceType:function(e){if(e.keyCode==9){e.preventDefault();$('[name="subject"]').focus()}},template:_.template($("#template-form-file").html()),render:function(){var e={};if(_.has(this.model,"id")){e.header='Details "'+this.model.get("title")+'"';var t=this.model.get("_attachments");var i=_.map(_.pairs(t),function(e){return{key:e[0],value:e[1]}});e.resourceAttachments=i;e.resourceTitle=this.model.get("title");e.resourceUrl=this.model.get("url")}else{e.header="New Resource";e.resourceAttachments="No File Selected.";e.resourceUrl=""}this.form=new Backbone.Form({model:this.model});this.form.render();this.form.fields["uploadDate"].$el.hide();if(this.edit==false){this.form.fields["addedBy"].$el.val($.cookie("Member.login"))}this.form.fields["addedBy"].$el.attr("disabled",true);this.form.fields["averageRating"].$el.hide();var s=this;if(_.has(this.model,"id")){if(this.model.get("Level")=="All"){s.hide=true}}e.form="";this.$el.html(this.template(e));$(".fields").html(this.form.el);this.$el.append('<button class="btn btn-success" id="add_newCoellection" >Add New</button>');$("#progressImage").hide();$('[name="title"]').focus();return this},saveUpdatedWelcomeVideoForm:function(){if(this.model.get("isWelcomeVideo")===undefined){this.model.set("isWelcomeVideo",true)}this.form.commit();this.model.set("Level",null);this.model.set("subject",null);var e=this;var t=$('input[type="file"]').val();this.model.save(null,{success:function(i){if(t){e.model.unset("_attachments");App.startActivityIndicator();e.model.on("savedAttachment",function(){App.stopActivityIndicator();this.trigger("processed")},e.model);e.model.saveAttachment("#fileAttachment","#_attachments","#fileAttachment .rev");e.form.fields["addedBy"].setValue($.cookie("Member.login"))}else{return}}})},renderAddOrUploadWelcomeVideoForm:function(){var e=$("<h3> Edit Welcome Video Form </h3><br><br><br><br>");this.$el.append(e);this.form=new Backbone.Form({model:this.model});this.$el.append(this.form.render().el);for(var t in this.form.fields){this.form.fields[t].$el.hide()}this.form.fields["addedBy"].$el.show();this.form.fields["resourceType"].$el.show();this.form.fields["addedBy"].editor.el.disabled=true;this.form.fields["uploadDate"].$el.show();this.form.fields["openWith"].$el.show();this.form.fields["resourceFor"].$el.show();var i=this.model.get("_attachments");var s=_.map(_.pairs(i),function(e){return{key:e[0],value:e[1]}});for(var t in s){var n=$("<label>").text(s[t].key);this.$el.append(n)}this.$el.append("<br><br>");this.$el.append('<form method="post" id="fileAttachment"></form>');this.$el.find("#fileAttachment").append('<label for="_attachments">Upload Welcome Video</label>');this.$el.find("#fileAttachment").append('<input type="file" name="_attachments" id="_attachments" style="line-height: 28px;" multiple="multiple" label=" :" />');this.$el.find("#fileAttachment").append('<input class="rev" type="hidden" name="_rev">');this.$el.append('<button class="addNation-btn btn btn-success" id="saveUpdatedWelcomeVideoForm">Submit</button>');this.$el.append('<a class="btn btn-danger" id="cancel">Cancel</a>')},saveForm:function(){var e=this.model.get("title");var t=this.model.get("_id");var i=this;this.form.commit();if(this.model.get("openWith")=="PDF.js"){this.model.set("need_optimization",true)}var s=this.model.get("title");if(this.model.get("title").length==0){alert("Resource Title is missing")}else if(this.model.get("subject")==null){alert("Resource Subject is missing")}else if(this.model.get("Level")==null){alert("Resource Level is missing")}else{if(t){var n=true;if(e!=s){if(this.DuplicateTitle()){n=false}}if(n){this.model.save(null,{success:function(e){if($('input[type="file"]').val()){i.model.unset("_attachments");App.startActivityIndicator();i.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev")}else{window.history.back()}}})}}else{if(!this.DuplicateTitle()){this.model.set("sum",0);this.model.set("timesRated",0);this.model.save(null,{success:function(e){if($('input[type="file"]').val()){App.startActivityIndicator();i.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev")}else{window.history.back()}}})}}}this.model.on("savedAttachment",function(){this.trigger("processed")},i.model)},DuplicateTitle:function(){var e=new App.Collections.Resources;e.title=this.model.get("title");e.fetch({async:false});e=e.first();if(e!=undefined)if(e.toJSON().title!=undefined){alert("Title already exist");return true}return false},statusLoading:function(){this.$el.children(".status").html('<div style="display:none" class="progress progress-striped active"> <div class="bar" style="width: 100%;"></div></div>')}})});$(function(){App.Views.MeetupInvitation=Backbone.View.extend({id:"invitationForm",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey","click #cancelButton":"hidediv"},title:null,entityId:null,type:null,senderId:null,hidediv:function(){$("#invitationdiv").fadeOut(1e3);document.getElementById("cont").style.opacity=1;document.getElementById("nav").style.opacity=1;setTimeout(function(){$("#invitationdiv").hide()},1e3);Backbone.history.navigate("meetups",{trigger:true})},SetParams:function(e,t,i,s){this.title=e;this.entityId=t;this.type=i;this.senderId=s},render:function(){console.log(this.model);var e=new App.Collections.Members;var t=this;var i=this;i.on("InvitationForm:MembersReady",function(){console.log(t.model.schema);this.model.schema.members.options=e;this.form=new Backbone.Form({model:i.model});this.$el.append(this.form.render().el);this.form.fields["members"].$el.hide();this.form.fields["invitationType"].$el.change(function(){var e=t.form.fields["invitationType"].$el.find("option:selected").text();if(e=="Members"){t.form.fields["members"].$el.show()}else{t.form.fields["members"].$el.hide()}});var s=$('<a class="btn btn-success" id="formButton">Invite</button>');this.$el.append(s);this.$el.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");this.$el.append('<a class="btn btn-danger" id="cancelButton">Cancel</button>')});e.once("sync",function(){i.trigger("InvitationForm:MembersReady")});e.fetch()},setFormFromEnterKey:function(e){e.preventDefault();this.setForm()},setForm:function(){var e=new App.Models.Member({_id:$.cookie("Member._id")});e.fetch({async:false});this.form.commit();var t=new App.Collections.Members;t.fetch({async:false});var i;var s=this;var n=new Date;if(this.model.get("invitationType")=="All"){t.each(function(e){i=new App.Models.Mail;i.set("senderId",s.model.senderId);i.set("receiverId",e.get("_id"));i.set("status","0");i.set("subject","Meetup Invitation | "+s.model.title);i.set("type","Meetup-invitation");i.set("body",s.model.description+'<br/><br/><button class="btn btn-primary" id="invite-accept" value="'+s.model.resId+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+s.model.resId+'" >Reject</button>');i.set("sendDate",n);i.set("entityId",s.model.resId);i.save()})}else if(this.model.get("invitationType")=="Members"){t.each(function(e){var t=s;if(s.model.get("members").indexOf(e.get("_id"))>-1){i=new App.Models.Mail;i.set("senderId",s.model.senderId);i.set("receiverId",e.get("_id"));i.set("status","0");i.set("subject","Meetup Invitation | "+s.model.title);i.set("body",s.model.description+'<br/><br/><button class="btn btn-primary" id="invite-accept" value="'+s.model.resId+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+s.model.resId+'" >Reject</button>');i.set("type","Meetup-invitation");i.set("sendDate",n);i.set("entityId",s.model.resId);i.save();console.log(i)}})}$("#invitationdiv").fadeOut(1e3);alert("Invitation sent successfully");document.getElementById("cont").style.opacity=1;document.getElementById("nav").style.opacity=1;setTimeout(function(){$("#invitationdiv").hide()},1e3);Backbone.history.navigate("meetups",{trigger:true})}})});$(function(){App.Views.MailView=Backbone.View.extend({code:null,vars:{},recordsPerPage:null,modelNo:null,nextButton:null,unopen:null,searchText:null,resultArray:null,inViewModel:null,showNextButton:null,template:_.template($("#template-mail").html()),templateMailView:_.template($("#template-view-mail").html()),events:{"click #replyMailButton":function(e){$("#recipients").val(this.vars.login);$("#subject").val("Re : "+this.vars.subject);$("#mailbodytexarea").val("")},"click #mailComposeButton":function(e){$("#subject").val("");$("#recipients").val("");$("#mailbodytexarea").val("")},"click #nextButton":function(e){this.modelNo=0;this.resultArray=[];skipStack.push(skip);this.fetchRecords()},"click #all-mails":function(e){this.modelNo=0;skip=0;this.searchText="";$("#search-text").val("");this.resultArray=[];this.unopen=false;this.fetchRecords();$("#nextButton").show();$("#previousButton").hide()},"click #unread-mails":"unReadMails","click #backpage":function(e){this.render();this.unReadMails()},"click .deleteBtn":function(e){var t=e.currentTarget.value;alert(t);var i=this.collection.at(t);var s=new App.Models.Mail;s.id=i.get("id");s.fetch({async:false});s.destroy();this.render();this.unReadMails()},"click #previousButton":function(e){if(skipStack.length>1){skipStack.pop();skip=skipStack.pop();skipStack.push(skip);this.resultArray=[];this.modelNo=0;this.showNextButton=1;this.fetchRecords()}else{$("#previousButton").hide()}},"click #invite-accept":function(e){if(mailView.inViewModel.get("type")=="admissionRequest"){mailView.admissionRequestAccepted(e.currentTarget.value);return}var t=mailView.inViewModel.get("body").replace(/<(?:.|\n)*?>/gm,"");t=t.replace("Accept","").replace("Reject","").replace("&nbsp;&nbsp;","");var i=t+"<div style='margin-left: 3%;margin-top: 174px;font-size: 11px;color: rgb(204,204,204);'>this Course Was Full.</div>";t=t+"<div style='margin-left: 3%;margin-top: 174px;font-size: 11px;color: rgb(204,204,204);'>You have accepted this invitation.</div>";if(mailView.inViewModel.get("type")=="Meetup-invitation"){mailView.meetupRequestAccepted(e.currentTarget.value);mailView.updateMailBody(t);return}var s=new App.Models.Group({_id:e.currentTarget.value});s.fetch({async:false});var n=this;var o=s.get("members").length;if(s.get("memberLimit"))if(s.get("memberLimit")<o){alert("This Course is full");mailView.updateMailBody(i);return}mailView.updateMailBody(t);if(s.get("_id")){var a=[];if(s.get("members")!=null){a=s.get("members")}if(a.indexOf($.cookie("Member._id"))==-1){a.push($.cookie("Member._id"));s.set("members",a);s.save({},{success:function(){var e=new App.Models.membercourseprogress;var t=new App.Collections.coursesteps;var i=new Array;var n=new Array;var o=new Array;t.courseId=s.get("_id");t.fetch({success:function(){t.each(function(e){i.push(e.get("_id"));n.push("0");o.push("0")});e.set("stepsIds",i);e.set("memberId",$.cookie("Member._id"));e.set("stepsResult",n);e.set("stepsStatus",o);e.set("courseId",t.courseId);e.save({success:function(){}})}});alert("Course added to your dashboard");Backbone.history.navigate("dashboard",{trigger:true})}})}else{alert("Course already added to your dashboard");Backbone.history.navigate("dashboard",{trigger:true})}}},"click #invite-reject":function(e){if(mailView.inViewModel.get("type")=="admissionRequest"){mailView.admissoinRequestRejected(e.currentTarget.value);return}var t=mailView.inViewModel.get("body").replace(/<(?:.|\n)*?>/gm,"");t=t.replace("Accept","").replace("Reject","").replace("&nbsp;&nbsp;","");t=t+"<div style='margin-left: 3%;margin-top: 174px;font-size: 11px;color: rgb(204,204,204);'>You have rejected this invitation.</div>";mailView.updateMailBody(t)},"click #search-mail":function(e){skip=0;while(skipStack.length>0){skipStack.pop()}this.searchText=$("#search-text").val();this.resultArray=[];skipStack.push(skip);this.modelNo=0;this.fetchRecords()},"click #back":function(e){skip=0;while(skipStack.length>0){skipStack.pop()}this.resultArray=[];skipStack.push(skip);this.modelNo=0;this.render();this.fetchRecords()}},unReadMails:function(e){this.modelNo=0;skip=0;this.searchText="";$("#search-text").val("");this.resultArray=[];this.unopen=true;this.fetchRecords();$("#nextButton").show();$("#previousButton").hide()},renderAllMails:function(e){mailView.modelNo=0;skip=0;this.searchText="";mailView.resultArray=[];mailView.unopen=false;mailView.fetchRecords();$("#nextButton").show();$("#previousButton").hide()},viewButton:function(e){var t=e.currentTarget.value;var i=mailView.collection.at(t);var s="/mail/"+i.get("_id")+"/";var n="";if(typeof i.get("_attachments")!=="undefined"){s=s+_.keys(i.get("_attachments"))[0];n=_.keys(i.get("_attachments"))[0]}mailView.inViewModel=i;i.set("status","1");console.log(e);i.save();mailView.vars=i.toJSON();var o=new App.Models.Member;o.id=i.get("senderId");o.fetch({async:false});mailView.vars.firstName=o.get("firstName");mailView.vars.lastName=o.get("lastName");mailView.vars.email=o.get("login")+"."+mailView.code+mailView.nationName.substring(3,5)+"@olebell.org";mailView.vars.modelNo=t;mailView.vars.login=mailView.vars.email;if(n!=""){mailView.vars.isAttachment=1;mailView.vars.attchmentURL=s}else{mailView.vars.isAttachment=0}mailView.$el.html("");mailView.$el.append(mailView.templateMailView(mailView.vars))},deleteButton:function(e){var t=e.currentTarget.value;var i=mailView.collection.at(t);i.destroy();mailView.renderAllMails()},initialize:function(e){this.code=e.community_code;this.nationName=e.nationName;this.modelNo=0;skip=0;this.unopen=true;this.recordsPerPage=5;this.nextButton=1;this.searchText="";this.delegateEvents();this.resultArray=[];this.showNextButton=0},addOne:function(e){vars=e.toJSON();var t=new App.Models.Member;t.set("id",e.get("senderId"));t.id=e.get("senderId");t.fetch({async:false});if(t.id==undefined){var i="Error!!"}else{var i=t.get("firstName")+" "+t.get("lastName")}if(vars.subject){var s="";if(vars.status==0){s='<tr bgcolor="B4D3EC" style="color:black">'}else{s='<tr bgcolor="E7E7E7" style="color:#2D2D34">'}var n="delete"+this.modelNo;var o="view"+this.modelNo;s=s+"<td>"+vars.subject+'</td><td align="center">'+i+'</td><td align="right"><button value="'+this.modelNo+'" id ="'+n+'" class="btn btn-danger">Delete</button>&nbsp;&nbsp;<button value="'+this.modelNo+'" id="'+o+'" class="btn btn-primary" >View</button></td></tr>';$("#inbox_mails").append(s);this.modelNo++;$("#"+n).click(this.deleteButton);$("#"+o).click(this.viewButton);mailView=this}},addAll:function(){$("#inbox_mails").html("");if(skipStack.length<=1){$("#previousButton").hide()}else{$("#previousButton").show()}this.collection.forEach(this.addOne,this)},render:function(){this.$el.html(this.template(this.vars));this.$el.append('<div class="mail-table"><span style="float:right; margin-left:10px;"><button id="nextButton" class="btn btn-primary fui-arrow-right"></button></span> <span style="float:right;"><button id="previousButton" class="btn btn-primary fui-arrow-left"></button></span></div>')},fetchRecords:function(){var e=this;var t=new App.Collections.Mails({receiverId:$.cookie("Member._id"),unread:e.unopen});t.fetch({success:function(){e.resultArray.push.apply(e.resultArray,e.searchInArray(t.models,e.searchText));if(e.resultArray.length!=limitofRecords&&t.models.length==limitofRecords){e.fetchRecords();return}else if(e.resultArray.length==0&&skipStack.length>1){$("#nextButton").hide();skipStack.pop();return}if(e.resultArray.length==0&&skipStack.length==1){{$("#errorMessage").show();return}}var i=new App.Collections.Mails;if(e.resultArray.length>0){$("#errorMessage").hide();i.set(e.resultArray);e.collection=i;e.addAll();if(e.showNextButton==1){$("#nextButton").show();e.showNextButton=0}}}})},searchInArray:function(e,t){var i=this;var s=[];var n;{_.each(e,function(e){if(e.get("subject")!=null&&e.get("body")!=null){skip++;if(e.get("subject").toLowerCase().indexOf(t.toLowerCase())>=0||e.get("body").toLowerCase().indexOf(t.toLowerCase())>=0){if(s.length<limitofRecords){s.push(e)}else{console.log("first");skip--}}else if(s.length>=limitofRecords){console.log("second");skip--}}})}return s},admissionRequestAccepted:function(e){var t=new App.Models.Group;t.id=e;t.fetch({async:false});var i=mailView.inViewModel.get("senderId");t.get("members").push(i);t.save(null,{success:function(e,t){
var s=new App.Models.membercourseprogress;var n=new App.Collections.coursesteps;var o=new Array;var a=new Array;var l=new Array;n.courseId=t.id;n.fetch({success:function(){n.each(function(e){o.push(e.get("_id"));a.push("0");l.push("0")});s.set("stepsIds",o);s.set("memberId",i);s.set("stepsResult",a);s.set("stepsStatus",l);s.set("courseId",n.courseId);s.save({success:function(){alert("saved")}})}})}});var s=mailView.inViewModel.get("body").replace(/<(?:.|\n)*?>/gm,"");s='Admission request received from user "a" has been Accepted<br>';s=s+"<div style='margin-left: 3%;margin-top: 174px;font-size: 11px;color: rgb(204,204,204);'>You have accepted this request.</div>";mailView.inViewModel.save();var n=new Date;var o=new App.Models.Mail;o.set("senderId",$.cookie("Member._id"));o.set("receiverId",mailView.inViewModel.get("senderId"));o.set("subject","Admission Request Accepted | "+t.get("name"));o.set("body",'Your admission request for "'+t.get("name")+'" has been accepted by the course leader.');o.set("status","0");o.set("type","mail");o.set("sentDate",n);o.save();mailView.updateMailBody(s)},admissoinRequestRejected:function(e){var t=new App.Models.Group;t.id=e;t.fetch({async:false});var i=mailView.inViewModel.get("body").replace(/<(?:.|\n)*?>/gm,"");i='Admission request received from user "a" has been Rejected<br>';i=i+"<div style='margin-left: 3%;margin-top: 174px;font-size: 11px;color: rgb(204,204,204);'>You have rejected this request.</div>";var s=new Date;var n=new App.Models.Mail;n.set("senderId",$.cookie("Member._id"));n.set("receiverId",mailView.inViewModel.get("senderId"));n.set("subject","Admission Request Rejected | "+e.get("name"));n.set("body",'Your admission request for "'+e.get("name")+'" has been rejected by the course leader.');n.set("status","0");n.set("type","mail");n.set("sentDate",s);n.save();mailView.updateMailBody(i)},meetupRequestAccepted:function(e){var t=new App.Collections.UserMeetups;t.memberId=$.cookie("Member._id");t.meetupId=e;t.fetch({async:false});if(t.length>0){alert("Your have already joined this Meetup");return}var i=new App.Models.MeetUp;i.id=e;i.fetch({async:false});console.log(i);if(!i.get("title")){alert("Meetup No more Exist");return}var s=new App.Models.UserMeetup;s.set({memberId:$.cookie("Member._id"),meetupId:e,meetupTitle:i.get("title")});s.save();alert("Successfully Joined")},updateMailBody:function(e){var t=new App.Models.Mail;t.id=mailView.inViewModel.get("id");t.fetch({async:false});t.set("body",e);t.save();$("#mail-body").html("<br/>"+e)}})});$(function(){App.Views.CoursesChartProgress=Backbone.View.extend({tagName:"div",className:"Graphbutton",arrayOfData:new Array,grandpassed:null,grandremaining:null,events:{"click #Donut":function(){$("#graph").html(" ");document.getElementById("horizontallabel").style.visibility="hidden";document.getElementById("veticallable").style.visibility="hidden";this.$el.html('<a class="btn btn-info" id="Bar">Detailed View</a>');Morris.Donut({element:"graph",data:[{label:"Passed Steps",value:this.grandpassed},{label:"Remaining Steps",value:this.grandremaining}],colors:["#0B62A4","#7A92A3"]})},"click #Bar":function(){$("#graph").html(" ");document.getElementById("horizontallabel").style.visibility="visible";document.getElementById("veticallable").style.visibility="visible";this.$el.html('<a class="btn btn-info" id="Donut">Birdeye View</a>');Morris.Bar({element:"graph",data:this.arrayOfData,xkey:"subject",ykeys:["passed","remaining"],labels:["passed","remaining"],gridTextWeight:900,gridTextSize:16,axes:true,grid:true,stacked:true})}},addOne:function(e){temp=new Object;data=e.toJSON().stepsStatus;total=e.toJSON().stepsStatus.length;passed=0;remaining=0;for(var t=0;t<total;t++){if(data[t]!="1"){remaining++;this.grandremaining++}else{passed++;this.grandpassed++}}course=new App.Models.Group({_id:e.toJSON().courseId});course.fetch({async:false});if(total==0){temp.subject=course.toJSON().name+" (No Steps)"}else{temp.subject=course.toJSON().name}temp.passed=passed;temp.remaining=remaining;this.arrayOfData.push(temp)},BuildString:function(){if(this.collection.length!=0){this.collection.each(this.addOne,this)}else{alert("No Data Found on Server")}},render:function(){this.arrayOfData=[];this.grandpassed=0;this.grandremaining=0;this.BuildString();Morris.Bar({element:"graph",data:this.arrayOfData,xkey:"subject",ykeys:["passed","remaining"],labels:["passed","remaining"],gridTextWeight:900,gridTextSize:12,axes:true,grid:true,stacked:true,xLabelMargin:5});this.$el.append('<a class="btn btn-info" id="Donut">Birdeye View</a>')}})});$(function(){App.Views.CalendarForm=Backbone.View.extend({className:"signup-form",events:{"click #formButton":"setForm"},render:function(){this.form=new Backbone.Form({model:this.model});this.$el.append(this.form.render().el);var e;if(this.update){e=$('<div class="signup-submit"><a class="addEvent-btn btn btn-success" style="width:" id="formButton">Update Event</button></div>')}else{e=$('<div class="signup-submit"><a class="addEvent-btn btn btn-success" id="formButton">Add Event</button></div>')}this.$el.append(e)},setForm:function(){var e=this;this.model.once("sync",function(){e.trigger("CalendarForm:done")});this.form.setValue("userId",$.cookie("Member._id"));if(this.form.validate()==null){this.form.commit();this.model.save();if(this.update){alert("Event Successfully Updated!!!")}else{alert("Event Successfully Created!!!")}Backbone.history.navigate("calendar",{trigger:true})}}})});$(function(){App.Views.EventInfo=Backbone.View.extend({authorName:null,tagName:"table",className:"btable btable-striped resourceDetail",sid:null,rid:null,events:{"click #DestroyEvent":function(e){var t=this.model.toJSON();var i=$.cookie("Member._id");this.model.destroy();alert("Event Successfully Deleted!!!");Backbone.history.navigate("calendar",{trigger:true})}},initialize:function(){this.$el.append('<th colspan="2"><h6>Event Detail</h6></th>')},render:function(){var e=this.model.toJSON();var t=new Date(e.schedule);e.schedule=t.toUTCString();console.log(e);this.$el.append("<tr><td>Title</td><td>"+e.title+"</td></tr>");this.$el.append("<tr><td>Description</td><td>"+e.description+"</td></tr>");this.$el.append("<tr><td>Start Date</td><td>"+e.startDate+"</td></tr>");this.$el.append("<tr><td>End Date</td><td>"+e.endDate+"</td></tr>");this.$el.append("<tr><td>Timing</td><td>"+e.startTime+"-"+e.endTime+"</td></tr>");this.$el.append('<tr><td colspan="2"><button class="btn btn-danger" id="DestroyEvent">Destroy</button><a href="#calendar" style="margin-left:10px" class="btn btn-info">&lt;&lt; Calendar</a></td></tr>')}})});$(function(){App.Views.CollectionTable=Backbone.View.extend({tagName:"table",id:"collectionTable",display:false,className:"table table-striped",initialize:function(e){},addOne:function(e){var t=new App.Views.CollectionRow({model:e});t.display=this.display;t.render();this.$el.append(t.el)},events:{"click .clickonalphabets":function(e){this.collection.skip=0;var t=$(e.target).text();this.collection.startkey=t;this.collection.fetch({async:false});if(this.collection.length>0){this.render()}},"click #allresources":function(e){this.collection.startkey="";this.collection.skip=0;this.collection.fetch({async:false});if(this.collection.length>0){this.render()}},"click #mergeCollection":function(e){this.displayMergeForm()},"click #nextButton":function(e){this.collection.skip+=20;this.collection.fetch({async:false});if(this.collection.length>0){this.render()}},"click #preButton":function(e){this.collection.skip-=20;this.collection.fetch({async:false});if(this.collection.length>0){this.render()}}},displayMergeForm:function(){$("#invitationdiv").fadeIn(1e3);document.getElementById("cont").style.opacity=.1;document.getElementById("nav").style.opacity=.1;$("#invitationdiv").show();$("#invitationdiv").html('<h5 style="margin-left:40px;margin-top:40px">Select Collections to Merge<h5>');var e='<p style="margin-left:20px;"><label style="margin-left:20px"><b>Collections</b></label><select multiple="true" style="width:400px;" id="selectCollections">';this.collection.each(function(t){e+='<option value="'+t.get("_id")+'">'+t.get("CollectionName")+"</option>"});e+="</select></p>";$("#invitationdiv").append(e);$("#invitationdiv").append('<br><label style="margin-left:40px"><b>Name</b></label><input id="collectionName" type="text"></input>');$("#invitationdiv select").multiselect().multiselectfilter();$("#invitationdiv select").multiselect("uncheckAll");$("#invitationdiv").append("<br><br>");$("#invitationdiv").append('<button class="btn btn-success" style="margin-left:40px" id="continueMerging" onClick="continueMerging()">Continue</button>');$("#invitationdiv").append('<button class="btn btn-danger" style="margin-left:20px"  id="cancelMerging" onClick="cancelMerging()">Cancel</button>')},addAll:function(){var e="<tr><th colspan='6'>Collections";if(this.display==true)e+="<a id='mergeCollection' style='margin-left:20px' class='btn btn-info small'>Merge</a>";e+="</th></tr>";this.$el.html(e);var t="<tr></tr>";t+="<tr><td colspan=7>";t+='<a  id="allresources" >#</a>&nbsp;&nbsp;';var i="ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var s=0;s<i.length;s++){var n=i.charAt(s);t+='<a  class="clickonalphabets" value="'+n+'">'+n+"</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"}t+="</td></tr>";this.$el.append(t);this.collection.each(this.addOne,this);var o="<tr><td>";if(this.collection.length>=20){if(this.collection.skip>=20)o+='<button class="btn btn-success" id="preButton">Back</buttton>';o+='<button class="btn btn-success" id="nextButton">Next</buttton>'}o+="</td></tr>";this.$el.append(o)},render:function(){var e=this.getRoles();if(e.indexOf("Manager")>=0){this.display=true}else{this.display=false}this.addAll()},getRoles:function(){var e=new App.Models.Member({_id:$.cookie("Member._id")});e.fetch({async:false});var t=e.get("roles");return t}})});$(function(){App.Views.CollectionRow=Backbone.View.extend({tagName:"tr",template:$("#template-CollectionRow").html(),initialize:function(e){},render:function(){var e=this.model.toJSON();e.display=this.display;if(!e.CollectionName)e.CollectionName="XYZ";this.$el.append(_.template(this.template,e))}})});$(function(){App.Views.ListCollectionView=Backbone.View.extend({id:"invitationForm",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey","click #cancelButton":"hidediv","click #deleteButton":"deleteRecord","click #invitationForm .bbf-form .field-IsMajor input":"nesttedHideShow"},nesttedHideShow:function(e){if($("#invitationForm .bbf-form .field-IsMajor input").is(":checked")){$("#invitationForm .bbf-form .field-NesttedUnder").css("visibility","hidden")}else{$("#invitationForm .bbf-form .field-NesttedUnder").css("visibility","visible")}},hidediv:function(){$("#invitationdiv").fadeOut(1e3);document.getElementById("cont").style.opacity=1;document.getElementById("nav").style.opacity=1;setTimeout(function(){$("#invitationdiv").hide()},1e3)},deleteCollectionNameFromResources:function(e){$.ajax({url:'/resources/_design/bell/_view/resourceOnTag?_include_docs=true&key="'+e+'"',type:"GET",dataType:"json",success:function(t){var i=t.rows;var s=[];for(var n=0;n<i.length;n++){if(i[n].value.Tag.length>0){var o=i[n].value.Tag.indexOf(e);if(o>-1){i[n].value.Tag.splice(o,1)}}s.push(i[n].value)}$.couch.db("resources").bulkSave({docs:s},{success:function(e){alert("Successfully pushed resources back")}})},async:false})},deleteRecord:function(){$(".form .field-Tag select option[value="+this.model.get("_id")+"]").remove();$("#"+this.model.get("_id")).parent("tr").remove();this.deleteCollectionNameFromResources(this.model.get("_id"));this.model.set({show:false});this.model.save({success:location.reload()})},render:function(){var e=this;this.form=new Backbone.Form({model:e.model});this.$el.append(this.form.render().el);var t=$('<a class="btn btn-success" id="formButton">Save</button>');this.$el.append(t);this.$el.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");this.$el.append('<a class="btn btn-warning" id="cancelButton">Cancel</button>');if(this.model.get("_id")!=undefined){this.$el.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");this.$el.append('<a class="btn btn-danger" id="deleteButton">Delete</button>')}},setFormFromEnterKey:function(e){e.preventDefault();this.setForm()},setForm:function(){this.form.commit();var e=this.model.get("CollectionName");var t=false;var i=new App.Collections.listRCollection;i.fetch({async:false});i.each(function(i){if(i.get("show")==true&&e==i.get("CollectionName")){t=true}});if(t){alert("Collection Name already exist");$("#invitationdiv").fadeOut(1e3);document.getElementById("cont").style.opacity=1;document.getElementById("nav").style.opacity=1}else{if(this.model.get("NesttedUnder")!="--Select--"){this.model.set({IsMajor:false})}else{this.model.set({IsMajor:true})}if(this.model.get("CollectionName").length>0){var s=this;this.model.save(null,{success:function(e){alert("Collection Saved Successfully");if(s.model.get("_id")==undefined){if(s.model.get("NesttedUnder")=="--Select--"){if(s.model.get("IsMajor")==true){$(".form .field-Tag select").append('<option class="MajorCategory" value="'+s.model.get("id")+'">'+s.model.get("CollectionName")+"</option>")}else $(".form .field-Tag select").append('<option value="'+s.model.get("id")+'">'+s.model.get("CollectionName")+"</option>")}else{if($(".form .field-Tag select option[value="+s.model.get("NesttedUnder")+"]")!=null){$(".form .field-Tag select option[value="+s.model.get("NesttedUnder")+"]").after('<option  value="'+s.model.get("id")+'">'+s.model.get("CollectionName")+"</option>")}}$("#invitationdiv").fadeOut(1e3);document.getElementById("cont").style.opacity=1;document.getElementById("nav").style.opacity=1;setTimeout(function(){$("#invitationdiv").hide()},1e3);$(".form .field-Tag select").multiselect("refresh")}else{location.reload()}}})}else{alert("Enter collection name!")}}}})});$(function(){App.Views.siteFeedbackPage=Backbone.View.extend({tagName:"table",className:" table-feedback notification-table table-striped",authorName:null,searchText:null,Resolved:null,stack:null,category:null,urgent:null,applyFilters:null,resultArray:null,events:{"click #see-all":function(e){this.applyFilters="0";while(skipStack.length>0){skipStack.pop()}searchText="";this.resultArray=[];skip=0;skipStack.push(skip);this.fetchRecords()},"click #switch":function(e){this.applyFilters="1";this.category=$("#select_category").val();this.urgent=$("#select_urgent").val();if($("#select_status").val()=="Resolved"){this.Resolved="1"}else{this.Resolved="0"}while(skipStack.length>0){skipStack.pop()}searchText="";this.resultArray=[];skip=0;skipStack.push(skip);this.fetchRecords()},"click #search_feedback":function(e){this.applyFilters="0";searchText=$("#searchText").val();if(searchText!=""){while(skipStack.length>0){skipStack.pop()}this.resultArray=[];skip=0;skipStack.push(skip);this.fetchRecords()}},"click #previousButton":function(e){if(skipStack.length>1){skipStack.pop();skip=skipStack.pop();skipStack.push(skip);this.resultArray=[];this.fetchRecords()}else{$("#previousButton").hide()}},"click #next_button":function(e){skipStack.push(skip);this.resultArray=[];this.fetchRecords()}},initialize:function(){this.resultArray=[];this.category="Bug";this.Resolved="1";this.applyFilters="0";this.searchText="";if(url=="unknown"){url="siteFeedback"}if($("#comments")!=null){$("#debug").append('<div id="comments"></div>')}},addAll:function(){this.$el.html('<h4>Keyword:&nbsp;<input class="form-control" type="text" placeholder="Search in comment" value="" size="30" id="searchText" style="height:24px;margin-top:1%;"></input>&nbsp;<span><button class="btn btn-info" id="search_feedback">Search</button>&nbsp;<button class="btn btn-info" id="see-all">See All</button></span>&nbsp;<img id="progress_img" src="vendor/progress.gif" width="3%"></h4><br/>');this.$el.append('<Select id="select_category"><option>Bug</option><option>Question</option><option>Suggestion</option></select>&nbsp;&nbsp<select id="select_status"><option>Unresolve</option><option>Resolved</option></select>&nbsp;&nbsp<select id="select_urgent"><option>Normal</option><option>Urgent</option></select>&nbsp;&nbsp<button class="btn btn-info" id="switch">Apply Filters</button><br/><br/>');this.$el.append("<th ><h4>Feedback</h4></th><th ><h4>Status</h4></th>");$("#progress_img").hide();console.log(this.collection.toJSON());this.collection.forEach(this.addOne,this);this.$el.append('<br/><br/><input type="button" class="btn btn-hg btn-primary" id="previousButton" value="< Previous"> &nbsp;&nbsp;&nbsp;<button class="btn btn-hg btn-primary" id="next_button" >Next  ></button>')},addOne:function(e){if(!e.get("category")){e.set("category","Bug")}if(!e.get("priority")){e.set("priority",[])}if(e.toJSON()._id!="_design/bell"){var t=new App.Views.siteFeedbackPageRow({model:e});t.render();this.$el.append(t.el)}},render:function(){this.addAll();if(skipStack.length<=1){$("#previousButton").hide()}if(this.collection.length<5){$("#next_button").hide()}},fetchRecords:function(){$("#progress_img").show();var e=this;this.collection.fetch({success:function(){e.resultArray.push.apply(e.resultArray,e.searchInArray(e.collection.models,searchText));if(e.resultArray.length!=limitofRecords&&e.collection.models.length==limitofRecords){e.fetchRecords();return}else if(e.resultArray.length==0&&e.collection.models.length==0&&skipStack.length>1){$("#next_button").hide();skipStack.pop();return}if(e.resultArray.length==0&&skipStack.length==1){if(searchText!=""){alert("No result found")}}var t=new App.Collections.siteFeedbacks;{t.set(e.resultArray);e.collection=t;e.$el.html("");e.render()}}})},filterResult:function(e){var t=e.get("PageUrl");if(!t){t=""}var i=t.split("/");var s=i[0];for(var n=1;n<i.length;n++){if(i[n].length!=32){s=s+"/"+i[n]}else{n=t.length}}if(s==url){return true}else{console.log(url);return false}},checkFilters:function(e){console.log(e);if(this.filterResult(e)){if(this.applyFilters=="0"){return true}else if(this.Resolved==e.get("Resolved")&&this.category==e.get("category")){if(this.urgent=="Normal"&&e.get("priority").length==0){return true}else if(this.urgent=="Urgent"&&e.get("priority").length>0){return true}else{return false}}else{return false}}else{return false}},searchInArray:function(e,t){var i=this;var s=[];var n;_.each(e,function(e){if(e.get("comment")!=null){skip++;if(!e.get("category")){e.set("category","Bug")}if(!e.get("priority")){e.set("priority",[])}if(e.get("comment").toLowerCase().indexOf(t.toLowerCase())>=0&&i.checkFilters(e)){if(s.length<limitofRecords){s.push(e)}else{enablenext=1;skip--}}else if(s.length>=limitofRecords){skip--}}});return s}})});$(function(){App.Views.siteFeedbackPageRow=Backbone.View.extend({template0:$("#template-siteReviewRowAdmin").html(),template1:$("#template-siteReviewRownoAdmin").html(),tagName:"tr",authorName:null,events:{"click #resolveButton":"resolve","click #commentButton":"comment"},comment:function(e){console.log(e.target.attributes[0].nodeValue);var t=new App.Collections.reportsComment;t.feedbackId=e.target.attributes[0].nodeValue;t.fetch({async:false});var i=new App.Views.addComment({collection:t,commentId:e.target.attributes[0].nodeValue});i.render();$("#debug").append(i.el)},resolve:function(e){console.log(e);e.preventDefault();this.model.on("sync",function(){location.reload()});this.model.save({Resolved:"1"},{success:function(){}})},initialize:function(){if($.cookie("Member.login")=="admin"){this.template=this.template0}else{this.template=this.template1}},render:function(){var e=this.model.toJSON();if(this.model.get("priority").length==0){e.urgent="Normal"}else{e.urgent="Urgent"}console.log(e);this.$el.html(_.template(this.template,e))}})});$(function(){App.Views.siteFeedbackPageRow=Backbone.View.extend({template0:$("#template-siteReviewRowAdmin").html(),template1:$("#template-siteReviewRownoAdmin").html(),tagName:"tr",authorName:null,events:{"click #resolveButton":"resolve","click #commentButton":"comment"},comment:function(e){console.log(e.target.attributes[0].nodeValue);var t=new App.Collections.reportsComment;t.feedbackId=e.target.attributes[0].nodeValue;t.fetch({async:false});var i=new App.Views.addComment({collection:t,commentId:e.target.attributes[0].nodeValue});i.render();$("#debug").append(i.el)},resolve:function(e){console.log(e);e.preventDefault();this.model.on("sync",function(){location.reload()});this.model.save({Resolved:"1"},{success:function(){}})},initialize:function(){if($.cookie("Member.login")=="admin"){this.template=this.template0}else{this.template=this.template1}},render:function(){var e=this.model.toJSON();if(this.model.get("priority").length==0){e.urgent="Normal"}else{e.urgent="Urgent"}console.log(e);this.$el.html(_.template(this.template,e))}})});$(function(){App.Views.RequestTable=Backbone.View.extend({tagName:"table",className:"table table-striped",id:"requestsTable",addOne:function(e){if(e.toJSON()._id!="_design/bell"){var t=new App.Views.RequestRow({model:e});t.render();this.$el.append(t.el)}},addAll:function(){if(this.collection.length!=0){this.$el.append("<tr><th>User</th><th>Category</th><th>Request</th></tr>");this.collection.each(this.addOne,this)}else{this.$el.append("<th>No Requests</th>")}},render:function(){this.addAll()}})});$(function(){App.Views.RequestRow=Backbone.View.extend({tagName:"tr",template:$("#template-RequestRow").html(),render:function(){var e=this.model.toJSON();var t=new App.Models.Member({_id:e.senderId});t.fetch({async:false});t=t.toJSON();e.name=t.firstName+" "+t.lastName;this.$el.html(_.template(this.template,e))}})});$(function(){App.Views.Configurations=Backbone.View.extend({initialize:function(){this.$el.html("<h3>Set Configurations<h3>")},events:{"click #formButton":"setForm"},render:function(){this.form=new Backbone.Form({model:this.model});this.$el.append(this.form.render().el);this.$el.append('<a style="margin-left:31px;" class="btn btn-success" id="formButton">Submit Configurations </a>')},setForm:function(){this.form.commit();if(this.form.validate()!=null){return}var e=this.form.model;var t=new App.Collections.Configurations;t.fetch({async:false});var i=t.first();i.set("name",e.get("name"));i.set("nationName",e.get("nationName"));i.set("nationUrl",e.get("nationUrl"));i.set("code",e.get("code"));i.set("type",e.get("type"));i.set("notes",e.get("notes"));i.set("region",e.get("region"));i.set("version",e.get("version"));if(e.get("selectLanguage")!="Select an Option"){i.set("currentLanguage",e.get("selectLanguage"))}i.save(null,{success:function(e,t){App.configuration=i;var s=new Date;var n=s.getFullYear();var o=(1+s.getMonth()).toString();o=o.length>1?o:"0"+o;var a=s.getDate().toString();a=a.length>1?a:"0"+a;var l=n+"/"+o+"/"+a;$.ajax({type:"GET",url:'/activitylog/_design/bell/_view/getDocumentByDate?key="'+l+'"',dataType:"json",success:function(e){var t=e.rows[0].value;t.community=App.configuration.get("code");$.ajax({type:"PUT",url:"/activitylog/"+t._id+"/?rev="+t._rev,data:JSON.stringify(t),async:false,dataType:"json",success:function(e){console.log(e)}})}});alert("Configurations are Successfully Added");Backbone.history.navigate("dashboard",{trigger:true})}})}})});$(function(){App.Views.LogQuery=Backbone.View.extend({events:{"click #report_button":function(e){var t="Open BeLL";if($("#community-select").val()){t=$("#community-select").val()}if($("#start-date").val()&&$("#end-date").val()){console.log("community: "+$("#community-select").val()+"	"+"Start-Date: "+$("#start-date").val()+"    "+"End-Date: "+$("#end-date").val());App.Router.LogActivity(t,$("#start-date").val(),$("#end-date").val())}else{console.log("At least one of the criteria for report is missing")}}},template:$("#template-LogQuery").html(),initialize:function(){},render:function(){this.$el.html(_.template(this.template))}})});$(function(){App.Views.ActivityReport=Backbone.View.extend({vars:{},events:{},template:$("#template-ActivityReport").html(),initialize:function(){},render:function(){var e=this;$.ajax({url:"/members/_design/bell/_view/MaleCount?group=false",type:"GET",dataType:"json",success:function(t){e.vars=e.data;if(t.rows[0]){e.vars.MaleMembers=t.rows[0].value}else{e.vars.MaleMembers=0}$.ajax({url:"/members/_design/bell/_view/FemaleCount?group=false",type:"GET",dataType:"json",success:function(t){if(t.rows[0]){e.vars.FemaleMembers=t.rows[0].value}else{e.vars.FemaleMembers=0}e.vars.startDate=e.startDate;e.vars.endDate=e.endDate;e.vars.CommunityName=e.CommunityName;e.$el.html(_.template(e.template,e.vars))}})}})}})});$(function(){App.Views.ManageCommunity=Backbone.View.extend({events:{"click .SyncDbSelect":"SyncDbSelect","click #configuration":"Configuration","click .back":function(e){alert("back")}},initialize:function(){this.$el.append('<th colspan="2"><h6>Meetup Detail</h6></th>')},processJsonp:function(){alert()},render:function(){this.$el.html("");nName=App.configuration.get("nationName");pass=App.password;nUrl=App.configuration.get("nationUrl");currentBellName=App.configuration.get("name");var e=this.$el;this.$el.append('<div style="padding: 20px 20px 0px 20px; float: left;"> <a id="configuration"><button class="btn btn-primary" id="configbutton">Configurations</button></a> </div>');this.$el.append('<div style="padding: 20px 20px 0px 0px; float: left;"> <button class="SyncDbSelect btn btn-primary" id="sync">Sync With Nation</button>  </div>');this.$el.append('<div style="padding: 20px 20px 0px 0px; float: left;"> <a class="btn btn-primary" href="#publications/for-'+App.configuration.get("name")+'">Publications</a>  </div>')},syncDbs:function(e){alert("this is sync db function in community manage")},SyncDbSelect:function(){$("#invitationdiv").fadeIn(1e3);var e=new App.Views.listSyncDbView;e.render();$("#invitationdiv").html("&nbsp");$("#invitationdiv").append(e.el)},Configuration:function(){var e=new App.Collections.Configurations;e.fetch({async:false});var t=e.first();var i=new App.Views.Configurations({model:t});i.render();this.$el.html(i.el)}})});$(function(){App.Views.PublicationTable=Backbone.View.extend({authorName:null,tagName:"table",className:"table table-striped",collectionInfo:[],add:function(e,t,i){this.collectionInfo[t._id]=t;if(i){this.$el.append('<tr id="'+e+'"><td>'+t.IssueNo+'</td><td><a name="'+t._id+'" class="synPublication btn btn-info">Sync publication</a></td></tr>')}else{this.$el.append('<tr id="'+e+'"><td>'+t.IssueNo+'</td><td><a name="'+t._id+'" class="synPublication btn btn-info">Sync publication</a><label>&nbsp&nbspNot Synced</label></td></tr>')}},events:{"click .synPublication":"synPublication"},render:function(){this.$el.html("<tr><th>Issue Number</th><th>Actions</th></tr>");var e=this;var t=App.configuration.get("nationName"),i=App.password;var s=App.configuration.get("nationUrl"),n=App.configuration.get("name");var o="http://"+t+":"+i+"@"+s+'/publicationdistribution/_design/bell/_view/getPublications?include_docs=true&key=["'+n+'",'+false+"]";$.ajax({url:o,type:"GET",dataType:"jsonp",success:function(n){var o="";var a={};_.each(n.rows,function(e){a[e.doc.publicationId]=e.doc._id;o+='"'+e.doc.publicationId+'",'});if(o!=""){o=o.substring(0,o.length-1);var l="http://"+t+":"+i+"@"+s+"/publications/_all_docs?include_docs=true&keys=["+o+"]";$.ajax({url:l,type:"GET",dataType:"jsonp",success:function(t){var i=new App.Collections.Publication;var s=App.Server+"/publications/_design/bell/_view/allPublication?include_docs=true";i.setUrl(s);i.fetch({success:function(){_.each(t.rows,function(t){var s=t.doc;var n=i.models;var o=n.map(function(e){return e.get("_id")}).indexOf(s._id);var l=a[s._id];var r=false;if(o>-1){r=true;e.add(l,s,r)}else{e.add(l,s,r)}})}})},error:function(e,t,i){console.log(e);console.log(t);console.log(i)}})}},error:function(e,t,i){console.log(e);console.log(t);console.log(i)}})},synPublication:function(e){var t=this;var i=e.currentTarget.name;var s=$(e.currentTarget).closest("tr").attr("id");var n=this.collectionInfo[i];$.couch.allDbs({success:function(e){if(e.indexOf("tempresources")!=-1){$.couch.db("tempresources").drop({success:function(e){console.log(e);t.syncCourses(s,n)},error:function(e){console.log(e)}})}else{t.syncCourses(s,n)}},async:false})},syncCourses:function(e,t){var i=t.resources,s=t.courses,n=t.IssueNo;var o=App.configuration.get("nationUrl"),a=App.configuration.get("nationName");var l=[],r=[],c=[];for(var d in s){var u=s[d];l.push(u["courseID"]);var p=u["stepIDs"];for(var h in p){var m=p[h];r.push(m["stepID"]);var f=m["resourceIDs"];for(var g in f){c.push(f[g])}}}for(var v in i){c.push(i[v])}console.log("Syncing Resources and Courses..");console.log("http://"+a+":"+App.password+"@"+o+"/resources");console.log(c);App.startActivityIndicator();$.couch.db("tempresources").create({success:function(e){console.log(e);$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+a+":"+App.password+"@"+o+"/resources",target:"tempresources",doc_ids:c}),async:false,success:function(e){console.log(e);$.ajax({url:"/tempresources/_all_docs?include_docs=true",type:"GET",dataType:"json",success:function(e){var t=e.rows;var i=[];for(var s=0;s<t.length;s++){t[s].doc.sum=0;t[s].doc.timesRated=0;i.push(t[s].doc)}$.couch.db("tempresources").bulkSave({docs:i},{success:function(e){$.couch.replicate("tempresources","resources",{success:function(e){alert("Resources successfully synced");$.couch.db("tempresources").drop({success:function(e){console.log(e)},error:function(e){console.log(e)}});alert('Publication "'+n+'" Resources successfully synced')},error:function(e){console.log(e);alert("Unable to sync Resources");$.couch.db("tempresources").drop({success:function(e){console.log(e)},error:function(e){console.log(e)}})}},{create_target:true})},error:function(e){$.couch.db("tempresources").drop({success:function(e){console.log(e)},error:function(e){console.log(e)}});alert("Error!")}})},error:function(){alert("Unable to get resources.");$.couch.db("tempresources").drop({success:function(e){console.log(e)},error:function(e){console.log(e)}})},async:false});$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+a+":"+App.password+"@"+o+"/groups",target:"groups",doc_ids:l}),success:function(e){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+a+":"+App.password+"@"+o+"/coursestep",target:"coursestep",doc_ids:r}),success:function(e){$.couch.db("publications").saveDoc(t,{success:function(e){console.log("adding publication# "+t.IssueNo+" doc at community for bookkeeping");console.log(e)},error:function(e,t,i){console.log(i)}});$.ajax({url:"http://"+App.configuration.get("nationName")+":oleoleole@"+App.configuration.get("nationUrl")+'/community/_design/bell/_view/getCommunityByCode?_include_docs=true&key="'+App.configuration.get("code")+'"',type:"GET",dataType:"jsonp",success:function(e){var t=e.rows[0].value;var i=e.rows[0].id;$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+App.configuration.get("nationName")+":oleoleole@"+App.configuration.get("nationUrl")+"/community",target:"community",doc_ids:[i]}),success:function(e){console.log("Successfully Replicated.");var s=new Date;var n=s.getFullYear();var o=(1+s.getMonth()).toString();o=o.length>1?o:"0"+o;var a=s.getDate().toString();a=a.length>1?a:"0"+a;var l=o+"-"+a+"-"+n;t.lastPublicationsSyncDate=o+"/"+a+"/"+n;$.ajax({headers:{Accept:"application/json","Content-Type":"multipart/form-data"},type:"PUT",url:App.Server+"/community/"+i+"?rev="+t._rev,dataType:"json",data:JSON.stringify(t),success:function(e){$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",
data:JSON.stringify({source:"community",target:"http://"+App.configuration.get("nationName")+":oleoleole@"+App.configuration.get("nationUrl")+"/community",doc_ids:[i]}),success:function(e){alert("Successfully Replicated Publications.");App.stopActivityIndicator()},async:false})},async:false})},async:false})},error:function(){console.log("http://"+a+":oleoleole@"+nationURL+'/community/_design/bell/_view/getCommunityByCode?key="'+App.configuration.get("code")+'"')}})},error:function(e,t,i){console.log('Error syncing/replicating Publication "'+n+'" course-steps');console.log(t);console.log(i);App.stopActivityIndicator();alert("Failed to sync course-steps")}})},error:function(e,t,i){console.log('Error syncing/replicating Publication "'+n+'" courses');console.log(t);console.log(i);App.stopActivityIndicator();alert("Failed to sync courses")}})},error:function(e,t,i){console.log('Error syncing/replicating Publication "'+n+'" resources');console.log(t);console.log(i);$.couch.db("tempresources").drop({success:function(e){console.log(e)},error:function(e){console.log(e)}});App.stopActivityIndicator();alert("Failed to sync resources")}})}})},synResources:function(e,t,i,s){console.log("Syncing Resources..");console.log("http://"+t+":"+App.password+"@"+e+"/resources");console.log(i);$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+t+":"+App.password+"@"+e+"/resources",target:"resources",doc_ids:i}),success:function(e){console.log(e);alert('Publication "'+s+'" Resources successfully Synced')},error:function(e,t,i){console.log('Error syncing/replicating Publication "'+s+'" resources');console.log(t);console.log(i)}})}})});$(function(){App.Views.TrendActivityReport=Backbone.View.extend({vars:{},events:{},template:$("#template-TrendActivityReport").html(),initialize:function(){},render:function(){var e=this;e.vars=e.data;e.vars.startDate=e.startDate;e.vars.endDate=e.endDate;e.vars.CommunityName=e.CommunityName;e.$el.html(_.template(e.template,e.vars))}})});