$(function(){App.Router=new(Backbone.Router.extend({routes:{updatewelcomevideo:"addOrUpdateWelcomeVideoDoc","":"MemberLogin",dashboard:"Dashboard",ereader:"eReader",login:"MemberLogin",logout:"MemberLogout","member/add":"MemberForm","member/edit/:mid":"MemberForm",resources:"Resources","resource/add":"ResourceForm","resource/edit/:resourceId":"ResourceForm","resource/detail/:rsrcid/:shelfid/:revid":"Resource_Detail","resource/feedback/:resourceId":"ResourceFeedback","resource/feedback/add/:resourceId/:title":"FeedbackForm","resource/search":"bellResourceSearch","search-bell/:levelId/:rId":"SearchBell","assign-to-level":"AssignResourcetoLevel",courses:"Groups","course/manage/:groupId":"ManageCourse","course/details/:courseId/:courseName":"courseDetails","usercourse/details/:courseId/:courseName":"UserCourseDetails","course/report/:groupId/:groupName":"CourseReport","course/assignments/week-of/:groupId/:weekOf":"GroupWeekOfAssignments","course/assignments/:groupId":"GroupAssignments","course/add":"GroupForm","CourseInfo/:courseId":"CourseInfo","course/resign/:courseId":"ResignCourse","course/members/:courseId":"GroupMembers","level/add/:groupId/:levelId/:totalLevels":"AddLevel","level/view/:levelId/:rid":"ViewLevel","savedesc/:lid":"saveDescprition","create-quiz/:lid/:rid/:title":"CreateQuiz",collection:"Collection","listCollection/:collectionId":"ListCollection","listCollection/:collectionId/:collectionName":"ListCollection",meetups:"ListMeetups","meetup/add":"Meetup","meetup/delete/:MeetupId":"deleteMeetUp","usermeetup/detail/:meetupId/:title":"Meetup_Detail","meetup/details/:meetupId/:title":"usermeetupDetails","meetup/manage/:meetUpId":"Meetup","configuration/add":"Configure","search-bell/:publicationId":"SearchPresources",members:"Members",reports:"Reports",trendreport:"trendReport","reports/edit/:resportId":"ReportForm","reports/add":"ReportForm",mail:"email",newsfeed:"NewsFeed",badges:"Badges","courses/barchart":"CoursesBarChart",calendar:"CalendarFunction",addEvent:"addEvent","calendar/event/:eid":"calendaar","calendar-event/edit/:eid":"EditEvent",siteFeedback:"viewAllFeedback",myRequests:"myRequests",AllRequests:"AllRequests",replicateResources:"Replicate",savingPochDB:"PochDB",deletePouchDB:"deletePouchDB","course/invitations/add":"addCourseInvi",compile:"CompileManifest",dbInfo:"dbinfo",weeklyreports:"WeeklyReports",removecache:"UpdateManifest",logreports:"LogQuery",reportsActivity:"LogActivity",setbit:"setNeedOptimizedBit",CompileAppManifest:"CompileAppManifest",communityManage:"communityManage","publications/:community":"Publications"},addOrUpdateWelcomeVideoDoc:function(){var e=new App.Collections.Resources;e.setUrl(App.Server+"/resources/_design/bell/_view/welcomeVideo?include_docs=true");e.fetch({success:function(){},error:function(){alert("router:: addOrUpdateWelcomeVideoDoc:: error fetching welcome resources")},async:false});var t;if(e.length>0){t=e.models[0]}var a=t?t:new App.Models.Resource;a.on("processed",function(){Backbone.history.navigate("dashboard",{trigger:true})});var l=new App.Views.ResourceForm({model:a});l.renderAddOrUploadWelcomeVideoForm();App.$el.children(".body").html(l.el)},Publications:function(e){var t=new App.Views.PublicationTable;t.render();App.$el.children(".body").html("<h3>Publications</h3>");App.$el.children(".body").append(t.el)},communityManage:function(){var e=new App.Views.ManageCommunity;e.render();App.$el.children(".body").html(e.el)},addCourseInvi:function(){var e=new App.Models.CourseInvitation;e.set("courseId","test");e.set("userId","test");e.save(null,{success:function(e,t){console.log(t);alert("success")}});var t=new App.Collections.CourseInvitations;t.courseId="test";t.fetch({async:false},{success:function(e){console.log(e)}})},initialize:function(){this.bind("all",this.startUpStuff);this.bind("all",this.checkLoggedIn);this.bind("all",this.renderNav)},eReader:function(){this.underConstruction()},Badges:function(){this.underConstruction()},underConstruction:function(){App.$el.children(".body").html('<div style="margin:0 auto"><h4>This Functionality is under Construction</h4></div>')},startUpStuff:function(){if(App.idss.length==0){}$("div.takeQuizDiv").hide();$("#externalDiv").hide();$("#invitationdiv").hide();$("#debug").hide()},renderNav:function(){if($.cookie("Member._id")){var e=new App.Views.navBarView({isLoggedIn:"1"})}else{var e=new App.Views.navBarView({isLoggedIn:"0"})}$("div#nav .container").html(e.el)},checkLoggedIn:function(){if(!$.cookie("Member._id")){if($.url().attr("fragment")!="login"&&$.url().attr("fragment")!=""&&$.url().attr("fragment")!="member/add"){Backbone.history.stop();App.start()}}else{var e=$.cookie("Member.expTime");var t=new Date(Date.parse(e));var a=Math.abs(new Date-t);var l=72e5;if(a<l){var s=new Date;$.cookie("Member.expTime",s,{path:"/apps/_design/bell"})}else{this.expireSession();Backbone.history.stop();App.start()}}},expireSession:function(){$.removeCookie("Member.login",{path:"/apps/_design/bell"});$.removeCookie("Member._id",{path:"/apps/_design/bell"});$.removeCookie("Member.roles",{path:"/apps/_design/bell"});$.removeCookie("Member.expTime",{path:"/apps/_design/bell"})},Configure:function(){var e=new App.Models.Configuration;var t=new App.Views.Configurations({model:e});t.render();App.$el.children(".body").html(t.el)},MemberLogin:function(){if($.cookie("Member._id")){Backbone.history.navigate("dashboard",{trigger:true});return}var e=new App.Models.Credentials;var t=new App.Views.MemberLoginForm({model:e});t.once("success:login",function(){Backbone.history.navigate("dashboard",{trigger:true})});t.render();App.$el.children(".body").html('<h1 class="login-heading">Member login</h1>');App.$el.children(".body").append(t.el)},MemberLogout:function(){App.ShelfItems=null;this.expireSession();Backbone.history.navigate("login",{trigger:true})},getRoles:function(){var e=new App.Models.Member({_id:$.cookie("Member._id")});e.fetch({async:false});var t=e.get("roles");return t},Dashboard:function(){{App.ShelfItems={};$.ajax({type:"GET",url:'/shelf/_design/bell/_view/DuplicateDetection?include_docs=true&key="'+$.cookie("Member._id")+'"',dataType:"json",success:function(e){for(var t=0;t<e.rows.length;t++){App.ShelfItems[e.rows[t].doc.resourceId]=[e.rows[t].doc.hidden+"+"+e.rows[t].doc.resourceTitle+"+"+e.rows[t].doc._id]}},data:{},async:false})}var e=new App.Views.Dashboard;App.$el.children(".body").html(e.el);e.render();$("#olelogo").remove()},MemberForm:function(e){this.modelForm("Member","Member",e,"login")},modelForm:function(e,t,a,l){var s=this;var o=new App.Models[e];var n=new App.Views[e+"Form"]({model:o});if(a){o.id=a;o.fetch({async:false});App.$el.children(".body").html("<h3>Edit "+t+" | "+o.get("firstName")+"  "+o.get("lastName")+"</h3>")}else{App.$el.children(".body").html("<h3>Add "+t+"</h3>")}App.$el.children(".body").append(n.el);o.once("Model:ready",function(){n.on(e+"Form:done",function(){Backbone.history.navigate(l,{trigger:true})});n.render();$(".form .field-startDate input").datepicker({todayHighlight:true});$(".form .field-firstName input").attr("maxlength","25");$(".form .field-lastName input").attr("maxlength","25");$(".form .field-middleNames input").attr("maxlength","25");$(".form .field-login input").attr("maxlength","25");$(".form .field-endDate input").datepicker({todayHighlight:true});$(".form .field-startTime input").timepicker({minTime:"8:00am",maxTime:"12:30am"});$(".form .field-endTime input").timepicker({minTime:"8:00am",maxTime:"12:30am"});$(".form .field-frequency input").click(function(){if(this.value=="Weekly"){$(".form .field-Day").show()}else{$(".form .field-Day").hide()}})});if(a){o.once("sync",function(){o.trigger("Model:ready")});o.fetch({async:false})}else{o.trigger("Model:ready")}},Resources:function(){App.startActivityIndicator();var e=this;var t;var a=$.url().data.attr.host.split(".");a=a[0].substring(3);if(a=="")a="local";var l=this.getRoles();var s=new App.Collections.Resources({skip:0});s.fetch({success:function(){t=new App.Views.ResourcesTable({collection:s});t.isManager=l.indexOf("Manager");var e='<p style="margin-top:20px"><a class="btn btn-success" href="#resource/add">Add New Resource</a>';e+='<a style="margin-left:10px" class="btn btn-success" onclick=showRequestForm("Resource")>Request Resource</a>';e+='<button style="margin-left:10px;"  class="btn btn-info" onclick="document.location.href=\'#resource/search\'">Search<img width="25" height="0" style="margin-left: 10px;" alt="Search" src="img/mag_glass4.png"></button>';App.$el.children(".body").html(e);App.$el.children(".body").append('<p style="font-size:30px;color:#808080"><a href="#resources"style="font-size:30px;color:#0088CC;text-decoration: underline;">Resources</a>&nbsp&nbsp|&nbsp&nbsp<a href="#collection" style="font-size:30px;">Collections</a></p>');t.collections=App.collectionslist;t.render();App.$el.children(".body").append(t.el)}});App.stopActivityIndicator()},ResourceForm:function(e){var t=this;var a=e?new App.Models.Resource({_id:e}):new App.Models.Resource;a.on("processed",function(){Backbone.history.navigate("resources",{trigger:true})});var l=new App.Views.ResourceForm({model:a});App.$el.children(".body").html(l.el);if(a.id){App.listenToOnce(a,"sync",function(){l.render()});a.fetch({async:false})}else{l.render();$("input[name='addedBy']").val($.cookie("Member.login"))}$("input[name='addedBy']").attr("disabled",true);$("select[class='bbf-date']").attr("disabled",true);$("select[class='bbf-month']").attr("disabled",true);$("select[class='bbf-year']").attr("disabled",true);$(".form .field-subject select").attr("multiple",true);$(".form .field-subject select").multiselect().multiselectfilter();$(".form .field-Level select").attr("multiple",true);$(".form .field-Level select").multiselect().multiselectfilter();if(a.id==undefined){$(".form .field-Level select").multiselect("uncheckAll");$(".form .field-subject select").multiselect("uncheckAll")}$(".form .field-Tag select").attr("multiple",true);$(".form .field-Tag select").click(function(){t.AddNewSelect(this.value)});$(".form .field-Tag select").dblclick(function(){t.EditTag(this.value)});var s=".form .field-Tag select";this.RenderTagSelect(s);$(".form .field-Tag select").multiselect().multiselectfilter();$(".form .field-Tag select").multiselect("uncheckAll");if(a.id){$(".form .field-subject select").multiselect("refresh");if(a.get("Tag")){var o=a.get("Tag").length;for(var n=0;n<o;n++){$('.form .field-Tag select option[value="'+a.get("Tag")[n]+'"]').attr("selected","selected")}$(".form .field-Tag select").multiselect("refresh")}if(a.get("subject")==null){$(".form .field-subject select").find("option").removeAttr("selected")}if(a.get("Tag")==null){$(".form .field-Tag select").find("option").removeAttr("selected")}if(a.get("Level")==null){$(".form .field-Level select").find("option").removeAttr("selected")}}},bellResourceSearch:function(){popAll();var e=new App.Views.Search;e.addResource=false;e.render();App.$el.children(".body").html(e.el);$("#multiselect-collections-search").multiselect().multiselectfilter();$("#multiselect-levels-search").multiselect().multiselectfilter();$("#multiselect-medium-search").multiselect({multiple:false,header:"Select an option",noneSelectedText:"Select an Option",selectedList:1});$("#search-language").multiselect({multiple:false,header:"Select an option",noneSelectedText:"Select an Option",selectedList:1});$("#srch").hide();$(".search-bottom-nav").hide();$(".search-result-header").hide();$("#selectAllButton").hide();showSubjectCheckBoxes();$("#multiselect-subject-search").multiselect().multiselectfilter()},SearchBell:function(e,t,a){var l=new App.Models.CourseStep({_id:e});l.fetch({success:function(){if(typeof e==="undefined"){document.location.href="#courses"}if(typeof t==="undefined"){document.location.href="#courses"}grpId=e;levelrevId=t;ratingFilter.length=0;rtitle.length=0;rids.length=0;var a=new App.Views.Search;a.resourceids=l.get("resourceId");a.addResource=true;a.render();App.$el.children(".body").html(a.el);$("#multiselect-collections-search").multiselect().multiselectfilter();$("#multiselect-levels-search").multiselect().multiselectfilter();$("#multiselect-medium-search").multiselect({multiple:false,header:"Select an option",noneSelectedText:"Select an Option",selectedList:1});$("#search-language").multiselect({multiple:false,header:"Select an option",noneSelectedText:"Select an Option",selectedList:1});$("#srch").hide();$(".search-bottom-nav").hide();$(".search-result-header").hide();$("#selectAllButton").hide();showSubjectCheckBoxes();$("#multiselect-subject-search").multiselect().multiselectfilter()}})},AssignResourcetoLevel:function(){if(typeof grpId==="undefined"){document.location.href="#courses"}var e=new App.Models.CourseStep({_id:grpId});e.fetch({async:false});var t=e.get("resourceId");var a=e.get("resourceTitles");$("input[name='result']").each(function(){if($(this).is(":checked")){var e=$(this).val();if(t.indexOf(e)==-1){rtitle.push($(this).attr("rTitle"));rids.push(e)}}});e.set("resourceId",t.concat(rids));e.set("resourceTitles",a.concat(rtitle));e.save(null,{success:function(t,a){e.set("_rev",a.rev);alert("Your Resources have been updated successfully");Backbone.history.navigate("level/view/"+a.id+"/"+a.rev,{trigger:true})}})},SearchPresources:function(e){var t=new App.Models.Publication({_id:e});t.fetch({success:function(){var t=new App.Views.Search;grpId=e;t.addResource=true;t.Publications=true;App.$el.children(".body").html(t.el);t.render();$("#multiselect-collections-search").multiselect().multiselectfilter();$("#multiselect-levels-search").multiselect().multiselectfilter();$("#multiselect-medium-search").multiselect({multiple:false,header:"Select an option",noneSelectedText:"Select an Option",selectedList:1});$("#search-language").multiselect({multiple:false,header:"Select an option",noneSelectedText:"Select an Option",selectedList:1});$("#srch").hide();$(".search-bottom-nav").hide();$(".search-result-header").hide();$("#selectAllButton").hide();showSubjectCheckBoxes();$("#multiselect-subject-search").multiselect().multiselectfilter()},async:false})},Groups:function(){App.startActivityIndicator();groups=new App.Collections.Groups;groups.fetch({success:function(){groupsTable=new App.Views.GroupsTable({collection:groups});groupsTable.render();var e='<p id="library-top-buttons">';e+='<a class="btn btn-success" style="width: 110px"; href="#course/add">Add Course</a>';e+='<a style="margin-left:10px" class="btn btn-success" onclick=showRequestForm("Course")>Request Course</a>';e+='<span style="float:right"><input id="searchText"  placeholder="Search" value="" size="30" style="height:24px;margin-top:1%;" type="text"><span style="margin-left:10px">';e+='<button class="btn btn-info" onclick="CourseSearch()">Search</button></span>';e+="</p>";App.$el.children(".body").html(e);App.$el.children(".body").append("<h3>Courses</h3>");App.$el.children(".body").append(groupsTable.el)}});App.stopActivityIndicator()},CreateQuiz:function(e,t,a){var l=new App.Models.CourseStep({_id:e});l.fetch({success:function(){var t=new App.Views.QuizView;t.levelId=e;t.revId=l.get("_rev");t.ltitle=a;if(l.get("questions")){App.$el.children(".body").html("<h3>Edit Quiz for |"+a+"</h3>");t.quizQuestions=l.get("questions");t.questionOptions=l.get("qoptions");t.answers=l.get("answers")}App.$el.children(".body").html(t.el);t.render();if(l.get("questions")){t.displayQuestionsInView()}}})},CourseInfo:function(e){var t=new App.Models.Group;t.set("_id",e);t.fetch({async:false});var a=t.get("courseLeader");var l=new App.Models.Member;l.set("_id",a);l.fetch({async:false});var s=new App.Views.CourseInfoView({model:t});s.leader=l;s.render();App.$el.children(".body").html("&nbsp");App.$el.children(".body").append('<div class="courseInfo-header"><a href="#usercourse/details/'+e+"/"+t.get("name")+'"><button type="button" class="btn btn-info" id="back">Back</button></a>&nbsp;&nbsp;&nbsp;&nbsp<a href="#course/resign/'+e+'"><button id="resignCourse" class="btn resignBtn btn-danger" value="0">Resign</button></a>&nbsp;&nbsp;</div>');App.$el.children(".body").append(s.el)},CourseReport:function(e,t){var a=this.getRoles();var l=new App.Models.Group;l.id=e;l.fetch({async:false});App.$el.children(".body").html("<h2> "+t+"</h2>");if(l.get("courseLeader")!=undefined&&l.get("courseLeader")==$.cookie("Member._id")||a.indexOf("Manager")!=-1){App.$el.children(".body").append('<button class="btn btn-success" style="margin-left:784px;margin-top:-74px"  onclick = "document.location.href=\'#course/manage/'+e+"'\">Manage</button>")}App.$el.children(".body").append("<div id='graph'></div>");var s=new App.Collections.StepResultsbyCourse;if(l.get("courseLeader")!=$.cookie("Member._id")&&a.indexOf("Manager")==-1){s.memberId=$.cookie("Member._id")}s.courseId=e;s.fetch({async:false});var o=new App.Views.CoursesStudentsProgress({collection:s});o.render();App.$el.children(".body").append(o.el)},ManageCourse:function(e){var t=this;levels=new App.Collections.CourseLevels;levels.groupId=e;var a="Group";var l=new App.Models[a];var s=new App.Views[a+"Form"]({model:l});App.$el.children(".body").html("<br/>");App.$el.children(".body").append("<h3>Course Manage</h3>");App.$el.children(".body").append(s.el);l.once("Model:ready",function(){s.on(a+"Form:done",function(){Backbone.history.navigate(reroute,{trigger:true})});s.render();$(".form .field-startDate input").datepicker({todayHighlight:true});$(".form .field-endDate input").datepicker({todayHighlight:true});$(".form .field-startTime input").timepicker({minTime:"8:00am",maxTime:"12:30am"});$(".form .field-endTime input").timepicker({minTime:"8:00am",maxTime:"12:30am"});var e=t.getRoles();if(e.indexOf("Manager")==-1)$(".form .field-courseLeader select").attr("disabled","true");$(".form .field-frequency input").click(function(){if(this.value=="Weekly"){$(".form .field-Day").show()}else{$(".form .field-Day").hide()}})});if(e){l.id=e;l.once("sync",function(){l.trigger("Model:ready")});l.fetch()}else{l.trigger("Model:ready")}levels.fetch({success:function(){levels.sort();lTable=new App.Views.LevelsTable({collection:levels});lTable.groupId=e;lTable.render();App.$el.children(".body").append("</BR><h3> Course Steps </h3>");App.$el.children(".body").append(lTable.el);$("#moveup").hide();$("#movedown").hide();$("input[type='radio']").hide()}})},courseDetails:function(e,t){var a=new App.Models.Group({_id:e});a.fetch({async:false});var l=a.get("courseLeader");var t=a.get("name");var s=a.get("members");var o='<br><a href="#courses"><button class="btn btn-success">Back to courses</button></a>';if(s&&s.indexOf($.cookie("Member._id"))==-1){o+='&nbsp;&nbsp;<button class="btn btn-danger" id="admissionButton" onClick=sendAdminRequest("'+l+'","'+encodeURI(t)+'","'+e+'")>Admission</button><br/><br/>'}else{o+="<br/><br/>"}App.$el.children(".body").html('<div id="courseName-heading"><h3>Course Details | '+t+"</h3></div>");App.$el.children(".body").append(o);var n=new App.Models.Member;n.set("_id",l);n.fetch({async:false});var r=new App.Collections.coursesteps;r.courseId=e;r.fetch({async:false});var i=new App.Views.GroupView({model:a});i.courseLeader=n;i.render();var c=new App.Views.CourseStepsView({collection:r});c.render();App.$el.children(".body").append(i.el);App.$el.children(".body").append('<div id="courseSteps-heading"><h5>Course Steps</h5></div>');App.$el.children(".body").append(c.el);$("#admissionButton").on("click",function(e){$(document).trigger("Notification:submitButtonClicked")})},UserCourseDetails:function(e,t){var a=new App.Collections.coursesteps;a.courseId=e;a.fetch({success:function(){App.$el.children(".body").html("&nbsp");App.$el.children(".body").append('<p class="Course-heading">Course<b>|</b>'+t+'    <a href="#CourseInfo/'+e+'"><button class="btn fui-eye"></button></a><a id="showBCourseMembers" style="float:right;margin-right:10%" href="#course/members/'+e+'" style="margin-left:10px" class="btn btn-info">Course Members</a> </p>');var l=new App.Views.CourseLevelsTable({collection:a});l.courseId=e;l.render();App.$el.children(".body").append(l.el)}})},GroupMembers:function(e){var t=new App.Views.GroupMembers;t.courseId=e;t.render();App.$el.children(".body").html(t.el)},GroupForm:function(e){this.modelForm("Group","Course",e,"courses")},GroupAssign:function(e){var t=new App.Views.AssignResourcesToGroupTable;t.groupId=e;t.render();App.$el.children(".body").html(t.el)},ResignCourse:function(e){var t=$.cookie("Member._id");var a=new App.Models.Group;a.set("_id",e);a.fetch({async:false});var l=a.get("members");var s=l.indexOf(t);l.splice(s,1);a.set({members:l});a.save();var o=new App.Collections.memberprogressallcourses;o.memberId=t;o.fetch({async:false});o.each(function(t){if(t.get("courseId")==e){t.destroy()}});var n=new App.Models.Mail;var r=new Date;var i=a.get("courseLeader");var c="Course Resignation | "+a.get("name")+"";var d="Hi,<br>Member "+$.cookie("Member.login")+" has resign from "+a.get("name")+"";n.set("senderId",$.cookie("Member._id"));n.set("receiverId",i);n.set("subject",c);n.set("body",d);n.set("status","0");n.set("type","mail");n.set("sentDate",r);n.save();alert("Successfully resigned from "+a.get("name")+" . ");Backbone.history.navigate("dashboard",{trigger:true})},GroupWeekOfAssignments:function(e,t){if(!t){t=moment().subtract("days",moment().format("d")).format("YYYY-MM-DD")}var a=t;var l=moment(t).add("days",7).format("YYYY-MM-DD");var s=new App.Views.AssignWeekOfResourcesToGroupTable;App.$el.children(".body").html(s.el);s.group=new App.Models.Group;s.group.id=e;s.resources=new App.Collections.Resources;s.assignments=new App.Collections.GroupAssignmentsByDate;s.assignments.groupId=e,s.assignments.startDate=a;s.assignments.endDate=l;s.weekOf=t;s.resources.on("sync",function(){s.assignments.fetch()});s.assignments.on("sync",function(){s.group.fetch()});s.group.on("sync",function(){s.render()});s.resources.fetch()},AddLevel:function(e,t,a){var l=new App.Models.CourseStep;l.set({courseId:e});var s=new App.Views.LevelForm({model:l});if(t=="nolevel"){App.$el.children(".body").html("<h3>New Step</h3>");s.edit=false;s.previousStep=0;s.render();App.$el.children(".body").append(s.el);$("input[name='step']").attr("disabled",true)}else{l.set({_id:t});l.once("sync",function(){App.$el.children(".body").html("<h3>Edit Step</h3>");s.edit=true;s.ques=l.get("questions");s.ans=l.get("answers");s.opt=l.get("qoptions");s.res=l.get("resourceId");s.rest=l.get("resourceTitles");s.previousStep=l.get("step");s.render();App.$el.children(".body").append(s.el);$("input[name='step']").attr("disabled",true)});l.fetch()}if(a!=-1){var o=parseInt(a)+1;$("input[name='step']").val(o)}},ViewLevel:function(e,t){var a=new App.Models.CourseStep({_id:e});var l=this;a.fetch({success:function(){var l=new App.Views.LevelDetail({model:a});l.render();App.$el.children(".body").html("<h3> Step "+a.get("step")+" | "+a.get("title")+"</h3>");App.$el.children(".body").append('<a class="btn btn-success" href=\'#level/add/'+a.get("courseId")+"/"+e+"/-1'\">Edit Step</a>&nbsp;&nbsp;");App.$el.children(".body").append("<a class='btn btn-success' href='#course/manage/"+a.get("courseId")+"'>Back To Course </a>&nbsp;&nbsp;");App.$el.children(".body").append("</BR></BR><B>Description</B></BR><TextArea id='LevelDescription' rows='5' cols='100' style='width:98%;'>"+a.get("description")+"</TextArea></BR>");App.$el.children(".body").append("<button class='btn btn-success' style='float:right;' onclick='document.location.href=\"#savedesc/"+e+"\"'>Save</button></BR></BR>");App.$el.children(".body").append('<B>Resources</B>&nbsp;&nbsp;<a class="btn btn-success"  style="" href=\'#search-bell/'+e+"/"+t+"'\">Add</a>");App.$el.children(".body").append(l.el);App.$el.children(".body").append("</BR>");if(a.get("questions")==null){App.$el.children(".body").append('<a class="btn btn-success"  style="float:right;"  href=\'#create-quiz/'+a.get("_id")+"/"+a.get("_rev")+"/"+a.get("title")+"'\">Create Quiz</a>&nbsp;&nbsp;")}else{App.$el.children(".body").append("<B>"+a.get("title")+' - Quiz</B><a class="btn btn-primary"  style="float:right;" href=\'#create-quiz/'+a.get("_id")+"/"+a.get("_rev")+"/"+a.get("title")+"'\">Edit Quiz</a>&nbsp;&nbsp;")}}})},saveDescprition:function(e){var t=new App.Models.CourseStep({_id:e});var a=this;t.fetch({success:function(){t.set("description",$("#LevelDescription").val());var a=this;t.save();t.on("sync",function(){document.location.href="#level/view/"+e+"/"+t.get("rev")})}})},GroupSearch:function(){var e;e=new App.Views.CourseSearch;e.render();var t='<p style="margin-top:15px">';t+='<a class="btn btn-success" href="#course/add">Add a new Cource</a>';t+='<a style="margin-left:10px" class="btn btn-success" onclick=showRequestForm("Course")>Request Course</a>';t+='<a style="margin-left:10px" class="btn btn-info" onclick="ListAllCourses()">View All Courses</a>';t+='<span style="float:right">Keyword:&nbsp;<input id="searchText"  placeholder="Search" value="" size="30" style="height:24px;margin-top:1%;" type="text"><span style="margin-left:10px">';t+='<button class="btn btn-info" onclick="CourseSearch()">Search</button></span>';t+="</p>";App.$el.children(".body").html(t);App.$el.children(".body").append("<h3>Courses</h3>");App.$el.children(".body").append(e.el)},ListMeetups:function(){App.$el.children(".body").html('<h3>Meetups<a style="margin-left:20px" class="btn btn-success" href="#meetup/add">Add Meetup</a></h3>');var e=new App.Collections.Meetups;e.fetch({async:false});var t=new App.Views.MeetUpTable({collection:e});t.render();App.$el.children(".body").append(t.el)},Meetup_Detail:function(e,t){var a=new App.Models.MeetUp({_id:e});a.fetch({async:false});var l=new App.Views.MeetupDetails({model:a});l.render();App.$el.children(".body").html(l.el)},usermeetupDetails:function(e,t){var a=new App.Models.MeetUp({_id:e});a.fetch({async:false});var l=new App.Views.meetupView({model:a});l.render();App.$el.children(".body").html(l.el)},Meetup:function(e){var t="MeetUp";var a=new App.Models[t];if(e){a.id=e;a.fetch({async:false})}var l=new App.Views[t+"Form"]({model:a});l.render();App.$el.children(".body").html(l.el);$(".form .field-startTime input").timepicker({minTime:"8:00am",maxTime:"12:30am"});$(".form .field-endTime input").timepicker({minTime:"8:00am",maxTime:"12:30am"});$(".form .field-startDate input").datepicker({todayHighlight:true});$(".form .field-endDate input").datepicker({todayHighlight:true});$(".form .field-reoccuring input").click(function(){if(this.value=="Weekly"){$(".form .field-Day").show()}else{$(".form .field-Day").hide()}})},deleteMeetUp:function(e){var t=new App.Collections.UserMeetups;t.meetupId=e;t.fetch({async:false});var a;while(a=t.first()){a.destroy()}var l=new App.Models.MeetUp({_id:e});l.fetch({async:false});l.destroy();Backbone.history.navigate("meetups",{trigger:true})},Members:function(){var e=new App.Views.MembersView;e.render();App.$el.children(".body").html(e.el)},Reports:function(){App.startActivityIndicator();var e=this.getRoles();var t=new App.Collections.Reports;t.fetch({async:false});var a=new App.Views.ReportsTable({collection:t});a.isManager=e.indexOf("Manager");a.render();App.$el.children(".body").html("");if(e.indexOf("Manager")>-1){App.$el.children(".body").append('<p style="margin-top:10px"><a class="btn btn-success" href="#reports/add">Add a new Report</a>'+'<a style="margin-left:20px" class="btn btn-success" href="#logreports">Activity Report</a>'+'<a style="margin-left:20px" class="btn btn-success" href="#trendreport">Trend Activity Report</a></p>')}else{App.$el.children(".body").append('<p style="margin-top:10px;margin-left:10px;"><a class="btn btn-success" href="#logreports">Activity Report</a></p>')}var l=$.url().attr("host").split(".");l=l[0].substring(3);if(l.length==0){l="Community"}App.$el.children(".body").append('<h4><span style="color:gray;">'+l+"</span> | Reports</h4>");App.$el.children(".body").append(a.el);App.stopActivityIndicator()},turnDateToYYYYMMDDFormat:function(e){var t=e.getFullYear().toString();var a=(e.getMonth()+1).toString();var l=e.getDate().toString();var s=a.split("");var o=l.split("");var n=t+"/"+(s.length===2?a:"0"+s[0])+"/"+(o.length===2?l:"0"+o[0]);return n},aggregateDataForTrendReport:function(e,t){if(t.length<1){var a={Visits:{male:0,female:0},New_Signups:{male:0,female:0},Deleted:{male:0,female:0},Most_Freq_Open:[],Highest_Rated:[],Lowest_Rated:[],ResourceViews:{male:0,female:0}};return a}var l=t[0];if(l==undefined){alert("No Activity Logged for this period")}var s=[],o=[],n=[],r=0,i=0,c=0,d=0,p=[],u=[],m=[],f=[],g=[],h=[];var v=0,y=0;if(l.resourcesIds){s=l.resourcesIds}if(l.resources_names){n=l.resources_names}if(l.resources_opened){o=l.resources_opened}if(l.male_visits){r=l.male_visits}if(l.female_visits){i=l.female_visits}if(l.male_new_signups){c=l.male_new_signups}if(l.female_new_signups){d=l.female_new_signups}if(l.male_rating){p=l.male_rating}if(l.female_rating){u=l.female_rating}if(l.male_timesRated){m=l.male_timesRated}if(l.female_timesRated){f=l.female_timesRated}if(l.male_opened){g=l.male_opened}if(l.female_opened){h=l.female_opened}if(l.male_deleted_count){y=l.male_deleted_count}if(l.female_deleted_count){v=l.female_deleted_count}for(var b=0;b<t.length;b++){if(b>0){var w=t[b];r+=w.male_visits;i+=w.female_visits;c+=w.male_new_signups?w.male_new_signups:0;d+=w.female_new_signups?w.female_new_signups:0;v+=w.female_deleted_count?w.female_deleted_count:0;y+=w.male_deleted_count?w.male_deleted_count:0;var _=w.resourcesIds;var A=w.resources_names;var M=w.resources_opened;for(var R=0;R<_.length;R++){var D=_[R];var $=s.indexOf(D);if($==-1){s.push(D);p.push(w.male_rating[R]);u.push(w.female_rating[R]);m.push(w.male_timesRated[R]);f.push(w.female_timesRated[R])}else{p[$]=p[$]+w.male_rating[R];u[$]=u[$]+w.female_rating[R];m[$]=m[$]+w.male_timesRated[R];f[$]=f[$]+w.female_timesRated[R]}}if(M){for(var R=0;R<M.length;R++){var D=M[R];var $=o.indexOf(D);if($==-1){o.push(D);if(A!=undefined&&A!=null){if(A.length>0){n.push(A[R])}}g.push(w.male_opened[R]);h.push(w.female_opened[R])}else{g[$]=g[$]+w.male_opened[R];h[$]=h[$]+w.female_opened[R]}}}}}var C=0;for(var R=0;R<h.length;R++){C+=h[R]}var F=0;for(var R=0;R<g.length;R++){F+=g[R]}var Y=[],S=[];for(var R=0;R<o.length;R++){Y.push(g[R]+h[R])}var T=[];var I=5;if(Y.length>=I){T=this.findIndicesOfMax(Y,I)}else{T=this.findIndicesOfMax(Y,Y.length)}var k,V;if(Y.length>0){var B,N;for(var R=0;R<T.length;R++){var x=new App.Models.Resource({_id:o[T[R]]});x.fetch({async:false});var O=x.get("title");B={resourceName:O,timesOpenedCumulative:Y[T[R]],timesOpenedByMales:g[T[R]],timesOpenedByFemales:h[T[R]]};if((N=s.indexOf(o[T[R]]))===-1){B["avgRatingCumulative"]="N/A";B["avgRatingByMales"]="N/A";B["avgRatingByFemales"]="N/A";B["timesRatedByMales"]="N/A";B["timesRatedByFemales"]="N/A";B["timesRatedCumulative"]="N/A"}else{k=m[N]+f[N];V=p[N]+u[N];B["avgRatingCumulative"]=Math.round(V/k*100)/100;B["avgRatingByMales"]=p[N];B["avgRatingByFemales"]=u[N];B["timesRatedByMales"]=m[N];B["timesRatedByFemales"]=f[N];B["timesRatedCumulative"]=k}S.push(B)}}var L=[],U=[],q=[];var P=5;for(var R=0;R<s.length;R++){k=m[R]+f[R];V=p[R]+u[R];L.push(V/k)}var j=[],J=[];if(L.length>=I){j=this.findIndicesOfMax(L,I);J=this.findIndicesOfMin(L,P)}else{j=this.findIndicesOfMax(L,L.length);J=this.findIndicesOfMin(L,L.length)}if(L.length>0){var G,H;for(var R=0;R<j.length;R++){var x=new App.Models.Resource({_id:s[j[R]]});x.fetch({async:false});var O=x.get("title");k=m[j[R]]+f[j[R]];G={resourceName:O,avgRatingCumulative:Math.round(L[j[R]]*100)/100,avgRatingByMales:p[j[R]],avgRatingByFemales:u[j[R]],timesRatedByMales:m[j[R]],timesRatedByFemales:f[j[R]],timesRatedCumulative:m[j[R]]+f[j[R]]};if((N=o.indexOf(s[j[R]]))===-1){G["timesOpenedByMales"]="N/A";G["timesOpenedByFemales"]="N/A";G["timesOpenedCumulative"]="N/A"}else{G["timesOpenedByMales"]=g[N];G["timesOpenedByFemales"]=h[N];G["timesOpenedCumulative"]=Y[N]}U.push(G)}for(var R=0;R<J.length;R++){k=m[J[R]]+f[J[R]];var x=new App.Models.Resource({
_id:s[J[R]]});x.fetch({async:false});var O=x.get("title");H={resourceName:O,avgRatingCumulative:Math.round(L[J[R]]*100)/100,avgRatingByMales:p[J[R]],avgRatingByFemales:u[J[R]],timesRatedByMales:m[J[R]],timesRatedByFemales:f[J[R]],timesRatedCumulative:m[J[R]]+f[J[R]]};if((N=o.indexOf(s[J[R]]))===-1){H["timesOpenedByMales"]="N/A";H["timesOpenedByFemales"]="N/A";H["timesOpenedCumulative"]="N/A"}else{H["timesOpenedByMales"]=g[N];H["timesOpenedByFemales"]=h[N];H["timesOpenedCumulative"]=Y[N]}q.push(H)}}var a={Visits:{male:r,female:i},New_Signups:{male:c,female:d},Deleted:{male:y,female:v},Most_Freq_Open:S,Highest_Rated:U,Lowest_Rated:q,ResourceViews:{male:F,female:C}};return a},turnDateFromMMDDYYYYToYYYYMMDDFormat:function(e){var t=e.match(/\d+/g),a=t[0],l=t[1],s=t[2];return s+"/"+a+"/"+l},getRegisteredMembersCount:function(e){var t=0,a=0;$.ajax({url:'/activitylog/_design/bell/_view/GetMaleCountByCommunity?key="'+App.configuration.get("code")+'"',type:"GET",dataType:"json",async:false,success:function(l){if(l.rows[0]){t=l.rows[0].value}$.ajax({url:'/activitylog/_design/bell/_view/GetFemaleCountByCommunity?key="'+App.configuration.get("code")+'"',type:"GET",dataType:"json",async:false,success:function(l){if(l.rows[0]){a=l.rows[0].value}e(t,a)}})}})},getRegisteredMembersCountFromMembersDB:function(e){var t=0,a=0;$.ajax({url:'/members/_design/bell/_view/MaleCountByCommunity?key="'+App.configuration.get("code")+'"',type:"GET",dataType:"json",async:false,success:function(l){if(l.rows[0]){t=l.rows[0].value}$.ajax({url:'/members/_design/bell/_view/FemaleCountByCommunity?key="'+App.configuration.get("code")+'"',type:"GET",dataType:"json",async:false,success:function(l){if(l.rows[0]){a=l.rows[0].value}e(t,a)}})}})},getTotalMemberVisits:function(e){var t=0,a=0;$.ajax({url:'/activitylog/_design/bell/_view/GetMaleVisitsByCommunity?key="'+App.configuration.get("code")+'"',type:"GET",dataType:"json",async:false,success:function(l){if(l.rows[0]){t=l.rows[0].value}$.ajax({url:'/activitylog/_design/bell/_view/GetFemaleVisitsByCommunity?key="'+App.configuration.get("code")+'"',type:"GET",dataType:"json",async:false,success:function(l){if(l.rows[0]){a=l.rows[0].value}e(t,a)}})}})},trendReport:function(){var e=this;App.$el.children(".body").html("");$('<div id="trend-report-form"></div>').appendTo(App.$el.children(".body"));var t=$("<label>").text("Trend report ending: ");$("#trend-report-form").append(t);var a=new Date;var l=$('<input type="text">').attr({id:"dateSelect",name:"dateSelect",value:a.getFullYear().toString()+"-"+(a.getMonth()<9?"0"+(a.getMonth()+1):a.getMonth()+1)+"-"+(a.getDate()<9?"0"+a.getDate():a.getDate())});l.width(85);l.appendTo(t);$("#dateSelect").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true});var s=$('<input type="button">').attr({id:"submit",name:"submit","class":"btn btn-success",value:"Generate Report"});$("#trend-report-form").append(s);s.click(function(){var t=$("#dateSelect").val();if(t){var a=$("#dateSelect").datepicker("getDate");var l=new Date(a.getFullYear(),a.getMonth(),1);var s=new Date(l.getFullYear(),l.getMonth(),l.getDate()-1);var o=new Date(s.getFullYear(),s.getMonth(),1);var n=new Date(o.getFullYear(),o.getMonth(),o.getDate()-1);var r=new Date(n.getFullYear(),n.getMonth(),1);var i=new Date(r.getFullYear(),r.getMonth(),r.getDate()-1);var c=new Date(i.getFullYear(),i.getMonth(),1);var d=new Date(c.getFullYear(),c.getMonth(),c.getDate()-1);var p=new Date(d.getFullYear(),d.getMonth(),1);var u=new Date(p.getFullYear(),p.getMonth(),p.getDate()-1);var m=new Date(u.getFullYear(),u.getMonth(),1);var f=new Date(m.getFullYear(),m.getMonth(),m.getDate()-1);var g=new Date(f.getFullYear(),f.getMonth(),1);var h=new Date(g.getFullYear(),g.getMonth(),g.getDate()-1);var v=new Date(h.getFullYear(),h.getMonth(),1);var y=new Date(v.getFullYear(),v.getMonth(),v.getDate()-1);var b=new Date(y.getFullYear(),y.getMonth(),1);var w=new Date(b.getFullYear(),b.getMonth(),b.getDate()-1);var _=new Date(w.getFullYear(),w.getMonth(),1);var A=new Date(_.getFullYear(),_.getMonth(),p.getDate()-1);var M=new Date(A.getFullYear(),A.getMonth(),1);var R=new Date(M.getFullYear(),M.getMonth(),M.getDate()-1);var D=new Date(R.getFullYear(),R.getMonth(),1);var C=e.changeDateFormat(e.turnDateToYYYYMMDDFormat(D));var F=e.changeDateFormat(e.turnDateToYYYYMMDDFormat(a));var Y=new App.Collections.ActivityLog;var S=App.Server+'/activitylog/_design/bell/_view/getDocByCommunityCode?include_docs=true&startkey=["'+App.configuration.get("code")+'","'+C+'"]&endkey=["'+App.configuration.get("code")+'","'+F+'"]';Y.setUrl(S);Y.fetch({async:false});Y.toJSON();var T=[],I=[],k=[],V=[],B=[],N=[],x=[],O=[],L=[],U=[],q=[],P=[];for(var j in Y.models){var J=e.turnDateFromMMDDYYYYToYYYYMMDDFormat(Y.models[j].get("logDate"));var G=e.turnDateToYYYYMMDDFormat(l);var H=e.turnDateToYYYYMMDDFormat(a);if(J>=e.turnDateToYYYYMMDDFormat(l)&&J<=e.turnDateToYYYYMMDDFormat(a)){T.push(JSON.parse(JSON.stringify(Y.models[j])))}else if(J>=e.turnDateToYYYYMMDDFormat(o)&&J<=e.turnDateToYYYYMMDDFormat(s)){I.push(JSON.parse(JSON.stringify(Y.models[j])))}else if(J>=e.turnDateToYYYYMMDDFormat(r)&&J<=e.turnDateToYYYYMMDDFormat(n)){k.push(JSON.parse(JSON.stringify(Y.models[j])))}else if(J>=e.turnDateToYYYYMMDDFormat(c)&&J<=e.turnDateToYYYYMMDDFormat(i)){V.push(JSON.parse(JSON.stringify(Y.models[j])))}else if(J>=e.turnDateToYYYYMMDDFormat(p)&&J<=e.turnDateToYYYYMMDDFormat(d)){B.push(JSON.parse(JSON.stringify(Y.models[j])))}else if(J>=e.turnDateToYYYYMMDDFormat(m)&&J<=e.turnDateToYYYYMMDDFormat(u)){N.push(JSON.parse(JSON.stringify(Y.models[j])))}else if(J>=e.turnDateToYYYYMMDDFormat(g)&&J<=e.turnDateToYYYYMMDDFormat(f)){x.push(JSON.parse(JSON.stringify(Y.models[j])))}else if(J>=e.turnDateToYYYYMMDDFormat(v)&&J<=e.turnDateToYYYYMMDDFormat(h)){O.push(JSON.parse(JSON.stringify(Y.models[j])))}else if(J>=e.turnDateToYYYYMMDDFormat(b)&&J<=e.turnDateToYYYYMMDDFormat(y)){L.push(JSON.parse(JSON.stringify(Y.models[j])))}else if(J>=e.turnDateToYYYYMMDDFormat(_)&&J<=e.turnDateToYYYYMMDDFormat(w)){U.push(JSON.parse(JSON.stringify(Y.models[j])))}else if(J>=e.turnDateToYYYYMMDDFormat(M)&&J<=e.turnDateToYYYYMMDDFormat(A)){q.push(JSON.parse(JSON.stringify(Y.models[j])))}else if(J>=e.turnDateToYYYYMMDDFormat(D)&&J<=e.turnDateToYYYYMMDDFormat(R)){P.push(JSON.parse(JSON.stringify(Y.models[j])))}}var E=e.aggregateDataForTrendReport("communityX",T);var z=e.aggregateDataForTrendReport("communityX",I);var W=e.aggregateDataForTrendReport("communityX",k);var X=e.aggregateDataForTrendReport("communityX",V);var Q=e.aggregateDataForTrendReport("communityX",B);var K=e.aggregateDataForTrendReport("communityX",N);var Z=e.aggregateDataForTrendReport("communityX",x);var ee=e.aggregateDataForTrendReport("communityX",O);var te=e.aggregateDataForTrendReport("communityX",L);var ae=e.aggregateDataForTrendReport("communityX",U);var le=e.aggregateDataForTrendReport("communityX",q);var se=e.aggregateDataForTrendReport("communityX",P);var oe=e.aggregateDataForTrendReport("communityX",JSON.parse(JSON.stringify(Y.models)));console.log(E);var ne=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var re={male:0,female:0};e.getRegisteredMembersCount(function(e,t){re["male"]=e;re["female"]=t});var ie={male:0,female:0};e.getRegisteredMembersCountFromMembersDB(function(e,t){ie["male"]=e;ie["female"]=t});var ce={male:0,female:0};e.getTotalMemberVisits(function(e,t){ce["male"]=e;ce["female"]=t});var de={male:re["male"],female:re["female"],total:0};var pe={male:re["male"]-E.New_Signups["male"],female:re["female"]-E.New_Signups["female"],total:0};var ue={male:pe["male"]-z.New_Signups["male"],female:pe["female"]-z.New_Signups["female"],total:0};var me={male:ue["male"]-W.New_Signups["male"],female:ue["female"]-W.New_Signups["female"],total:0};var fe={male:me["male"]-X.New_Signups["male"],female:me["female"]-X.New_Signups["female"],total:0};var ge={male:fe["male"]-Q.New_Signups["male"],female:fe["female"]-Q.New_Signups["female"],total:0};var he={male:ge["male"]-K.New_Signups["male"],female:ge["female"]-K.New_Signups["female"],total:0};var ve={male:he["male"]-Z.New_Signups["male"],female:he["female"]-Z.New_Signups["female"],total:0};var ye={male:ve["male"]-ee.New_Signups["male"],female:ve["female"]-ee.New_Signups["female"],total:0};var be={male:ye["male"]-te.New_Signups["male"],female:ye["female"]-te.New_Signups["female"],total:0};var we={male:be["male"]-ae.New_Signups["male"],female:be["female"]-ae.New_Signups["female"],total:0};var _e={male:we["male"]-le.New_Signups["male"],female:we["female"]-le.New_Signups["female"],total:0};de["total"]=de["male"]+de["female"];pe["total"]=pe["male"]+pe["female"];ue["total"]=ue["male"]+ue["female"];me["total"]=me["male"]+me["female"];fe["total"]=fe["male"]+fe["female"];ge["total"]=ge["male"]+ge["female"];he["total"]=he["male"]+he["female"];ve["total"]=ve["male"]+ve["female"];ye["total"]=ye["male"]+ye["female"];be["total"]=be["male"]+be["female"];we["total"]=we["male"]+we["female"];_e["total"]=_e["male"]+_e["female"];var Ae={male:ie["male"],female:ie["female"],total:0};var Me={male:ie["male"]-(E.New_Signups["male"]-E.Deleted["male"]),female:ie["female"]-(E.New_Signups["female"]-E.Deleted["female"]),total:0};var Re={male:Me["male"]-(z.New_Signups["male"]-z.Deleted["male"]),female:Me["female"]-(z.New_Signups["female"]-z.Deleted["female"]),total:0};var De={male:Re["male"]-(W.New_Signups["male"]-W.Deleted["male"]),female:Re["female"]-(W.New_Signups["female"]-W.Deleted["female"]),total:0};var $e={male:De["male"]-(X.New_Signups["male"]-X.Deleted["male"]),female:De["female"]-(X.New_Signups["female"]-X.Deleted["female"]),total:0};var Ce={male:$e["male"]-(Q.New_Signups["male"]-Q.Deleted["male"]),female:$e["female"]-(Q.New_Signups["female"]-Q.Deleted["female"]),total:0};var Fe={male:Ce["male"]-(K.New_Signups["male"]-K.Deleted["male"]),female:Ce["female"]-(K.New_Signups["female"]-K.Deleted["female"]),total:0};var Ye={male:Fe["male"]-(Z.New_Signups["male"]-Z.Deleted["male"]),female:Fe["female"]-(Z.New_Signups["female"]-Z.Deleted["female"]),total:0};var Se={male:Ye["male"]-(ee.New_Signups["male"]-ee.Deleted["male"]),female:Ye["female"]-(ee.New_Signups["female"]-ee.Deleted["female"]),total:0};var Te={male:Se["male"]-(te.New_Signups["male"]-te.Deleted["male"]),female:Se["female"]-(te.New_Signups["female"]-te.Deleted["female"]),total:0};var Ie={male:Te["male"]-(ae.New_Signups["male"]-ae.Deleted["male"]),female:Te["female"]-(ae.New_Signups["female"]-ae.Deleted["female"]),total:0};var ke={male:Ie["male"]-(le.New_Signups["male"]-le.Deleted["male"]),female:Ie["female"]-(le.New_Signups["female"]-le.Deleted["female"]),total:0};Ae["total"]=Ae["male"]+Ae["female"];Me["total"]=Me["male"]+Me["female"];Re["total"]=Re["male"]+Re["female"];De["total"]=De["male"]+De["female"];$e["total"]=$e["male"]+$e["female"];Ce["total"]=Ce["male"]+Ce["female"];Fe["total"]=Fe["male"]+Fe["female"];Ye["total"]=Ye["male"]+Ye["female"];Se["total"]=Se["male"]+Se["female"];Te["total"]=Te["male"]+Te["female"];Ie["total"]=Ie["male"]+Ie["female"];ke["total"]=ke["male"]+ke["female"];var Ve={male:ce["male"],female:ce["female"],total:0};var Be={male:ce["male"]-E.Visits["male"],female:ce["female"]-E.Visits["female"],total:0};var Ne={male:Be["male"]-z.Visits["male"],female:Be["female"]-z.Visits["female"],total:0};var xe={male:Ne["male"]-W.Visits["male"],female:Ne["female"]-W.Visits["female"],total:0};var Oe={male:xe["male"]-X.Visits["male"],female:xe["female"]-X.Visits["female"],total:0};var Le={male:Oe["male"]-Q.Visits["male"],female:Oe["female"]-Q.Visits["female"],total:0};var Ue={male:Le["male"]-K.Visits["male"],female:Le["female"]-K.Visits["female"],total:0};var qe={male:Ue["male"]-Z.Visits["male"],female:Ue["female"]-Z.Visits["female"],total:0};var Pe={male:qe["male"]-ee.Visits["male"],female:qe["female"]-ee.Visits["female"],total:0};var je={male:Pe["male"]-te.Visits["male"],female:Pe["female"]-te.Visits["female"],total:0};var Je={male:je["male"]-ae.Visits["male"],female:je["female"]-ae.Visits["female"],total:0};var Ge={male:Je["male"]-le.Visits["male"],female:Je["female"]-le.Visits["female"],total:0};Ve["total"]=Ve["male"]+Ve["female"];Be["total"]=Be["male"]+Be["female"];Ne["total"]=Ne["male"]+Ne["female"];xe["total"]=xe["male"]+xe["female"];Oe["total"]=Oe["male"]+Oe["female"];Le["total"]=Le["male"]+Le["female"];Ue["total"]=Ue["male"]+Ue["female"];qe["total"]=qe["male"]+qe["female"];Pe["total"]=Pe["male"]+Pe["female"];je["total"]=je["male"]+je["female"];Je["total"]=Je["male"]+Je["female"];Ge["total"]=Ge["male"]+Ge["female"];var He=new App.Views.TrendActivityReport;He.data=oe;He.startDate=Y.startkey;He.endDate=Y.endkey;He.render();App.$el.children(".body").html(He.el);$("#trend-report-div-total-members").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Registered Members Past 12 Months"},xAxis:{categories:[ne[D.getMonth()]+" "+D.getFullYear(),ne[M.getMonth()]+" "+M.getFullYear(),ne[_.getMonth()]+" "+_.getFullYear(),ne[b.getMonth()]+" "+b.getFullYear(),ne[v.getMonth()]+" "+v.getFullYear(),ne[g.getMonth()]+" "+g.getFullYear(),ne[m.getMonth()]+" "+m.getFullYear(),ne[p.getMonth()]+" "+p.getFullYear(),ne[c.getMonth()]+" "+c.getFullYear(),ne[r.getMonth()]+" "+r.getFullYear(),ne[o.getMonth()]+" "+o.getFullYear(),ne[l.getMonth()]+" "+l.getFullYear()]},yAxis:{min:0,title:{text:"Members Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[ke["male"],Ie["male"],Te["male"],Se["male"],Ye["male"],Fe["male"],Ce["male"],$e["male"],De["male"],Re["male"],Me["male"],Ae["male"]],color:"#33ccff"},{name:"Females",data:[ke["female"],Ie["female"],Te["female"],Se["female"],Ye["female"],Fe["female"],Ce["female"],$e["female"],De["female"],Re["female"],Me["female"],Ae["female"]],color:"#66ff66"},{name:"Total",data:[ke["total"],Ie["total"],Te["total"],Se["total"],Ye["total"],Fe["total"],Ce["total"],$e["total"],De["total"],Re["total"],Me["total"],Ae["total"]],color:"#ff9900"}]});$("#trend-report-div-total-member-visits").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Visits Past 12 Months"},xAxis:{categories:[ne[D.getMonth()]+" "+D.getFullYear(),ne[M.getMonth()]+" "+M.getFullYear(),ne[_.getMonth()]+" "+_.getFullYear(),ne[b.getMonth()]+" "+b.getFullYear(),ne[v.getMonth()]+" "+v.getFullYear(),ne[g.getMonth()]+" "+g.getFullYear(),ne[m.getMonth()]+" "+m.getFullYear(),ne[p.getMonth()]+" "+p.getFullYear(),ne[c.getMonth()]+" "+c.getFullYear(),ne[r.getMonth()]+" "+r.getFullYear(),ne[o.getMonth()]+" "+o.getFullYear(),ne[l.getMonth()]+" "+l.getFullYear()]},yAxis:{min:0,title:{text:"Visits Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[Ge["male"],Je["male"],je["male"],Pe["male"],qe["male"],Ue["male"],Le["male"],Oe["male"],xe["male"],Ne["male"],Be["male"],Ve["male"]],color:"#33ccff"},{name:"Females",data:[Ge["female"],Je["female"],je["female"],Pe["female"],qe["female"],Ue["female"],Le["female"],Oe["female"],xe["female"],Ne["female"],Be["female"],Ve["female"]],color:"#66ff66"},{name:"Total",data:[Ge["total"],Je["total"],je["total"],Pe["total"],qe["total"],Ue["total"],Le["total"],Oe["total"],xe["total"],Ne["total"],Be["total"],Ve["total"]],color:"#ff9900"}]});$("#trend-report-div-new-memberships").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Active Members This Month"},xAxis:{categories:[ne[D.getMonth()]+" "+D.getFullYear(),ne[M.getMonth()]+" "+M.getFullYear(),ne[_.getMonth()]+" "+_.getFullYear(),ne[b.getMonth()]+" "+b.getFullYear(),ne[v.getMonth()]+" "+v.getFullYear(),ne[g.getMonth()]+" "+g.getFullYear(),ne[m.getMonth()]+" "+m.getFullYear(),ne[p.getMonth()]+" "+p.getFullYear(),ne[c.getMonth()]+" "+c.getFullYear(),ne[r.getMonth()]+" "+r.getFullYear(),ne[o.getMonth()]+" "+o.getFullYear(),ne[l.getMonth()]+" "+l.getFullYear()]},yAxis:{min:0,title:{text:"Members Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[_e["male"],we["male"]-_e["male"],be["male"]-we["male"],ye["male"]-be["male"],ve["male"]-ye["male"],he["male"]-ve["male"],ge["male"]-he["male"],fe["male"]-ge["male"],me["male"]-fe["male"],ue["male"]-me["male"],pe["male"]-ue["male"],re["male"]-pe["male"]],color:"#33ccff"},{name:"Females",data:[_e["female"],we["female"]-_e["female"],be["female"]-we["female"],ye["female"]-be["female"],ve["female"]-ye["female"],he["female"]-ve["female"],ge["female"]-he["female"],fe["female"]-ge["female"],me["female"]-fe["female"],ue["female"]-me["female"],pe["female"]-ue["female"],re["female"]-pe["female"]],color:"#66ff66"},{name:"Total",data:[_e["total"],we["total"]-_e["total"],be["total"]-we["total"],ye["total"]-be["total"],ve["total"]-ye["total"],he["total"]-ve["total"],ge["total"]-he["total"],fe["total"]-ge["total"],me["total"]-fe["total"],ue["total"]-me["total"],pe["total"]-ue["total"],de["total"]-pe["total"]],color:"#ff9900"}]});$("#trend-report-div-visits").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Member Visits This Month"},xAxis:{categories:[ne[D.getMonth()]+" "+D.getFullYear(),ne[M.getMonth()]+" "+M.getFullYear(),ne[_.getMonth()]+" "+_.getFullYear(),ne[b.getMonth()]+" "+b.getFullYear(),ne[v.getMonth()]+" "+v.getFullYear(),ne[g.getMonth()]+" "+g.getFullYear(),ne[m.getMonth()]+" "+m.getFullYear(),ne[p.getMonth()]+" "+p.getFullYear(),ne[c.getMonth()]+" "+c.getFullYear(),ne[r.getMonth()]+" "+r.getFullYear(),ne[o.getMonth()]+" "+o.getFullYear(),ne[l.getMonth()]+" "+l.getFullYear()]},yAxis:{min:0,title:{text:"Visits Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[se.Visits["male"],le.Visits["male"],ae.Visits["male"],te.Visits["male"],ee.Visits["male"],Z.Visits["male"],K.Visits["male"],Q.Visits["male"],X.Visits["male"],W.Visits["male"],z.Visits["male"],E.Visits["male"]],color:"#33ccff"},{name:"Females",data:[se.Visits["female"],le.Visits["female"],ae.Visits["female"],te.Visits["female"],ee.Visits["female"],Z.Visits["female"],K.Visits["female"],Q.Visits["female"],X.Visits["female"],W.Visits["female"],z.Visits["female"],E.Visits["female"]],color:"#66ff66"},{name:"Total",data:[se.Visits["male"]+se.Visits["female"],le.Visits["male"]+le.Visits["female"],ae.Visits["male"]+ae.Visits["female"],te.Visits["male"]+te.Visits["female"],ee.Visits["male"]+ee.Visits["female"],Z.Visits["male"]+Z.Visits["female"],K.Visits["male"]+K.Visits["female"],Q.Visits["male"]+Q.Visits["female"],X.Visits["male"]+X.Visits["female"],W.Visits["male"]+W.Visits["female"],z.Visits["male"]+z.Visits["female"],E.Visits["male"]+E.Visits["female"]],color:"#ff9900"}]});$("#trend-report-div-total-resource-views-this-month").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Resource Views This Month"},xAxis:{categories:[ne[D.getMonth()]+" "+D.getFullYear(),ne[M.getMonth()]+" "+M.getFullYear(),ne[_.getMonth()]+" "+_.getFullYear(),ne[b.getMonth()]+" "+b.getFullYear(),ne[v.getMonth()]+" "+v.getFullYear(),ne[g.getMonth()]+" "+g.getFullYear(),ne[m.getMonth()]+" "+m.getFullYear(),ne[p.getMonth()]+" "+p.getFullYear(),ne[c.getMonth()]+" "+c.getFullYear(),ne[r.getMonth()]+" "+r.getFullYear(),ne[o.getMonth()]+" "+o.getFullYear(),ne[l.getMonth()]+" "+l.getFullYear()]},yAxis:{min:0,title:{text:"Resource count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[se.ResourceViews["male"],le.ResourceViews["male"],ae.ResourceViews["male"],te.ResourceViews["male"],ee.ResourceViews["male"],Z.ResourceViews["male"],K.ResourceViews["male"],Q.ResourceViews["male"],X.ResourceViews["male"],W.ResourceViews["male"],z.ResourceViews["male"],E.ResourceViews["male"]],color:"#33ccff"},{name:"Females",data:[se.ResourceViews["female"],le.ResourceViews["female"],ae.ResourceViews["female"],te.ResourceViews["female"],ee.ResourceViews["female"],Z.ResourceViews["female"],K.ResourceViews["female"],Q.ResourceViews["female"],X.ResourceViews["female"],W.ResourceViews["female"],z.ResourceViews["female"],E.ResourceViews["female"]],color:"#66ff66"},{name:"Total",data:[se.ResourceViews["male"]+se.ResourceViews["female"],le.ResourceViews["male"]+le.ResourceViews["female"],ae.ResourceViews["male"]+ae.ResourceViews["female"],te.ResourceViews["male"]+te.ResourceViews["female"],ee.ResourceViews["male"]+ee.ResourceViews["female"],Z.ResourceViews["male"]+Z.ResourceViews["female"],K.ResourceViews["male"]+K.ResourceViews["female"],Q.ResourceViews["male"]+Q.ResourceViews["female"],X.ResourceViews["male"]+X.ResourceViews["female"],W.ResourceViews["male"]+W.ResourceViews["female"],z.ResourceViews["male"]+z.ResourceViews["female"],E.ResourceViews["male"]+E.ResourceViews["female"]],color:"#ff9900"}]})}else{alert("You must choose a date to proceed")}})},isWithinRange:function(e,t,a){},ReportForm:function(e){var t=e?new App.Models.CommunityReport({_id:e}):new App.Models.CommunityReport;t.on("processed",function(){Backbone.history.navigate("report",{trigger:true})});var a=new App.Views.ReportForm({model:t});App.$el.children(".body").html(a.el);if(t.id){App.listenToOnce(t,"sync",function(){a.render()});t.fetch()}else{a.render()}},routeStartupTasks:function(){$("#invitationdiv").hide();$("#debug").hide()},Resource_Detail:function(e,t,a){var l=new App.Models.Resource({_id:e});l.fetch({success:function(){var e=l.toJSON().Tag;var s=JSON.stringify(e);var o=Array();var n=Backbone.Collection.extend({url:App.Server+"/collectionlist/_design/bell/_view/DocById?keys="+s+"&include_docs=true"});var r=new n;r.fetch({async:false});r=r.first();if(r!=undefined){accessedTags=r.toJSON().rows;_.each(accessedTags,function(e){o.push(e.value)})}l.set({Tag:o});var i=new App.Views.ResourcesDetail({model:l});i.SetShelfId(t,a);i.render();App.$el.children(".body").html(i.el)}})},RenderTagSelect:function(e){var t=new App.Collections.listRCollection;t.major=true;t.fetch({async:false});t.each(function(t){$(e).append('<option value="'+t.get("_id")+'" class="MajorCategory">'+t.get("CollectionName")+"</option>")});var a=new App.Collections.listRCollection;a.major=false;a.fetch({async:false});_.each(a.last(a.length).reverse(),function(t){if(t.get("NesttedUnder")=="--Select--"){$(e).append('<option value="'+t.get("_id")+'">'+t.get("CollectionName")+"</option>")}else{if($(e+' option[value="'+t.get("NesttedUnder")+'"]')!=null){$(e).find('option[value="'+t.get("NesttedUnder")+'"]').after('<option value="'+t.get("_id")+'">'+t.get("CollectionName")+"</option>")}}})},ResourceFeedback:function(e){var t=new App.Models.Resource;t.id=e;t.on("sync",function(){var a=new App.Collections.ResourceFeedback;a.resourceId=e;var l=new App.Views.FeedbackTable({collection:a});a.on("sync",function(){l.render();App.$el.children(".body").html('<h3>Feedback for "'+t.get("title")+'"</h3>');var a="#resource/feedback/add/"+e+"/"+t.get("title");App.$el.children(".body").append('<a class="btn btn-primary"" href="'+a+'"><i class="icon-plus"></i> Add your feedback</a>');App.$el.children(".body").append('<a class="btn btn-primary" style="margin:20px" href="#resources"><< Back to Resources</a>');App.$el.children(".body").append(l.el)});a.fetch()});t.fetch()},FeedbackForm:function(e,t){var a=new App.Models.Feedback({resourceId:e,memberId:$.cookie("Member._id")});a.on("sync",function(){Backbone.history.navigate("resource/feedback/"+e,{trigger:true})});var l=new App.Models.Resource({_id:e});l.fetch({async:false});var s=new App.Views.FeedbackForm({model:a});s.rtitle=l.get("title");var o;s.render();App.$el.children(".body").html('<h4 style="color:gray">Add Feedback For<span style="color:black;"> '+l.get("title")+"</span></h4>");App.$el.children(".body").append('<p style="font-size:15px;">&nbsp;&nbsp;<span style="font-size:50px;">.</span>Rating </p>');App.$el.children(".body").append('<div id="star" data-score="0"></div>');$("#star").raty();$("#star > img").click(function(){s.setUserRating($(this).attr("alt"))});App.$el.children(".body").append(s.el)},email:function(){App.$el.children(".body").html("&nbsp");var e=new App.Collections.Configurations;e.fetch({async:false});var t=e.first();var a=t.toJSON();code=a.code;Bellname=a.nationName;var l=new App.Collections.Mails({skip:0});l.fetch({async:false});var s=new App.Views.MailView({collection:l,community_code:code,nationName:Bellname});s.render();App.$el.children(".body").append(s.el);skipStack.push(skip);s.fetchRecords()},CoursesBarChart:function(){App.$el.children(".body").html("&nbsp");App.$el.children(".body").append('<div id="veticallable"><b>S<br/>T<br/>E<br/>P<br/>S<br/></b></div>');App.$el.children(".body").append('<div id="graph"></div>');App.$el.children(".body").append('<div id="horizontallabel"><b>COURSES</b></div>');var e=new App.Collections.memberprogressallcourses;e.memberId=$.cookie("Member._id");e.fetch({async:false});var t=new App.Views.CoursesChartProgress({collection:e});t.render();App.$el.children(".body").append(t.el)},AddToShelf:function(e,t){var a=new App.Collections.shelfResource;a.resourceId=e;a.memberId=$.cookie("Member._id");a.fetch({async:false});if(a.length==0){var l=new App.Models.Shelf;l.set("memberId",$.cookie("Member._id"));l.set("resourceId",e);l.set("resourceTitle",unescape(t));l.save(null,{success:function(e,t,a){}});alert("Successfully Add To Shelf")}else{alert("Already in Shelf")}},AddToShelfAndSaveFeedback:function(e,t){var a=new App.Collections.shelfResource;a.resourceId=e;a.memberId=$.cookie("Member._id");a.fetch({async:false});if(a.length==0){var l=new App.Models.Shelf;l.set("memberId",$.cookie("Member._id"));l.set("resourceId",e);l.set("resourceTitle",unescape(t));l.save(null,{success:function(e,t,a){}});alert("Successfully Saved Feedback and Add To Shelf")}else{alert("Successfully Saved Feedback,Resource Already in Shelf")}Backbone.history.navigate("resources",{trigger:true})},CalendarFunction:function(){App.$el.children(".body").html("<div id='addEvent' style='position:fixed;z-index:5;' class='btn btn-primary' onclick =\"document.location.href='#addEvent'\">Add Event</div><br/><br/>");App.$el.children(".body").append("<br/><br/><div id='calendar'></div>");$(document).ready(function(){var e=[];var t=new App.Collections.Calendars;t.fetch({async:false});t.each(function(t){if(t.get("startDate")&&t.get("endDate")){var a=t.get("startDate").split("/");var l=t.get("endDate").split("/");daysindex=new Array(0,1,2,3,4,5,6);var s=getScheduleDatesForCourse(new Date(a[2],--a[0],a[1]),new Date(l[2],--l[0],l[1]),daysindex);var o=convertTo24Hour(t.get("startTime"));var n=convertTo24Hour(t.get("endTime"));for(var r=0;r<s.length;r++){var i=new Object;i.title=t.get("title");i.start=new Date(s[r].setHours(o));i.end=new Date(s[r].setHours(n));i.url="calendar/event/"+t.id;i.allDay=false;e.push(i)}}});var a=new App.Collections.MemberGroups;a.fetch({async:false});a.each(function(t){var a;if(t.get("frequency")=="Daily"){a=new Array(0,1,2,3,4,5,6)}else{a=new Array;var l=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday");var s=t.get("Day");if(s instanceof Array){}else{var o=s;s=new Array;s[0]=o}var n=0;while(n<s.length){a.push(l.indexOf(s[n]));n++}}if(t.get("startDate")&&t.get("startDate")){var r=t.get("startDate").split("/");var i=t.get("endDate").split("/");var c=getScheduleDatesForCourse(new Date(r[2],--r[0],r[1]),new Date(i[2],--i[0],i[1]),a);var d=convertTo24Hour(t.get("startTime"));var p=convertTo24Hour(t.get("endTime"));for(var n=0;n<c.length;n++){var o=new Object;o.title="\nCourse: \n"+t.get("name");o.start=new Date(c[n].setHours(d));o.end=new Date(c[n].setHours(p));o.allDay=false;e.push(o)}}});var l=new App.Collections.UserMeetups;l.memberId=$.cookie("Member._id");l.fetch({async:false});l.each(function(t){model=new App.Models.MeetUp({_id:t.get("meetupId")});model.fetch({async:false});var a;if(model.get("reoccuring")=="Daily"){a=new Array(0,1,2,3,4,5,6)}else{a=new Array;var l=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday");var s=model.get("Day");if(s instanceof Array){}else{var o=s;s=new Array;s[0]=o}var n=0;while(n<s.length){a.push(l.indexOf(s[n]));n++}}if(model.get("startDate")&&model.get("startDate")){var r=model.get("startDate").split("/");var i=model.get("endDate").split("/");var c=getScheduleDatesForCourse(new Date(r[2],--r[0],r[1]),new Date(i[2],--i[0],i[1]),a);var d=convertTo24Hour(model.get("startTime"));var p=convertTo24Hour(model.get("endTime"));for(var n=0;n<c.length;n++){var o=new Object;o.title="\nMeetup: \n"+model.get("title");o.start=new Date(c[n].setHours(d));o.end=new Date(c[n].setHours(p));o.allDay=false;e.push(o)}}});var s=$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},selectable:true,eventClick:function(e){Backbone.history.navigate(e.url,{trigger:true});return false},events:e})})},addEvent:function(){var e=new App.Models.Calendar;var t=new App.Views.CalendarForm({model:e});App.$el.children(".body").html('<h3 class="signup-heading">Add Event</h3>');App.$el.children(".body").append(t.el);t.render();$(".bbf-form .field-startTime input").timepicker({minTime:"8:00am",maxTime:"12:30am"});$(".bbf-form .field-endTime input").timepicker({minTime:"8:00am",maxTime:"12:30am"});$(".bbf-form .field-startDate input").datepicker({todayHighlight:true});$(".bbf-form .field-endDate input").datepicker({todayHighlight:true})},calendaar:function(e){App.$el.children(".body").html("&nbsp");var t=new App.Models.Calendar({_id:e});t.fetch({async:false});var a=new App.Views.EventInfo({model:t});a.render();App.$el.children(".body").append(a.el)},EditEvent:function(e){var t=new App.Models.Calendar({_id:e});t.fetch({async:false});var a=new App.Views.CalendarForm({model:t});a.update=true;App.$el.children(".body").html('<h3 class="signup-heading">Update Event</h3>');App.$el.children(".body").append(a.el);a.render()},EditTag:function(e){var t=this.getRoles();if(t.indexOf("Manager")>-1){if(e!="Add New"){var a=new App.Collections.listRCollection;a.major=true;a.fetch({async:false});$("#invitationdiv").fadeIn(1e3);document.getElementById("cont").style.opacity=.2;document.getElementById("nav").style.opacity=.2;var l=new App.Models.CollectionList({_id:e});l.fetch({async:false});a.remove(l);var s=new App.Views.ListCollectionView({model:l});s.render();$("#invitationdiv").html("&nbsp");$("#invitationdiv").append(s.el);a.each(function(e){$("#invitationForm .bbf-form .field-NesttedUnder select").append('<option value="'+e.get("_id")+'" class="MajorCategory">'+e.get("CollectionName")+"</option>")});$('#invitationForm .bbf-form .field-NesttedUnder select option[value="'+l.get("NesttedUnder")+'"]').attr("selected","selected");
if($("#invitationForm .bbf-form .field-IsMajor input").is(":checked")){$("#invitationForm .bbf-form .field-NesttedUnder").css("visibility","hidden")}else{$("#invitationForm .bbf-form .field-NesttedUnder").css("visibility","visible")}$("#invitationForm .bbf-form .field-AddedDate input",this.el).datepicker({todayHighlight:true});$("input[name='AddedBy']").attr("disabled",true)}}},AddNewSelect:function(e){if(e=="Add New"){var t=new App.Collections.listRCollection;t.major=true;t.fetch({async:false});$("#invitationdiv").fadeIn(1e3);document.getElementById("cont").style.opacity=.2;document.getElementById("nav").style.opacity=.2;var a=new App.Models.CollectionList;var l=new App.Views.ListCollectionView({model:a});l.render();$("#invitationdiv").html("&nbsp");$("#invitationdiv").append(l.el);$("input[name='AddedBy']").val($.cookie("Member.login"));var s=new Date;$("#invitationForm .bbf-form .field-AddedDate input",this.el).datepicker({todayHighlight:true});$("#invitationForm .bbf-form .field-AddedDate input",this.el).datepicker("setDate",s);$("input[name='AddedBy']").attr("disabled",true);$("input[name='AddedDate']").attr("disabled",true);t.each(function(e){$("#invitationForm .bbf-form .field-NesttedUnder select").append('<option value="'+e.get("_id")+'" class="MajorCategory">'+e.get("CollectionName")+"</option>")})}else{document.getElementById("cont").style.opacity=1;document.getElementById("nav").style.opacity=1;$("#invitationdiv").hide()}},Collection:function(){App.startActivityIndicator();var e=$.url().data.attr.host.split(".");e=e[0].substring(3);if(e=="")e="local";var t=this.getRoles();var a=new App.Collections.listRCollection;a.major=true;a.fetch({success:function(){var e=new App.Views.CollectionTable({collection:a});e.render();App.$el.children(".body").html('<p style="margin-top:20px"><a class="btn btn-success" href="#resource/add">Add New Resource</a><a style="margin-left:10px" class="btn btn-success" onclick=showRequestForm("Resource")>Request Resource</a></p></span>');App.$el.children(".body").append('<p style="font-size:30px;color:#808080"><a href="#resources"style="font-size:30px;">Resources</a>&nbsp&nbsp|&nbsp&nbsp<a href="#collection" style="font-size:30px;color:#0088CC;text-decoration: underline;">Collections</a></p>');if(t.indexOf("Manager")!=-1)App.$el.children(".body").append('<button style="margin:-90px 0px 0px 500px;" class="btn btn-success"  onclick="AddColletcion()">Add Collection</button>');App.$el.children(".body").append(e.el)},async:false});var l=new App.Collections.listRCollection;l.major=false;l.fetch({async:false});if(t.indexOf("Manager")!=-1){_.each(l.last(l.length).reverse(),function(e){if(e.get("NesttedUnder")=="--Select--"){$("#collectionTable").append('<tr><td><a href="#listCollection/'+e.get("_id")+"/"+e.get("CollectionName")+'">'+e.get("CollectionName")+"</a></td><td><button onclick=EditColletcion("+e.get("_id")+')><i class="icon-edit pull-right"></i></button></td></tr>')}else{$("#"+e.get("NesttedUnder")+"").parent().after('<tr><td>&nbsp&nbsp&nbsp&nbsp<a href="#listCollection/'+e.get("_id")+"/"+e.get("CollectionName")+'">'+e.get("CollectionName")+'</a></td><td><button onclick=EditColletcion("'+e.get("_id")+'")><i class="icon-edit pull-right"></i></button></td></tr>')}})}else{_.each(l.last(l.length).reverse(),function(e){if(e.get("NesttedUnder")=="--Select--"){$("#collectionTable").append('<tr><td><a href="#listCollection/'+e.get("_id")+"/"+e.get("CollectionName")+'">'+e.get("CollectionName")+"</a></td><td></td></tr>")}else{$("#"+e.get("NesttedUnder")+"").parent().after('<tr><td>&nbsp&nbsp&nbsp&nbsp<a href="#listCollection/'+e.get("_id")+"/"+e.get("CollectionName")+'">'+e.get("CollectionName")+"</a></td><td></td></tr>")}})}App.stopActivityIndicator()},mergecollection:function(e,t){for(var a=0;a<e.length;a++){var l=new App.Models.CollectionList({_id:e[a]});l.fetch({success:function(e){e.destroy()}})}var s=new App.Collections.Resources;s.collectionName=JSON.stringify(e);s.fetch({success:function(a){var l=new App.Models.CollectionList;l.set("CollectionName",t);l.set("Description","");l.set("IsMajor",true);l.set("NesttedUnder","--Select--");l.set("AddedBy",$.cookie("Member.login"));l.set("AddedDate",new Date);l.set("show",true);l.save(null,{success:function(t,l){var s=l.id;a.each(function(t){resourceTags=t.get("Tag");if(Array.isArray(resourceTags)){for(var a=0;a<e.length;a++)if(resourceTags.indexOf(e[a])!=-1){var l=resourceTags.indexOf(e[a]);resourceTags.splice(l,1)}resourceTags.push(s);t.set("Tag",resourceTags);t.save()}});alert("Collections Merge Successfully");document.getElementById("cont").style.opacity=1;document.getElementById("nav").style.opacity=1;$("#invitationdiv").hide();location.reload()}})}})},viewAllFeedback:function(){feed=new App.Collections.siteFeedbacks;feed.fetch({success:function(){feedul=new App.Views.siteFeedbackPage({collection:feed});feedul.render();App.$el.children(".body").html("&nbsp");App.$el.children(".body").append(feedul.el)}})},ListCollection:function(e,t){App.startActivityIndicator();var a=this;var l=$.url().data.attr.host.split(".");l=l[0].substring(3);if(l=="")l="local";var s=this.getRoles();var o=new App.Models.CollectionList({_id:e});o.fetch({async:false});var n=Array();n.push(e);n=JSON.stringify(n);var r=new App.Collections.Resources({collectionName:n});r.fetch({success:function(){var e=new App.Views.ResourcesTable({collection:r});e.displayCollec_Resources=true;e.collections=App.collectionslist;e.isManager=s.indexOf("Manager");e.render();App.$el.children(".body").html('<p style="margin-top:20px"><a class="btn btn-success" href="#resource/add">Add New Resource</a><a style="margin-left:10px" class="btn btn-success" onclick=showRequestForm("Resource")>Request Resource</a><span style="float:right"></span></p>');App.$el.children(".body").append('<p style="font-size:30px;color:#808080;"><a href="#resources"style="font-size:30px;color:#0088CC;text-decoration: underline;">Resources</a>&nbsp&nbsp|&nbsp&nbsp<a href="#collection" style="font-size:30px;">Collections</a> </p>');App.$el.children(".body").append('<p style="font-size: 30px;font-weight: bolder;color: #808080;width: 450px;word-wrap: break-word;">'+o.get("CollectionName")+"</p>");App.$el.children(".body").append(e.el);$("#backButton").click(function(){Backbone.history.navigate("#resources",{trigger:false})})}});App.stopActivityIndicator()},NewsFeed:function(){this.underConstruction()},AllRequests:function(){App.$el.children(".body").html("&nbsp");var e=new App.Collections.Requests;e.fetch({async:false});var t=new App.Views.RequestTable({collection:e});t.render();App.$el.children(".body").append(t.el)},myRequests:function(){App.$el.children(".body").html("&nbsp");var e=new App.Collections.Requests({memberId:$.cookie("Member._id")});e.fetch({async:false});var t=new App.Views.RequestTable({collection:e});t.render();App.$el.children(".body").append(t.el)},synchCommunityWithURL:function(e,t){console.log("http://"+t+":"+App.password+"@"+e+":5984/resources");$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"resources",target:"http://"+t+":"+App.password+"@"+e+":5984/resources"}),success:function(e){},async:false})},PochDB:function(){var e=$.cookie("Member._id");var t=$.cookie("Member.login");var a=new App.Collections.Members;var l=new App.Models.Member({_id:e});l.fetch({async:false});var s=null;var o=l.get("login");var n=Backbone.history.location.href;n=n.split("/");var r=n[2].split(".");var i=new PouchDB("feedback");if(r[0].indexOf("cloudant")!=-1){s="http://"+r[0]+":"+App.password+"@"+n[2]}else if(r[0].match(/^\d*[0-9](\.\d*[0-9])?$/)){s="http://"+n[2]}else{s="http://"+n[2]}i.replicate.to(s+"/feedback",function(e,t){if(e){console.log("FeedBackDb replication error :"+e)}else{console.log("Successfully replicated FeedBackDb :"+t)}});this.syncResourceFeedback();this.WeeklyReports()},syncResourceFeedback:function(){var e=new PouchDB("resources");e.allDocs({include_docs:true},function(t,a){console.log(a);_.each(a.rows,function(t){var a=t.doc._id;var l=new App.Models.Resource({_id:a});l.fetch({success:function(){if(l.get("sum")==undefined||l.get("timesRated")==undefined){l.set("sum",0);l.set("timesRated",0)}else{l.set("sum",parseInt(l.get("sum"))+parseInt(t.doc.sum));l.set("timesRated",parseInt(l.get("timesRated"))+parseInt(t.doc.timesRated))}l.save(null,{success:function(a,l){e.put({sum:0,timesRated:0},t.doc._id,t.doc._rev,function(e,t){if(!e){console.log(t)}else{console.log(e)}});e.remove(t.doc._id,t.doc._rev,function(e,t){if(!e){console.log(t)}else{console.log(e)}})}})}})})})},saveResources:function(e){var t=new PouchDB("resources");var a;var l=new App.Collections.MemberGroups;l.memberId=$.cookie("Member._id");l.once("sync",function(){_.each(l.models,function(e){levels=new App.Collections.CourseLevels;levels.groupId=e.id;levels.fetch({async:false});levels.each(function(e){var a=e.get("resourceId");_.each(a,function(e){var a=new App.Models.Resource({_id:e});a.fetch({success:function(e){var l=e.toJSON();console.log(l);t.get(l._id,function(e,s){if(!e){console.log("Sum   "+l.sum+"    "+s.sum);console.log("timesRated   "+l.timesRated+"    "+s.timesRated);if(!l.sum||!l.timesRated){a.set("sum",0);a.set("timesRated",0)}else{a.set("sum",parseInt(l.sum)+parseInt(s.sum));a.set("timesRated",parseInt(l.timesRated)+parseInt(s.timesRated))}a.save(null,{success:function(e,a){t.put({sum:0,timesRated:0},s._id,s._rev,function(e,t){})}})}else{t.post({_id:l._id,sum:0,timesRated:0})}})}})})})})});l.fetch()},saveFrequency:function(e){if($.cookie("Member._id")){var t=new PouchDB("resourcefrequency");var a=new App.Collections.ResourcesFrequency;a.memberID=$.cookie("Member._id");a.fetch(null,{success:function(e,l){console.log(a.toJSON());var s=a.first().toJSON();t.put(s,s._id,s._rev,function(e,t){if(e){console.log("ResourceFrequencyDB replication error :"+e)}else{console.log("Successfully replicated ResourceFrequencyDB :"+t)}})}});t.replicate.to(e+"/resourcefrequency",function(e,t){if(e){console.log("ResourceFrequencyDB replication error :"+e)}else{console.log("Successfully replicated ResourceFrequencyDB :"+t)}})}},LogQuery:function(){var e="community";var t=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var a=new t;a.fetch({async:false});var l=a.first();var s=l.toJSON();if(s.rows[0].doc.type){e=s.rows[0].doc.type}var o=new App.Views.LogQuery;o.type=e;o.render();App.$el.children(".body").html(o.el);$("#community-select").hide();$("#start-date").datepicker({dateFormat:"yy-mm-dd",todayHighlight:true});$("#end-date").datepicker({dateFormat:"yy-mm-dd",todayHighlight:true})},changeDateFormat:function(e){var t=e.match(/\d+/g),a=t[0],l=t[1],s=t[2];return a+"/"+l+"/"+s},deletePouchDB:function(){var e=new PouchDB("resources");e.destroy(function(e,t){if(e)console.log(e);else console.log("deleted successfully "+t)});var t=new PouchDB("feedback");t.destroy(function(e,t){if(e)console.log(e);else console.log("Successfully Deleted feedback"+t)});var a=new PouchDB("members");a.destroy(function(e,t){if(e)console.log(e);else console.log("Successfully Deleted members"+t)});var l=new PouchDB("resourcefrequency");l.destroy(function(e,t){if(e)console.log(e);else console.log("Successfully Destroy ResourceFrequency"+t)});var s=new PouchDB("membercourseprogress");s.destroy(function(e,t){if(e)console.log(e);else console.log("Successfully Destroy membercourseprogress"+t)});var o=new PouchDB("coursestep");o.destroy(function(e,t){if(e)console.log(e);else console.log("Successfully Destroy coursestep"+t)});var n=new PouchDB("activitylogs");n.destroy(function(e,t){if(e)console.log(e);else console.log("Successfully Destroy activitylogs"+t)});return true},dbinfo:function(){var e=new PouchDB("resources");e.info(function(e,t){console.log(t)});var t=new PouchDB("feedback");t.info(function(e,t){console.log(t)});var a=new PouchDB("members");a.info(function(e,t){console.log(t)});var l=new PouchDB("resourcefrequency");l.info(function(e,t){console.log(t)});var s=new PouchDB("coursestep");s.info(function(e,t){console.log(t)});var o=new PouchDB("membercourseprogress");o.info(function(e,t){console.log(t);console.log(e)});var n=new PouchDB("activitylogs");n.info(function(e,t){console.log(t)})},CompileAppManifest:function(){var e=new App.Collections.Apps;var t="{replace me}";var a="# Compiled at "+(new Date).getTime()+"\n";var l="/apps/_design/bell/manifest.default.appcache";var s="/apps/_design/bell";var o=s+"/manifest.appcache";e.once("sync",function(){_.each(e.models,function(e){_.each(e.get("_attachments"),function(t,l,s){if(l!=="manifest.appcache")a+=encodeURI("/apps/"+e.id+"/"+l)+"\n"})});App.trigger("compile:appsListReady")});e.fetch();App.once("compile:appsListReady",function(){$.get(l,function(e){var l=e.replace(t,a);$.getJSON(s,function(e){var t=new XMLHttpRequest;t.open("PUT",o+"?rev="+e._rev,true);t.onload=function(e){App.trigger("compile:done")};t.setRequestHeader("Content-type","text/cache-manifest");t.send(new Blob([l],{type:"text/plain"}))})})});App.once("compile:done",function(){alert("menifist file is creted in Bell-apps")})},CompileManifest:function(){App.startActivityIndicator();var e=new App.Collections.Resources;var t=new App.Collections.Apps;var a=new App.Collections.Configurations;var l=new App.Collections.membercourseprogresses;var s=new App.Collections.Languages;var o=new App.Collections.Members;var n=new App.Collections.listRCollection;var r=new App.Collections.Members;var i=new App.Models.Member({_id:$.cookie("Member._id")});i.fetch({async:false});var c=i.get("login");r.login=c;var d=new App.Collections.Meetups;var p=new App.Collections.MemberGroups;p.memberId=$.cookie("Member._id");var u=new App.Collections.Reports;var m=$.cookie("Member._id");var f=$.cookie("Member.login");var g="/devices/_design/all";var h="/apps/_design/bell/manifest.default.appcache";var v="/apps/_design/bell/update.default.html";var y=new App.Collections.shelfResource;y.compile=true;var b=g+"/manifest.appcache";var w=g+"/update.html";var A="{replace me}";var M="# Compiled at "+(new Date).getTime()+"\n";e.on("sync",function(){App.trigger("compile:resourceListReady")});App.once("compile:resourceListReady",function(){t.once("sync",function(){_.each(t.models,function(e){_.each(e.get("_attachments"),function(t,a,l){M+=encodeURI("/apps/"+e.id+"/"+a)+"\n"})});App.trigger("compile:configurations")});t.fetch()});App.once("compile:configurations",function(){a.once("sync",function(){_.each(a.models,function(e){M+=encodeURI("/configurations/_all_docs?include_docs=true")+"\n"});App.trigger("compile:languages")});a.fetch()});App.once("compile:languages",function(){s.once("sync",function(){_.each(s.models,function(e){M+=encodeURI("/languages/_all_docs?include_docs=true")+"\n"});App.trigger("compile:members")});s.fetch()});App.once("compile:members",function(){o.once("sync",function(){M+=encodeURI("/members/_design/bell/_view/Members?include_docs=true")+"\n";_.each(o.models,function(e){M+=encodeURI("/members/"+e.id)+"\n"});App.trigger("compile:shelfResource")});o.fetch()});App.once("compile:shelfResource",function(){y.once("sync",function(){M+='/shelf/_design/bell/_view/DuplicateDetection?include_docs=true&key="'+m+'"'+"\n";_.each(y.models,function(e){var t=e.get("resourceId");console.log(t);var a=new App.Models.Resource({_id:t});a.fetch({success:function(e){M+=encodeURI("/resources/"+t)+"\n";if(a.get("kind")=="Resource"&&a.get("_attachments")){_.each(a.get("_attachments"),function(e,a,l){M+=encodeURI("/resources/"+t+"/"+a)+"\n"})}}})});App.trigger("compile:collectionList")});y.fetch()});App.once("compile:collectionList",function(){n.once("sync",function(){M+=encodeURI("/collectionlist/_design/bell/_view/allrecords?include_docs=true")+"\n";App.trigger("compile:Meetups")});n.fetch()});App.once("compile:Meetups",function(){d.once("sync",function(){M+=encodeURI("/meetups/_all_docs?include_docs=true")+"\n";M+=encodeURI('/usermeetups/_design/bell/_view/getUsermeetups?key="'+m+'"&include_docs=true')+"\n";M+=encodeURI('/members/_design/bell/_view/MembersByLogin?include_docs=true&key="'+f+'"')+"\n";_.each(d.models,function(e){M+=encodeURI("/meetups/"+e.id)+"\n"});App.trigger("compile:Groups")});d.fetch()});App.once("compile:Groups",function(){p.once("sync",function(){M+=encodeURI("/groups/_all_docs?include_docs=true")+"\n";M+=encodeURI('/groups/_design/bell/_view/GetCourses?key="'+m+'"&include_docs=true')+"\n";_.each(p.models,function(e){M+=encodeURI("/groups/"+e.id)+"\n";M+=encodeURI('/coursestep/_design/bell/_view/StepsData?key="'+e.id+'"&include_docs=true')+"\n";l.courseId=e.id;l.memberId=m;l.fetch({success:function(){M+='/membercourseprogress/_design/bell/_view/GetMemberCourseResult?key=["'+m+'","'+e.id+'"]&include_docs=true'+"\n"}});levels=new App.Collections.CourseLevels;levels.groupId=e.id;levels.fetch({async:false});levels.each(function(e){var t=e.get("resourceId");_.each(t,function(e){console.log(e);var t=new App.Models.Resource({_id:e});t.fetch({success:function(a){M+=encodeURI("/resources/"+e)+"\n";if(t.get("kind")=="Resource"&&t.get("_attachments")){_.each(t.get("_attachments"),function(t,a,l){M+=encodeURI("/resources/"+e+"/"+a)+"\n"})}}})},this)},this)});App.trigger("compile:CommunityReport")});p.fetch()});App.once("compile:CommunityReport",function(){u.once("sync",function(){M+=encodeURI("/communityreports/_design/bell/_view/allCommunityReports?include_docs=true")+"\n";_.each(u.models,function(e){M+=encodeURI("/communityreports/"+e.id)+"\n"});App.trigger("compile:appsListReady")});u.fetch()});App.once("compile:appsListReady",function(){$.get(h,function(e){var t=e.replace(A,M);$.getJSON(g,function(e){var a=new XMLHttpRequest;a.open("PUT",b+"?rev="+e._rev,true);a.onload=function(e){App.trigger("compile:done")};a.setRequestHeader("Content-type","text/cache-manifest");a.send(new Blob([t],{type:"text/plain"}))})})});App.once("compile:done",function(){$.get(v,function(e){transformedUpdateHTML=e;$.getJSON(g,function(e){var t=new XMLHttpRequest;t.open("PUT",w+"?rev="+e._rev,true);t.onload=function(e){App.$el.children(".body").html('<a class="btn" href="'+w+'">Resources compiled. Click here to update your device.</a>')};t.setRequestHeader("Content-type","text/html");t.send(new Blob([transformedUpdateHTML],{type:"text/plain"}))})})});e.fetch();App.stopActivityIndicator()},UpdateManifest:function(){var e="/devices/_design/all";var t="/apps/_design/bell/manifest.default.appcache";var a=e+"/manifest.appcache";var l="{replace me}";var s="# Compiled at "+(new Date).getTime()+"\n";$.get(t,function(t){var o=t.replace(l,s);$.getJSON(e,function(e){var t=new XMLHttpRequest;t.open("PUT",a+"?rev="+e._rev,true);t.onload=function(e){};t.setRequestHeader("Content-type","text/cache-manifest");t.send(new Blob([o],{type:"text/plain"}))})})},WeeklyReports:function(){var e=new PouchDB("activitylogs");var t=this;e.allDocs({include_docs:true},function(e,a){if(!e){var l=a.rows;for(var s=0;s<a.total_rows;s++){var o=l[s].doc;var n=o.logDate;var r=new App.Collections.ActivityLog;r.logDate=n;r.fetch({success:function(e,a){if(e.length==0){t.createLogs(o)}else{var l=e.first();t.updateLogs(o,l)}},error:function(e){console.log("WeeklyReports:: Error looking for (daily) activitylog doc for today's date in CouchDB")}})}}else{console.log("Error fetching documents of 'activitylogs' db in PouchDB. Please try again or refresh page.")}})},createLogs:function(e){var t=e._id;var a=e._rev;var l=new PouchDB("activitylogs");var s=new App.Models.DailyLog;var o=e;s.set("logDate",e.logDate);s.set("community",e.community);s.set("resourcesIds",e.resourcesIds);s.set("resources_names",e.resources_names);s.set("resources_opened",e.resources_opened);s.set("male_visits",e.male_visits);s.set("female_visits",e.female_visits);s.set("female_new_signups",e.female_new_signups?e.female_new_signups:0);s.set("male_new_signups",e.male_new_signups?e.male_new_signups:0);s.set("male_rating",e.male_rating);s.set("female_rating",e.female_rating);s.set("male_timesRated",e.male_timesRated);s.set("female_timesRated",e.female_timesRated);s.set("male_opened",e.male_opened);s.set("female_opened",e.female_opened);s.set("male_deleted_count",e.male_deleted_count);s.set("female_deleted_count",e.female_deleted_count);s.save(null,{success:function(t,a){l.remove(e,function(e,t){if(e){console.log("MyApp:: createLogs:: Failed to delete Pouch activitylog doc after it had been synced i-e its data pushed to (community) CouchDB");console.log(e)}else{}})}})},updateLogs:function(e,t){var a=0,l=0;var s=0;var o=0;var n=0,r=0;var i=0,c=0;var d=0,p=0,u=0,m=0,f=0,g=0,h=0,v=0,y=0,b=0,w=0,_=0;if(e.resources_names){s=e.resources_names}if(t.get("resources_names")){o=t.get("resources_names")}if(e.resourcesIds){a=e.resourcesIds}if(e.resources_opened){l=e.resources_opened}if(t.get("resourcesIds")){d=t.get("resourcesIds")}if(t.get("resources_opened")){p=t.get("resources_opened")}if(t.get("male_visits")){u=t.get("male_visits")}if(t.get("female_visits")){m=t.get("female_visits")}g=t.get("male_new_signups")?t.get("male_new_signups"):0;f=t.get("female_new_signups")?t.get("female_new_signups"):0;if(t.get("male_rating")){h=t.get("male_rating")}if(t.get("female_rating")){v=t.get("female_rating")}if(t.get("male_timesRated")){y=t.get("male_timesRated")}if(t.get("female_timesRated")){b=t.get("female_timesRated")}if(t.get("male_opened")){w=t.get("male_opened")}if(t.get("female_opened")){_=t.get("female_opened")}if(t.get("male_deleted_count")){i=t.get("male_deleted_count")}if(t.get("female_deleted_count")){c=t.get("female_deleted_count")}u=parseInt(u)+parseInt(e.male_visits);m=parseInt(m)+parseInt(e.female_visits);g=parseInt(g)+parseInt(e.male_new_signups?e.male_new_signups:0);f=parseInt(f)+parseInt(e.female_new_signups?e.female_new_signups:0);c=parseInt(c)+parseInt(e.female_deleted_count?e.female_deleted_count:0);i=parseInt(i)+parseInt(e.male_deleted_count?e.male_deleted_count:0);var A,M;for(var R=0;R<a.length;R++){A=a[R];M=d.indexOf(A);if(M==-1){d.push(A);h.push(e.male_rating[R]);v.push(e.female_rating[R]);y.push(e.male_timesRated[R]);b.push(e.female_timesRated[R])}else{h[M]=parseInt(h[M])+parseInt(e.male_rating[R]);v[M]=parseInt(v[M])+parseInt(e.female_rating[R]);y[M]=parseInt(y[M])+parseInt(e.male_timesRated[R]);b[M]=parseInt(b[M])+parseInt(e.female_timesRated[R])}}for(R=0;R<l.length;R++){A=l[R];M=p.indexOf(A);if(M==-1){p.push(A);w.push(e.male_opened[R]);_.push(e.female_opened[R])}else{w[M]=parseInt(w[M])+parseInt(e.male_opened[R]);_[M]=parseInt(_[M])+parseInt(e.female_opened[R])}}t.set("resources_names",o);t.set("resourcesIds",d);t.set("resources_opened",p);t.set("male_visits",u);t.set("female_visits",m);t.set("male_new_signups",g);t.set("female_new_signups",f);t.set("male_rating",h);t.set("female_rating",v);t.set("male_timesRated",y);t.set("female_timesRated",b);t.set("male_opened",w);t.set("female_opened",_);t.set("male_deleted_count",i);t.set("female_deleted_count",c);var D=new PouchDB("activitylogs");t.save(null,{success:function(t,a){D.remove(e,function(e,t){if(e){console.log("MyAppRouter:: updateLogs:: Failed to delete Pouch activitylog doc after it is synced i-e its data pushed to (community) CouchDB");console.log(e)}else{}})}})},LogActivity:function(e,t,a){var l=new App.Views.ActivityReport;var s="community";var o=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var n=new o;n.fetch({async:false});var r=n.first();var i=r.toJSON();if(i.rows[0].doc.type){s=i.rows[0].doc.type}var c=new App.Collections.ActivityLog;c.startkey=this.changeDateFormat(t);c.endkey=this.changeDateFormat(a);if(e!="all"){c.name=e}c.fetch({async:false});var d=c.first();if(d==undefined){alert("No Activity Logged for this period")}var p=d.get("resourcesIds");var u=[];var m=[];if(d.get("resources_names")){m=d.get("resources_names")}if(d.get("resources_opened")){u=d.get("resources_opened")}var f=0;if(d.get("male_visits")){f=d.get("male_visits")}var g=0;if(d.get("female_visits")){g=d.get("female_visits")}var h=[];if(d.get("male_rating")){h=d.get("male_rating")}var v=[];if(d.get("female_rating")){v=d.get("female_rating")}var y=[];if(d.get("male_timesRated")){y=d.get("male_timesRated")}var b=[];if(d.get("female_timesRated")){b=d.get("female_timesRated")}var w=[];if(d.get("male_opened")){w=d.get("male_opened")}var _=[];if(d.get("female_opened")){_=d.get("female_opened")}c.each(function(e,t){if(t>0){f+=e.get("male_visits");g+=e.get("female_visits");resourcesIds=e.get("resourcesIds");resourcesOpened=e.get("resources_opened");resourcesNames=e.get("resources_names");for(var a=0;a<resourcesIds.length;a++){resId=resourcesIds[a];t=p.indexOf(resId);if(t==-1){p.push(resId);h.push(e.get("male_rating")[a]);v.push(e.get("female_rating")[a]);y.push(e.get("male_timesRated")[a]);b.push(e.get("female_timesRated")[a])}else{h[t]=h[t]+e.get("male_rating")[a];v[t]=v[t]+e.get("female_rating")[a];y[t]=y[t]+e.get("male_timesRated")[a];b[t]=b[t]+e.get("female_timesRated")[a]}}if(resourcesOpened)for(var a=0;a<resourcesOpened.length;a++){resId=resourcesOpened[a];t=u.indexOf(resId);if(t==-1){m.push(resourcesNames[a]);u.push(resId);w.push(e.get("male_opened")[a]);_.push(e.get("female_opened")[a])}else{w[t]=w[t]+e.get("male_opened")[a];_[t]=_[t]+e.get("female_opened")[a]}}}});var A=[],M=[];for(var R=0;R<u.length;R++){A.push(w[R]+_[R])}var D=[];var $=5;if(A.length>=$){D=this.findIndicesOfMax(A,$)}else{D=this.findIndicesOfMax(A,A.length)}var C,F;if(A.length>0){var Y,S;for(var R=0;R<D.length;R++){var T=new App.Models.Resource({_id:u[D[R]]});T.fetch({async:false});var I=T.get("title");Y={resourceName:I,timesOpenedCumulative:A[D[R]],timesOpenedByMales:w[D[R]],timesOpenedByFemales:_[D[R]]};if((S=p.indexOf(u[D[R]]))===-1){Y["avgRatingCumulative"]="N/A";Y["avgRatingByMales"]="N/A";Y["avgRatingByFemales"]="N/A";Y["timesRatedByMales"]="N/A";Y["timesRatedByFemales"]="N/A";Y["timesRatedCumulative"]="N/A"}else{C=y[S]+b[S];F=h[S]+v[S];Y["avgRatingCumulative"]=Math.round(F/C*100)/100;Y["avgRatingByMales"]=h[S];Y["avgRatingByFemales"]=v[S];Y["timesRatedByMales"]=y[S];Y["timesRatedByFemales"]=b[S];Y["timesRatedCumulative"]=C}M.push(Y)}}var k=[],V=[],B=[];var N=5;for(var R=0;R<p.length;R++){C=y[R]+b[R];F=h[R]+v[R];k.push(F/C)}var x=[],O=[];if(k.length>=$){x=this.findIndicesOfMax(k,$);O=this.findIndicesOfMin(k,N)}else{x=this.findIndicesOfMax(k,k.length);O=this.findIndicesOfMin(k,k.length)}if(k.length>0){var L,U;for(var R=0;R<x.length;R++){var T=new App.Models.Resource({_id:p[x[R]]});T.fetch({async:false});var I=T.get("title");C=y[x[R]]+b[x[R]];L={resourceName:I,avgRatingCumulative:Math.round(k[x[R]]*100)/100,avgRatingByMales:h[x[R]],avgRatingByFemales:v[x[R]],timesRatedByMales:y[x[R]],timesRatedByFemales:b[x[R]],timesRatedCumulative:y[x[R]]+b[x[R]]};if((S=u.indexOf(p[x[R]]))===-1){L["timesOpenedByMales"]="N/A";L["timesOpenedByFemales"]="N/A";L["timesOpenedCumulative"]="N/A"}else{L["timesOpenedByMales"]=w[S];L["timesOpenedByFemales"]=_[S];L["timesOpenedCumulative"]=A[S]}V.push(L)}for(var R=0;R<O.length;R++){C=y[O[R]]+b[O[R]];var T=new App.Models.Resource({_id:p[O[R]]});T.fetch({async:false});var I=T.get("title");U={resourceName:I,avgRatingCumulative:Math.round(k[O[R]]*100)/100,avgRatingByMales:h[O[R]],avgRatingByFemales:v[O[R]],timesRatedByMales:y[O[R]],timesRatedByFemales:b[O[R]],timesRatedCumulative:y[O[R]]+b[O[R]]};if((S=u.indexOf(p[O[R]]))===-1){U["timesOpenedByMales"]="N/A";U["timesOpenedByFemales"]="N/A";U["timesOpenedCumulative"]="N/A"}else{U["timesOpenedByMales"]=w[S];U["timesOpenedByFemales"]=_[S];U["timesOpenedCumulative"]=A[S]}B.push(U)}}console.log(V);var q={Visits:{male:f,female:g},Most_Freq_Open:M,Highest_Rated:V,Lowest_Rated:B};l.data=q;l.startDate=t;l.endDate=a;l.CommunityName=e;l.render();App.$el.children(".body").html(l.el)},findIndicesOfMax:function(e,t){var a=[];for(var l=0;l<e.length;l++){a.push(l);if(a.length>t){a.sort(function(t,a){return e[a]-e[t]});a.pop()}}if(e.length<=t){a.sort(function(t,a){return e[a]-e[t]})}return a},findIndicesOfMin:function(e,t){var a=[];for(var l=0;l<e.length;l++){a.push(l);if(a.length>t){a.sort(function(t,a){return e[t]-e[a]});a.pop()}}if(e.length<=t){a.sort(function(t,a){return e[t]-e[a]})}return a},setNeedOptimizedBit:function(){var e=0;var t=new App.Collections.Resources;t.fetch({async:false});t.each(function(t){if(t.get("openWith")==="PDF.js"){if(t.get("need_optimization")==undefined){t.set({need_optimization:true});t.save();console.log("Done")}}console.log(e);e++})}}))});