var searchText="";var skip=0;var enablenext=0;var searchRecordsPerPage=2;var limitofRecords=5;var skipStack=new Array;var ratingFilter=new Array;var rtitle=new Array;var rids=new Array;var numberOfNotificattions=".";url="unknown";var lastpage=false;var mailView;function showFeedbackForm(){App.renderFeedback();if(document.getElementById("site-feedback").style.visibility!="visible"){$("#site-feedback").animate({height:"320px"});document.getElementById("site-feedback").style.visibility="visible"}else{$("#site-feedback").animate({height:"toggle"})}}function sendAdminRequest(e,t,a){var n=new Date;var r=new App.Models.Mail;r.set("senderId",$.cookie("Member._id"));r.set("receiverId",e);r.set("subject","Course Admission Request | "+decodeURI(t));r.set("body",'Admission request received from user "'+$.cookie("Member.login")+'" in '+decodeURI(t)+' <br/><br/><button class="btn btn-primary" id="invite-accept" value="'+a+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+a+'" >Reject</button>');r.set("status","0");r.set("type","admissionRequest");r.set("sentDate",n);r.save();$("#admissionButton").hide();alert("Admission request successfully sent to this course leader.")}function searchResources(){skip=0;popAll();lastpage=false;App.Router.SearchResult();$("#previous_button").remove();$("#searchText").focus();$("#searchText").val(searchText)}function popAll(){while(skipStack.length>0){skipStack.pop()}}function onFocus(e){var t=e.value.length;if(e.setSelectionRange)e.setSelectionRange(t,t)}function showComposePopupMultiple(e){$("#subject").val("");$("#recipients").val("");$("#mailbodytexarea").val("");var t=new Array;$("input[name='courseMember']").each(function(){if($(this).is(":checked")){t.push($(this).val())}});console.log(t);$("#recipients").val(t);showComposePopup()}function hideMail(){}function showComposePopup(){$("#emailCompose").popup({horizontal:"right",vertical:"bottom",background:false,blur:false,scrolllock:true});$("#emailCompose").popup("show")}function HandleBrowseClick(e){var t=document.forms["fileAttachment"+e]["_attachments"];t.click()}function FieSelected(e){var t=document.getElementById("courseId"+e).value;var a=document.getElementById("stepTitle"+e).value;var n=document.getElementById("stepNo"+e).value;var r=new App.Models.Group;r.set("_id",t);r.fetch({async:false});if(!r.get("courseLeader")){return}var i=$('input[type="file"]');var s=i.val().split(".");if(i.val()!=""&&s[s.length-1]!="doc"&&s[s.length-1]!="pdf"&&s[s.length-1]!="mp4"&&s[s.length-1]!="ppt"&&s[s.length-1]!="docx"&&s[s.length-1]!="pptx"&&s[s.length-1]!="jpg"&&s[s.length-1]!="jpeg"&&s[s.length-1]!="png"){alert("Invalid attatchment.");return}var l=new Date;var o=new App.Models.Mail;o.set("senderId",$.cookie("Member._id"));o.set("receiverId",r.get("courseLeader"));o.set("subject","Assignment | "+r.get("name"));o.set("body","Assignment submited for <b>"+a+"</b>.");o.set("status","0");o.set("type","mail");o.set("sentDate",l);o.save();var c=new App.Models.AssignmentPaper;c.set("sentDate",l);c.set("senderId",$.cookie("Member._id"));c.set("courseId",t);c.set("stepId",e);c.set("stepNo",n);c.save(null,{success:function(){if($('input[type="file"]').val()){c.saveAttachment("form#fileAttachment"+e,"form#fileAttachment"+e+" #_attachments","form#fileAttachment"+e+" .rev")}else{alert("no attachment")}c.on("savedAttachment",function(){alert("Assignement successfully submitted.")},c)}})}function validateEmail(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)}function sendMail(){var e=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var t=new e;t.fetch({async:false});var a=t.first();var n=a.toJSON();var r=n.rows[0].doc.code+n.rows[0].doc.nationName.substring(3,5);var i=true;var s=$("#recipients").val();var l=new Array;var o=new Array;var c=new Array;c=s.split(",");for(var u=0;u<c.length;u++){var d=c[u];if(validateEmail(d)){if(d!="mycommunity@olebell.org"){var p=d.split("@")[0].split(".");if(p.length>0){var v=p[p.length-1];console.log(r+"    "+v);if(v==r&&d.split("@")[1]=="olebell.org"){}else{l.push(d);o.push(u)}}else{o.push(u);l.push(d)}}}else{o.push(u);l.push(d)}}for(var u=0;u<o.length;u++){c.splice(o[u],1)}var h=$("#subject").val();var m=$("textarea#mailbodytexarea").val();var f=$('input[type="file"]');if(!f.val()){i=false}else{var g=f.val().split(".")}if(s==""){alert("Please enter recipient.")}else if(h==""){alert("Please enter subject.")}else if(m==""){alert("Please enter message.")}else if(i&&f.val()!=""&&g[g.length-1]!="doc"&&g[g.length-1]!="pdf"&&g[g.length-1]!="mp4"&&g[g.length-1]!="ppt"&&g[g.length-1]!="docx"&&g[g.length-1]!="pptx"&&g[g.length-1]!="jpg"&&g[g.length-1]!="jpeg"&&g[g.length-1]!="png"){alert("Invalid attatchment.")}else{if(c.length<=0){return}var b="";if(c.indexOf("mycommunity@olebell.org")!=-1){var A=new App.Collections.Members;A.fetch({async:false});A.each(function(e){b=e.get("login");sendSingleMail(b,m,h,c)});alert("Mail successfully sent.");return}for(var u=0;u<c.length;u++){if(c[u].indexOf("@olebell.org")!=-1){var y=c[u].split("@");b=y[0].substring(0,y[0].lastIndexOf("."))}else{b=c[u]}sendSingleMail(b,m,h,c)}alert("Mail successfully sent.");$("#MakeMailForMembers").popup("hide")}}function sendSingleMail(e,t,a,n){$.getJSON('/members/_design/bell/_view/MembersByLogin?include_docs=true&key="'+e+'"',function(r){if(r.rows[0]){var i=new Date;var s=r.rows[0].doc._id;var l=new App.Models.Mail;l.set("senderId",$.cookie("Member._id"));l.set("receiverId",s);l.set("subject",a);l.set("body",t);l.set("status","0");l.set("type","mail");l.set("sentDate",i);l.set("mailingList",n);$("#emailCompose").popup("hide");l.save(null,{success:function(){l.unset("_attachments");if($('input[type="file"]').val()){l.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev")}else{}l.on("savedAttachment",function(){},l)}});$("#emailCompose").popup("hide")}else{alert("Invalid mail address "+e)}})}function getScheduleDatesForCourse(e,t,a){var n=e.getDay();var r=new Array;while(e<t||e.valueOf()==t.valueOf()){n=e.getDay();var i=new Date(e.valueOf());for(var s=0;s<a.length;s++){if(n<=a[s]){var l=e.getDate()+(a[s]-n);i.setDate(l);if(i<t||i.valueOf()==t.valueOf()){var o=new Date(i.valueOf());r.push(o)}else{if(i.valueOf()==t.valueOf()){var o=new Date(i.valueOf());r.push(o)}else{break}}}}e.setDate(e.getDate()+(7-e.getDay()))}return r}function convertTo24Hour(e){var t=parseInt(e.substr(0,2));return t;if(e.indexOf("am")!=-1&&t==12){e=e.replace("12","0")}if(e.indexOf("pm")!=-1&&t<12){e=e.replace(t,t+12)}return e.replace(/(am|pm)/,"")}$(window).scroll(function(){var e=$("#addEvent"),t=$(window).scrollTop();if(t>=118){e.css({top:"0",position:"fixed"})}else{e.css({position:"fixed",top:"68px"})}});function startRecording(){var e=this;var t={audio:true};var a;navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(!!navigator.getUserMedia_){navigator.getUserMedia_(t,n,r)}function n(e){var t=document.createElement("audio");t=mergeProps(t,{controls:true,src:URL.createObjectURL(e)});t.volume=0;t.play();s.appendChild(t);s.appendChild(document.createElement("hr"));var n=new MediaStreamRecorder(e);a=n;n.mimeType="audio/wav";n.ondataavailable=function(e){i(e)};n.start(20*1e3);alert("You have 20 seconds")}function r(e){console.error("media error",e)}function i(e){var t=document.createElement("a");t.target="_blank";t.innerHTML="Listen Recording "+l++;t.style.color="black";t.href=URL.createObjectURL(e);s.appendChild(t);s.appendChild(document.createElement("hr"));var a=document.getElementsByTagName("audio")[0];a.pause();alert("stoped")}var s=document.getElementById("audios-container");var l=1}function AddToShelf(e,t){App.Router.AddToShelf(e,t)}function AddToShelfAndSaveFeedback(e,t){App.Router.AddToShelfAndSaveFeedback(e,t)}function showSubjectCheckBoxes(){var e=["Agriculture","Arts","Business and Finance","Environment","Food and Nutrition","Geography","Health and Medicine","History","Human Development","Languages","Law","Learning","Literature","Math","Music","Politics and Government","Reference","Religion","Science","Social Sciences","Sports","Technology"];var t=e.length;var a="<label style='font-size:16px'><b>Subject</b></label><br>";a+="<select id='multiselect-subject-search' multiple='multiple' style='width: 370px;'>";for(var n=0;n<t;n++){a=a+'<option id="subject'+(n+1)+'" value="'+e[n]+'">'+e[n]+"</option>"}a+="</select>";$("#SubjectCheckboxes").html(a)}function ResourceSearch(){skip=0;searchText=$("#searchText").val();searchType=$("#searchtype").val();var e=new Array;var t=new Array;var a=new Array;var n=new Array;ratingFilter.length=0;skipStack.push(skip);e=$("#multiselect-collections-search").val();t=$("#multiselect-subject-search").val();a=$("#multiselect-levels-search").val();n=$("#search-language").val();authorName=$("#Author-name").val();mediumFilter=$("#multiselect-medium-search").val();$("input[name='star']").each(function(){if($(this).is(":checked")){ratingFilter.push($(this).val())}});if(searchText!=""||e||t||a||n||authorName||mediumFilter||ratingFilter&&ratingFilter.length>0){var r=new App.Views.Search;r.collectionFilter=e;r.languageFilter=n;r.levelFilter=a;r.subjectFilter=t;r.ratingFilter=ratingFilter;r.mediumFilter=mediumFilter;r.authorName=authorName;r.addResource=false;App.$el.children(".body").html(r.el);r.render();$("#srch").show();$(".row").hide();$("#not-found").show();$(".search-bottom-nav").hide();$(".search-result-header").hide();$("#selectAllButton").hide()}}function backtoSearchView(){$("#not-found").hide();searchText="";App.Router.bellResourceSearch()}function changeRatingImage(e,t){var a="";if($("#"+e+1).attr("src")=="star-on.png"){a="star-off.png"}else{a="star-on.png"}for(var n=1;n<=5;n++){$("#"+e+n).attr("src",a)}}function showRequestForm(e){App.renderRequest(e)}function showSearchView(){$("#not-found").hide();App.Router.SearchBell(grpId,levelrevId,0)}function selectAllSearchResult(){$("input[name='result']").each(function(){$(this).prop("checked",true)})}function CourseSearch(){skip=0;searchText=$("#searchText").val();App.Router.GroupSearch()}function ListAllCourses(){App.Router.Groups()}function AddColletcion(){App.Router.AddNewSelect("Add New")}function EditColletcion(e){App.Router.EditTag(e)}function continueMerging(){var e=$("#selectCollections").val();var t=$("#collectionName").val();if(e){if(e.length<2)alert("Please select 2 or more than 2 items to merge");else if(t=="")alert("Collection Name can not be Empty");else App.Router.mergecollection(e,t)}else alert("Please Select Collections to Merge")}function cancelMerging(){document.getElementById("cont").style.opacity=1;document.getElementById("nav").style.opacity=1;$("#invitationdiv").hide()}