$(function(){App.Router=new(Backbone.Router.extend({routes:{addCommunity:"CommunityForm","addCommunity/:CommunityId":"CommunityForm",login:"MemberLogin",logout:"MemberLogout",listCommunity:"ListCommunity",siteFeedback:"viewAllFeedback",dashboard:"Dashboard",request:"commRequest",earthrequest:"earthRequest",reports:"Reports","reports/edit/:resportId":"ReportForm","reports/add":"ReportForm",publication:"Publication","publication/add":"PublicationForm",configuration:"Configuration","publication/add/:publicationId":"PublicationForm","publicationdetail/:publicationId":"PublicationDetails","courses/:publicationId":"addCourses",trendreport:"TrendReport","communityreport/:syncDate/:name/:code":"communityReport"},initialize:function(){this.bind("all",this.checkLoggedIn);this.bind("all",this.routeStartupTasks);this.bind("all",this.renderNav)},routeStartupTasks:function(){$("#invitationdiv").hide();$("#debug").hide()},findIndicesOfMax:function(e,t){var a=[];for(var l=0;l<e.length;l++){a.push(l);if(a.length>t){a.sort(function(t,a){return e[a]-e[t]});a.pop()}}if(e.length<=t){a.sort(function(t,a){return e[a]-e[t]})}return a},findIndicesOfMin:function(e,t){var a=[];for(var l=0;l<e.length;l++){a.push(l);if(a.length>t){a.sort(function(t,a){return e[t]-e[a]});a.pop()}}if(e.length<=t){a.sort(function(t,a){return e[t]-e[a]})}return a},aggregateDataForTrendReport:function(e,t){if(t.length<1){var a={Visits:{male:0,female:0},New_Signups:{male:0,female:0},Deleted:{male:0,female:0},Most_Freq_Open:[],Highest_Rated:[],Lowest_Rated:[],ResourceViews:{male:0,female:0}};return a}var l=t[0];if(l==undefined){alert("No Activity Logged for this period")}var o=[],r=[],i=[],m=0,s=0,n=0,u=0,f=[],g=[],d=[],p=[],c=[],h=[];var v=0,M=0;if(l.resourcesIds){o=l.resourcesIds}if(l.resources_names){i=l.resources_names}if(l.resources_opened){r=l.resources_opened}if(l.male_visits){m=l.male_visits}if(l.female_visits){s=l.female_visits}if(l.male_new_signups){n=l.male_new_signups}if(l.female_new_signups){u=l.female_new_signups}if(l.male_rating){f=l.male_rating}if(l.female_rating){g=l.female_rating}if(l.male_timesRated){d=l.male_timesRated}if(l.female_timesRated){p=l.female_timesRated}if(l.male_opened){c=l.male_opened}if(l.female_opened){h=l.female_opened}if(l.male_deleted_count){M=l.male_deleted_count}if(l.female_deleted_count){v=l.female_deleted_count}for(var Y=0;Y<t.length;Y++){if(Y>0){var y=t[Y];m+=y.male_visits;s+=y.female_visits;n+=y.male_new_signups?y.male_new_signups:0;u+=y.female_new_signups?y.female_new_signups:0;v+=y.female_deleted_count?y.female_deleted_count:0;M+=y.male_deleted_count?y.male_deleted_count:0;var w=y.resourcesIds;var D=y.resources_names;var F=y.resources_opened;for(var b=0;b<w.length;b++){var V=w[b];var R=o.indexOf(V);if(R==-1){o.push(V);f.push(y.male_rating[b]);g.push(y.female_rating[b]);d.push(y.male_timesRated[b]);p.push(y.female_timesRated[b])}else{f[R]=f[R]+y.male_rating[b];g[R]=g[R]+y.female_rating[b];d[R]=d[R]+y.male_timesRated[b];p[R]=p[R]+y.female_timesRated[b]}}if(F){for(var b=0;b<F.length;b++){var V=F[b];var R=r.indexOf(V);if(R==-1){r.push(V);if(D!=undefined&&D!=null){if(D.length>0){i.push(D[b])}}c.push(y.male_opened[b]);h.push(y.female_opened[b])}else{c[R]=c[R]+y.male_opened[b];h[R]=h[R]+y.female_opened[b]}}}}}var _=0;for(var b=0;b<h.length;b++){_+=h[b]}var N=0;for(var b=0;b<c.length;b++){N+=c[b]}var S=[],T=[];for(var b=0;b<r.length;b++){S.push(c[b]+h[b])}var A=[];var C=5;if(S.length>=C){A=this.findIndicesOfMax(S,C)}else{A=this.findIndicesOfMax(S,S.length)}var $,O;if(S.length>0){var x,k;for(var b=0;b<A.length;b++){var J=new App.Models.Resource({_id:r[A[b]]});J.fetch({async:false});var B=r[A[b]];var I=J.get("title");console.log(l.resources_names);if(!I){var P=r.indexOf(B);console.log(P);I=i[A[b]]}x={resourceName:I,timesOpenedCumulative:S[A[b]],timesOpenedByMales:c[A[b]],timesOpenedByFemales:h[A[b]]};if((k=o.indexOf(r[A[b]]))===-1){x["avgRatingCumulative"]="N/A";x["avgRatingByMales"]="N/A";x["avgRatingByFemales"]="N/A";x["timesRatedByMales"]="N/A";x["timesRatedByFemales"]="N/A";x["timesRatedCumulative"]="N/A"}else{$=d[k]+p[k];O=f[k]+g[k];x["avgRatingCumulative"]=Math.round(O/$*100)/100;x["avgRatingByMales"]=f[k];x["avgRatingByFemales"]=g[k];x["timesRatedByMales"]=d[k];x["timesRatedByFemales"]=p[k];x["timesRatedCumulative"]=$}T.push(x)}}var L=[],X=[],q=[];var W=5;for(var b=0;b<o.length;b++){$=d[b]+p[b];O=f[b]+g[b];L.push(O/$)}var j=[],H=[];if(L.length>=C){j=this.findIndicesOfMax(L,C);H=this.findIndicesOfMin(L,W)}else{j=this.findIndicesOfMax(L,L.length);H=this.findIndicesOfMin(L,L.length)}if(L.length>0){var G,z;for(var b=0;b<j.length;b++){var J=new App.Models.Resource({_id:o[j[b]]});J.fetch({async:false});var I=J.get("title");if(!I){var P=r.indexOf(B);console.log(P);I=i[A[b]]}$=d[j[b]]+p[j[b]];G={resourceName:I,avgRatingCumulative:Math.round(L[j[b]]*100)/100,avgRatingByMales:f[j[b]],avgRatingByFemales:g[j[b]],timesRatedByMales:d[j[b]],timesRatedByFemales:p[j[b]],timesRatedCumulative:d[j[b]]+p[j[b]]};if((k=r.indexOf(o[j[b]]))===-1){G["timesOpenedByMales"]="N/A";G["timesOpenedByFemales"]="N/A";G["timesOpenedCumulative"]="N/A"}else{G["timesOpenedByMales"]=c[k];G["timesOpenedByFemales"]=h[k];G["timesOpenedCumulative"]=S[k]}X.push(G)}for(var b=0;b<H.length;b++){$=d[H[b]]+p[H[b]];var J=new App.Models.Resource({_id:o[H[b]]});J.fetch({async:false});var I=J.get("title");if(!I){var P=r.indexOf(B);console.log(P);I=i[A[b]]}z={resourceName:I,avgRatingCumulative:Math.round(L[H[b]]*100)/100,avgRatingByMales:f[H[b]],avgRatingByFemales:g[H[b]],timesRatedByMales:d[H[b]],timesRatedByFemales:p[H[b]],timesRatedCumulative:d[H[b]]+p[H[b]]};if((k=r.indexOf(o[H[b]]))===-1){z["timesOpenedByMales"]="N/A";z["timesOpenedByFemales"]="N/A";z["timesOpenedCumulative"]="N/A"}else{z["timesOpenedByMales"]=c[k];z["timesOpenedByFemales"]=h[k];z["timesOpenedCumulative"]=S[k]}q.push(z)}}var a={Visits:{male:m,female:s},New_Signups:{male:n,female:u},Deleted:{male:M,female:v},Most_Freq_Open:T,Highest_Rated:X,Lowest_Rated:q,ResourceViews:{male:N,female:_}};return a},turnDateFromMMDDYYYYToYYYYMMDDFormat:function(e){var t=e.match(/\d+/g),a=t[0],l=t[1],o=t[2];return o+"/"+a+"/"+l},turnDateToYYYYMMDDFormat:function(e){var t=e.getFullYear().toString();var a=(e.getMonth()+1).toString();var l=e.getDate().toString();var o=a.split("");var r=l.split("");var i=t+"/"+(o.length===2?a:"0"+o[0])+"/"+(r.length===2?l:"0"+r[0]);return i},changeDateFormat:function(e){var t=e.match(/\d+/g),a=t[0],l=t[1],o=t[2];return a+"/"+l+"/"+o},Configuration:function(){var e=new App.Collections.Configurations;e.fetch({async:false});var t=e.first();var a=new App.Views.Configurations({model:t});a.render();App.$el.children(".body").html(a.el)},getRegisteredMembersCount:function(e,t){var a=0,l=0;$.ajax({url:'/activitylog/_design/bell/_view/GetMaleCountByCommunity?key="'+e+'"',type:"GET",dataType:"json",async:false,success:function(o){if(o.rows[0]){a=o.rows[0].value}$.ajax({url:'/activitylog/_design/bell/_view/GetFemaleCountByCommunity?key="'+e+'"',type:"GET",dataType:"json",async:false,success:function(e){if(e.rows[0]){l=e.rows[0].value}t(a,l)}})}})},getRegisteredMembersCountFromMembersDB:function(e,t){var a=0,l=0;$.ajax({url:'/members/_design/bell/_view/MaleCountByCommunity?key="'+e+'"',type:"GET",dataType:"json",async:false,success:function(o){if(o.rows[0]){a=o.rows[0].value}$.ajax({url:'/members/_design/bell/_view/FemaleCountByCommunity?key="'+e+'"',type:"GET",dataType:"json",async:false,success:function(e){if(e.rows[0]){l=e.rows[0].value}t(a,l)}})}})},getTotalMemberVisits:function(e,t){var a=0,l=0;$.ajax({url:'/activitylog/_design/bell/_view/GetMaleVisitsByCommunity?key="'+e+'"',type:"GET",dataType:"json",async:false,success:function(o){if(o.rows[0]){a=o.rows[0].value}$.ajax({url:'/activitylog/_design/bell/_view/GetFemaleVisitsByCommunity?key="'+e+'"',type:"GET",dataType:"json",async:false,success:function(e){if(e.rows[0]){l=e.rows[0].value}t(a,l)}})}})},lastSyncDateForCommunity:function(e,t){var e=e;var a=$.url().data.attr.host.split(".");var l=a[0];var o=$.url().data.attr.authority;var r="";$.ajax({url:"http://"+l+":oleoleole@"+o+'/community/_design/bell/_view/getCommunityByCode?_include_docs=true&key="'+e+'"',type:"GET",dataType:"jsonp",success:function(e){var a=e.rows[0].value;var l=e.rows[0].id;r=a.lastActivitiesSyncDate;t(r)},async:false})},communityReport:function(e,t,a){var l=this;var o=a;var t=t;var r=e;var i=new Date;var m=new Date(i.getFullYear(),i.getMonth(),1);var s=new Date(m.getFullYear(),m.getMonth(),m.getDate()-1);var n=new Date(s.getFullYear(),s.getMonth(),1);var u=new Date(n.getFullYear(),n.getMonth(),n.getDate()-1);var f=new Date(u.getFullYear(),u.getMonth(),1);var g=new Date(f.getFullYear(),f.getMonth(),f.getDate()-1);var d=new Date(g.getFullYear(),g.getMonth(),1);var p=new Date(d.getFullYear(),d.getMonth(),d.getDate()-1);var c=new Date(p.getFullYear(),p.getMonth(),1);var h=new Date(c.getFullYear(),c.getMonth(),c.getDate()-1);var v=new Date(h.getFullYear(),h.getMonth(),1);var M=new Date(v.getFullYear(),v.getMonth(),v.getDate()-1);var Y=new Date(M.getFullYear(),M.getMonth(),1);var y=new Date(Y.getFullYear(),Y.getMonth(),Y.getDate()-1);var w=new Date(y.getFullYear(),y.getMonth(),1);var D=new Date(w.getFullYear(),w.getMonth(),w.getDate()-1);var F=new Date(D.getFullYear(),D.getMonth(),1);var b=new Date(F.getFullYear(),F.getMonth(),F.getDate()-1);var V=new Date(b.getFullYear(),b.getMonth(),1);var R=new Date(V.getFullYear(),V.getMonth(),c.getDate()-1);var _=new Date(R.getFullYear(),R.getMonth(),1);var N=new Date(_.getFullYear(),_.getMonth(),_.getDate()-1);var S=new Date(N.getFullYear(),N.getMonth(),1);var T=l.changeDateFormat(l.turnDateToYYYYMMDDFormat(S));var A=l.changeDateFormat(l.turnDateToYYYYMMDDFormat(i));var C=new App.Collections.ActivityLog;var O=App.Server+'/activitylog/_design/bell/_view/getDocByCommunityCode?include_docs=true&startkey=["'+o+'","'+T+'"]&endkey=["'+o+'","'+A+'"]';C.setUrl(O);C.fetch({async:false});C.toJSON();var x=[],k=[],J=[],B=[],I=[],P=[],L=[],X=[],q=[],W=[],j=[],H=[];for(var G in C.models){var z=l.turnDateFromMMDDYYYYToYYYYMMDDFormat(C.models[G].get("logDate"));if(z>=l.turnDateToYYYYMMDDFormat(m)&&z<=l.turnDateToYYYYMMDDFormat(i)){x.push(JSON.parse(JSON.stringify(C.models[G])))}else if(z>=l.turnDateToYYYYMMDDFormat(n)&&z<=l.turnDateToYYYYMMDDFormat(s)){k.push(JSON.parse(JSON.stringify(C.models[G])))}else if(z>=l.turnDateToYYYYMMDDFormat(f)&&z<=l.turnDateToYYYYMMDDFormat(u)){J.push(JSON.parse(JSON.stringify(C.models[G])))}else if(z>=l.turnDateToYYYYMMDDFormat(d)&&z<=l.turnDateToYYYYMMDDFormat(g)){B.push(JSON.parse(JSON.stringify(C.models[G])))}else if(z>=l.turnDateToYYYYMMDDFormat(c)&&z<=l.turnDateToYYYYMMDDFormat(p)){I.push(JSON.parse(JSON.stringify(C.models[G])))}else if(z>=l.turnDateToYYYYMMDDFormat(v)&&z<=l.turnDateToYYYYMMDDFormat(h)){P.push(JSON.parse(JSON.stringify(C.models[G])))}else if(z>=l.turnDateToYYYYMMDDFormat(Y)&&z<=l.turnDateToYYYYMMDDFormat(M)){L.push(JSON.parse(JSON.stringify(C.models[G])))}else if(z>=l.turnDateToYYYYMMDDFormat(w)&&z<=l.turnDateToYYYYMMDDFormat(y)){X.push(JSON.parse(JSON.stringify(C.models[G])))}else if(z>=l.turnDateToYYYYMMDDFormat(F)&&z<=l.turnDateToYYYYMMDDFormat(D)){q.push(JSON.parse(JSON.stringify(C.models[G])))}else if(z>=l.turnDateToYYYYMMDDFormat(V)&&z<=l.turnDateToYYYYMMDDFormat(b)){W.push(JSON.parse(JSON.stringify(C.models[G])))}else if(z>=l.turnDateToYYYYMMDDFormat(_)&&z<=l.turnDateToYYYYMMDDFormat(R)){j.push(JSON.parse(JSON.stringify(C.models[G])))}else if(z>=l.turnDateToYYYYMMDDFormat(S)&&z<=l.turnDateToYYYYMMDDFormat(N)){H.push(JSON.parse(JSON.stringify(C.models[G])))}}var E=l.aggregateDataForTrendReport("communityX",x);var U=l.aggregateDataForTrendReport("communityX",k);var K=l.aggregateDataForTrendReport("communityX",J);var Q=l.aggregateDataForTrendReport("communityX",B);var Z=l.aggregateDataForTrendReport("communityX",I);var ee=l.aggregateDataForTrendReport("communityX",P);var te=l.aggregateDataForTrendReport("communityX",L);var ae=l.aggregateDataForTrendReport("communityX",X);var le=l.aggregateDataForTrendReport("communityX",q);var oe=l.aggregateDataForTrendReport("communityX",W);var re=l.aggregateDataForTrendReport("communityX",j);var ie=l.aggregateDataForTrendReport("communityX",H);var me=l.aggregateDataForTrendReport("communityX",JSON.parse(JSON.stringify(C.models)));console.log(E);var se=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var ne={male:0,female:0};l.getRegisteredMembersCount(o,function(e,t){ne["male"]=e;ne["female"]=t});var ue={male:0,female:0};l.getRegisteredMembersCountFromMembersDB(o,function(e,t){ue["male"]=e;ue["female"]=t});var fe={male:0,female:0};l.getTotalMemberVisits(o,function(e,t){fe["male"]=e;fe["female"]=t});var ge={male:ne["male"],female:ne["female"],total:0};var de={male:ne["male"]-E.New_Signups["male"],female:ne["female"]-E.New_Signups["female"],total:0};var pe={male:de["male"]-U.New_Signups["male"],female:de["female"]-U.New_Signups["female"],total:0};var ce={male:pe["male"]-K.New_Signups["male"],female:pe["female"]-K.New_Signups["female"],total:0};var he={male:ce["male"]-Q.New_Signups["male"],female:ce["female"]-Q.New_Signups["female"],total:0};var ve={male:he["male"]-Z.New_Signups["male"],female:he["female"]-Z.New_Signups["female"],total:0};var Me={male:ve["male"]-ee.New_Signups["male"],female:ve["female"]-ee.New_Signups["female"],total:0};var Ye={male:Me["male"]-te.New_Signups["male"],female:Me["female"]-te.New_Signups["female"],total:0};var ye={male:Ye["male"]-ae.New_Signups["male"],female:Ye["female"]-ae.New_Signups["female"],total:0};var we={male:ye["male"]-le.New_Signups["male"],female:ye["female"]-le.New_Signups["female"],total:0};var De={male:we["male"]-oe.New_Signups["male"],female:we["female"]-oe.New_Signups["female"],total:0};var Fe={male:De["male"]-re.New_Signups["male"],female:De["female"]-re.New_Signups["female"],total:0};ge["total"]=ge["male"]+ge["female"];de["total"]=de["male"]+de["female"];pe["total"]=pe["male"]+pe["female"];ce["total"]=ce["male"]+ce["female"];he["total"]=he["male"]+he["female"];ve["total"]=ve["male"]+ve["female"];Me["total"]=Me["male"]+Me["female"];Ye["total"]=Ye["male"]+Ye["female"];ye["total"]=ye["male"]+ye["female"];we["total"]=we["male"]+we["female"];De["total"]=De["male"]+De["female"];Fe["total"]=Fe["male"]+Fe["female"];var be={male:ue["male"],female:ue["female"],total:0};var Ve={male:ue["male"]-(E.New_Signups["male"]-E.Deleted["male"]),female:ue["female"]-(E.New_Signups["female"]-E.Deleted["female"]),total:0};var Re={male:Ve["male"]-(U.New_Signups["male"]-U.Deleted["male"]),female:Ve["female"]-(U.New_Signups["female"]-U.Deleted["female"]),total:0};var _e={male:Re["male"]-(K.New_Signups["male"]-K.Deleted["male"]),female:Re["female"]-(K.New_Signups["female"]-K.Deleted["female"]),total:0};var Ne={male:_e["male"]-(Q.New_Signups["male"]-Q.Deleted["male"]),female:_e["female"]-(Q.New_Signups["female"]-Q.Deleted["female"]),total:0};var Se={male:Ne["male"]-(Z.New_Signups["male"]-Z.Deleted["male"]),female:Ne["female"]-(Z.New_Signups["female"]-Z.Deleted["female"]),total:0};var Te={male:Se["male"]-(ee.New_Signups["male"]-ee.Deleted["male"]),female:Se["female"]-(ee.New_Signups["female"]-ee.Deleted["female"]),total:0};var Ae={male:Te["male"]-(te.New_Signups["male"]-te.Deleted["male"]),female:Te["female"]-(te.New_Signups["female"]-te.Deleted["female"]),total:0};var Ce={male:Ae["male"]-(ae.New_Signups["male"]-ae.Deleted["male"]),female:Ae["female"]-(ae.New_Signups["female"]-ae.Deleted["female"]),total:0};var $e={male:Ce["male"]-(le.New_Signups["male"]-le.Deleted["male"]),female:Ce["female"]-(le.New_Signups["female"]-le.Deleted["female"]),total:0};var Oe={male:$e["male"]-(oe.New_Signups["male"]-oe.Deleted["male"]),female:$e["female"]-(oe.New_Signups["female"]-oe.Deleted["female"]),total:0};var xe={male:Oe["male"]-(re.New_Signups["male"]-re.Deleted["male"]),female:Oe["female"]-(re.New_Signups["female"]-re.Deleted["female"]),total:0};be["total"]=be["male"]+be["female"];Ve["total"]=Ve["male"]+Ve["female"];Re["total"]=Re["male"]+Re["female"];_e["total"]=_e["male"]+_e["female"];Ne["total"]=Ne["male"]+Ne["female"];Se["total"]=Se["male"]+Se["female"];Te["total"]=Te["male"]+Te["female"];Ae["total"]=Ae["male"]+Ae["female"];Ce["total"]=Ce["male"]+Ce["female"];$e["total"]=$e["male"]+$e["female"];Oe["total"]=Oe["male"]+Oe["female"];xe["total"]=xe["male"]+xe["female"];var ke={male:fe["male"],female:fe["female"],total:0};var Je={male:fe["male"]-E.Visits["male"],female:fe["female"]-E.Visits["female"],total:0};var Be={male:Je["male"]-U.Visits["male"],female:Je["female"]-U.Visits["female"],total:0};var Ie={male:Be["male"]-K.Visits["male"],female:Be["female"]-K.Visits["female"],total:0};var Pe={male:Ie["male"]-Q.Visits["male"],female:Ie["female"]-Q.Visits["female"],total:0};var Le={male:Pe["male"]-Z.Visits["male"],female:Pe["female"]-Z.Visits["female"],total:0};var Xe={male:Le["male"]-ee.Visits["male"],female:Le["female"]-ee.Visits["female"],total:0};var qe={male:Xe["male"]-te.Visits["male"],female:Xe["female"]-te.Visits["female"],total:0};var We={male:qe["male"]-ae.Visits["male"],female:qe["female"]-ae.Visits["female"],total:0};var je={male:We["male"]-le.Visits["male"],female:We["female"]-le.Visits["female"],total:0};var He={male:je["male"]-oe.Visits["male"],female:je["female"]-oe.Visits["female"],total:0};var Ge={male:He["male"]-re.Visits["male"],female:He["female"]-re.Visits["female"],total:0};ke["total"]=ke["male"]+ke["female"];Je["total"]=Je["male"]+Je["female"];Be["total"]=Be["male"]+Be["female"];Ie["total"]=Ie["male"]+Ie["female"];Pe["total"]=Pe["male"]+Pe["female"];Le["total"]=Le["male"]+Le["female"];Xe["total"]=Xe["male"]+Xe["female"];qe["total"]=qe["male"]+qe["female"];We["total"]=We["male"]+We["female"];je["total"]=je["male"]+je["female"];He["total"]=He["male"]+He["female"];Ge["total"]=Ge["male"]+Ge["female"];var ze=new App.Views.TrendActivityReport;ze.data=me;ze.startDate=C.startkey;ze.endDate=C.endkey;ze.CommunityName=t;ze.lastActivitySyncDate=r;ze.render();App.$el.children(".body").html(ze.el);$("#trend-report-div-total-members").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Registered Members Past 12 Months"},xAxis:{categories:[se[S.getMonth()]+" "+S.getFullYear(),se[_.getMonth()]+" "+_.getFullYear(),se[V.getMonth()]+" "+V.getFullYear(),se[F.getMonth()]+" "+F.getFullYear(),se[w.getMonth()]+" "+w.getFullYear(),se[Y.getMonth()]+" "+Y.getFullYear(),se[v.getMonth()]+" "+v.getFullYear(),se[c.getMonth()]+" "+c.getFullYear(),se[d.getMonth()]+" "+d.getFullYear(),se[f.getMonth()]+" "+f.getFullYear(),se[n.getMonth()]+" "+n.getFullYear(),se[m.getMonth()]+" "+m.getFullYear()]},yAxis:{min:0,title:{text:"Members Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[xe["male"],Oe["male"],$e["male"],Ce["male"],Ae["male"],Te["male"],Se["male"],Ne["male"],_e["male"],Re["male"],Ve["male"],be["male"]],color:"#33ccff"},{name:"Females",data:[xe["female"],Oe["female"],$e["female"],Ce["female"],Ae["female"],Te["female"],Se["female"],Ne["female"],_e["female"],Re["female"],Ve["female"],be["female"]],color:"#66ff66"},{name:"Total",data:[xe["total"],Oe["total"],$e["total"],Ce["total"],Ae["total"],Te["total"],Se["total"],Ne["total"],_e["total"],Re["total"],Ve["total"],be["total"]],color:"#ff9900"}]});$("#trend-report-div-total-member-visits").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Visits Past 12 Months"},xAxis:{categories:[se[S.getMonth()]+" "+S.getFullYear(),se[_.getMonth()]+" "+_.getFullYear(),se[V.getMonth()]+" "+V.getFullYear(),se[F.getMonth()]+" "+F.getFullYear(),se[w.getMonth()]+" "+w.getFullYear(),se[Y.getMonth()]+" "+Y.getFullYear(),se[v.getMonth()]+" "+v.getFullYear(),se[c.getMonth()]+" "+c.getFullYear(),se[d.getMonth()]+" "+d.getFullYear(),se[f.getMonth()]+" "+f.getFullYear(),se[n.getMonth()]+" "+n.getFullYear(),se[m.getMonth()]+" "+m.getFullYear()]},yAxis:{min:0,title:{text:"Visits Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[Ge["male"],He["male"],je["male"],We["male"],qe["male"],Xe["male"],Le["male"],Pe["male"],Ie["male"],Be["male"],Je["male"],ke["male"]],color:"#33ccff"},{name:"Females",data:[Ge["female"],He["female"],je["female"],We["female"],qe["female"],Xe["female"],Le["female"],Pe["female"],Ie["female"],Be["female"],Je["female"],ke["female"]],color:"#66ff66"},{name:"Total",data:[Ge["total"],He["total"],je["total"],We["total"],qe["total"],Xe["total"],Le["total"],Pe["total"],Ie["total"],Be["total"],Je["total"],ke["total"]],color:"#ff9900"}]});$("#trend-report-div-new-memberships").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Active Members This Month"},xAxis:{categories:[se[S.getMonth()]+" "+S.getFullYear(),se[_.getMonth()]+" "+_.getFullYear(),se[V.getMonth()]+" "+V.getFullYear(),se[F.getMonth()]+" "+F.getFullYear(),se[w.getMonth()]+" "+w.getFullYear(),se[Y.getMonth()]+" "+Y.getFullYear(),se[v.getMonth()]+" "+v.getFullYear(),se[c.getMonth()]+" "+c.getFullYear(),se[d.getMonth()]+" "+d.getFullYear(),se[f.getMonth()]+" "+f.getFullYear(),se[n.getMonth()]+" "+n.getFullYear(),se[m.getMonth()]+" "+m.getFullYear()]},yAxis:{min:0,title:{text:"Members Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[Fe["male"],De["male"]-Fe["male"],we["male"]-De["male"],ye["male"]-we["male"],Ye["male"]-ye["male"],Me["male"]-Ye["male"],ve["male"]-Me["male"],he["male"]-ve["male"],ce["male"]-he["male"],pe["male"]-ce["male"],de["male"]-pe["male"],ne["male"]-de["male"]],color:"#33ccff"},{name:"Females",data:[Fe["female"],De["female"]-Fe["female"],we["female"]-De["female"],ye["female"]-we["female"],Ye["female"]-ye["female"],Me["female"]-Ye["female"],ve["female"]-Me["female"],he["female"]-ve["female"],ce["female"]-he["female"],pe["female"]-ce["female"],de["female"]-pe["female"],ne["female"]-de["female"]],color:"#66ff66"},{name:"Total",data:[Fe["total"],De["total"]-Fe["total"],we["total"]-De["total"],ye["total"]-we["total"],Ye["total"]-ye["total"],Me["total"]-Ye["total"],ve["total"]-Me["total"],he["total"]-ve["total"],ce["total"]-he["total"],pe["total"]-ce["total"],de["total"]-pe["total"],ge["total"]-de["total"]],color:"#ff9900"}]});$("#trend-report-div-visits").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Member Visits This Month"},xAxis:{categories:[se[S.getMonth()]+" "+S.getFullYear(),se[_.getMonth()]+" "+_.getFullYear(),se[V.getMonth()]+" "+V.getFullYear(),se[F.getMonth()]+" "+F.getFullYear(),se[w.getMonth()]+" "+w.getFullYear(),se[Y.getMonth()]+" "+Y.getFullYear(),se[v.getMonth()]+" "+v.getFullYear(),se[c.getMonth()]+" "+c.getFullYear(),se[d.getMonth()]+" "+d.getFullYear(),se[f.getMonth()]+" "+f.getFullYear(),se[n.getMonth()]+" "+n.getFullYear(),se[m.getMonth()]+" "+m.getFullYear()]},yAxis:{min:0,title:{text:"Visits Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[ie.Visits["male"],re.Visits["male"],oe.Visits["male"],le.Visits["male"],ae.Visits["male"],te.Visits["male"],ee.Visits["male"],Z.Visits["male"],Q.Visits["male"],K.Visits["male"],U.Visits["male"],E.Visits["male"]],color:"#33ccff"},{name:"Females",data:[ie.Visits["female"],re.Visits["female"],oe.Visits["female"],le.Visits["female"],ae.Visits["female"],te.Visits["female"],ee.Visits["female"],Z.Visits["female"],Q.Visits["female"],K.Visits["female"],U.Visits["female"],E.Visits["female"]],color:"#66ff66"},{name:"Total",data:[ie.Visits["male"]+ie.Visits["female"],re.Visits["male"]+re.Visits["female"],oe.Visits["male"]+oe.Visits["female"],le.Visits["male"]+le.Visits["female"],ae.Visits["male"]+ae.Visits["female"],te.Visits["male"]+te.Visits["female"],ee.Visits["male"]+ee.Visits["female"],Z.Visits["male"]+Z.Visits["female"],Q.Visits["male"]+Q.Visits["female"],K.Visits["male"]+K.Visits["female"],U.Visits["male"]+U.Visits["female"],E.Visits["male"]+E.Visits["female"]],color:"#ff9900"}]});$("#trend-report-div-total-resource-views-this-month").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Resource Views This Month"},xAxis:{categories:[se[S.getMonth()]+" "+S.getFullYear(),se[_.getMonth()]+" "+_.getFullYear(),se[V.getMonth()]+" "+V.getFullYear(),se[F.getMonth()]+" "+F.getFullYear(),se[w.getMonth()]+" "+w.getFullYear(),se[Y.getMonth()]+" "+Y.getFullYear(),se[v.getMonth()]+" "+v.getFullYear(),se[c.getMonth()]+" "+c.getFullYear(),se[d.getMonth()]+" "+d.getFullYear(),se[f.getMonth()]+" "+f.getFullYear(),se[n.getMonth()]+" "+n.getFullYear(),se[m.getMonth()]+" "+m.getFullYear()]},yAxis:{min:0,title:{text:"Resource count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[ie.ResourceViews["male"],re.ResourceViews["male"],oe.ResourceViews["male"],le.ResourceViews["male"],ae.ResourceViews["male"],te.ResourceViews["male"],ee.ResourceViews["male"],Z.ResourceViews["male"],Q.ResourceViews["male"],K.ResourceViews["male"],U.ResourceViews["male"],E.ResourceViews["male"]],color:"#33ccff"},{name:"Females",data:[ie.ResourceViews["female"],re.ResourceViews["female"],oe.ResourceViews["female"],le.ResourceViews["female"],ae.ResourceViews["female"],te.ResourceViews["female"],ee.ResourceViews["female"],Z.ResourceViews["female"],Q.ResourceViews["female"],K.ResourceViews["female"],U.ResourceViews["female"],E.ResourceViews["female"]],color:"#66ff66"},{name:"Total",data:[ie.ResourceViews["male"]+ie.ResourceViews["female"],re.ResourceViews["male"]+re.ResourceViews["female"],oe.ResourceViews["male"]+oe.ResourceViews["female"],le.ResourceViews["male"]+le.ResourceViews["female"],ae.ResourceViews["male"]+ae.ResourceViews["female"],te.ResourceViews["male"]+te.ResourceViews["female"],ee.ResourceViews["male"]+ee.ResourceViews["female"],Z.ResourceViews["male"]+Z.ResourceViews["female"],Q.ResourceViews["male"]+Q.ResourceViews["female"],K.ResourceViews["male"]+K.ResourceViews["female"],U.ResourceViews["male"]+U.ResourceViews["female"],E.ResourceViews["male"]+E.ResourceViews["female"]],color:"#ff9900"}]})},TrendReport:function(){var e=this;App.$el.children(".body").html("");$('<div id="trend-report-form" style="height: auto"></div>').appendTo(App.$el.children(".body"));var t=$("<select id='communitySelector'>");var a=$("<label>").text("Select Community: ");$("#trend-report-form").append(a);var l=[];$.ajax({type:"GET",url:"/community/_design/bell/_view/getAllCommunityNames",dataType:"json",success:function(e){for(var a=0;a<e.rows.length;a++){l[a]=e.rows[a].value;t.append("<option value="+l[a]+">"+e.rows[a].key+"</option>")}},data:{},async:false});$("#trend-report-form").append(t);var o=$('<input type="button" style="height: 100%">').attr({id:"submit",name:"submit","class":"btn btn-success",value:"Generate Report"});$("#trend-report-form").append(o);var r="";o.click(function(){var t=$("#communitySelector").val();r=$("#communitySelector option:selected").text();var a=new Date;var l=new Date(a.getFullYear(),a.getMonth(),1);var o=new Date(l.getFullYear(),l.getMonth(),l.getDate()-1);var i=new Date(o.getFullYear(),o.getMonth(),1);var m=new Date(i.getFullYear(),i.getMonth(),i.getDate()-1);var s=new Date(m.getFullYear(),m.getMonth(),1);var n=new Date(s.getFullYear(),s.getMonth(),s.getDate()-1);var u=new Date(n.getFullYear(),n.getMonth(),1);var f=new Date(u.getFullYear(),u.getMonth(),u.getDate()-1);var g=new Date(f.getFullYear(),f.getMonth(),1);var d=new Date(g.getFullYear(),g.getMonth(),g.getDate()-1);var p=new Date(d.getFullYear(),d.getMonth(),1);var c=new Date(p.getFullYear(),p.getMonth(),p.getDate()-1);var h=new Date(c.getFullYear(),c.getMonth(),1);var v=new Date(h.getFullYear(),h.getMonth(),h.getDate()-1);var M=new Date(v.getFullYear(),v.getMonth(),1);var Y=new Date(M.getFullYear(),M.getMonth(),M.getDate()-1);var y=new Date(Y.getFullYear(),Y.getMonth(),1);var w=new Date(y.getFullYear(),y.getMonth(),y.getDate()-1);var D=new Date(w.getFullYear(),w.getMonth(),1);var F=new Date(D.getFullYear(),D.getMonth(),g.getDate()-1);var b=new Date(F.getFullYear(),F.getMonth(),1);var V=new Date(b.getFullYear(),b.getMonth(),b.getDate()-1);var R=new Date(V.getFullYear(),V.getMonth(),1);var _=e.changeDateFormat(e.turnDateToYYYYMMDDFormat(R));var N=e.changeDateFormat(e.turnDateToYYYYMMDDFormat(a));var S=new App.Collections.ActivityLog;var T=App.Server+'/activitylog/_design/bell/_view/getDocByCommunityCode?include_docs=true&startkey=["'+t+'","'+_+'"]&endkey=["'+t+'","'+N+'"]';S.setUrl(T);S.fetch({async:false});S.toJSON();var A=[],C=[],O=[],x=[],k=[],J=[],B=[],I=[],P=[],L=[],X=[],q=[];for(var W in S.models){var j=e.turnDateFromMMDDYYYYToYYYYMMDDFormat(S.models[W].get("logDate"));if(j>=e.turnDateToYYYYMMDDFormat(l)&&j<=e.turnDateToYYYYMMDDFormat(a)){A.push(JSON.parse(JSON.stringify(S.models[W])))}else if(j>=e.turnDateToYYYYMMDDFormat(i)&&j<=e.turnDateToYYYYMMDDFormat(o)){C.push(JSON.parse(JSON.stringify(S.models[W])))}else if(j>=e.turnDateToYYYYMMDDFormat(s)&&j<=e.turnDateToYYYYMMDDFormat(m)){O.push(JSON.parse(JSON.stringify(S.models[W])))}else if(j>=e.turnDateToYYYYMMDDFormat(u)&&j<=e.turnDateToYYYYMMDDFormat(n)){x.push(JSON.parse(JSON.stringify(S.models[W])))}else if(j>=e.turnDateToYYYYMMDDFormat(g)&&j<=e.turnDateToYYYYMMDDFormat(f)){k.push(JSON.parse(JSON.stringify(S.models[W])))}else if(j>=e.turnDateToYYYYMMDDFormat(p)&&j<=e.turnDateToYYYYMMDDFormat(d)){J.push(JSON.parse(JSON.stringify(S.models[W])))}else if(j>=e.turnDateToYYYYMMDDFormat(h)&&j<=e.turnDateToYYYYMMDDFormat(c)){B.push(JSON.parse(JSON.stringify(S.models[W])))}else if(j>=e.turnDateToYYYYMMDDFormat(M)&&j<=e.turnDateToYYYYMMDDFormat(v)){I.push(JSON.parse(JSON.stringify(S.models[W])))}else if(j>=e.turnDateToYYYYMMDDFormat(y)&&j<=e.turnDateToYYYYMMDDFormat(Y)){P.push(JSON.parse(JSON.stringify(S.models[W])))}else if(j>=e.turnDateToYYYYMMDDFormat(D)&&j<=e.turnDateToYYYYMMDDFormat(w)){L.push(JSON.parse(JSON.stringify(S.models[W])))}else if(j>=e.turnDateToYYYYMMDDFormat(b)&&j<=e.turnDateToYYYYMMDDFormat(F)){X.push(JSON.parse(JSON.stringify(S.models[W])))}else if(j>=e.turnDateToYYYYMMDDFormat(R)&&j<=e.turnDateToYYYYMMDDFormat(V)){q.push(JSON.parse(JSON.stringify(S.models[W])))}}var H=e.aggregateDataForTrendReport("communityX",A);var G=e.aggregateDataForTrendReport("communityX",C);var z=e.aggregateDataForTrendReport("communityX",O);var E=e.aggregateDataForTrendReport("communityX",x);var U=e.aggregateDataForTrendReport("communityX",k);var K=e.aggregateDataForTrendReport("communityX",J);var Q=e.aggregateDataForTrendReport("communityX",B);var Z=e.aggregateDataForTrendReport("communityX",I);var ee=e.aggregateDataForTrendReport("communityX",P);var te=e.aggregateDataForTrendReport("communityX",L);
var ae=e.aggregateDataForTrendReport("communityX",X);var le=e.aggregateDataForTrendReport("communityX",q);var oe=e.aggregateDataForTrendReport("communityX",JSON.parse(JSON.stringify(S.models)));console.log(H);var re=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var ie={male:0,female:0};e.getRegisteredMembersCount(t,function(e,t){ie["male"]=e;ie["female"]=t});var me={male:0,female:0};e.getRegisteredMembersCountFromMembersDB(t,function(e,t){me["male"]=e;me["female"]=t});var se={male:0,female:0};e.getTotalMemberVisits(t,function(e,t){se["male"]=e;se["female"]=t});var ne={male:ie["male"],female:ie["female"],total:0};var ue={male:ie["male"]-H.New_Signups["male"],female:ie["female"]-H.New_Signups["female"],total:0};var fe={male:ue["male"]-G.New_Signups["male"],female:ue["female"]-G.New_Signups["female"],total:0};var ge={male:fe["male"]-z.New_Signups["male"],female:fe["female"]-z.New_Signups["female"],total:0};var de={male:ge["male"]-E.New_Signups["male"],female:ge["female"]-E.New_Signups["female"],total:0};var pe={male:de["male"]-U.New_Signups["male"],female:de["female"]-U.New_Signups["female"],total:0};var ce={male:pe["male"]-K.New_Signups["male"],female:pe["female"]-K.New_Signups["female"],total:0};var he={male:ce["male"]-Q.New_Signups["male"],female:ce["female"]-Q.New_Signups["female"],total:0};var ve={male:he["male"]-Z.New_Signups["male"],female:he["female"]-Z.New_Signups["female"],total:0};var Me={male:ve["male"]-ee.New_Signups["male"],female:ve["female"]-ee.New_Signups["female"],total:0};var Ye={male:Me["male"]-te.New_Signups["male"],female:Me["female"]-te.New_Signups["female"],total:0};var ye={male:Ye["male"]-ae.New_Signups["male"],female:Ye["female"]-ae.New_Signups["female"],total:0};ne["total"]=ne["male"]+ne["female"];ue["total"]=ue["male"]+ue["female"];fe["total"]=fe["male"]+fe["female"];ge["total"]=ge["male"]+ge["female"];de["total"]=de["male"]+de["female"];pe["total"]=pe["male"]+pe["female"];ce["total"]=ce["male"]+ce["female"];he["total"]=he["male"]+he["female"];ve["total"]=ve["male"]+ve["female"];Me["total"]=Me["male"]+Me["female"];Ye["total"]=Ye["male"]+Ye["female"];ye["total"]=ye["male"]+ye["female"];var we={male:me["male"],female:me["female"],total:0};var De={male:me["male"]-(H.New_Signups["male"]-H.Deleted["male"]),female:me["female"]-(H.New_Signups["female"]-H.Deleted["female"]),total:0};var Fe={male:De["male"]-(G.New_Signups["male"]-G.Deleted["male"]),female:De["female"]-(G.New_Signups["female"]-G.Deleted["female"]),total:0};var be={male:Fe["male"]-(z.New_Signups["male"]-z.Deleted["male"]),female:Fe["female"]-(z.New_Signups["female"]-z.Deleted["female"]),total:0};var Ve={male:be["male"]-(E.New_Signups["male"]-E.Deleted["male"]),female:be["female"]-(E.New_Signups["female"]-E.Deleted["female"]),total:0};var Re={male:Ve["male"]-(U.New_Signups["male"]-U.Deleted["male"]),female:Ve["female"]-(U.New_Signups["female"]-U.Deleted["female"]),total:0};var _e={male:Re["male"]-(K.New_Signups["male"]-K.Deleted["male"]),female:Re["female"]-(K.New_Signups["female"]-K.Deleted["female"]),total:0};var Ne={male:_e["male"]-(Q.New_Signups["male"]-Q.Deleted["male"]),female:_e["female"]-(Q.New_Signups["female"]-Q.Deleted["female"]),total:0};var Se={male:Ne["male"]-(Z.New_Signups["male"]-Z.Deleted["male"]),female:Ne["female"]-(Z.New_Signups["female"]-Z.Deleted["female"]),total:0};var Te={male:Se["male"]-(ee.New_Signups["male"]-ee.Deleted["male"]),female:Se["female"]-(ee.New_Signups["female"]-ee.Deleted["female"]),total:0};var Ae={male:Te["male"]-(te.New_Signups["male"]-te.Deleted["male"]),female:Te["female"]-(te.New_Signups["female"]-te.Deleted["female"]),total:0};var Ce={male:Ae["male"]-(ae.New_Signups["male"]-ae.Deleted["male"]),female:Ae["female"]-(ae.New_Signups["female"]-ae.Deleted["female"]),total:0};we["total"]=we["male"]+we["female"];De["total"]=De["male"]+De["female"];Fe["total"]=Fe["male"]+Fe["female"];be["total"]=be["male"]+be["female"];Ve["total"]=Ve["male"]+Ve["female"];Re["total"]=Re["male"]+Re["female"];_e["total"]=_e["male"]+_e["female"];Ne["total"]=Ne["male"]+Ne["female"];Se["total"]=Se["male"]+Se["female"];Te["total"]=Te["male"]+Te["female"];Ae["total"]=Ae["male"]+Ae["female"];Ce["total"]=Ce["male"]+Ce["female"];var $e={male:se["male"],female:se["female"],total:0};var Oe={male:se["male"]-H.Visits["male"],female:se["female"]-H.Visits["female"],total:0};var xe={male:Oe["male"]-G.Visits["male"],female:Oe["female"]-G.Visits["female"],total:0};var ke={male:xe["male"]-z.Visits["male"],female:xe["female"]-z.Visits["female"],total:0};var Je={male:ke["male"]-E.Visits["male"],female:ke["female"]-E.Visits["female"],total:0};var Be={male:Je["male"]-U.Visits["male"],female:Je["female"]-U.Visits["female"],total:0};var Ie={male:Be["male"]-K.Visits["male"],female:Be["female"]-K.Visits["female"],total:0};var Pe={male:Ie["male"]-Q.Visits["male"],female:Ie["female"]-Q.Visits["female"],total:0};var Le={male:Pe["male"]-Z.Visits["male"],female:Pe["female"]-Z.Visits["female"],total:0};var Xe={male:Le["male"]-ee.Visits["male"],female:Le["female"]-ee.Visits["female"],total:0};var qe={male:Xe["male"]-te.Visits["male"],female:Xe["female"]-te.Visits["female"],total:0};var We={male:qe["male"]-ae.Visits["male"],female:qe["female"]-ae.Visits["female"],total:0};$e["total"]=$e["male"]+$e["female"];Oe["total"]=Oe["male"]+Oe["female"];xe["total"]=xe["male"]+xe["female"];ke["total"]=ke["male"]+ke["female"];Je["total"]=Je["male"]+Je["female"];Be["total"]=Be["male"]+Be["female"];Ie["total"]=Ie["male"]+Ie["female"];Pe["total"]=Pe["male"]+Pe["female"];Le["total"]=Le["male"]+Le["female"];Xe["total"]=Xe["male"]+Xe["female"];qe["total"]=qe["male"]+qe["female"];We["total"]=We["male"]+We["female"];var je=new App.Views.TrendActivityReport;je.data=oe;je.startDate=S.startkey;je.endDate=S.endkey;je.CommunityName=r;je.render();App.$el.children(".body").html(je.el);$("#trend-report-div-total-members").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Registered Members Past 12 Months"},xAxis:{categories:[re[R.getMonth()]+" "+R.getFullYear(),re[b.getMonth()]+" "+b.getFullYear(),re[D.getMonth()]+" "+D.getFullYear(),re[y.getMonth()]+" "+y.getFullYear(),re[M.getMonth()]+" "+M.getFullYear(),re[h.getMonth()]+" "+h.getFullYear(),re[p.getMonth()]+" "+p.getFullYear(),re[g.getMonth()]+" "+g.getFullYear(),re[u.getMonth()]+" "+u.getFullYear(),re[s.getMonth()]+" "+s.getFullYear(),re[i.getMonth()]+" "+i.getFullYear(),re[l.getMonth()]+" "+l.getFullYear()]},yAxis:{min:0,title:{text:"Members Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[Ce["male"],Ae["male"],Te["male"],Se["male"],Ne["male"],_e["male"],Re["male"],Ve["male"],be["male"],Fe["male"],De["male"],we["male"]],color:"#33ccff"},{name:"Females",data:[Ce["female"],Ae["female"],Te["female"],Se["female"],Ne["female"],_e["female"],Re["female"],Ve["female"],be["female"],Fe["female"],De["female"],we["female"]],color:"#66ff66"},{name:"Total",data:[Ce["total"],Ae["total"],Te["total"],Se["total"],Ne["total"],_e["total"],Re["total"],Ve["total"],be["total"],Fe["total"],De["total"],we["total"]],color:"#ff9900"}]});$("#trend-report-div-total-member-visits").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Visits Past 12 Months"},xAxis:{categories:[re[R.getMonth()]+" "+R.getFullYear(),re[b.getMonth()]+" "+b.getFullYear(),re[D.getMonth()]+" "+D.getFullYear(),re[y.getMonth()]+" "+y.getFullYear(),re[M.getMonth()]+" "+M.getFullYear(),re[h.getMonth()]+" "+h.getFullYear(),re[p.getMonth()]+" "+p.getFullYear(),re[g.getMonth()]+" "+g.getFullYear(),re[u.getMonth()]+" "+u.getFullYear(),re[s.getMonth()]+" "+s.getFullYear(),re[i.getMonth()]+" "+i.getFullYear(),re[l.getMonth()]+" "+l.getFullYear()]},yAxis:{min:0,title:{text:"Visits Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[We["male"],qe["male"],Xe["male"],Le["male"],Pe["male"],Ie["male"],Be["male"],Je["male"],ke["male"],xe["male"],Oe["male"],$e["male"]],color:"#33ccff"},{name:"Females",data:[We["female"],qe["female"],Xe["female"],Le["female"],Pe["female"],Ie["female"],Be["female"],Je["female"],ke["female"],xe["female"],Oe["female"],$e["female"]],color:"#66ff66"},{name:"Total",data:[We["total"],qe["total"],Xe["total"],Le["total"],Pe["total"],Ie["total"],Be["total"],Je["total"],ke["total"],xe["total"],Oe["total"],$e["total"]],color:"#ff9900"}]});$("#trend-report-div-new-memberships").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Active Members This Month"},xAxis:{categories:[re[R.getMonth()]+" "+R.getFullYear(),re[b.getMonth()]+" "+b.getFullYear(),re[D.getMonth()]+" "+D.getFullYear(),re[y.getMonth()]+" "+y.getFullYear(),re[M.getMonth()]+" "+M.getFullYear(),re[h.getMonth()]+" "+h.getFullYear(),re[p.getMonth()]+" "+p.getFullYear(),re[g.getMonth()]+" "+g.getFullYear(),re[u.getMonth()]+" "+u.getFullYear(),re[s.getMonth()]+" "+s.getFullYear(),re[i.getMonth()]+" "+i.getFullYear(),re[l.getMonth()]+" "+l.getFullYear()]},yAxis:{min:0,title:{text:"Members Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[ye["male"],Ye["male"]-ye["male"],Me["male"]-Ye["male"],ve["male"]-Me["male"],he["male"]-ve["male"],ce["male"]-he["male"],pe["male"]-ce["male"],de["male"]-pe["male"],ge["male"]-de["male"],fe["male"]-ge["male"],ue["male"]-fe["male"],ie["male"]-ue["male"]],color:"#33ccff"},{name:"Females",data:[ye["female"],Ye["female"]-ye["female"],Me["female"]-Ye["female"],ve["female"]-Me["female"],he["female"]-ve["female"],ce["female"]-he["female"],pe["female"]-ce["female"],de["female"]-pe["female"],ge["female"]-de["female"],fe["female"]-ge["female"],ue["female"]-fe["female"],ie["female"]-ue["female"]],color:"#66ff66"},{name:"Total",data:[ye["total"],Ye["total"]-ye["total"],Me["total"]-Ye["total"],ve["total"]-Me["total"],he["total"]-ve["total"],ce["total"]-he["total"],pe["total"]-ce["total"],de["total"]-pe["total"],ge["total"]-de["total"],fe["total"]-ge["total"],ue["total"]-fe["total"],ne["total"]-ue["total"]],color:"#ff9900"}]});$("#trend-report-div-visits").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Member Visits This Month"},xAxis:{categories:[re[R.getMonth()]+" "+R.getFullYear(),re[b.getMonth()]+" "+b.getFullYear(),re[D.getMonth()]+" "+D.getFullYear(),re[y.getMonth()]+" "+y.getFullYear(),re[M.getMonth()]+" "+M.getFullYear(),re[h.getMonth()]+" "+h.getFullYear(),re[p.getMonth()]+" "+p.getFullYear(),re[g.getMonth()]+" "+g.getFullYear(),re[u.getMonth()]+" "+u.getFullYear(),re[s.getMonth()]+" "+s.getFullYear(),re[i.getMonth()]+" "+i.getFullYear(),re[l.getMonth()]+" "+l.getFullYear()]},yAxis:{min:0,title:{text:"Visits Count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[le.Visits["male"],ae.Visits["male"],te.Visits["male"],ee.Visits["male"],Z.Visits["male"],Q.Visits["male"],K.Visits["male"],U.Visits["male"],E.Visits["male"],z.Visits["male"],G.Visits["male"],H.Visits["male"]],color:"#33ccff"},{name:"Females",data:[le.Visits["female"],ae.Visits["female"],te.Visits["female"],ee.Visits["female"],Z.Visits["female"],Q.Visits["female"],K.Visits["female"],U.Visits["female"],E.Visits["female"],z.Visits["female"],G.Visits["female"],H.Visits["female"]],color:"#66ff66"},{name:"Total",data:[le.Visits["male"]+le.Visits["female"],ae.Visits["male"]+ae.Visits["female"],te.Visits["male"]+te.Visits["female"],ee.Visits["male"]+ee.Visits["female"],Z.Visits["male"]+Z.Visits["female"],Q.Visits["male"]+Q.Visits["female"],K.Visits["male"]+K.Visits["female"],U.Visits["male"]+U.Visits["female"],E.Visits["male"]+E.Visits["female"],z.Visits["male"]+z.Visits["female"],G.Visits["male"]+G.Visits["female"],H.Visits["male"]+H.Visits["female"]],color:"#ff9900"}]});$("#trend-report-div-total-resource-views-this-month").highcharts({chart:{type:"column",borderColor:"#999999",borderWidth:2,borderRadius:10},title:{text:"Total Resource Views This Month"},xAxis:{categories:[re[R.getMonth()]+" "+R.getFullYear(),re[b.getMonth()]+" "+b.getFullYear(),re[D.getMonth()]+" "+D.getFullYear(),re[y.getMonth()]+" "+y.getFullYear(),re[M.getMonth()]+" "+M.getFullYear(),re[h.getMonth()]+" "+h.getFullYear(),re[p.getMonth()]+" "+p.getFullYear(),re[g.getMonth()]+" "+g.getFullYear(),re[u.getMonth()]+" "+u.getFullYear(),re[s.getMonth()]+" "+s.getFullYear(),re[i.getMonth()]+" "+i.getFullYear(),re[l.getMonth()]+" "+l.getFullYear()]},yAxis:{min:0,title:{text:"Resource count"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td>'+'<td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:true,useHTML:true},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Males",data:[le.ResourceViews["male"],ae.ResourceViews["male"],te.ResourceViews["male"],ee.ResourceViews["male"],Z.ResourceViews["male"],Q.ResourceViews["male"],K.ResourceViews["male"],U.ResourceViews["male"],E.ResourceViews["male"],z.ResourceViews["male"],G.ResourceViews["male"],H.ResourceViews["male"]],color:"#33ccff"},{name:"Females",data:[le.ResourceViews["female"],ae.ResourceViews["female"],te.ResourceViews["female"],ee.ResourceViews["female"],Z.ResourceViews["female"],Q.ResourceViews["female"],K.ResourceViews["female"],U.ResourceViews["female"],E.ResourceViews["female"],z.ResourceViews["female"],G.ResourceViews["female"],H.ResourceViews["female"]],color:"#66ff66"},{name:"Total",data:[le.ResourceViews["male"]+le.ResourceViews["female"],ae.ResourceViews["male"]+ae.ResourceViews["female"],te.ResourceViews["male"]+te.ResourceViews["female"],ee.ResourceViews["male"]+ee.ResourceViews["female"],Z.ResourceViews["male"]+Z.ResourceViews["female"],Q.ResourceViews["male"]+Q.ResourceViews["female"],K.ResourceViews["male"]+K.ResourceViews["female"],U.ResourceViews["male"]+U.ResourceViews["female"],E.ResourceViews["male"]+E.ResourceViews["female"],z.ResourceViews["male"]+z.ResourceViews["female"],G.ResourceViews["male"]+G.ResourceViews["female"],H.ResourceViews["male"]+H.ResourceViews["female"]],color:"#ff9900"}]})})},renderNav:function(){var e=this.getConfigurations();if($.cookie("Member._id")){var t=new App.Views.navBarView({isLoggedIn:"1",type:e.get("type")})}else{var t=new App.Views.navBarView({isLoggedIn:"0"})}$("div.navbar-collapse").html(t.el)},checkLoggedIn:function(){if(!$.cookie("Member._id")){if($.url().attr("fragment")!="login"&&$.url().attr("fragment")!=""&&$.url().attr("fragment")!="landingPage"&&$.url().attr("fragment")!="becomemember"){Backbone.history.stop();App.start()}}else{var e=$.cookie("Member.expTime");var t=new Date(Date.parse(e));var a=Math.abs(new Date-t);var l=72e5;if(a<l){var o=new Date;$.cookie("Member.expTime",o,{path:"/apps/_design/bell"});$.cookie("Member.expTime",o,{path:"/apps/_design/bell"})}else{this.expireSession();Backbone.history.stop();App.start()}}},getConfigurations:function(){var e=new App.Collections.Configurations;e.fetch({async:false});var t=e.first();return t},addCourses:function(e){var t=new App.Views.courseSeach;t.publicationId=e;t.render();App.$el.children(".body").html(t.el)},Dashboard:function(){var e=this.getConfigurations();if(e.get("type")=="community"){this.cummunityManage();return}var t=new App.Views.Dashboard;App.$el.children(".body").html(t.el);t.render();var a=new App.Collections.Community({limit:3});a.fetch({async:false});console.log(a);a.each(function(e){$("#communities tbody").append('<tr class="success"><td>'+e.toJSON().Name+"</td></tr>")});$("#communities").append('<tr ><td><a class="btn btn-default" href="#listCommunity" id="clickmore">Click for more</a></td></tr>');var l=new App.Collections.Publication;l.getlast=true;l.fetch({success:function(e,t){_.each(t.results,function(e){if(e.doc.IssueNo!=undefined){$("#publications tbody").append('<tr class="info"><td>Issue :'+e.doc.IssueNo+"</td></tr>")}else{$("#publications tbody").append('<tr class="info"><td>Issue Deleted</td></tr>')}})},async:false});$("#publications").append('<tr ><td><a class="btn btn-default" href="#publication" id="clickmore">Click for more</a></td></tr>')},cummunityManage:function(){App.$el.children(".body").html("");App.$el.children(".body").append('<a href="#configuration"><button class="btn btn-hg btn-primary" id="configbutton">Configurations</button></a>');App.$el.children(".body").append('<button class="btn btn-hg btn-primary" onclick=SyncDbSelect() id="sync">Sync With Nation</button>')},CommunityForm:function(e){this.modelForm("Community",e,"login")},viewAllFeedback:function(){var e=new App.Collections.siteFeedbacks;e.fetch({async:false});feedul=new App.Views.siteFeedbackPage({collection:e});feedul.render();$("#see-all",feedul.$el).trigger("click");App.$el.children(".body").html("&nbsp");App.$el.children(".body").append(feedul.el);$("#previousButton").hide();$("#progress_img").hide()},modelForm:function(e,t,a){var l=new App.Models[e];var o=new App.Views["CommunityForm"]({model:l});App.$el.children(".body").html("");App.$el.children(".body").append(o.el);l.once("Model:ready",function(){o.on(e+"Form:done",function(){Backbone.history.navigate(a,{trigger:true})});o.render()});if(t){l.id=t;l.once("sync",function(){l.trigger("Model:ready")});l.fetch({async:false})}else{l.trigger("Model:ready")}},MemberLogin:function(){if($.cookie("Member._id")){Backbone.history.navigate("listCommunity",{trigger:true});return}var e=new App.Models.Credentials;var t=new App.Views.MemberLoginForm({model:e});t.once("success:login",function(){window.location.href="../MyApp/index.html#dashboard"});t.render();App.$el.children(".body").html(t.el);$("ul.nav").html($("#template-nav-log-in").html()).hide()},MemberLogout:function(){this.expireSession();Backbone.history.navigate("login",{trigger:true})},expireSession:function(){$.removeCookie("Member.login",{path:"/apps/_design/bell"});$.removeCookie("Member._id",{path:"/apps/_design/bell"});$.removeCookie("Member.expTime",{path:"/apps/_design/bell"})},ListCommunity:function(){App.startActivityIndicator();var e=new App.Collections.Community;e.fetch({success:function(){CommunityTable=new App.Views.CommunitiesTable({collection:e});CommunityTable.render();var t="<h3> Communities  |  <a  class='btn btn-success' id='addComm' href='#addCommunity'>Add Community</a>  </h3><p>*The Total Member Visits and Total Resource Views columns contain data of the current month only</p>";t+="<div id='list-of-Communities'></div>";App.$el.children(".body").html(t);$("#list-of-Communities",App.$el).append(CommunityTable.el)}});App.stopActivityIndicator()},earthRequest:function(){var e="<div id='listRequest-head'> <p class='heading'> <a href='#' style='color:#1ABC9C'>Earth Request</a>  |   <a href='#request'>Communities Request</a> </p> </div>";e+="<div style='width:940px;margin:0 auto' id='listReq'></div>";App.$el.children(".body").html(e)},commRequest:function(){var e="<div id='listRequest-head'> <p class='heading'> <a href='#earthrequest' >Earth Request</a>  |   <a href='#request' style='color:#1ABC9C'>Communities Request</a> </p> </div>";e+="<div style='width:940px;margin:0 auto' id='listReq'></div>";App.$el.children(".body").html(e);App.startActivityIndicator();var t=new App.Collections.CourseRequest;t.fetch({async:false});var a=new App.Collections.ResourceRequest;a.fetch({async:false});t.add(a.toJSON(),{silent:true});var l=new App.Views.RequestsTable({collection:t});l.render();App.$el.children(".body").append(l.el);App.stopActivityIndicator()},Reports:function(e){App.startActivityIndicator();var t=new App.Models.Member({_id:$.cookie("Member._id")});t.fetch({async:false});var a=t.get("roles");$("ul.nav").html($("#template-nav-logged-in").html()).show();$("#itemsinnavbar").html($("#template-nav-logged-in").html());var l=new App.Collections.Reports;l.fetch({async:false});var o=new App.Views.ReportsTable({collection:l});o.isManager=a.indexOf("Manager");o.render();App.$el.children(".body").html("");if(a.indexOf("Manager")>-1){App.$el.children(".body").append('<p><a class="btn btn-success" href="#reports/add">Add a new Report</a>'+'<a style="margin-left:20px" class="btn btn-success" href="#trendreport">Trend Activity Report</a></p>')}var r=$.url().attr("host").split(".");r=r[0].substring(3);if(r.length==0){r=r+"Nation"}App.$el.children(".body").append('<h4><span style="color:gray;">'+r+"</span> | Reports</h4>");App.$el.children(".body").append(o.el);App.stopActivityIndicator()},ReportForm:function(e){var t=e?new App.Models.NationReport({_id:e}):new App.Models.NationReport;t.on("processed",function(){Backbone.history.navigate("report",{trigger:true})});var a=new App.Views.ReportForm({model:t});App.$el.children(".body").html(a.el);if(t.id){App.listenToOnce(t,"sync",function(){a.render()});t.fetch()}else{a.render()}},Publication:function(){App.startActivityIndicator();var e=new App.Collections.Publication;e.fetch({async:false});var t=new App.Views.Publication;t.render();App.$el.children(".body").html(t.el);var a=new App.Views.PublicationTable({collection:e});a.render();App.$el.children(".body").append(a.el);App.stopActivityIndicator()},PublicationDetails:function(e){var t=new App.Models.Publication({_id:e});t.fetch({async:false});var a=t.get("resources");var l=t.get("courses");App.$el.children(".body").html('<div style="margin-top:10px"><h6 style="float:left;">Issue No.'+t.get("IssueNo")+'</h6> <a class="btn btn-success" style="margin-left:20px" href="#courses/'+e+'">Add Course</a> <a class="btn btn-success" href = "../MyApp/index.html#search-bell/'+e+'" style="float:left;margin-left:20px;margin-bottom:10px;">Add Resource</a><button class="btn btn-info" style="float:left;margin-left:20px" onclick=SelectCommunity("'+e+'")>Send Publication</button></div>');var o="";_.each(a,function(e){o+='"'+e+'",'});if(o!="")o=o.substring(0,o.length-1);var r=new App.Collections.Resources;r.keys=encodeURI(o);r.fetch({async:false});var i=new App.Views.PublicationResourceTable({collection:r});i.Id=e;i.render();App.$el.children(".body").append(i.el);var m="";_.each(l,function(e){m+='"'+e["courseID"]+'",'});if(m!="")m=m.substring(0,m.length-1);var s=new App.Collections.Courses;s.keys=encodeURI(m);s.fetch({async:false});var n=new App.Views.PublicationCoursesTable({collection:s});n.Id=e;n.render();App.$el.children(".body").append(n.el)},PublicationForm:function(e){var t=e?new App.Models.Publication({_id:e}):new App.Models.Publication;t.on("processed",function(){Backbone.history.navigate("publication",{trigger:true})});var a=new App.Views.PublicationForm({model:t});App.$el.children(".body").html(a.el);if(t.id){t.fetch({success:function(e){if(t.get("kind")=="CoursePublication"){a.rlength=t.get("courses").length}else{if(t.get("resources")!=null)a.rlength=t.get("resources").length}},async:false});a.render()}else{a.rlength=0;a.render()}$(".bbf-form .field-Date input").attr("disabled",true);if(!t.id){$(".bbf-form .field-IssueNo input").val("")}var l=new Date;$(".bbf-form .field-Date input").datepicker({todayHighlight:true});$(".bbf-form .field-Date input",this.el).datepicker("setDate",l);$(".bbf-form .field-Date input").datepicker({todayHighlight:true})},SelectCommunities:function(e){$("#invitationdiv").fadeIn(1e3);var t=new App.Views.listCommunityView;t.pId=e;t.render();$("#invitationdiv").html("&nbsp");$("#invitationdiv").append(t.el);var a=new App.Collections.Community;a.fetch({async:false});a.each(function(e){$("#comselect").append("<option value='"+e.get("Name")+"'>"+e.get("Name")+"</option>")})},SyncDbSelect:function(){$("#invitationdiv").fadeIn(1e3);var e=new App.Views.listSyncDbView;e.render();$("#invitationdiv").html("&nbsp");$("#invitationdiv").append(e.el)}}))});