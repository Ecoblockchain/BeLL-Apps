$(function(){App.Views.TrendActivityReport=Backbone.View.extend({vars:{},events:{},template:$("#template-TrendActivityReport").html(),initialize:function(){},render:function(){var e=this;e.vars=e.data;e.vars.startDate=e.startDate;e.vars.endDate=e.endDate;e.vars.CommunityName=e.CommunityName;e.vars.lastActivitySyncDate=e.lastActivitySyncDate;e.$el.html(_.template(e.template,e.vars))}})});$(function(){App.Views.CommunityForm=Backbone.View.extend({className:"addNation-form",vars:{},events:{"click #formButton":function(){document.getElementById("addCommunity").submit()},"submit form":"setForm"},template:$("#template-addCommunity").html(),render:function(){var e=this.model;this.$el.append(_.template(this.template,this.vars));if(this.model.id!=undefined){buttonText="Update";$("#nation-name").val(e.get("Name"));$("#community-code").val(e.get("Code"));$("#nation-url").val(e.get("Url"));$("#org-name").val(e.get("SponserName"));$("#org-sponseraddress").val(e.get("SponserAddress"));$("#org-firstname").val(e.get("ContactFirstname"));$("#org-middlename").val(e.get("ContactMiddlename"));$("#org-lastname").val(e.get("ContactLastname"));$("#org-phone").val(e.get("ContactPhone"));$("#org-email").val(e.get("ContactEmail"));$("#leader-firstname").val(e.get("LeaderFirstname"));$("#leader-middlename").val(e.get("LeaderMiddlename"));$("#leader-lastname").val(e.get("LeaderLastname"));$("#leader-phone").val(e.get("LeaderPhone"));$("#leader-email").val(e.get("LeaderEmail"));$("#leader-ID").val(e.get("LeaderId"));$("#leader-password").val(e.get("LeaderPassword"));$("#urg-name").val(e.get("UrgentName"));$("#urg-phone").val(e.get("UrgentPhone"));$("#auth-name").val(e.get("AuthName"));$("#auth-date").val(e.get("AuthDate"))}var t=this},setForm:function(){this.model.set({Name:$("#nation-name").val(),Code:$("#community-code").val(),Url:$("#nation-url").val(),SponserName:$("#org-name").val(),SponserAddress:$("#org-sponseraddress").val(),ContactFirstname:$("#org-firstname").val(),ContactMiddlename:$("#org-middlename").val(),ContactLastname:$("#org-lastname").val(),ContactPhone:$("#org-phone").val(),ContactEmail:$("#org-email").val(),LeaderFirstname:$("#leader-firstname").val(),LeaderMiddlename:$("#leader-middlename").val(),LeaderLastname:$("#leader-lastname").val(),LeaderPhone:$("#leader-phone").val(),LeaderEmail:$("#leader-email").val(),LeaderId:$("#leader-ID").val(),LeaderPassword:$("#leader-password").val(),UrgentName:$("#urg-name").val(),UrgentPhone:$("#urg-phone").val(),AuthName:$("#auth-name").val(),AuthDate:$("#auth-date").val()});var e=this;$.ajax({url:'/community/_design/bell/_view/isDuplicateName?include_docs=true&key="'+e.model.get("Name")+'"',type:"GET",dataType:"json",async:false,success:function(t){if(t.rows.length>1){alert("Community has duplicates in the database. Please delete other copies and retry.");return}else if(t.rows.length===0){e.model.save();alert("Successfully Saved");App.startActivityIndicator();Backbone.history.navigate("listCommunity",{trigger:true});App.stopActivityIndicator()}else{var i=t.rows[0].doc;if(e.model.id&&e.model.id===i._id){e.model.save();alert("Successfully Saved");App.startActivityIndicator();Backbone.history.navigate("listCommunity",{trigger:true});App.stopActivityIndicator()}else{alert("Community 'Name' you entered is a duplicate. Please try again with a different name.")}}},error:function(){alert("There was an error in getting a response from the server. Please try again.")}})}})});$(function(){App.Views.ConfigurationView=Backbone.View.extend({template:$("#template-Configuration").html(),template:_.template($("#template-Configuration").html()),vars:{},events:{"click #saveLanguage":function(e){var t=false;var i=$("#languageSelection").val();if(i!=""){this.model.set("currentLanguage",i);t=true}if($("#appversion").val()!=""){this.model.set("version",$("#appversion").val());t=true}if($("#notes").val()!=""){this.model.set("notes",$("#notes").val());t=true}if(t){var n=this;console.log(this.model.toJSON());this.model.save(null,{success:function(e,t){n.model.set("_rev",e.get("rev"))}});alert("Configuration saved.")}else{alert("You have not changed any thing.")}}},render:function(){this.vars=this.model.toJSON();this.$el.html(this.template(this.vars));this.$el.append('<br>&nbsp;&nbsp;<button class="btn btn-success" id="saveLanguage" >Save</button>')}})});$(function(){App.Views.navBarView=Backbone.View.extend({tagName:"ul",className:"nav",authorName:null,template1:_.template($("#template-nav-logged-in").html()),template0:_.template($("#template-nav-log-in").html()),template2:_.template($("#template-nav-logged-in-cummunity").html()),initialize:function(e){if(e.isLoggedIn==0){this.template=this.template0}else{this.template=this.template1;if(e.type=="community"){this.template=this.template2}}var t=Backbone.history.location.href;t=t.split("#");this.data={uRL:t[1]};this.$el.append(this.template(this.data))},render:function(){}})});$(function(){App.Views.MemberLoginForm=Backbone.View.extend({template:$("#template-login").html(),vars:{},className:"form",events:{"click #formButton":"setForm","submit form":"setFormFromEnterKey"},render:function(){this.$el.html(_.template(this.template,this.vars));var e=$('<button class="btn btn-success" style="background-color:#34495e" id="formButton">Sign In</button>');$("#submit-button",this.$el).append(e)},setFormFromEnterKey:function(e){e.preventDefault();this.setForm()},setForm:function(){var e=this;var t=$("#username").val();var i=$("#password").val();$.getJSON('/members/_design/bell/_view/MembersByLogin?include_docs=true&key="'+t+'"',function(t){if(t.rows[0]){if(t.total_rows>0&&t.rows[0].doc.password==i){if(t.rows[0].doc.status=="active"){var n=new Date;$.cookie("Member.login",t.rows[0].doc.login,{path:"/apps/_design/bell"});$.cookie("Member._id",t.rows[0].doc._id,{path:"/apps/_design/bell"});$.cookie("Member.expTime",n,{path:"/apps/_design/bell"});if($.inArray("student",t.rows[0].doc.roles)!=-1){if(t.rows[0].doc.roles.length<2){alert("You are not authorized to sign in")}else{e.trigger("success:login")}}else{e.trigger("success:login")}}else{alert("Your account is deactivated")}}else{alert("Login or Password Incorrect")}}else{alert("Login or Password Incorrect")}})}})});$(function(){App.Views.CommunitiesTable=Backbone.View.extend({tagName:"table",className:"table table-striped",vars:{},addOne:function(e){if(e.get("_id")!=="_design/bell"){var t=new App.Views.CommunityRow({model:e});t.render();this.$el.append(t.el)}},addAll:function(){this.collection.each(this.addOne,this)},render:function(){this.$el.append('<tr><th>Community</th><th>Last App <br>Update</th><th>Version No.</th><th>Last Publications <br>Sync</th><th>Last Activities <br>Sync</th><th>Total Member <br>Visits</th><th>Total Resource <br>Views</th></th><th colspan="2">Actions</th></tr>');this.addAll()}})});$(function(){App.Views.CommunityRow=Backbone.View.extend({tagName:"tr",events:{"click .destroy":function(e){if(confirm("Are you sure you want to delete this Community?")){e.preventDefault();this.model.destroy();this.remove()}else{e.preventDefault();App.startActivityIndicator();Backbone.history.navigate("listCommunity",{trigger:true});App.stopActivityIndicator()}},"click .browse":function(e){e.preventDefault();$("#modal").modal({show:true})}},initialize:function(){},render:function(){var e=this;var t=this.model;var i="";var n=t.attributes.Code;var s=t.get("Name");var a=t.get("lastActivitiesSyncDate");var o=a.split("/").join("-");i=n+"."+s;var l=$.url().data.attr.host.split(".");var r=l[0];var c=$.url().data.attr.authority;var d=new Date;var p=new Date(d.getFullYear(),d.getMonth(),1);var u=new Date(d.getFullYear(),d.getMonth()+1,0);var h=e.changeDateFormat(e.turnDateToYYYYMMDDFormat(p));var m=e.changeDateFormat(e.turnDateToYYYYMMDDFormat(u));$.ajax({url:"http://"+r+":oleoleole@"+c+'/activitylog/_design/bell/_view/getDocByCommunityCodeWithValue?_include_docs=true&&startkey=["'+n+'","'+h+'"]&endkey=["'+n+'","'+m+'"]',type:"GET",dataType:"jsonp",success:function(i){var n=0;var s=0;var a;a=i.rows;if(a.length>0){n=0;s=0;for(var l=0;l<a.length;l++){var r=a[l].value.female_visits;var c=a[l].value.male_visits;console.log(r+" "+c);n=n+r+c;console.log("Female Visits: "+r+" "+"Male Visits: "+c+" "+"Total: "+r+c);var d=a[l].value.female_opened;var p=a[l].value.male_opened;var u=0;var h=0;for(var m=0;m<d.length;m++){u=u+d[m]}for(var f=0;f<p.length;f++){h=h+p[f]}s=s+u+h;console.log("resource views: "+s)}}var v="<td>"+t.get("Name")+"</td><td>"+t.get("lastAppUpdateDate")+"</td><td>"+t.get("version")+"</td><td>"+t.get("lastPublicationsSyncDate")+"</td><td>"+t.get("lastActivitiesSyncDate")+"</td><td>"+n+"</td><td>"+s+"</td>"+"<td><a  class='btn btn-success' id='submit' href='#communityreport/"+o+"/"+t.get("Name")+"/"+t.get("Code")+"'>Generate Report</a>&nbsp&nbsp&nbsp<a role='button' class='btn btn-info' href='#addCommunity/"+t.get("_id")+"'> <i class='icon-pencil icon-white'></i>Edit</a>&nbsp&nbsp&nbsp<a role='button' class='btn btn-danger destroy' href='#addCommunity/"+t.get("_id")+"'> <i class='icon-remove icon-white'></i>Delete</a></td>";e.$el.append(v)},error:function(){console.log("Unable to get communities list.")}})},turnDateToYYYYMMDDFormat:function(e){var t=e.getFullYear().toString();var i=(e.getMonth()+1).toString();var n=e.getDate().toString();var s=i.split("");var a=n.split("");var o=t+"/"+(s.length===2?i:"0"+s[0])+"/"+(a.length===2?n:"0"+a[0]);return o},changeDateFormat:function(e){var t=e.match(/\d+/g),i=t[0],n=t[1],s=t[2];return i+"/"+n+"/"+s}})});$(function(){App.Views.Dashboard=Backbone.View.extend({template:$("#template-Dashboard").html(),vars:{},render:function(){var e=new App.Collections.Configurations;e.fetch({async:false});var t=e.first();var i=this;this.vars.imgURL="img/header_slice.png";var n=new App.Collections.MailUnopened({receiverId:$.cookie("Member._id")});n.fetch({async:false});this.vars.type=t.get("type");this.vars.mails=n.length;this.$el.html(_.template(this.template,this.vars));$(".now").html(moment().format("dddd | DD MMMM, YYYY"));var s=new App.Models.Member;s.id=$.cookie("Member._id");s.on("sync",function(){var e="/members/"+s.id+"/";if(typeof s.get("_attachments")!=="undefined"){e=e+_.keys(s.get("_attachments"))[0];document.getElementById("imgurl").src=e}var t;var i=new App.Collections.Configurations;i.fetch({async:false,success:function(){t=i.first().attributes.name}});t=t.charAt(0).toUpperCase()+t.slice(1);var n=i.first().attributes.type;if(n==="nation"){t=t+" Nation Bell"}else{t=t+" Community Bell"}$(".bellLocation").html(t);if(!s.get("visits")){s.set("visits",1);s.save()}if(parseInt(s.get("visits"))==0){temp="Error!!"}else{temp=s.get("visits")+" visits"}var a="&nbsp;-&nbsp;";var o=0;if(s.get("roles").indexOf("Learner")!=-1){a=a+"Learner";o=1}if(s.get("roles").indexOf("Leader")!=-1){if(o==1){a=a+",&nbsp;"}a=a+"Leader";o=1}if(s.get("roles").indexOf("Manager")!=-1){if(o==1){a=a+",&nbsp;"}a=a+"Manager"}$(".visits").html(temp);$(".name").html(s.get("firstName")+" "+s.get("lastName")+'<span style="font-size:15px;">'+a+"</span>"+'&nbsp;<a href="../MyApp/index.html#member/edit/'+$.cookie("Member._id")+'"><i class="fui-gear"></i></a>')});s.fetch()}})});$(function(){App.Views.siteFeedback=Backbone.View.extend({tagName:"div",id:"site-feedback",authorName:null,initialize:function(){},events:{"click #formButton":"setForm","click #CancelButton":"cancelform","click #ViewAllButton":"gotoRoute"},gotoRoute:function(){var e=Backbone.history.location.href;e=e.split("#");var t=e[1].split("/");var i="LMS:"+t[0];for(var n=1;n<t.length;n++){if(t[n].length!=32){i=i+"/"+t[n]}else{n=e.length}}url=i;Backbone.history.navigate("siteFeedback",{trigger:true})},cancelform:function(){$("#site-feedback").animate({height:"toggle"});this.unsetForm()},setForm:function(){if($("#comment").val().length!=0&&$('input[name="category"]:checked').val()){var e=Backbone.history.location.href;var t=new Date;t.getDate();e=e.split("#");var i="";if($("#priority").is(":checked")){i="urgent"}this.model.set({comment:$("#comment").val(),category:$('input[name="category"]:checked').val(),priority:i,PageUrl:"Nation:"+e[1],Resolved:"0",memberLogin:$.cookie("Member.login"),time:t.toString()});this.model.save();alert("Feedback Successfully Sent");this.unsetForm()}$("#site-feedback").animate({height:"toggle"})},unsetForm:function(){$("#comment",this.$el).val("");$('input[name="category"]').attr("checked",false);$("#priority").attr("checked",false)},render:function(){this.$el.append('<br/><br/><div class="form-field" ><input name="PageUrl" id="PageUrl" type="text"></div>');this.$el.append('<div class="form-field" style="margin-left:23px;"><input name="priority" value="urgent" id="priority" type="checkbox"><label for="priority">urgent</label></div>');this.$el.append('<div class="form-field" style="margin-top: -28px;margin-left: 115px;"> <input type="radio" name="category" value="Bug">&nbsp Bug &nbsp&nbsp&nbsp<input type="radio" name="category" value="Question">&nbsp Question &nbsp&nbsp&nbsp<input type="radio" name="category" value="Suggestion">&nbsp Suggestion &nbsp&nbsp&nbsp</div><br/><br/>');this.$el.append('<div class="form-field" style="margin-left:23px;"><textarea �rows="7" type="text" name="comment" id="comment"></textarea></div>');this.$el.append('<div class="form-field"><input name="Resolved" id="Resolved" type="text"></div>');this.$el.append('<div class="form-field"><input name="memberLogin" id="memberLogin" type="text"></div>');this.$el.append('<div class="form-field"><input name="time" id="time" type="text"></div>');$("#PageUrl",this.$el).hide();$("#Resolved",this.$el).hide();$("#memberLogin",this.$el).hide();$("#time",this.$el).hide();var e=$('<br/><div id="f-formButton"><button class="btn btn-hg btn-danger" id="CancelButton">Cancel</button><button class="btn btn-hg btn-info" id="ViewAllButton">View</button><button class="btn btn-hg btn-primary" id="formButton">Submit</button></div>');this.$el.append(e)}})});$(function(){App.Views.siteFeedbackPage=Backbone.View.extend({tagName:"table",className:" table-feedback notification-table table-striped",authorName:null,searchText:null,Resolved:null,stack:null,category:null,urgent:null,applyFilters:null,resultArray:null,events:{"click #see-all":function(e){this.applyFilters="0";while(skipStack.length>0){skipStack.pop()}searchText="";this.resultArray=[];skip=0;skipStack.push(skip);this.fetchRecords()},"click #switch":function(e){this.applyFilters="1";this.category=$("#select_category").val();this.urgent=$("#select_urgent").val();if($("#select_status").val()=="Resolved"){this.Resolved="1"}else{this.Resolved="0"}while(skipStack.length>0){skipStack.pop()}searchText="";this.resultArray=[];skip=0;skipStack.push(skip);this.fetchRecords()},"click #search_feedback":function(e){this.applyFilters="0";searchText=$("#searchText").val();if(searchText!=""){while(skipStack.length>0){skipStack.pop()}this.resultArray=[];skip=0;skipStack.push(skip);this.fetchRecords()}},"click #previousButton":function(e){if(skipStack.length>1){skipStack.pop();skip=skipStack.pop();skipStack.push(skip);this.resultArray=[];this.fetchRecords()}else{$("#previousButton").hide()}},"click #next_button":function(e){skipStack.push(skip);this.resultArray=[];this.fetchRecords()}},initialize:function(){this.resultArray=[];this.category="Bug";this.Resolved="1";this.applyFilters="0";this.searchText="";if(url=="unknown"){url="siteFeedback"}if($("#comments")==null){alert($("#comments"));$("#debug").append('<div id="comments"></div>')}},addAll:function(){this.$el.html('<h4>Keyword:&nbsp;<input class="form-control" type="text" placeholder="Search in comment" value="" size="30" id="searchText" style="height:24px;margin-top:1%;"></input>&nbsp;<span><button class="btn btn-info" id="search_feedback">Search</button>&nbsp;<button class="btn btn-info" id="see-all">See All</button></span>&nbsp;<img id="progress_img" src="vendor/progress.gif" width="3%"></h4><br/>');this.$el.append('<Select id="select_category"><option>Bug</option><option>Question</option><option>Suggestion</option></select>&nbsp;&nbsp<select id="select_status"><option>Unresolve</option><option>Resolved</option></select>&nbsp;&nbsp<select id="select_urgent"><option>Normal</option><option>Urgent</option></select>&nbsp;&nbsp<button class="btn btn-info" id="switch">Apply Filters</button><br/><br/>');this.$el.append("<th ><h4>Feedback</h4></th><th ><h4>Status</h4></th>");$("#progress_img").hide();console.log(this.collection.toJSON());this.collection.forEach(this.addOne,this);this.$el.append('<br/><br/><input type="button" class="btn btn-hg btn-primary" id="previousButton" value="< Previous"> &nbsp;&nbsp;&nbsp;<button class="btn btn-hg btn-primary" id="next_button" >Next  ></button>')},addOne:function(e){if(!e.get("category")){e.set("category","Bug")}if(!e.get("priority")){e.set("priority",[])}var t=new App.Views.siteFeedbackPageRow({model:e});t.render();this.$el.append(t.el)},render:function(){this.addAll();if(skipStack.length<=1){$("#previousButton").hide()}if(this.collection.length<5){$("#next_button").hide()}$("#progress_img").hide()},fetchRecords:function(){var e=this;this.collection.fetch({success:function(){e.resultArray.push.apply(e.resultArray,e.searchInArray(e.collection.models,searchText));if(e.resultArray.length!=limitofRecords&&e.collection.models.length==limitofRecords){e.fetchRecords();return}else if(e.resultArray.length==0&&e.collection.models.length==0&&skipStack.length>1){$("#next_button").hide();skipStack.pop();return}if(e.resultArray.length==0&&skipStack.length==1){if(searchText!=""){alert("No result found")}}var t=new App.Collections.siteFeedbacks;if(e.resultArray.length>0){t.set(e.resultArray);e.collection=t;e.$el.html("");e.render()}}})},filterResult:function(e){var t=e.get("PageUrl");if(!t){t=""}var i=t.split("/");var n=i[0];for(var s=1;s<i.length;s++){if(i[s].length!=32){n=n+"/"+i[s]}else{s=t.length}}if(n==url){return true}else{console.log(url);return false}},checkFilters:function(e){console.log(e);if(this.filterResult(e)){if(this.applyFilters=="0"){return true}else if(this.Resolved==e.get("Resolved")&&this.category==e.get("category")){if(this.urgent=="Normal"&&e.get("priority").length==0){return true}else if(this.urgent=="Urgent"&&e.get("priority").length>0){return true}else{return false}}else{return false}}else{return false}},searchInArray:function(e,t){var i=this;var n=[];var s;_.each(e,function(e){if(e.get("comment")!=null){skip++;if(!e.get("category")){e.set("category","Bug")}if(!e.get("priority")){e.set("priority",[])}if(e.get("comment").toLowerCase().indexOf(t.toLowerCase())>=0&&i.checkFilters(e)){if(n.length<limitofRecords){n.push(e)}else{enablenext=1;skip--}}else if(n.length>=limitofRecords){skip--}}});return n}})});$(function(){App.Views.siteFeedbackPageRow=Backbone.View.extend({template0:$("#template-siteReviewRowAdmin").html(),template1:$("#template-siteReviewRownoAdmin").html(),tagName:"tr",authorName:null,events:{"click #resolveButton":"resolve","click #commentButton":"comment"},comment:function(e){console.log(e.target.attributes[0].nodeValue);var t=new App.Collections.reportsComment;t.feedbackId=e.target.attributes[0].nodeValue;t.fetch({async:false});var i=new App.Views.addComment({collection:t,commentId:e.target.attributes[0].nodeValue});i.render();$("#debug").append(i.el)},resolve:function(e){console.log(e);e.preventDefault();this.model.on("sync",function(){location.reload()});this.model.save({Resolved:"1"},{success:function(){}})},initialize:function(){if($.cookie("Member.login")=="admin"){this.template=this.template0}else{this.template=this.template1}},render:function(){var e=this.model.toJSON();if(this.model.get("priority").length==0){e.urgent="Normal"}else{e.urgent="Urgent"}console.log(e);this.$el.html(_.template(this.template,e))}})});$(function(){App.Views.ReportsRow=Backbone.View.extend({tagName:"tr",admn:null,events:{"click .destroy":function(e){alert("deleting");this.model.destroy();e.preventDefault()},"click #open":function(e){if(this.model.get("views")==undefined){this.model.set("views",1);this.model.save()}else{this.model.set("views",this.model.get("views")+1);this.model.save()}},"click #commentButton":function(e){console.log(e);console.log(e.target.attributes[0].nodeValue);var t=new App.Collections.NationReportComments;t.NationReportId=e.target.attributes[0].nodeValue;t.fetch({async:false});console.log(t.toJSON());var i=new App.Views.NationReportCommentView({collection:t,NationReportId:e.target.attributes[0].nodeValue});i.render();$("#debug").append(i.el)}},vars:{},template:_.template($("#template-ReportRow").html()),initialize:function(e){this.model.on("destroy",this.remove,this)},render:function(){var e=this.model.toJSON();if(e.views==undefined){e.views=0}e.isManager=this.isManager;var t=new Date(e.Date);e.Date=t.toUTCString();this.$el.append(this.template(e))}})});$(function(){App.Views.Publication=Backbone.View.extend({template:$("#template-Publication").html(),render:function(){this.$el.html(_.template(this.template))}})});$(function(){App.Views.PublicationTable=Backbone.View.extend({tagName:"table",isManager:null,className:"table table-striped",initialize:function(){},addOne:function(e){var t=new App.Views.PublicationRow({model:e});t.render();this.$el.append(t.el)},addAll:function(){this.$el.append('<tr><th>Date Issue</th><th>Issue No.</th><th>Editor Name</th><th>Editor Email</th><th>Editor Phone</th><th colspan="2">Actions</th></tr>');this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}})});$(function(){App.Views.PublicationRow=Backbone.View.extend({tagName:"tr",admn:null,events:{"click .destroy":function(e){alert("deleting");this.model.destroy();e.preventDefault()},"click #a":function(e){alert(e)}},vars:{},template:_.template($("#template-PublicationRow").html()),initialize:function(e){this.model.on("destroy",this.remove,this)},render:function(){var e=this.model.toJSON();e.isManager=this.isManager;var t=new Date(e.Date);e.Date=t.toUTCString();this.$el.append(this.template(e))}})});$(function(){App.Views.ReportsTable=Backbone.View.extend({tagName:"table",isManager:null,className:"table table-striped",initialize:function(){},addOne:function(e){var t=new App.Views.ReportsRow({model:e});t.isManager=this.isManager;t.render();this.$el.append(t.el)},addAll:function(){this.$el.append('<tr><th>Time</th><th>Request</th><th>Author</th><th>Views</th><th colspan="5">Actions</th></tr>');this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}})});$(function(){App.Views.ReportForm=Backbone.View.extend({className:"form",hide:false,events:{"click .save":"saveForm","click #cancel":function(){window.history.back()}},template:_.template($("#template-form-file").html()),render:function(){var e={};if(_.has(this.model,"id")){e.header='Title "'+this.model.get("title")+'"';e.hidesave=true}else{e.header="New Nation Report";e.hidesave=false}this.form=new Backbone.Form({model:this.model});this.form.render();if(this.edit==false){alert("here")}var t=this;if(_.has(this.model,"id")){}e.form="";console.log(e);this.$el.html(this.template(e));$(".fields").html(this.form.el);$("#progressImage").hide();return this},saveForm:function(){var e=true;var t=this.model.get("title");var i;var n=this.model.get("_id");console.log(n);this.form.commit();i=this.model.get("title");var s=this;var a=false;if(this.model.get("title").length==0){alert("Resource Title is missing")}else if(this.model.get("Tag")=="News"&&!this.model.get("author")){alert("Please Specify Author For This News Resource")}else{$("#gressImage").show();this.model.set(" uploadDate",(new Date).getTime());if(this.model.get("Level")=="All"){this.model.set("toLevel",0);this.model.set("fromLevel",0)}else{if(parseInt(this.model.get("fromLevel"))>parseInt(this.model.get("toLevel"))){alert("Invalid range specified ");e=false}}if(n==undefined){var s=this;var o=new App.Collections.Reports;o.fetch({async:false});o.each(function(t){if(s.model.get("title")==t.get("title")){alert("Title already exist");e=false}})}if(e){if(n==undefined){this.model.set("sum",0)}else{this.model.set("title",t)}this.model.save(null,{success:function(){s.model.unset("_attachments");if($('input[type="file"]').val()){if(n!=undefined){if(t!=i){var e=false;var a=new App.Collections.Resources;a.fetch({async:false});a.each(function(t){if(i==t.get("title")){e=true}});if(!e){var o=new App.Models.Resource;o.set("title",i);o.set("description",s.model.get("description"));o.set("articleDate",s.model.get("articleDate"));o.set("addedBy",s.model.get("addedBy"));o.set("openWith",s.model.get("openWith"));o.set("subject",s.model.get("subject"));o.set("Level",s.model.get("Level"));o.set("fromLevel",s.model.get("fromLevel"));o.set("toLevel",s.model.get("toLevel"));o.set("Tag",s.model.get("Tag"));o.set("author",s.model.get("author"));o.set("openWhichFile",s.model.get("openWhichFile"));o.set("uploadDate",s.model.get("uploadDate"));o.set("openUrl",s.model.get("openUrl"));o.set("averageRating",s.model.get("averageRating"));o.set("sum",0);o.set("timesRated",0);o.save();console.log("MODEL UPDATION");o.on("sync",function(){o.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev");o.on("savedAttachment",function(){alert("Resource Updated Successfully");Backbone.history.navigate("#resources",{trigger:true});s.trigger("processed");$("#progressImage").hide()},o)})}else{alert("Resource title Already exist")}}else{alert("Cannot update model due to identical title")}}else{s.model.saveAttachment("form#fileAttachment","form#fileAttachment #_attachments","form#fileAttachment .rev")}}else{s.model.trigger("processed")}s.model.on("savedAttachment",function(){this.trigger("processed");$("#progressImage").hide()},s.model)}})}}},statusLoading:function(){alert("asdf");this.$el.children(".status").html('<div style="display:none" class="progress progress-striped active"> <div class="bar" style="width: 100%;"></div></div>')}})});$(function(){App.Views.PublicationResourceTable=Backbone.View.extend({tagName:"table",isManager:null,className:"table table-striped",initialize:function(){},addOne:function(e){var t=new App.Views.PublicationResourceRow({model:e});t.Id=this.Id;t.render();this.$el.append(t.el)},addAll:function(){this.$el.append('<tr><th>Resource Title</th><th colspan="2">Actions</th></tr>');if(this.collection.length==0)this.$el.append('<tr><td colspan="2"> No Resource in this publication <td></tr>');this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}})});$(function(){App.Views.PublicationResourceRow=Backbone.View.extend({tagName:"tr",admn:null,events:{"click .destroy":function(e){var t=new App.Models.Publication({_id:this.Id});t.fetch({async:false});var i=t.get("resources");var n=i.indexOf(this.model.get("_id"));if(n>-1){i.splice(n,1)}this.$el.hide();t.set({resources:i});t.save()}},vars:{},template:_.template($("#template-ResourceRow").html()),initialize:function(e){this.model.on("destroy",this.remove,this)},render:function(){var e=this.model.toJSON();this.$el.append(this.template(e))}})});$(function(){App.Views.PublicationForm=Backbone.View.extend({className:"form",events:{"click .save":"saveForm","click #AddResPublication":"searchres","click #AddCoursePublication":"listCourses","click #cancel":function(){window.location.href="#publication"}},template:_.template($("#template-form-file").html()),render:function(){var e={};if(_.has(this.model,"id")){e.header='Publication Issue : "'+this.model.get("IssueNo")+'"'}else{e.header="New Publication Issue"}this.form=new Backbone.Form({model:this.model});e.form="";e.rlength=this.rlength;this.form.render();this.$el.html(this.template(e));$(".fields").html(this.form.el);$(".form .field-resources").hide();$("#progressImage").hide();return this},saveForm:function(){var e=this.model.get("_id");var t=true;this.form.commit();if(this.model.get("IssueNo")==undefined){alert("Publication Issue is missing")}else{if(e==undefined){var i=this;var n=new App.Collections.Publication;n.fetch({async:false});n.each(function(e){if(i.model.get("IssueNo")==e.get("IssueNo")){alert("IssueNo already exist");t=false}})}if(t){this.form.commit();this.model.save(null,{success:function(e){alert("Issue Saved!");window.location.href="#publicationdetail/"+e.toJSON().id}})}}},searchres:function(){var e=true;var t=this.model.get("_id");this.form.commit();if(this.model.get("IssueNo")==undefined){alert("Publication Issue is missing");e=false}else{if(t==undefined){var i=this;var n=new App.Collections.Publication;n.issue=this.model.get("IssueNo");n.fetch({async:false});n=n.first();if(n!=undefined)if(n.toJSON().IssueNo!=undefined){alert("IssueNo already exist");e=false}}}if(e){this.model.save(null,{success:function(e){window.location.href="../MyApp/index.html#search-bell/"+e.toJSON().id}})}},listCourses:function(){var e=true;var t=new Array;var i=this.model.get("_id");this.form.commit();this.model.set({courses:t});if(this.model.get("IssueNo")==undefined){alert("Publication Issue is missing");e=false}else{if(i==undefined){var n=this;var s=new App.Collections.Publication;s.issue=this.model.get("IssueNo");s.fetch({async:false});s=s.first();if(s!=undefined)if(s.toJSON().IssueNo!=undefined){alert("IssueNo already exist");e=false}}}if(e){this.model.save(null,{success:function(e){window.location.href="#courses/"+e.toJSON().id}})}},statusLoading:function(){this.$el.children(".status").html('<div style="display:none" class="progress progress-striped active"> <div class="bar" style="width: 100%;"></div></div>')}})});$(function(){App.Views.RequestsTable=Backbone.View.extend({tagName:"table",className:"table table-striped",initialize:function(){},addOne:function(e){var t=new App.Views.RequestRow({model:e});t.render();this.$el.append(t.el)},addAll:function(){this.$el.append("<tr><th>Location</th><th>Request-Type</th><th>Request</th><th>From</th><th>Date(MM/DD/YY)</th><th>Response</th></tr>");this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}})});$(function(){App.Views.RequestRow=Backbone.View.extend({tagName:"tr",template:_.template($("#template-RequestRow").html()),initialize:function(e){this.model.on("destroy",this.remove,this)},render:function(){var e=this.model.toJSON();var t=new App.Models.Member({_id:e.senderId});t.fetch({async:false});e.login=t.toJSON().login;if(e.date==undefined){e.date="Not available"}if(e.sendFromName==undefined){e.sendFromName="Not available"}e.from="";this.$el.append(this.template(e))}})});$(function(){App.Views.NationReportCommentView=Backbone.View.extend({tagName:"div",id:"comment-feedback",cId:null,initialize:function(e){console.log(e);this.cId=e.NationReportId;this.model=new App.Models.NationReportComment},events:{"click #submitFormButton":"submit","click #cancelFormButton":"cancel"},cancel:function(){$("#debug").hide();this.remove()},submit:function(){if(this.form.getValue("comment").length!=0){var e=new Date;e.getDate();this.form.setValue({NationReportId:this.cId});this.form.setValue({commentNumber:this.collection.length+1});this.form.setValue({memberLogin:$.cookie("Member.login")});this.form.setValue({time:e.toString()});this.form.commit();this.model.save();this.form.setValue({comment:""});this.collection.fetch({async:false});this.model.set({comment:""});this.render()}},addOne:function(e){$("#comments").append("<div id=tile><b>Login:</b>"+e.toJSON().memberLogin+"<br/><b>Time:</b>"+e.toJSON().time+"<br/><b>Comment:</b>"+e.toJSON().comment+"</div>");console.log(e.toJSON())},render:function(){$("#debug").show();this.$el.html("&nbsp;");$("#comments").html("&nbsp;");this.collection.forEach(this.addOne,this);this.form=new Backbone.Form({model:this.model});this.$el.append(this.form.render().el);this.form.fields["NationReportId"].$el.hide();this.form.fields["commentNumber"].$el.hide();this.form.fields["memberLogin"].$el.hide();this.form.fields["time"].$el.hide();var e=$('<div id="r-formButton"><button class="btn btn-primary" id="submitFormButton">Add Comment</button><button class="btn btn-info" id="cancelFormButton">Close</button></div>');
this.$el.append(e)}})});$(function(){App.Views.listCommunityView=Backbone.View.extend({id:"invitationForm",events:{"click #cancelButton":"hidediv","click #formButton":"syncData"},hidediv:function(){$("#invitationdiv").fadeOut(1e3);setTimeout(function(){$("#invitationdiv").hide()},1e3)},render:function(){var e=$('<h6>Select Community(\'ies)</h6><select multiple id="comselect"></select><br><br><a class="btn btn-success" id="formButton">Send</button>');this.$el.append(e);this.$el.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");this.$el.append('<a class="btn btn-warning" id="cancelButton">Cancel</button>')},syncData:function(){var e=$("#comselect").val();if(!e){alert("Please select Community first");return}App.startActivityIndicator();var t=new Array;if(e.length>0){for(var i=0;i<e.length;i++){var n=e[i];var s=$("#comselect option[value='"+e[i]+"']").text();t.push({communityUrl:n,communityName:s,publicationId:this.pId,Viewed:false})}$.couch.db("publicationdistribution").bulkSave({docs:t},{success:function(e){console.log(e)},error:function(e){console.log(e)}})}$("#list option[value='2']").text();$("#invitationdiv").fadeOut(1e3);setTimeout(function(){$("#invitationdiv").hide()},1e3);App.stopActivityIndicator()},synchResCommunityWithURL:function(e,t,i){console.log("http://"+t+":"+App.password+"@"+e+":5984/pubresources");$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"resources",target:"http://"+t+":"+App.password+"@"+e+":5984/pubresources",doc_ids:i}),success:function(e){console.log(e)},async:false})},synchPubCommunityWithURL:function(e,t,i){console.log("http://"+t+":"+App.password+"@"+e+":5984/recpublication");$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"publications",target:"http://"+t+":"+App.password+"@"+e+":5984/recpublication",doc_ids:i}),success:function(e){console.log(e)},async:false})}})});$(function(){App.Views.GroupView=Backbone.View.extend({tagName:"table",className:"table table-striped",roles:null,events:{"click #admissionButton":function(e){alert("asdfasdf")}},render:function(){console.log(this.model);this.addCourseDetails()},addCourseDetails:function(){var e=this;var t=this.model.toJSON();var i=this.courseLeader.toJSON();console.log(t);console.log(i);this.$el.append("<tr><td><b>Name</b></td><td>"+t.CourseTitle+"</td></tr>");this.$el.append("<tr><td><b>Subject Level </b></td><td>"+t.subjectLevel+"</td></tr>");this.$el.append("<tr><td><b>Grade Level </b></td><td>"+t.gradeLevel+"</td></tr>");this.$el.append("<tr><td><b>Description</b></td><td>"+t.description+"</td></tr>");this.$el.append("<tr><td><b>LeaderName </b></td><td>"+i.firstName+" "+i.lastName+"</td></tr>");this.$el.append("<tr><td><b>Leader Email </b></td><td>"+t.leaderEmail+"</td></tr>");this.$el.append("<tr><td><b>Leader Phone Number </b></td><td>"+t.leaderPhone+"</td></tr>");this.$el.append("<tr><td><b>schedule</b></td><td>Date :  "+t.startDate+"-"+t.endDate+"<br>Time :  "+t.startTime+"- "+t.endTime+"</td></tr>");this.$el.append("<tr><td><b>Location </b></td><td>"+t.location+"</td></tr>");$(document).on("Notification:submitButtonClicked",function(t){var i=new Date;var n=new App.Models.Mail;n.set("senderId",$.cookie("Member._id"));n.set("receiverId",e.model.get("courseLeader"));n.set("subject","Course Admission Request | "+e.model.get("name"));n.set("body",'Admission request received from user "'+$.cookie("Member.login")+'" in '+e.model.get("name")+' <br/><br/><button class="btn btn-primary" id="invite-accept" value="'+e.model.get("_id")+'" >Accept</button>&nbsp;&nbsp;<button class="btn btn-danger" id="invite-reject" value="'+e.model.get("id")+'" >Reject</button>');n.set("status","0");n.set("type","admissionRequest");n.set("sentDate",i);n.save();alert("Admission request successfully sent to this course leader.")})}})});$(function(){App.Views.GroupsTable=Backbone.View.extend({tagName:"table",className:"table table-striped",roles:null,addOne:function(e){var t=new App.Views.GroupRow({model:e,roles:this.roles});t.publicationId=this.publicationId;t.render();this.$el.append(t.el)},addAll:function(){this.$el.html("<tr><th>Title</th><th colspan='0'>Actions</th></tr>");var e=new App.Models.Member({_id:$.cookie("Member._id")});e.fetch({async:false});this.roles=e.get("roles");this.collection.each(this.addOne,this)},render:function(){this.addAll()}})});$(function(){App.Views.GroupRow=Backbone.View.extend({tagName:"tr",roles:null,events:{"click .addtoPublication":"addtoPublication","click .browse":function(e){}},template:$("#template-GroupRow").html(),initialize:function(e){this.roles=e.roles},render:function(){var e=this.model.toJSON();if(e._id=="_design/bell")return;this.$el.append(_.template(this.template,e))},addtoPublication:function(e){var t=e.currentTarget.name;var i=new App.Models.Publication({_id:this.publicationId});i.fetch({success:function(e){courses=e.get("courses");if(courses==undefined){courses=[]}for(var i in courses){if(courses[i]["courseID"]===t){alert("This Course Already Exists In This Publication");return}}var n={};n["courseID"]=t;n["stepIDs"]=[];var s=new App.Collections.CourseLevels;s.groupId=t;s.fetch({success:function(t,i){s.each(function(e){var t={stepID:e.get("_id")};t["resourceIDs"]=e.get("resourceId").length>0?e.get("resourceId"):[];n["stepIDs"].push(t)});courses.push(n);e.set({courses:courses});e.save(null,{success:function(){alert("Added Successfully")}})},error:function(e){console.log(e);alert("Failed to add the course to the publication")}})}})}})});$(function(){App.Views.listSyncDbView=Backbone.View.extend({id:"invitationForm",events:{"click #cancelButton":"hidediv","click #formButton":"syncData","click #selectAll":"selectAll"},hidediv:function(){$("#invitationdiv").fadeOut(1e3);setTimeout(function(){$("#invitationdiv").hide()},1e3)},render:function(){var e=$('<h6>Select Item(\'s) To Sync</h6><br><br><input type="checkbox" value="Resources" name="syncData">Resources<br><input type="checkbox" value="ActivityReports" name="syncData">Log Activity Reports<br><input type="checkbox" value="Reports" name="syncData">Reports<br><input type="checkbox" value="Application" name="syncData" >Application<br><br><br>');this.$el.append(e);this.$el.append('<button class="btn btn-info" id="selectAll" style="width:110px">Select All</button><button style="margin-left:10px; width:110px" class="btn btn-success" id="formButton" style="width:110px">Send</button>');this.$el.append('<button class="btn btn-warning" id="cancelButton" style="width:110px;margin-left:10px">Cancel</button>')},selectAll:function(){if($("#selectAll").text()=="Select All"){$("input[name='syncData']").each(function(){$(this).prop("checked",true)});$("#selectAll").text("Unselect All")}else{$("input[name='syncData']").each(function(){$(this).prop("checked",false)});$("#selectAll").text("Select All")}},syncData:function(){var e=this;App.startActivityIndicator();$("input[name='syncData']").each(function(){if($(this).is(":checked")){if($(this).val()=="Resources"){e.ReplicateResource()}else if($(this).val()=="ActivityReports"){e.syncLogActivitiy()}else if($(this).val()=="Reports"){e.syncReports()}if($(this).val()=="Application"){e.checkAvailableUpdates()}}});$("#invitationdiv").fadeOut(1e3);setTimeout(function(){$("#invitationdiv").hide()},1e3);App.stopActivityIndicator()},ReplicateResource:function(){App.startActivityIndicator();var e=this;var t=$.url().attr("host").split(".");var i=$.url().attr("host");var n="";var s="";var a="";var o=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var l=new o;l.fetch({async:false});var r=l.first();var c=r.toJSON();a=c.rows[0].doc.type;n=c.rows[0].doc.nationUrl;s=c.rows[0].doc.nationName;App.$el.children(".body").html("Please Wait…");var d="";var p="";$.ajax({url:"http://"+s+":"+App.password+"@"+n+":5984/communities/_all_docs?include_docs=true",type:"GET",dataType:"jsonp",success:function(t){for(var i=0;i<t.rows.length;i++){var o=t.rows[i];var l=o.doc.url;var r=o.doc.name;p=d;d=d+"<br>Replicating to "+r+". Please wait…";App.$el.children(".body").html(d);e.synchCommunityWithURL(l,r);d=p;d=d+"<br>Replication to "+r+" is complete.";App.$el.children(".body").html(d)}if(a!="nation"){p=d;d=d+"<br>Replicating to "+r+". Please wait…";e.synchCommunityWithURL(n,s);d=p;d=d+"<br>Replication to "+r+" is complete.<br>Replication completed."}}});App.stopActivityIndicator()},synchCommunityWithURL:function(e,t){console.log("http://"+t+":"+App.password+"@"+e+":5984/resources");$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"resources",target:"http://"+t+":"+App.password+"@"+e+":5984/resources"}),success:function(e){},async:false})},syncReports:function(){App.startActivityIndicator();var e=new App.Collections.Configurations;e.fetch({success:function(e){var t=e.first();console.log(t);var i=t.get("nationName");var n=t.get("nationUrl");$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"communityreports",target:"http://"+i+":"+App.password+"@"+n+":5984/communityreports"}),success:function(e){App.stopActivityIndicator();alert("sync successfully ");Backbone.history.navigate("reports",{trigger:true})},error:function(e,t,i){App.stopActivityIndicator();alert("Status: "+t);alert("Error: "+i);Backbone.history.navigate("reports",{trigger:true})},async:false})}})},syncLogActivitiy:function(){var e=new App.Collections.Configurations;e.fetch({success:function(e){var t=e.first();console.log(t);var i=t.get("nationName");var n=t.get("nationUrl");$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"activitylog",target:"http://"+i+":"+App.password+"@"+n+"/activitylog"}),success:function(e){alert("Successfully Replicated Reports")},error:function(e,t,i){alert("Error (Try Later)")},async:false})}})},versionCompare:function(e,t,i){var n=i&&i.lexicographical;zeroExtend=i&&i.zeroExtend;v1parts=e.split(".");v2parts=t.split(".");function s(e){return(n?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}if(!v1parts.every(s)||!v2parts.every(s)){return NaN}if(zeroExtend){while(v1parts.length<v2parts.length)v1parts.push("0");while(v2parts.length<v1parts.length)v2parts.push("0")}if(!n){v1parts=v1parts.map(Number);v2parts=v2parts.map(Number)}for(var a=0;a<v1parts.length;++a){if(v2parts.length==a){return 1}if(v1parts[a]==v2parts[a]){continue}else if(v1parts[a]>v2parts[a]){return 1}else{return-1}}if(v1parts.length!=v2parts.length){return-1}return 0},checkAvailableUpdates:function(){var e=this;var t;var i=new App.Collections.Configurations;i.fetch({success:function(e){t=e.first()},async:false});var n=t.get("nationName");var s=t.get("nationUrl");var a="http://"+n+":oleoleole@"+s+":5984/configurations/_all_docs?include_docs=true";$.ajax({url:a,type:"GET",dataType:"jsonp",success:function(i){var n=i.rows[0].doc;nationConfigJson=n;if(typeof n.version==="undefined"){}else if(n.version==t.get("version")){}else{if(e.versionCompare(n.version,t.get("version"))<0){console.log("Nation is at low level")}else if(e.versionCompare(n.version,t.get("version"))>0){e.updateApp()}else{console.log("Nation is uptodate")}}}});return},updateApp:function(){var e=Backbone.Collection.extend({url:App.Server+"/configurations/_all_docs?include_docs=true"});var t=new e;t.fetch({async:false});var i=t.first().toJSON().rows[0].doc;i.version=this.latestVersion;var n=i.nationName;var s=i.nationUrl;$.ajax({headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},type:"POST",url:"/_replicate",dataType:"json",data:JSON.stringify({source:"http://"+n+":oleoleole@"+s+":5984/apps",target:"apps"}),success:function(e){console.log(e)},async:false});$.ajax({headers:{Accept:"application/json","Content-Type":"multipart/form-data"},type:"PUT",url:App.Server+"/configurations/"+i._id+"?rev="+i._rev,dataType:"json",data:JSON.stringify(i),success:function(e){console.log(e);alert("Successfully updated to latest version.")},async:false})}})});$(function(){App.Views.courseSeach=Backbone.View.extend({className:"form",events:{"click #seachCourse":"seachCourse","click #back":"publicationdetails"},publicationdetails:function(){window.location.href="#publicationdetail/"+this.publicationId},render:function(){var e=this;this.$el.append('<p><h3>Courses</h3><a id="back" class="btn btn-success"> Done </a><h6 style="margin-top:-52px;float:right"><input placeholder="Key Word" style="margin-right:20px;height:30px;width:170px" type="text" id="SeachCourseText" ><a  style="margin-top: -11px; width: 60px;" class="btn btn-info" id="seachCourse" > Search </a> </h6></p>');this.$el.append('<div id="courseList"></div>');var t=new App.Collections.Courses;t.fetch({success:function(t){var i=new App.Views.GroupsTable({collection:t});i.publicationId=e.publicationId;i.render();$("#courseList").html(i.el)}})},seachCourse:function(e){var t=this;var i=new App.Collections.Courses;if($("#SeachCourseText").val()!="")i.seachText='["'+$("#SeachCourseText").val()+'"]';i.fetch({success:function(e){var i=new App.Views.GroupsTable({collection:e});i.publicationId=t.publicationId;i.render();$("#courseList").html(i.el)}})}})});$(function(){App.Views.PublicationCoursesTable=Backbone.View.extend({tagName:"table",isManager:null,className:"table table-striped",initialize:function(){},addOne:function(e){var t=new App.Views.PublicationCourseRow({model:e});t.Id=this.Id;t.render();this.$el.append(t.el)},addAll:function(){this.$el.append('<tr><th>Course Title</th><th colspan="2">Actions</th></tr>');if(this.collection.length==0)this.$el.append('<tr><td colspan="2"> No Course in this publication <td></tr>');this.collection.forEach(this.addOne,this)},render:function(){this.addAll()}})});$(function(){App.Views.PublicationCourseRow=Backbone.View.extend({tagName:"tr",admn:null,events:{"click .destroy":function(e){var t=new App.Models.Publication({_id:this.Id});t.fetch({async:false});var i=t.get("courses");for(var n in i){if(i[n]["courseID"]===this.model.get("_id")){i.splice(n,1);break}}this.$el.hide();t.set({courses:i});t.save()}},vars:{},template:_.template($("#template-publication-CourseRow").html()),initialize:function(e){this.model.on("destroy",this.remove,this)},render:function(){var e=this.model.toJSON();this.$el.append(this.template(e))}})});$(function(){App.Views.Configurations=Backbone.View.extend({initialize:function(){this.$el.html("<h3>Set Configurations<h3>")},events:{"click #formButton":"setForm"},render:function(){this.form=new Backbone.Form({model:this.model});this.$el.append(this.form.render().el);this.$el.append('<a style="margin-left:31px" class="btn btn-success" id="formButton">Submit Configurations </a>')},setForm:function(){this.form.commit();if(this.form.validate()!=null){return}var e=this.form.model;var t=new App.Collections.Configurations;t.fetch({async:false});var i=t.first();i.set("name",e.get("name"));i.set("nationName",e.get("nationName"));i.set("nationUrl",e.get("nationUrl"));i.set("code",e.get("code"));i.set("type",e.get("type"));i.set("notes",e.get("notes"));i.set("version",e.get("version"));if(e.get("selectLanguage")!="Select an Option"){i.set("currentLanguage",e.get("selectLanguage"))}i.save(null,{success:function(e,t){App.configuration=i;console.log(App.configuration.get("name"));alert("Configurations are Successfully Added");Backbone.history.navigate("dashboard",{trigger:true})}})}})});